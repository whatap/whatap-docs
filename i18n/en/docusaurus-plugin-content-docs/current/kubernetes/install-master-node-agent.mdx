---
id: install-master-node-agent
title: Installation of the master and node agents
description: Follow the installation guide to install the master and node agents.
tags:
  - Kubernetes
  - Kubernetes Monitoring
  - Agent
  - Master
  - Node
  - Agent Installation
hide_table_of_contents: true
toc_max_heading_level: 2
---


import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

The following guides you to the master and node agent installation procedure as follows: This procedure is the same as in **Install guide**.

:::note 

EKS Fargate is to be supported later. 

:::

## Pre-environment checking and setting

Depending on the Kubernetes environment, pre-environment configuration may be required. If this does not apply to the Istio, GKE, and OpenShift environments, skip to [Next step](#create-kubernetes-agent).

<Tabs>

<TabItem value='istio' label='Istio Environment' default>

In the Istio environment, execute the following command to create the ServiceEntry, the resource that communicates with the WhaTap collection server.

```bash title='SH'
kubectl create namespace whatap-monitoring
kubectl label namespace whatap-monitoring istio-injection=enabled
kubectl apply -f - <<EOF
apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: whatap-external
spec:
  hosts:
  - whatap-proxy1
  - whatap-proxy2
  addresses:
  - 13.124.11.223
  - 13.209.172.35
  ports:
  - name: proxy
    number: 6600
    protocol: tcp
    location: MESH_EXTERNAL
EOF
```

</TabItem>

<TabItem value='gke' label='GKE Environment'>

In case of Google Kubernetes Engine (GKE), create a user cluster and then execute the following command to set roles.

```bash
ACCOUNT=$(gcloud info --format='value(config.account)')
kubectl create clusterrolebinding owner-cluster-admin-binding \
  --clusterrole cluster-admin \
  --user $ACCOUNT
```

:::note

For more information about installation with the gcloud commands, see [Google Cloud Document](https://cloud.google.com/sdk/docs/install)

:::

</TabItem>

<TabItem value='openshift' label='OpenShift Environment'>

![OpenShift](/img/kube-install-openshift.png)

On the ***Installation guide*** screen, open the ***Additional setting in case of the OpenShift environment*** section and then select ***whatap_openshift_scc.yaml***. After downloading the file, execute the following command.

```bash
oc create -f whatap_openshift_scc.yaml
```

</TabItem>

</Tabs>

## Creating the Kubernetes agent

Download the *YAML* file that is suitable for your Kubernetes version and container runtime, and then create an agent.

1.  Check the **VERSION** and **CONTAINER-RUNTIME** by executing the following command:

    ```bash
    kubectl get node -o wide
    ```

    ![](/img/k8s-check-version.svg)

2.  On the ***Agent Installation*** screen, select the *YAML* file that matches the **VERSION** and **CONTAINER-RUNTIME** and then click ***Download***.

    <ImgLang img='k8s-download-yaml.png' desc='yaml download' />

3.  Upload the downloaded *YAML* file to the master node.

4.  Execute the following command to create an agent. 

    ```bash
    # {whatap_kube_X.YZ.yaml} filename to match the downloaded filename.
    kubectl apply -f {whatap_kube_X.YZ.yaml}
    ```

5.  Check that the agent has been created successfully as follows:

    ![Agent creation check](/img/k8s-install-agent-check.svg)

:::note

**Using the master agent resources can be affected by the increase in the container count**. Out of memory (OOM) may occur if the resources are used beyond the default memory limit (350 MB). You can change the settings through the *YAML* file.

:::

## Checking the Kubernetes agent installation

If the Kubernetes agent installation has been completed, you can check the status of the master agent and node agent by executing the following command:

```bash
kubectl get pod -n whatap-monitoring
```

#### In case the status is Running

If **STATUS** is in **Running**, it indicates the installation has been finished as follows. After installing the master and node agents, start monitoring the resources in your Kubernetes environment. Go to [Whatap Monitoring Service](https://service.whatap.io) and then check the performance data collection in ***Project List*** and ***Dashboard*** > ***Container Map***. 

![](/img/k8s-check-running-agent-monitoring.svg)

#### In case the status is not Running

If the **STATUS** is not **Running**, it indicates that the installation has not been completed successfully as follows. 

![](/img/k8s-not-running-agent-monitoring.svg)

1.  Execute the following command on the master node to determine the cause of the Pod creation failure. 

    ```bash
    kubectl describe pod {POD_NAME} -n whatap-monitoring
    ```

2.  Check the **Events:** item at the bottom of the execution result.

    ![](/img/k8s-check-install-fail.svg)

:::tip

When using the `kubectl` command, the `-n {namespace}` option performs the task for specific namespaces. Because the WhaTap agent is installed in the namespace named `whatap-monitoring` by default, add the `-n whatap-monitoring` option.

:::

:::note

-   To proceed with the application agent installation, select ***Application Agent Installation*** at the lower right of the screen. For more information, see [the following](install-application-agent).
-   To update the agent to the latest version, see [the following](agent-update).

:::