---
id: install-agent
title: Agent Installation
description: The following explains how to install an agent on the application server in the Go environment.
tags:
  - Go
  - Agent Installation
---

An agent must be installed on the same server to forward data from the monitored application server through TCP communication and to transfer the data to the WhaTap collection server. The agent can be installed using the package.

:::note

The agent works as the default **127.0.0.1:6600** TCP server. It receives data from the Go application and forwards the data to the WhaTap collection server via the outbound 6600 port.

:::

1.  Install the WhaTap repository.

2.  Install the whatap-agent Linux package (yum, apt-get).

3.  Run the whatap-agent service.

![Go Monitoring](/img/golang_system.png)

To use the WhaTap monitoring service, after [Sign up](https://www.whatap.io/ko/signup/), create a project and then install the agent to the target server.

{@include: ../getting-started/_create-project-v2.mdx} 

{@include: ../getting-started/_accesskey-v2.mdx} 

## Download agent

Once you have received the **access key**, download the agent with the following command.

<Tabs groupId="golang">
<TabItem value="redhat-centos" label="Red Hat/CentOS">

```bash title='SH'
## Register the package repository
$ sudo rpm -Uvh https://repo.whatap.io/centos/5/noarch/whatap-repo-1.0-1.noarch.rpm

## Install the package
$ sudo yum install whatap-agent
```

</TabItem>
<TabItem value="debian-ubuntu" label="Debian/Ubuntu">

```bash title='SH'
## Register the package repository
$ wget https://repo.whatap.io/debian/release.gpg -O -|sudo apt-key add -
$ wget https://repo.whatap.io/debian/whatap-repo_1.0_all.deb
$ sudo dpkg -i whatap-repo_1.0_all.deb
$ sudo apt-get update

## Install the package
$ sudo apt-get install whatap-agent
```

</TabItem>
<TabItem value="amazonlinux" label="Amazon Linux">

```bash title='SH'
## Register the package repository
$ sudo rpm --import https://repo.whatap.io/centos/release.gpg
$ echo "[whatap]" | sudo tee /etc/yum.repos.d/whatap.repo > /dev/null
$ echo "name=whatap packages for enterprise linux" | sudo tee -a /etc/yum.repos.d/whatap.repo > /dev/null
$ echo "baseurl=https://repo.whatap.io/centos/latest/\$basearch" | sudo tee -a /etc/yum.repos.d/whatap.repo > /dev/null
$ echo "enabled=1" | sudo tee -a /etc/yum.repos.d/whatap.repo > /dev/null
$ echo "gpgcheck=0" | sudo tee -a /etc/yum.repos.d/whatap.repo > /dev/null

## Install the package
$ sudo yum install whatap-agent
```

</TabItem>
<TabItem value="alpinelinux" label="Alpine Linux">

[whatap-agent.tar.gz]After downloading the file (https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz), unzip the file based on the "/" directory. Create the monitoring file in the _/usr/whatap/agent_ path.

```bash title='SH'
$ wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz
$ tar -xvzf whatap-agent.tar.gz -C /
```

</TabItem>
<TabItem value="al-docker" label="Alpine Linux Docker">

[whatap-agent.tar.gz]After downloading the file (https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz), unzip the file in the _/usr/whatap/agent_ path.

```bash title='SH'
FROM alpine

RUN apk update && apk upgrade

# Install WhaTap Go monitoring agent
RUN wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz
RUN tar -xvzf whatap-agent.tar.gz -C /
```

</TabItem>
</Tabs>

<details>
<summary>Agent configuration file</summary>

It consists of a tracer to collect the monitoring data, an agent to transmit the collected data to the server, and an installation script file to dynamically apply the tracer and agent to the server.

-   _whatap-agent_: This program transmits the data passed from the agent and tracer to UDP, to the collection server.

-   _/etc/init.d/whatap-agent_: Service script file.

-   _whatap_agent_: Service execution file.

-   _whatap.conf_: Enter the configuration data, collection server IP, and access key in this file.

-   _whatap-boot-`yyyymmdd`.log_: Agent log file. (path: _/usr/whata/agent/log_)

</details>

## Agent setting{#set-agent}

### Default settings

Execute the following commands in order to set the **access key** and **collection server IP** in _whatap.conf_.

-   Create the _whatap.conf_ file in the path of the application startup script. 

-   If the `WHATAP_HOME` environment variable has not been set, the path of the application startup script is recognized as the one of the _whatap.conf_ file.

```bash title='SH'
# Creation of whatap.conf in the script running path
$ echo "license={Access Key}" >> ./whatap.conf
$ echo "whatap.server.host={Collection Server IP}" >> ./whatap.conf
$ echo "app_name={Application Name}" >> ./whatap.conf

# 애플리케이션 실행
./app
```

-   `license`: Enter the **access key**.

-   `whatap.server.host`: Enter the **collection server IP address**.

-   `app_name`: Enter the application name. Set the user as a string.

    :::note

    `app_name` is a component to determine the agent name. For more information, see [the following](agent-name).

    :::

### Setting the `WHATAP_HOME` variable

You can set the _whatap.conf_ path as the `WHATAP_HOME` variable. Create the `WHATAP_HOME` path first.

```bash
# Set the whatap.conf path after setting the WHATAP_HOME path.
mkdir ./whatap_home
echo "license={Access Key}" >> ./whatap_home/whatap.conf
echo "whatap.server.host={Collection Server IP}" >> ./whatap_home/whatap.conf
echo "app_name={Application Name}" >> ./whatap_home/whatap.conf

# Run the application.
WHATAP_HOME=./whatap_home ./app
```

### Setting the agent names for each process{#duplicate_appname}

If one _whatap.conf_ file is shared by the applications running in multiple processes, any changes may not be reflected. It is recommended to set a _whatap.conf_ for each process.

To avoid duplicate agent names, you can add a string to each agent name for identification. The value set with the `app_name` option is added to the beginning of the agent name.

You can avoid duplicate names of agents run with the same command and the same instance. 

```bash
# Set the whatap.conf path after setting the WHATAP_HOME path.
mkdir ./whatap_home
echo "license={Access Key}" >> ./whatap_home/whatap.conf
echo "whatap.server.host={Collection Server IP}" >> ./whatap_home/whatap.conf
echo "app_name={Application Name-1}" >> ./whatap_home/whatap.conf

# Run the application.
WHATAP_HOME=./whatap_home ./app 

# Set the whatap.conf path after setting the WHATAP_HOME path.
mkdir ./whatap_home1
echo "license={Access Key}" >> ./whatap_home1/whatap.conf
echo "whatap.server.host={Collection Server IP}" >> ./whatap_home1/whatap.conf
echo "app_name={Application Name-2}" >> ./whatap_home1/whatap.conf

# Run the application
WHATAP_HOME=./whatap_home1 ./app

```

## Configuring the Go library

Add the [github.com/whatap/go-api](https://github.com/whatap/go-api) package to the Go application source code.

```bash
go get github.com/whatap/go-api
```

Configure for initialization and shutdown with the `trace.Init()` and `trace.Shutdown()` functions. Set the startup and end for transactions with the `trace.Start()` and `trace.End()` functions.

```go title='Go'
import "github.com/whatap/go-api/trace"

func main(){
    trace.Init(nil)
    //It must be executed before closing the app.    
    defer trace.Shutdown()    

    ctx, _ := trace.Start(context.Bacground(), "Start Tx")

    ...

    trace.End(ctx, err)
}
```

:::note

For more information about the library configuration, see [the following](api-guide).

:::

## Starting the monitoring

<Tabs groupId="golang">
<TabItem value="redhat-centos" label="Red Hat/CentOS">

Once the application server has been restarted, the agent starts collecting data.

</TabItem>
<TabItem value="debian-ubuntu" label="Debian/Ubuntu">

Once the application server has been restarted, the agent starts collecting data.

</TabItem>
<TabItem value="amazonlinux" label="Amazon Linux">

1.  Execute the following command to install the WhaTap agent daemon.

    ```bash
    /usr/whatap/php/whatap-agent start
    ```

2.  Execute the following command to check whether the WhaTap service has been run normally.

    ```bash
    ps -elf | grep whatap_agent_static
    ```

Once the application server has been restarted, the agent starts collecting data.

</TabItem>
</Tabs>
