**Multi-transaction** means the transaction involving a different agent or project. **Multiple Transaction Trace** is to trace calls between the application services registered in the WhaTap project. 

<InDoc product="java">

:::info

The Java agent traces multi-transactions with three HTTP header keys (`x-wtap-po`, `x-wtap-mst`, and `x-wtap-sp1`). If HTTP transactions passing through the gateway cannot be traced, check the HTTP header conditions.

:::

</InDoc>

:::note

**Enabling the multi-transaction**

To trace multi-transactions, set the `mtrace_enabled` option to `true` in <Cmdname sid="management" className="uitext" /> &gt; <Cmdname sid="agent_configuration" className="uitext" />. For more information about the agent configuration, see [the following](set-agent#set-agent-service).

:::

## Checking the multi-transaction ID

To use the <Cmdname sid="multi_server_transaction_trace" className="uitext" /> menu, <b>MTID</b> (Multi Transaction ID) is required. Through the following procedure, you can find the <b>MTID</b> value.

1. In <Cmdname sid="analysis" className="uitext" /> &gt; <Cmdname sid="AA005" className="uitext" />, drag the chart area.

2. The transaction information in the dragged chart area is displayed in the <Cmdname sid="trace_list" className="uitext" /> list below as follows.

   <ImgLang img='tx-trace-table.png' desc='mtrace_M' />

3. If you select the trace with the ![Icon](/img/ic-s-mult-transation.svg) icon displayed, the <Cmdname sid="TTL06527" className="uitext" /> window appears. 

4. In the <Cmdname sid="TTL06125" className="uitext" /> tab, you can see the <Cmdname sid="TTL06107" className="uitext" /> value.

   <ImgLang img='tx-trace-dt-up.png' desc='Record summary' />

:::note

- The same <Cmdname sid="TTL06107" className="uitext" /> is generated even if the transaction makes an external call. Even if projects are separated by service, all transactions between applications can be found through the initially issued <Cmdname sid="TTL06107" className="uitext" />. For more information about the detailed analysis of transaction trace through the <Cmdname sid="TTL06527" className="uitext" /> window, see [the following](trs-profile#transaction-info).

- If you select <Cmdname sid="TTL06107" className="uitext" /> in the <Cmdname sid="TTL06527" className="uitext" /> window, the <Cmdname sid="TTL06377" className="uitext" /> tab appears. The transactions and trace data are provided so that you can see various call relationships at a glance within or between systems, and identify where problems occurred for improvement.

:::

## Using the multi-transaction tracing feature

1. Go to <Cmdname sid="analysis" className="uitext" /> > <Cmdname sid="multi_server_transaction_trace" className="uitext" />.

2. Enter the <b>MTID</b> value found in the <Cmdname sid="TTL06527" className="uitext" /> window into the <Cmdname sid="search_mtid_or_custid" className="uitext" /> field.

3. Select the date and project you want to query.

4. Click the <Cmdname sid="apply" className="uitext" /> button at the bottom of the screen.

    * The <Cmdname sid="apply" className="uitext" /> button becomes disabled in the following cases:
        * When the same filter values (MTID/CUSTID, date, selected project) as the previous search are set.
        * When none of the filter values (MTID/CUSTID, date, selected project) are entered.

5. The right <Cmdname sid="BTN07120" className="uitext" /> tab displays a diagram and a table that allow you to understand the call relationships of each transaction.

    :::tip
    The diagram and table areas are divided vertically, and you can adjust their ratio manually.

    - Clicking the upward arrow makes the table occupy the entire area. However, if the diagram area was occupying the entire area, the diagram and table will split into equal halves.
    - Clicking the downward arrow makes the chart (diagram) area occupy the entire area. However, if the table area was occupying the entire area, the diagram and table will split into equal halves.
    
    :::

### <Cmdname sid="BTN07120" />

The <Cmdname sid="BTN07120" className="uitext" /> quickly and clearly provides users with the call relationship between transactions. The execution times for each individual transaction service with the same <Cmdname sid="TTL06107" className="uitext" /> can be viewed. You can check the call relationship between transactions by using the execution time displayed at the top of the transaction node (<LinkImage img="number-01.png" desc="number 1"/> <Cmdname sid="time_bar" className="uitext" />). In <Cmdname sid="BTN07120" className="uitext" />, you can use the mouse to go to a desired position or zoom in or out by scrolling.

![Chart](/img/trace-mtx-chart-timebar.png)

If you select a transaction node, an additional <Cmdname sid="TTL06527" className="uitext" /> window appears as follows. The transaction trace allows you to see the transaction details. For more information about the detailed analysis of transaction trace through the <Cmdname sid="TTL06527" className="uitext" /> window, see [the following](trs-profile#transaction-info).

- **_A_**<Cmdname sid="small" className="uitext" /> / **_A_**<Cmdname sid="big" className="uitext" />: The size of the font displayed on the node can be adjusted.

- <Cmdname sid="time_bar" className="uitext" />: You can display or hide the step times (<Cmdname sid="time_bar" className="uitext" />) for each node.

- <Cmdname sid="application_name" className="uitext" />: You can display or hide the agent names (oname) for each node.

- <Cmdname sid="project" className="uitext" />: You can display or hide the project names for each node.

- <Cmdname sid="database" className="uitext" /> / <Cmdname sid="apply_external_remote" className="uitext" /> / <Cmdname sid="apply_internal_remote" className="uitext" />: Connection requests for other databases or HTTP calls that occurred in the transaction can also be viewed through the nodes of the chart.

### <Cmdname sid="BTN07121" />

In the <Cmdname sid="BTN07121" className="uitext" /> tab, you can see information for each transaction included in a multi-transaction in the table format.

<ImgLang img='trace-mtx-table.png' desc='Table' />

If you select each transaction, the <Cmdname sid="TTL06527" className="uitext" /> window for the selected transaction appears, similar to selecting a node on the <Cmdname sid="BTN07120" className="uitext" /> tab. The transaction trace allows you to see the transaction details. For more information about the detailed analysis of transaction trace through the <Cmdname sid="TTL06527" className="uitext" /> window, see [the following](trs-profile#transaction-info).

![Column icon](/img/ic-column.svg) <Cmdname sid="BTN06441" className="uitext" />: You can edit the columns in the table. 

### <Cmdname sid="BTN06296" />

In the <Cmdname sid="BTN06296" className="uitext" /> tab, you can see each transaction and its trace details. The transactions within the overall transaction time or start times and step times of each trace to provide transaction call relationships in a tree format.

<ImgLang img='trace-mtx-tree.png' desc='Tree' />

- ![View one line icon](/img/ic-single-line.svg) <Cmdname sid="BTN06368" className="uitext" />: You can arrange the tree format at intervals by displaying the texts displayed in the execution data for each section in a single line.

- ![View multiple lines icon](/img/ic-multi-line.svg) <Cmdname sid="BTN06369" className="uitext" />: All the texts displayed in the execution data for each section, appear by wrapping words.

- <Cmdname sid="BTN06327" className="uitext" />: The longest route can appear.

- ![Chart icon](/img/ic-bar-chart.svg) <Cmdname sid="BTN06743" className="uitext" />: The elapsed times are displayed in a bar chart.

- ![Time icon](/img/ic-custom-time.svg) <Cmdname sid="BTN06744" className="uitext" />: The timestamps, gaps, and elapsed times for each segment are displayed in text.

  - 8 seconds or more: <span class='etrs'>Excessive delay</span> state is distinguished in <span class='etrs'>red</span>.

  - Between 3 and 8 seconds: <span class='ov5ud10'>Delay</span> state is distinguished in <span class='ov5ud10'>orange</span>.

  - Less than 3 seconds: <span class='woer'>Normal</span> state is distinguished in <span class='woer'>blue</span>.

  :::note

  In case of start and step times, the time differences caused by the transaction call environment are corrected on the screen through traces and mappings in the parent transactions. Accordingly, there may be differences from the actual time data.

  :::

- ![Hide icon](/img/ic-eye-invisible.svg) <Cmdname sid="BTN06745" className="uitext" />: The time is hidden.

:::note

If you select ![Statistics icon](/img/ic-static.svg) button or ![Pop-up icon](/img/ic-popup.svg) button, you can see the summary window such as <Cmdname sid="remote_http_call_statistics" className="uitext" /> and <Cmdname sid="activestack" className="uitext" />.

:::

:::tip

To search SQL variables and HTTP queries, add the following options to the agent settings.

- For agent settings related to recording SQL parameters, see [the following](agent-dbsql#profile-sql-param).

- For agent settings related to recording the HTTP parameters, see [the following](agent-transaction#profile_http_parameter).

```ini title='whatap.conf'
# SQL parameter lookup option: If the option is applied, SQL parameters are collected after being encrypted.
profile_sql_param_enabled=true 

// HTTP parameter lookup option: If the option is applied, HTTP query parameters are collected after being encrypted.
profile_http_parameter_enabled=true 
```

:::
