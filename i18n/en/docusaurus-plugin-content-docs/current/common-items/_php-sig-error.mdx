### Segmentation fault, Sig bus Error

If an error occurs after applying PHP monitoring, check the Apache or PHP-FPM error log.

Check whether the error log contains messages such as `segmentation fault` or `sig bus`.  
These errors often appear together with messages like `kill child process`, `exit child`, or `exit process`.

If these errors occur, it indicates a conflict with the PHP extension module *whatap.so*.  
Disable the PHP extension module *whatap.so* and restart Apache or PHP-FPM.

In an environment that does not affect the service, enable the `Core dump` configuration for Apache and PHP-FPM, then reload *whatap.so*.  
If an error occurs afterward, a *dump* file will be generated.  
Analyze the *dump* file using gdb to identify the cause.

---

#### Disable Module & Check Logs

Disable the module first and check the logs to identify the issue.

---

##### Windows

**Disable Test**
```cmd
REM Temporarily disable php_whatap.dll
ren "C:\PHP\conf.d\whatap.ini" "whatap.ini.disabled"

REM Restart web server
net stop Apache2.4 && net start Apache2.4
```

**Check error logs**

* **Apache**
```cmd
type "C:\Apache24\logs\error.log"
```

* **IIS**
```cmd
REM Check Event Viewer
eventvwr.msc
→ Windows Logs → Application
```

---

#### Core Dump Configuration

1. Grant permissions to the directory where the *dump* file will be stored:

```bash
chmod 0777 /home/httpd-core
```

2. Apply system settings:

```bash
ulimit -c unlimited
sysctl fs.suid_dumpable=2
sysctl kernel.core_uses_pid=0
sysctl kernel.core_pattern='| /home/httpd-core/core-%e.%p'
```

---

#### Apache

1. Add CoreDumpDirectory to Apache configuration:

```bash
vi /etc/httpd/conf/httpd.conf

CoreDumpDirectory /home/httpd-core
```

2. Restart Apache to apply the setting.

3. When an error occurs, a *dump* file is generated.  
   Analyze the file using gdb and use `bt full` to print the full stack trace:

```bash
# gdb /usr/sbin/httpd /home/httpd-core/core-httpd.31832
...

> bt full
```

---

#### PHP-FPM

1. Configure `rlimit_core` in the FPM configuration file:

```bash
rlimit_core = unlimited
```

2. Restart PHP-FPM.

3. When an error occurs, a *dump* file will be created.  
   Analyze it using gdb with `bt full`:

```bash
# gdb /usr/sbin/php-fpm /home/httpd-core/core-php-fpm.31832
...

> bt full
```
