---
id: agent-name
title: エージェント名の識別
description: モニタリング対象を区別するためのアプリケーションサーバーの固有の識別子設定について案内します。モニタリング対象システムの中からアプリケーションサーバーを正確に区別するために必須な設定です。サーバーのタイプ、IPなどの情報から自動的に名前を指定する方式と、ユーザーが直接whatap.confファイルやJVMオプションでエージェント名を設定する方法があります。
keywords:
  - Java
  - アプリケーション
  - エージェント
  - whatap.conf
---

import OkindNodename from "../common-items/_agent-name-okind-onode-desc.mdx";
import Apmnamedescription from "../common-items/_apm-name-description.mdx";

<Apmnamedescription />

import Agentnamewarning from "../common-items/_agent-name-warning.mdx";

<Agentnamewarning />

:::note

- WhaTapモニタリンサービスでは、モニタリング対象をオブジェクトまたはエージェントとして混在して使用できます。

:::

## デフォルト名の決定方法

JVMオプションで`whatap.oname`設定がない場合、エージェント名に次の優先順位で自動的に割り当てられます。

1. `whatap.type`を特定します。
2. `whatap.type`がサーブレットコンテナの場合、アプリケーションが使用するポートを識別します。
3. ポートを特定できない場合は、process ID(PID)を検索します。
4. 識別された情報にIPv4アドレスの3番目と4 番目を追加して、最終的に名前を決定します。

例えば、IPアドレスが10.11.**12**.**13**のサーバーで**Tomcat**が**8080**番ポートで起動した場合、`TC-12-13-8080`名でエージェント名が自動的に割り振られます。

## エージェント名の変数

使用可能な名前の変数を次のように指定します。

| 変数       | 説明                                                                                                                           |
| -------- | ---------------------------------------------------------------------------------------------------------------------------- |
| 文字列      | 入力した文字列を使用します。                                                                                                               |
| `{type}` | コンテナタイプを自動的に識別して割り当てます。<br/>自動識別の対象：JAVA、 TOMCAT、 JBOSS、 RESIN、 SPRINGBOOT、 JETTY、 JEUS、 WEBLOGIC、 WEBSPHERE、 UNDERTOW、 PLAY |
| `{ip0}`  | IPv4アドレスのうち、1番目の単位を使用します。(例：**10**.11.12.13のうち**10**)                                                                        |
| `{ip1}`  | IPv4アドレスのうち、2番目の単位を使用します。(例：10.**11**.12.13のうち**11**)                                                                        |
| `{ip2}`  | IPv4アドレスのうち、3番目の単位を使用します。(例：10.11.**12**.13のうち**12**)                                                                        |
| `{ip3}`  | IPv4アドレスのうち、4番目の単位を使用します。(例：10.11.12.**13**のうち**13**)                                                                        |
| `{pid}`  | JavaのProcess ID(PID)を使用します。                                                                                                  |
| `{port}` | アプリケーションがListenするポートを使用します。                                                                                                  |

## エージェント名の設定

起動スクリプトにJVMオプションを追加して、自動的に指定する名前の代わりに独自の名前を設定できます。

<div class="c4-name">

| オプション            | 設定位置        | 説明                                                                                                                 |
| ---------------- | ----------- | ------------------------------------------------------------------------------------------------------------------ |
| `-Dwhatap.name`  | JVM Options | エージェント名をパターンで設定します。<br/>既定値`{type}-{ip2}-{ip3}-{port}`                                                             |
| `-Dwhatap.oname` | JVM Options | エージェント名を固定値で設定します。<br/>`-Dwhatap.oname=java-sales-01` <br/>オプションを設定しないと`-Dwhatap.name`オプションに設定されたパターンが適用されます。<br/> |

</div>

:::tip

IPアドレスが10.11.12.13で、ポート番号が8000の環境で

- **-Dwhatap.onameオプションを適用しない場合**：**whatap.oname**は、`-Dwhatap.name`に設定されたパターンによって`JAVA-12-13-8000`に設定されます。

- **-Dwhatap.onameオプションを適用した場合**: `-Dwhatap.name`オプションを無視して`-Dwhatap.oname`オプションに設定した値でエージェント名が適用されます。

:::

:::note

- クラウドのScale Out環境では、VMをコピーして使用できます。したがって、オブジェクト名が自動的に付与されることが重要です。
- 2つのVPC環境を作成し、同じprivate IPを使用するようにネットワークを構成した場合、2つのVPCが重複しないようにする必要があります。それらを別々のプロジェクトに分割したり、`-Dwhatap.name`オプションと名前変数を異なる方法で設定できます。

:::

次は、*whatap.conf*ファイルにエージェント名で適用できるオプションです。

import Javaagentname from "../common-items/_java-agent-name.mdx";

<Javaagentname />

<OkindNodename />
