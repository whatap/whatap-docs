---
id: agent-weaving
title: オープンソーストラッキング
description: Javaアプリケーションで使用するフレームワークやオープンソースライブラリをエージェントを通じてトラッキングする設定方法を提供します。Javaエージェント設定ファイル(whatap.conf)にweavingオプションを追加して設定し、さまざまなフレームワークおよびライブラリバージョンに対応する方法を案内します。
keywords: [ Java, エージェント, オープンソーストラッキング, Weaving ]
---

Javaアプリケーションで使用するフレームワークやオープンソースライブラリをエージェントを通じてトラッキングする設定方法を提供します。Javaエージェント設定ファイル(*whatap.conf*)に`weaving`オプションを追加して設定し、さまざまなフレームワークおよびライブラリバージョンに対応する方法を案内します。

例えば、フレームワークやオープンソースとしてspring-boot-3.x、feign-client-11、okhttp3-4.4を使用する場合、次のようにオプションを設定してください。
```ini title='whatap.conf'
weaving=spring-boot-3.0,feign-11,okhttp3-4.4
```

## サポートオープンソースリスト

Javaエージェントを通じてトラッキングしているフレームワークまたはオープンソースに対する設定方法は、以下を参照してください。

### Apache Camel

#### CXF
**設定**: `weaving=camel-cxf-3.15`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.27 | camel-cxf 3.15以上 |

#### Netty
**設定**: `weaving=camel-netty4-2.25`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.42 | camel-netty4 2.25以上 |

#### SEDA
**設定**: `weaving=camel-seda-2.22`, `weaving=camel-seda-3.2`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.20 | camel-seda 2.22以上、3.2以上 |

### DB2
**設定**: `weaving=db2-11.5`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.18 | db2 11.5以上 |

### DynamoDB
**設定**: `weaving=dynamodb-1.11`, `weaving=dynamodb-2.25`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.39 | dynamodb 1.11, 2.25 |

### Feign Client
**設定**: `weaving=feign-11`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.6 | feign 11以上 |

### Hystrix
**設定**: `weaving=hystrix-1.5`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.0_21 | hystrix 1.5以上 |

### Kafka
**設定**: `weaving=kafka-clients-2.4.0`, `weaving=reactor-kafka-1.3`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.15 | kafka-clients 2.4.0以上 |
| v2.2.5 | reactor-kafka 1.3以上 |

### ロギング

#### Log4j2
**設定**: `weaving=log4j-2.17`

**備考**: [特定のappenderを除外するエージェントオプション提供](agent-log#excludeappender)

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.28 | log4j 2.17以上 |

#### Logback
**設定**: `weaving=logback-1.2.8`

**備考**: [特定のappenderを除外するエージェントオプション提供](agent-log#excludeappender)

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.28 | logback 1.2.8以上 |

### MongoDB
**設定**: `weaving=mongodb-{version}`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.45 | 3.8.2 ~ 5.0 |
| v2.2.11 | 3.8.2 ~ 4.8 |

### Mule Framework
**設定**: `weaving=mule-3.9.5`, `weaving=mule-4.5`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.23 | mule 3.9.5以上、4.5以上 |

### OkHttp
**設定**: `weaving=okhttp-2.7`, `weaving=okhttp3`, `weaving=okhttp3-4.4`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.9 | okhttp 2.7以上、okhttp3、okhttp3-4.4 |
| v2.0_15 | okhttp 2.7以上、okhttp3（4.4を除く） |

### Quarkus Reactive
**設定**: `weaving=quarkus-reactive-1.13`, `weaving=quarkus-reactive-2.10`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.19 | quarkus-reactive 1.13以上、2.10以上 |

### RabbitMQ
**設定**: `weaving=reactor-rabbitmq-1.2`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.0_06 | reactor-rabbitmq 1.2以上 |

### Redis

#### Jedis
**設定**: `weaving=jedis-{version}`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.43 | jedis 2.9.0 ~ 3.2 |
| v2.0_33 | jedis 2.9.3 ~ 3.2 |
| v2.0_09 | jedis 3.2 |

#### Lettuce
**設定**: `weaving=lettuce-{version}`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.16 | lettuce 5.1 ~ 6.2 |
| v2.2.7 | lettuce 5.1 |

### Retrofit
**設定**: `weaving=retrofit-2.5`

**備考**: okhttp設定と同時使用不可

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.39 | retrofit 2.5以上 |

### Ribbon
**設定**: `weaving=ribbon`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.10 | ribbon |

### Spring Boot
**設定**: `weaving=spring-boot-{version}`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.38 | spring-boot 2.1 ~ 3.2 |
| v2.2.23 | spring-boot 2.1 |
| v2.2.9 | spring-boot 2.5 ~ 3.0 |

<details>
<summary>含まれる技術スタックを表示</summary>

- **spring-boot-2.1**: r2dbc-mysql-0.8.2, spring-cloud-gateway-2.1, spring-kafka-2.7, spring-webflux-5.1, tomcat9
- **spring-boot-2.5**: r2dbc-mysql-0.8.2, spring-cloud-gateway-3.0, spring-kafka-2.7, spring-webflux-5.3, mongodb-4.0.3, reactor-kafka-1.3, rxjava2, tomcat9
- **spring-boot-2.7**: jasync-r2dbc-mysql-2.1.23, r2dbc-mysql-0.9.3, spring-cloud-gateway-3.1, spring-kafka-3.0, spring-webflux-5.3, mongodb-4.4, reactor-kafka-1.3, rxjava2, tomcat9
- **spring-boot-3.0**: jasync-r2dbc-mysql-2.1.23, r2dbc-mysql-1.0.2, spring-cloud-gateway-4.0, spring-kafka-3.0, spring-webflux-6.0, mongodb-4.8, redis(lettuce-6.2), reactor-kafka-1.3, rxjava3, tomcat10
- **spring-boot-3.2**: jasync-r2dbc-mysql-2.1.23, r2dbc-mysql-1.1.3, spring-cloud-gateway-4.1, spring-kafka-3.1, spring-webflux-6.1, redis(lettuce-6.2), reactor-kafka-1.3, rxjava3, tomcat10

</details>

### Tomcat
**設定**: `weaving=tomcat9`, `weaving=tomcat10`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.5 | tomcat9, tomcat10 |

### Undertow
**設定**: `weaving=undertow-{version}`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.39 | undertow 2.2 ~ 2.3 |
| v2.2.14 | undertow 2.3 |

### Vert.x
**設定**: `weaving=vertx-{version}`

| エージェントバージョン | サポート範囲 |
| --- | --- |
| v2.2.44 | vertx 3.5.3 ~ 4.5 |
| v2.2.42 | vertx 3.5.3 |
| v2.2.39 | vertx 4.5 |

## JavaエージェントのCVE誤検知防止

Javaエージェントに含まれるライブラリクラスは、アプリケーションで実際に使用される場合にのみロードされます。CVE脆弱性スキャンでライブラリが検出されても、使用していなければ実際の脆弱性はありません。

不要なトラッキングクラスを削除するには、次のコマンドを実行してください。
```bash
java -cp whatap.agent-X.Y.Z.jar whatap.agent.setup.RemoveWeaving -remove [weaving jar filename]
```

:::caution
Javaエージェントの更新ごとに削除作業を再度実行する必要があります。
:::

:::note

特定のライブラリクラスを削除するコマンドは**Javaエージェント2.2.37バージョン**以上でサポートされます。

**使用法**: `java -cp whatap.agent-X.Y.Z.jar whatap.agent.setup.RemoveWeaving [arguments] [weaving jar filename]`
```bash title="Example"
java -cp whatap.agent-2.2.37.jar whatap.agent.setup.RemoveWeaving -remove spring-boot-2.5.jar spring-boot-2.7.jar
```

**Arguments:**

* `-r` または `-remove`: Javaエージェントからweaving jarファイルを削除し、新しいJavaエージェントを生成します。

* `-l` または `-list`: weaving jarファイルのリストを出力します。

* `-d` または `-debug`: デバッグロギング(debug logging)を有効化します。

* `-e` または `-error`: エラーに対するフルスタックトレース情報を表示します。

* `-h` または `-help`: ヘルプを出力して終了します。

:::