---
id: agent-weaving
title: オープンソース追跡
description: Javaアプリケーションで使用するフレームワークやオープンソースライブラリをエージェントを介して追跡する設定方法を提供します。 Javaエージェント設定ファイル(whatap.conf)にweavingオプションを追加して設定し、様々なフレームワーク及びライブラリバージョンに対応する方法を案内します。
keywords:
  - Java
  - エージェント
  - オープンソース追跡
  - Weaving
---

Javaアプリケーションで使用するフレームワークやオープンソースライブラリをエージェントを介して追跡する設定方法を提供します。 これはJavaエージェント設定ファイル(*whatap.conf*)ファイルに`weaving`オプションを追加して設定し、様々なフレームワークやライブラリバージョンに対応する方法を案内します。

たとえば、フレームワークやオープンソースでspring-boot-3.x、feign-client-11、okhttp3-4.4使用の際は、次のようにオプションを設定します。

```ini title='whatap.conf'
weaving=spring-boot-3.0,feign-11,okhttp3-4.4
```

## 対応オープンソースの一覧

Javaエージェントを通じて追跡しているフレームワーク、またはオープンソースに対する設定方法は以下を参照してください。

<div class='weaving-table'>

| フレームワーク/オープンソース           | バージョン                   | 設定                              |                                  エージェント最低バージョン                                  | 備考                                                                                                                                                                                  |
| ------------------------- | ----------------------- | ------------------------------- | :-----------------------------------------------------------------------------: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| apache-camel-cxf          | camel-cxf-3.15以降        | `weaving=camel-cxf-3.15`        |   <Link to="../release-notes/java/java-2_2_27" target="_blank">v2.2.27</Link>   | -                                                                                                                                                                                   |
| apache-camel-netty        | camel-netty4 2.25以降     | `weaving=camel-netty4-2.25`     |   <Link to="../release-notes/java/java-2_2_42" target="_blank">v2.2.42</Link>   | -                                                                                                                                                                                   |
| apache-camel-seda         | camel-seda-2.22以降       | `weaving=camel-seda-2.22`       |   <Link to="../release-notes/java/java-2_2_20" target="_blank">v2.2.20</Link>   | -                                                                                                                                                                                   |
| ^                         | camel-seda-3.2以降        | `weaving=camel-seda-3.2`        |   <Link to="../release-notes/java/java-2_2_20" target="_blank">v2.2.20</Link>   | -                                                                                                                                                                                   |
| db2                       | db2-11.5以降              | `weaving=db2-11.5`              |   <Link to="../release-notes/java/java-2_2_18" target="_blank">v2.2.18</Link>   | -                                                                                                                                                                                   |
| dynamodb                  | dynamodb-1.11           | `weaving=dynamodb-1.11`         |   <Link to="../release-notes/java/java-2_2_39" target="_blank">v2.2.39</Link>   | -                                                                                                                                                                                   |
| ^                         | dynamodb-2.25           | `weaving=dynamodb-2.25`         |   <Link to="../release-notes/java/java-2_2_39" target="_blank">v2.2.39</Link>   | -                                                                                                                                                                                   |
| feign-client              | feign-11以降              | `weaving=feign-11`              |    <Link to="../release-notes/java/java-2_2_6" target="_blank">v2.2.6</Link>    | -                                                                                                                                                                                   |
| hystrix                   | hystrix-1.5以降           | `weaving=hystrix-1.5`           | <Link to="../release-notes/java/java-2_0#v20_21" target="_blank">v2.0_21</Link> | -                                                                                                                                                                                   |
| kafka                     | kafka-clients-2.4.0以降   | `weaving=kafka-clients-2.4.0`   |   <Link to="../release-notes/java/java-2_2_15" target="_blank">v2.2.15</Link>   | -                                                                                                                                                                                   |
| ^                         | reactor-kafka-1.3以降     | `weaving=reactor-kafka-1.3`     |    <Link to="../release-notes/java/java-2_2_5" target="_blank">v2.2.5</Link>    | -                                                                                                                                                                                   |
| logback                   | logback-1.2.8以降         | `weaving=logback-1.2.8`         |   <Link to="../release-notes/java/java-2_2_28" target="_blank">v2.2.28</Link>   | [特定のappenderを除外するエージェントオプションを提供](agent-log#excludeappender)                                                                                                                         |
| log4j2                    | log4j-2.17以降            | `weaving=log4j-2.17`            |   <Link to="../release-notes/java/java-2_2_28" target="_blank">v2.2.28</Link>   | [特定のappenderを除外するエージェントオプションを提供](agent-log#excludeappender)                                                                                                                         |
| mongodb、mongodb-reactive  | mongodb-3.8.2以降         | `weaving=mongodb-3.8.2`         |   <Link to="../release-notes/java/java-2_2_11" target="_blank">v2.2.11</Link>   | -                                                                                                                                                                                   |
| ^                         | mongodb-4.0.3以降         | `weaving=mongodb-4.0.3`         |   <Link to="../release-notes/java/java-2_2_11" target="_blank">v2.2.11</Link>   | -                                                                                                                                                                                   |
| ^                         | mongodb-4.4以降           | `weaving=mongodb-4.4`           |   <Link to="../release-notes/java/java-2_2_11" target="_blank">v2.2.11</Link>   | -                                                                                                                                                                                   |
| ^                         | mongodb-4.8以降           | `weaving=mongodb-4.8`           |   <Link to="../release-notes/java/java-2_2_11" target="_blank">v2.2.11</Link>   | -                                                                                                                                                                                   |
| ^                         | mongodb-4.11以降          | `weaving=mongodb-4.11`          |   <Link to="../release-notes/java/java-2_2_45" target="_blank">v2.2.45</Link>   | -                                                                                                                                                                                   |
| ^                         | mongodb-5.0以降           | `weaving=mongodb-5.0`           |   <Link to="../release-notes/java/java-2_2_45" target="_blank">v2.2.45</Link>   | -                                                                                                                                                                                   |
| mule framework            | mule-3.9.5以降            | `weaving=mule-3.9.5`            |   <Link to="../release-notes/java/java-2_2_23" target="_blank">v2.2.23</Link>   | -                                                                                                                                                                                   |
| ^                         | mule-4.5以降              | `weaving=mule-4.5`              |   <Link to="../release-notes/java/java-2_2_23" target="_blank">v2.2.23</Link>   | -                                                                                                                                                                                   |
| okhttp                    | okhttp-2.7以降            | `weaving=okhttp-2.7`            | <Link to="../release-notes/java/java-2_0#v20_15" target="_blank">v2.0_15</Link> | -                                                                                                                                                                                   |
| quarkus, quarkus-reactive | quarkus-reactive-1.13以降 | `weaving=quarkus-reactive-1.13` |   <Link to="../release-notes/java/java-2_2_19" target="_blank">v2.2.19</Link>   | -                                                                                                                                                                                   |
| ^                         | quarkus-reactive-2.10以降 | `weaving=quarkus-reactive-2.10` |   <Link to="../release-notes/java/java-2_2_19" target="_blank">v2.2.19</Link>   | -                                                                                                                                                                                   |
| redis(jedis)              | jedis-2.9.0以降           | `weaving=jedis-2.9.0`           |   <Link to="../release-notes/java/java-2_2_43" target="_blank">v2.2.43</Link>   | -                                                                                                                                                                                   |
| ^                         | jedis-2.9.3以降           | `weaving=jedis-2.9.3`           | <Link to="../release-notes/java/java-2_0#v20_33" target="_blank">v2.0_33</Link> | -                                                                                                                                                                                   |
| ^                         | jedis-3.2以降             | `weaving=jedis-3.2`             | <Link to="../release-notes/java/java-2_0#v20_09" target="_blank">v2.0_09</Link> | -                                                                                                                                                                                   |
| redis(lettuce)            | lettuce-5.1以降           | `weaving=lettuce-5.1`           |    <Link to="../release-notes/java/java-2_2_7" target="_blank">v2.2.7</Link>    | -                                                                                                                                                                                   |
| ^                         | lettuce-6.2以降           | `weaving=lettuce-6.2`           |   <Link to="../release-notes/java/java-2_2_16" target="_blank">v2.2.16</Link>   | -                                                                                                                                                                                   |
| ^                         | okhttp3以降               | `weaving=okhttp3`               | <Link to="../release-notes/java/java-2_0#v20_15" target="_blank">v2.0_15</Link> | -                                                                                                                                                                                   |
| ^                         | okhttp3-4.4             | `weaving=okhttp3-4.4`           |    <Link to="../release-notes/java/java-2_2_9" target="_blank">v2.2.9</Link>    | -                                                                                                                                                                                   |
| rabbitmq                  | reactor-rabbitmq-1.2以降  | `weaving=reactor-rabbitmq-1.2`  | <Link to="../release-notes/java/java-2_0#v20_06" target="_blank">v2.0_06</Link> | -                                                                                                                                                                                   |
| retrofit                  | retrofit-2.5以降          | `weaving=retrofit-2.5`          |   <Link to="../release-notes/java/java-2_2_39" target="_blank">v2.2.39</Link>   | okhttp設定と同時使用不可                                                                                                                                                                     |
| ribbon                    | ribbon                  | `weaving=ribbon`                |   <Link to="../release-notes/java/java-2_2_10" target="_blank">v2.2.10</Link>   | -                                                                                                                                                                                   |
| spring-boot               | spring-boot-2.1以降       | `weaving=spring-boot-2.1`       |   <Link to="../release-notes/java/java-2_2_23" target="_blank">v2.2.23</Link>   | r2dbc-mysql-0.8.2, spring-cloud-gateway-2.1, spring-kafka-2.7, spring-webflux-5.1, tomcat9                                                                                          |
| ^                         | spring-boot-2.5以降       | `weaving=spring-boot-2.5`       |    <Link to="../release-notes/java/java-2_2_9" target="_blank">v2.2.9</Link>    | r2dbc-mysql-0.8.2, spring-cloud-gateway-3.0, spring-kafka-2.7, spring-webflux-5.3, mongodb-4.0.3, reactor-kafka-1.3, rxjava2, tomcat9                                               |
| ^                         | spring-boot-2.7以降       | `weaving=spring-boot-2.7`       |    <Link to="../release-notes/java/java-2_2_9" target="_blank">v2.2.9</Link>    | jasync-r2dbc-mysql-2.1.23, r2dbc-mysql-0.9.3, spring-cloud-gateway-3.1, spring-kafka-3.0, spring-webflux-5.3, mongodb-4.4, reactor-kafka-1.3, rxjava2, tomcat9                      |
| ^                         | spring-boot-3.0以降       | `weaving=spring-boot-3.0`       |    <Link to="../release-notes/java/java-2_2_9" target="_blank">v2.2.9</Link>    | jasync-r2dbc-mysql-2.1.23, r2dbc-mysql-1.0.2, spring-cloud-gateway-4.0, spring-kafka-3.0, spring-webflux-6.0, mongodb-4.8, redis(lettuce-6.2), reactor-kafka-1.3, rxjava3, tomcat10 |
| ^                         | spring-boot-3.2以降       | `weaving=spring-boot-3.2`       |   <Link to="../release-notes/java/java-2_2_38" target="_blank">v2.2.38</Link>   | jasync-r2dbc-mysql-2.1.23, r2dbc-mysql-1.1.3,  spring-cloud-gateway-4.1, spring-kafka-3.1, spring-webflux-6.1, redis(lettuce-6.2), reactor-kafka-1.3, rxjava3, tomcat10             |
| tomcat                    | tomcat9                 | `weaving=tomcat9`               |    <Link to="../release-notes/java/java-2_2_5" target="_blank">v2.2.5</Link>    | -                                                                                                                                                                                   |
| ^                         | tomcat10                | `weaving=tomcat10`              |    <Link to="../release-notes/java/java-2_2_5" target="_blank">v2.2.5</Link>    | -                                                                                                                                                                                   |
| undertow                  | undertow-2.2以降          | `weaving=undertow-2.2`          |   <Link to="../release-notes/java/java-2_2_39" target="_blank">v2.2.39</Link>   | -                                                                                                                                                                                   |
| ^                         | undertow-2.3以降          | `weaving=undertow-2.3.0`        |   <Link to="../release-notes/java/java-2_2_14" target="_blank">v2.2.14</Link>   | -                                                                                                                                                                                   |
| vertx                     | vertx-3.5.3             | `weaving=vertx-3.5.3`           |   <Link to="../release-notes/java/java-2_2_42" target="_blank">v2.2.42</Link>   | -                                                                                                                                                                                   |
| ^                         | vertx-3.9               | `weaving=vertx-3.9`             |   <Link to="../release-notes/java/java-2_2_44" target="_blank">v2.2.44</Link>   | -                                                                                                                                                                                   |
| ^                         | vertx-4.5               | `weaving=vertx-4.5`             |   <Link to="../release-notes/java/java-2_2_39" target="_blank">v2.2.39</Link>   | -                                                                                                                                                                                   |

</div>

## JavaエージェントのCVE誤検知防止

JavaエージェントのCVE脆弱性の誤検知防止と不要なライブラリクラスの削除方法を案内します。

CVE脆弱性が検出されても、Javaエージェントが実際に脆弱ではない可能性があります。 Javaアプリケーションで使用するライブラリ情報をモニタリングするために、エージェントには様々なライブラリクラスが含まれていますが、実際に使用しないとロードされません。 Javaアプリケーションで特定のクラスがロードされる時だけ追跡クラスとメソッドが結合され、モニタリングが行われるからです。

従って、CVE脆弱性検査時にソフトウェアの名前とバージョンのみに基づいて警告が発生することがあります。 複数のライブラリが検出されても、実際にアプリケーションでそのライブラリを使用しなければ脆弱性がオープンされないため、必ずしも脆弱な状態ではありません。

もしJavaアプリケーションで該当バージョンを使用せずに追跡クラスを削除する場合は、以下のコマンドを実行してください。 ただし、Javaエージェントがアップデートされるたびに削除作業を再度実行する必要があります。

```bash
java -cp whatap.agent-X.Y.Z.jar whatap.agent.setup.RemoveWeaving -remove [weaving jar filename]
```

:::note

特定のライブラリクラスを削除するコマンドは**Javaエージェント2.2.37バージョン**以降で対応します。

**使い方**：`java -cp whatap.agent-X.Y.Z.jar whatap.agent.setup.RemoveWeaving [arguments] [weaving jar filename]`

```bash title="Example"
java -cp whatap.agent-2.2.37.jar whatap.agent.setup.RemoveWeaving -remove spring-boot-2.5.jar spring-boot-2.7.jar
```

Arguments:

- `-r`または`-remove`: Javaエージェントでweaving jarファイルを削除して、新しいJavaエージェントを作成します。

- `-l`または`-list`: weaving jarのファイル一覧を出力します。

- `-d`または`-debug`: デバッグロギング(debug logging)を有効にします。

- `-e`または`-error`: エラーのフルスタックトレースの情報を表示します。

- `-h`または`-help`: ヘルプを出力して終了します。

:::
