---
id: set-agent
title: エージェント設定
description: Javaエージェントの設定方法を案内します。whatap.confファイルによるエージェントのデフォルト設定、サーバー接続およびデータ転送設定、複数のアプリケーション サーバーの設定ファイルの管理方法などが含まれます。また、WhaTapモニタリングサービス画面で直接エージェントオプションを管理する方法も提供します。
keywords:
  - Java
  - エージェント
  - エージェント設定
  - whatap.conf
---

WhaTapエージェントは、エージェントごとに必要な設定を*whatap.conf*ファイルに作成します。 エージェントは、環境変数を使用して設定ファイルの位置を把握して読み込みます。

他の設定がない場合、エージェントは(_whatap.agent-X.Y.Z.jar_)にあるディレクトリから*whatap.conf* ファイルを実装します。5秒ごとに*whatap.conf*ファイルの確認してリロードします。

ユーザーの利便性を高めるため、[WhaTapモニタリングサービス](https://service.whatap.io)でもエージェント設定機能を提供しています。

## 基本設定

```ini title='whatap.conf'
whatap.home=.
whatap.config=whatap.conf
```

- `whatap.home`：既定値は_whatap.agent.jar_ファイルへのパスを入力してください。

- `whatap.config`: ファイル名のみを入力することをお勧めします。相手パスを一緒に入力することができます。

エージェントがデータを収集し、サーバーにデータを送信するには、アクセスキーとサーバーアドレスが設定されている必要があります。

```ini title='whatap.conf'
license=x220g160hgd29-x3qpff0garcus7-z4p0kao58un11a
whatap.server.host=10.10.0.1
```

WhaTapエージェントを初めて実行すると、次のようにどのjarファイルがエージェントとして使用され、どのパスで*whatap.conf*ファイルをロードされたのかを確認できます。

![Java start screen](/img/set-java-agent-start.png)

## サーバー接続およびデータ送信

WhaTapエージェントは、*whatap.conf*ファイルに設定したサーバーアドレスに接続します。

```ini title='whatap.conf'
whatap.server.host=10.10.1.1
whatap.server.port=6600 # 既定値
```

- TCPセッションを接続すると`license`を利用してサーバーから通信キーを受け取ります。誤った`license`を設定すると、サーバーはセッションを終了します。
- TCP接続が繰り返し終了する場合は、ファイアウォールの確認または`license`の値が正しいことを確認してください。
- TCPセッションを接続すると、サーバーから受信した秘密鍵に基づいてセキュリティで保護された通信データが送信されます。

## 複数のアプリケーションサーバーの設定ファイル管理

1つのサーバーの中で複数のアプリケーションを運営する場合、各アプリケーション別の設定ファイルを別途管理するには、*whatap.conf*ファイル名を変更し、開始スクリプトにJVMオプションを追加してください。

```bash title='Service A'
-Dwhatap.config=whatap_Aservice.conf
```

```bash title='Service B'
-Dwhatap.config=whatap_Bservice.conf
```

:::caution

*whatap.conf*設定ファイルは、`${WHATAP_HOME}`パスに配置する必要があります。

:::

import ProdImg from '@site/src/components/ChangeImgName.js';

## サービス画面でエージェントを設定する{#set-agent-service}

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_management" className="uitext" /> &gt; <Cmdname sid="side_agentSetting" className="uitext" />

import Desc from '../common-items/_import_set-agent-desc-okind.mdx';

<Desc name='whatap.conf'/>

import Setagentinservicedescnotes from "../common-items/_set-agent-in-service-desc-notes.mdx";

<Setagentinservicedescnotes />

import Setagentinserviceaddoptions from "../common-items/_set-agent-in-service-add-options.mdx";

<Setagentinserviceaddoptions />

import Setagentinservicemodifyoptions from "../common-items/_set-agent-in-service-modify-options.mdx";

<Setagentinservicemodifyoptions />

import Setagentinservicemuliagent from "../common-items/_set-agent-in-service-muli-agent.mdx";

<Setagentinservicemuliagent />

import Setagentinserviceapplydafaultdesc from "../common-items/_set-agent-in-service-apply-dafault-desc.mdx";

<Setagentinserviceapplydafaultdesc />

import DefaultItems from '../common-items/_import_set-agent-in-service-default-item.mdx';

<DefaultItems name='whatap.conf'/>

import Setagentinservicedefaultnotes from "../common-items/_set-agent-in-service-default-notes.mdx";

<Setagentinservicedefaultnotes />

import Setagentsharing from "../common-items/_set-agent-sharing.mdx";

<Setagentsharing />

## エージェント設定オプションの案内

次のリンクは、設定できるオプションについて説明します。

import DocCardList from '@theme/DocCardList';

<DocCardList/>
