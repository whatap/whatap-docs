---
id: advanced-feature
title: 拡張機能
description: Pythonエージェントの高度な機能を説明します。
keywords:
  - Python
  - 拡張機能
---

## サーバー名の任意付与と管理{#custom-naming}

エージェントは、アプリケーション サーバーの種類とアプリケーション サーバーのIP、サービス ポートを使用して、自動的にサーバー名を割り当てます。

### アプリケーション名の指定オプション

デフォルトのパターンの変更は*whatap.conf*で設定できます。

```bash
object_name default: {type}-{ip2}-{ip3}-{process}
```

### アプリケーション名のパターン

プロジェクトに登録されているアプリケーションサーバーに同じ名前を使用しないでください。また、静的なサーバー名を使用しないでください。Internal ip addressが原因でサーバーIPが重複する場合は、アプリケーションサーバー名をグループでパターン化して適用できます。

**パターンオプション**

| 設定       | 説明                       |
| -------- | ------------------------ |
| type     | app_name                 |
| ip#      | Ipを「.」で分割したとき、#番目の桁(0から) |
| process  | app_process_name         |
| hostname | ホスト名                     |

## OpenFile Descriptorの使用量収集{#open-file-descriptor-usage-collection}

Python WebアプリケーションでOpen File Descriptorの使用量をモニタリングすることは、システムリソース管理に不可欠です。ファイルディスクリプターは、システムで同時に表示できるファイルの数を制限する重要なリソースであるため、使用量が限界に達すると、アプリケーションで新しいファイルを表示できなくなり、エラーが発生する可能性があります。これらの問題は、特にマルチスレッドおよびマルチプロセス環境で頻繁に発生します。

また、ファイルディスクリプターのリーク発生時、資源枯渇によりシステム性能が低下し、安定性が損なわれる可能性があります。この機能は、ファイルディスクリプターの使用量をモニタリングして使用量の高い時点を把握し、必要に応じてファイルディスクリプターの限界を増加させたり、リークを解決するのに役立ちます。

:::note 

**要求事項**

WhaTap Pythonエージェント1.7.2バージョン以降が必要です。 

:::

### 活性化オプション

次の例を参照して*whatap.conf*ファイルを修正します。 

```ini
#収集機能on/off設定
open_file_descriptor_enabled=true

#収集の周期設定で省略時、規定値60秒
open_file_descriptor_interval=60
```

### 収集メトリクス

| 名前                   | 説明                               |
| -------------------- | -------------------------------- |
| `current_nofile_pct` | 現在のOpen File Descriptor使用量比率(%)  |
| `currnet_nofile`     | 現在のOpen File Descriptorの個数       |
| `max_nofile`         | プロセスの最大Open File Descriptorの許容個数 |
| `pid`                | プロセスID                           |

## AES256暗号化の適用

WhaTapアプリケーションモニタリングエージェントは、収集されたデータを暗号化し、サーバーに送信します。データの重要度や設定に応じて変更できます。  

基本的に、XOR演算とAESアルゴリズムによる暗号化を使用します。 平文を128ビット単位に分けて暗号化・復号化を行います。ユーザーの設定によって256ビットまで拡張できます。

1. **設定する**

   エージェントがインストールされたディレクトリの*whatap.conf*ファイルに次の設定を追加します。

   ```ini title='whatap.conf'
   license={アクセスキー}
   whatap.server.host={収集サーバーIP}
   cypher_level=256
   ```

2. **再起動する**

   設定を追加した後、WASを再起動します。

## 制約事項

### 複数リージョンを１つのプロジェクトとして選択することはできません。

[WhaTapモニタリングサービス](https://service.whatap.io)で **_プロジェクト作成_**時、地域(Region)を重複して選択することができません。複数の地域を使用する場合は、別のプロジェクトを作成する必要があります。

クラウド環境など、複数のリージョンにサーバがある場合、ネットワークlatencyなどの性能情報収集の制約を回避するために、リージョン単位で収集サーバを配置する必要があります。WhaTapは、顧客のニーズに満たすために地域ごとに収集サーバーを構築します。

### エージェント名(ONAME) は重複使用できません

WhaTapアプリケーションモニタリングは、エージェントを識別するための用途でエージェントのIPアドレスとポート情報を使用します。ユーザー環境のモニタリング対象のアプリケーションサーバーが同じIPおよび、同じPortを使用する場合、WhaTapサーバーはサーバーインスタンスを区別できません。

サーバーインスタンスが動的に拡張されている環境でない場合は、 [次の文書](#custom-naming)を参照して、アプリケーションの識別のために名前を直接つけることで迂回できます。

モニタリング対象アプリケーションがinternal addressまたはネットワーク仮想化により重複したIPを使用する場合は、[次の文書](#custom-naming)を参照して、別のアプリケーション名のパターンを使用します。
