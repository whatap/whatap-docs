---
id: openapi-spec
title: Open APIスペック
description: Open API 仕様の説明。
tags:
  - Open API
  - アプリケーション
  - APM
---

## アカウントAPI

プロジェクトのリスト表示など、プロジェクトのアクセス許可の範囲を超えるOpen APIの場合は、アカウントAPIトークンを使用して呼び出します。

OpenAPIの呼び出し時、ヘッダーに含まれる内容は次のとおりです。

| 区分   | キー               | 設定値     | 備考                                                                                              |
| ---- | ---------------- | ------- | ----------------------------------------------------------------------------------------------- |
| ヘッダー | `x-whatap-token` | APIトークン | アカウントAPIトークン：画面右上のプロフィールアイコンを選択 > <Cmdname sid="MNU07360" className="uitext" /> > **_APIトークン_** |

メタデータ情報検索のためにOpenAPIで次の項目を呼び出すことができます。Open API 呼び出しの使用方法については、[次の記事](openapi-call-meta)を参照してください。

- プロジェクトリストの照会
- プロジェクトメンバー一覧を参照
- ユーザーのグループリストを表示
- グループメンバーのリストを表示
- グループに含まれるプロジェクトを表示

## プロジェクトAPI

プロジェクト権限範囲内のOpen APIの場合、プロジェクトコードでプロジェクトAPIトークンを使用して呼び出します。

OpenAPIの呼び出し時、ヘッダーに含まれる内容は次のとおりです。

| 区分   | キー             | 設定値       | 備考                                                                              |
| ---- | -------------- | --------- | ------------------------------------------------------------------------------- |
| ヘッダー | x-whatap-token | APIトークン   | プロジェクトAPIトークン：プロジェクト選択 > **_管理_** > **_プロジェクト管理_** > **_APIトークン_**              |
| ^    | x-whatap-pcode | プロジェクトコード | 画面ウィンドウまたはブラウザのタブタイトルを確認してください<br/>`[{プロジェクトコード}]` Cloud Application Monitoring |

### メタ情報照会

メタ情報検索のためにOpenAPIで次の項目を呼び出すことができます。Open API呼び出しの使用方法については、[次の記事](openapi-call-meta#project-info) を参照してください。

- プロジェクト情報照会(Application製品群)
- プロジェクト情報及び詳細サーバ照会（サーバ商品群）
- プロジェクトエージェントのステータスおよびホスト照会

### Spot情報照会

スポット情報検索の Open API で呼び出しできる項目は次のとおりです。Open API 呼び出しの使用方法については、[次の記事](openapi-call-apm-spot)を参照してください。

#### アプリケーション製品群

- 活性化状態のエージェント数
- 非活性化状態のエージェント数
- ホスト数
- ホストCPUコアの合計
- トランザクション数
- １秒あたりのトランザクション数
- 5分間集計されたユニークなユーザー数
- アクティブトランザクション数
- 平均応答時間
- CPU使用率
- スレッドプールのアクティブスレッド数
- スレッドプールのキューイングスレッド数
- 全体DB Connection数
- 活性化状態(Active)のDB Connection数
- 非活性化状態(idle)のDB Connection数
- アクティブMethod数
- アクティブSQL数
- アクティブHTTP Call数
- アクティブDB Connection数
- アクティブSocket数

#### サーバー製品群

- 活性化状態のエージェント数
- 非活性化状態のエージェント数
- ホスト数
- ホストCPUコアの合計
- CPU使用率
- ディスクIOPSの合計
- ネットワークトラフィック（IN／OUT）の合計
- プロセス状況
- サーバーリスト
- サーバーモニタリングの詳細
- サーバー統計の詳細

### 統計情報の表示

統計情報を表示するためのOpenAPIは、時間範囲を設定して呼び出され、URLに次の項目を含めると次のように動作します。

- 時間範囲を指定しない場合は、5 分前の情報を表示します。
- `stime`：クエリ開始時間(UNIX epoch time、 millisecond)
- `etime`：クエリ終了時間(UNIX epoch time, millisecond)

:::note

`etime`は、 `stime`を基準に1日を超えることはできません。

:::

- oids：agentの識別IDです。コンマ(,)を区切り文字として使用することで複数の文字を設定できます。
- URL に "/avg" を含めると、エージェントごとに平均値を導き出すことができます。

統計情報を表示するために、OpenAPI で次の項目を呼び出すことができます。Open API 呼び出しの使用方法については、[次の記事](openapi-call-apm-stat-data) を参照ください。

- Exception発生
- HTTP外部呼び出し
- Client IP
- SQL発行
- トランザクション
- スレッド数
- Thread Daemon数
- Thread Peak数
- Thread Pool数
- Thread Pool Queue数
- プロジェクト間のトランザクション呼び出し統計
- ドメイン呼び出し統計
- アクティブユーザー(5分単位)
- アクティブユーザー(1時間単位)

### プロジェクト統計照会

プロジェクト統計を表示するための Open API は、複数のエージェントによって収集されたデータを 1 つのプロジェクトにマージしてクエリを実行します。時間範囲を設定することで呼び出すことができます。

- 時間範囲を設定しない場合、最新のデータ参照

- `stime`：クエリ開始時間(UNIX epoch time、 millisecond)

- `etime`：クエリ終了時間(UNIX epoch time, millisecond)

  `etime` 値のみが指定されている場合、データは`etime` 時間の5秒前に参照されます。

- `timeMerge`： クエリ開始時間と終了時間を設定する時の時間データの統合 (平均：`avg`、最大値：`max`、最小値：`min`)

:::note

- `etime`は、 `stime`を基準に1日を超えることはできません。
- `stime`は`etime`を設定した場合、`timeMerge`(時間統合)をオプションとして追加できます。時間統合を追加しない場合、デフォルトの統合方法は平均です。

:::

プロジェクトの統計を表示するために、OpenAPIで呼び出すことができます。Open API呼び出しの使用方法については、[次の文書](openapi-call-project-stat)を参照ください。

- プロジェクト内のTPS
- プロジェクトの平均応答時間
- プロジェクトの平均CPU使用率
- プロジェクト内のデータソースあたりのDB Connection数

### 長期統計データの照会

長期統計データ照会のOpen APIは、タイプにより設定可能な時間範囲が異なります。URLに次のような時間設定項目を追加して呼出し可能です。

- `stime`：クエリ開始時間(UNIX epoch time、 millisecond)
- `etime`：クエリ終了時間(UNIX epoch time, millisecond)

:::note

**訪問ユーザー**は、1日単位のアクティブユーザー数と1ヶ月単位のアクティブユーザー数として集計されます。 

- アクティブユーザー(１日単位)：`etime`は、`stime`を基準に31日を超えることはできません。
- アクティブユーザ(1ヶ月単位): `etime`は、`stime`を基準に365日を超えることはできません。

:::

Open API呼び出しの使用方法は、[次の文書](openapi-call-long-stat)を参照ください。

### 短期データ照会

指定した時間の情報を表示します。時間を設定しない場合は、最新のデータを検索します。プロジェクトごとに表示され、エージェントのデータは自動的にマージされます。 Query String(クエリ文字列) を使用します。クエリ文字列は「&」記号で連結でき、使用可能なクエリ文字列は次のとおりです。

- `stime`：クエリ開始時間(UNIX epoch time、 millisecond)
- `etime`：クエリ終了時間(UNIX epoch time, millisecond)
- `timeMerge`：時間統合設定で`avg`、 `min`、 `max`、 `sum`が使用できます。

短期データ照会のOpen APIには次の機能があります。Open APIの呼出し方法は、[次の文書](openapi-call-short-stat)を参照にしてください。

- トランザクション数
- 平均応答時間
- 平均CPU使用率
- 活性化/非活性化状態のDB Connection数
