---
id: multi-instance-monitoring
title: マルチインスタンスモニタリング
description: 複数のインスタンスの指標を一つの画面で確認・比較することができます。
tags:
  - MySQL RDS
  - インスタンス
  - ダッシュボード
  - データベースモニタリング
  - マルチインスタンスモニタリング
---

import ProdImg from '@site/src/components/ChangeImgName.js';

ホーム画面 > プロジェクト選択 > **_ダッシュボード_** > **_マルチインスタンスモニタリング_**

**_[インスタンスモニタリング](instance-monitoring)_**メニューが一つのインスタンスをモニタリングすることに対し、**_マルチインスタンスモニタリング_**は、複数のインスタンスの指標を一つの画面で確認し、比較することができます。 動作中のエージェント数、アクティブセッションの合計、平均バッファヒット率などのインスタンス指標をグループ化した値を通じて、インスタンスの現況を把握することができます。グラフチャートにより、インスタンスの指標値の推移はもちろん、どのインスタンスの指標値が高いかを簡単に確認できます。最も長持ちするアクティブセッションの情報を提供します。

{@include: ../common-items/_db-multi-instance-monitoring-desc-notes.mdx}

## 基本画面案内

<ProdImg img='db-multi-instance.png' desc='멀티 인스턴스 모니터링' />

### ![](/img/number-01.png)インスタンス

エージェントインストールを通じて接続したインスタンスの一覧です。インスタンスの色は、画面の中央領域のグラフチャートの色と一致します。インスタンスを選択したときに色が灰色になると、選択が解除された状態です。各指標とグラフチャートから解除したインスタンスのデータを除きます。

### ![](/img/number-02.png)インスタンスステータスの把握{#instance-status}

-   **_Instance_**

    活性化/非活性化されたインスタンスの数を確認できます。

-   **_Active Session_**

    `Threads_running`変数と同じです。sleepingされていない活性化されたThreadの数です。

-   **_Connection Usage_**

    現在開いている接続比率（Connection thread）です。この比率が高いとMySQLサーバーへの同時接続が多いことを意味し、'Too many Connections'エラーが発生する可能性があります。接続比率を得る数式は次のとおりです。

    ```txt

    Current connections(%) = (threads_connected / max_connections) x 100

    ```

    :::note

    最適な比率の値は80%以下である必要があります。`max_connections`変数を増やすか、SHOW FULL PROCESSLISTを利用して接続を検査してみてください。'Too many connections'エラーが発生すると、一部の接続を解除するまでスーパーユーザーでない一般ユーザーは、MySQLデータベースサーバーにアクセスできません。`max_connections`変数値を増やすとMySQLのメモリ使用量が増加することもあります。

    :::

-   **_Buffer Hit Rate_**

    ページがディスクではなくメモリで検索される頻度の割合です。MySQLを最初に起動する時、**_Buffer Hit Rate_**値が低い場合は、バッファプール（buffer pool）をウォーミングアップするまで若干の時間を許可してください。最適な値は100%であり、これはよくアクセスするデータがメモリに完全に含まれていることを意味します。

    :::note

    `innodb_buffer_pool_size`変数を増やすと、MySQLが作業するスペースをより多く確保するのに役立ちます。ただ、事前に十分なメモリリソースがあるか確認してください。重複インデックスを削除することも役立ちます。

    :::

-   **_SQL Executed_**

    選択したインスタンスの1秒当たりのSQL実行件数の合計です。5秒単位で収集した`Questions`(全体クエリのリクエスト回数) 指標値に基づいています。

-   **_Lock waiting_**

    `Innodb_row_lock_current_waits`変数の値を使用します。現在、row lockを獲得するために待機中の数です。

### ![](/img/number-03.png)インスタンス指標の現状

全体インスタンスの重要な指標を次の4つの分類で把握できます。各グラフの色は![数字1](/img/number-01.png)のインスタンスの色と一致します。時間による指標値の推移をグラフチャートで確認できます。

-   **_Connection_**

    Sleepingされていない活性化されたThread数(**_Threads_running_**)と現在接続されているThread数(**_Threads_connected_**)をリアルタイムで照会します。これは![数字2](/img/number-02.png)の**_[Connection Usage](#instance-status)_**と関連があります。DBサーバーへの接続が多くなる場合は、関連するチューニングを探して措置を取ってください。

-   **_Throughput_**

    処理するデータ量の観点からインスタンスの性能をモニタリングできます。どのインスタンスが大量のタスクを処理するかを確認してください。指標の詳細については、[次の文書](metrics-data-list)を参考にしてください。

-   **_Performance_**

    サーバーの状態に関する関連指標をモニタリングします。該当セクションに含まれる指標の値が大きくなると、性能を低下させる要因になります。指標の詳細については、[次の文書](metrics-data-list)を参考にしてください。

-   **_Disk I/O_**

    ディスク使用率により、データベース処理性能への影響をモニタリングできます。該当セクションに含まれる指標の値が高くなると、過度にディスクを使用しているということです。指標の詳細については、[次の文書](metrics-data-list)を参考にしてください。

### ![](/img/number-04.png)アクティブセッション/ロックツリー

リアルタイムで実行中のアクティブセッションとロックツリー情報を照会することができます。

-   **_Acitive Sessions_** 

    リアルタイムで実行中のセッションとクエリ内容を照会することができます。テーブルの一番右側の**_query_**カラムの項目を選択すると、**_SQLを見る_**ウィンドウが表示されます。選択したクエリ（Query）に対するFull TextおよびPlan情報を確認することができます。テーブルのカラムの詳細については、[次の文書](#column-info)を参考にしてください。

-   **_ロックツリー_**

    リアルタイムでロックセッションに関する情報やHolder、Waiter情報を照会することができます。テーブルのカラムの詳細については、[次の文書](#column-info)を参考にしてください。

{@include: ../common-items/_db-data-list-filter.mdx}

## テーブルカラムの変更{#change-column}

{@include: ../common-items/_db-data-edit-column.mdx}

{@include: ../common-items/_db_ats-lock-column.mdx}  
