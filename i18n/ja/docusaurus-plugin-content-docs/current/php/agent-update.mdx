---
id: agent-update
title: エージェントのアップデート
description: PHPエージェントのアップデート方法を提供します。
keywords:
  - PHP
  - アップデート
  - 管理
  - アプリケーション
---

パッケージアップデートは、既存の設定を維持したまま PHP モニタリングサービスを更新します。  
正常なアップデートは **バージョン 0.2.7 以降**でサポートされています。  
それ以前のバージョンでは、アンインストール後に **再インストール** が必要です。

:::caution
Apache 実行中に PHP Extension の *shared library (.so)* を変更すると、Apache デーモンが異常終了する恐れがあります。  
必ず Apache サーバーを停止した状態で更新を行ってください。
:::

## Red Hat/CentOS

1. パッケージ情報更新のためキャッシュを削除します。

```bash
$ yum clean all
```

2. Apache または PHP-FPM を停止します。

3. whatap-php パッケージを更新します。

```bash
$ yum update whatap-php
```

:::note
特定バージョンを指定して更新する場合：

```bash
$ yum update whatap-php-{version}
```
:::

---

## Debian/Ubuntu

1. パッケージ情報を更新します。

```bash
$ sudo apt-get update
```

2. Apache または PHP-FPM を停止します。

3. whatap-php パッケージを更新します。

```bash
$ sudo apt-get install --only-upgrade whatap-php
```

:::note
特定バージョンを指定する場合：

```bash
$ sudo apt-get install whatap-php={version}
```
:::

---

## FreeBSD

エージェントを削除して再インストールしてください。

1. Apache または PHP-FPM を停止

2. エージェント削除と再インストール

```bash
$ /usr/whatap/php/install.sh remove

$ wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/freebsd/10/whatap-php-0.4.10.txz
$ pkg install whatap-php-0.4.10.txz
```

3. PHP Extension モジュールと whatap-php サービスを登録

```bash
$ /usr/whatap/php/install.sh
```

:::note
特定バージョンを指定する場合：

```bash
$ wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/freebsd/10/whatap-php-{version}.txz
$ pkg install whatap-php-{version}.txz
```

その後、Apache または PHP-FPM を開始してください。
:::

---

## Windows

`whatap_php_setup.exe` を実行すると、既存の設定を保持したまま自動的にアップデートが行われます。

:::warning
更新時は Web サーバーを停止し、更新後に再起動することを推奨します。
:::

### GUI アップデート

1. Web サーバーを停止

```cmd
net stop Apache2.4
REM または
iisreset /stop
```

2. インストーラーを実行して更新

```cmd
whatap_php_setup.exe
```

3. Web サーバーを再起動

```cmd
net start Apache2.4
REM または
iisreset /start
```

---

### CLI 自動アップデート

既存インストールがある場合、自動的にアップデートモードで動作します。

1. Web サーバーを停止

```cmd
net stop Apache2.4
```

2. インストーラー実行

```cmd
whatap_php_setup.exe /VERYSILENT /SUPPRESSMSGBOXES /NORESTART
```

3. Web サーバー開始

```cmd
net start Apache2.4
```

---

### バッチスクリプト例

```batch
@echo off
echo Stopping web server...
net stop Apache2.4

echo Updating WhaTap PHP Agent...
whatap_php_setup.exe /VERYSILENT /SUPPRESSMSGBOXES /NORESTART

if %errorlevel% equ 0 (
    echo Update completed successfully!
) else (
    echo Update failed with error code: %errorlevel%
    exit /b %errorlevel%
)

timeout /t 3

echo Starting web server...
net start Apache2.4
echo Update completed!
```