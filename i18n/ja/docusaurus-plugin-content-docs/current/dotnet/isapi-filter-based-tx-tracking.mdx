---
id: isapi-filter-based-tx-tracking
title: ISAPIフィルターベースのトランザクション追跡
description: ISAPIフィルターベースでトランザクション追跡機能を適用する方法を案内します。
keywords:
  - .NET
---

WhaTapの.NETエージェントは、IISで動作する様々なアプリケーションのトランザクションを追跡できるよう、ISAPIフィルタ機能を提供します。 これにより、ASP、ASP·NET、CGI、ISAPIの拡張など、.NET以外の様々な技術ベースのリクエストまで幅広くモニタリングできます。

:::note 

**要求事項**

ISAPIフィルター機能は、WhaTapの.NETエージェントv2.4.0以降に対応します。

:::

## インストール

1. 既存の[エージェントインストール](/dotnet/install-agent)案内どおり.NETエージェントをインストールします。 

2. エージェントインストール後*whatap_isapi_filter.dll*ファイルを対象サイトのルートディレクトリにコピーします。 

   ```bash
   C:..> copy "C:\Program Files\WhaTap .NET\whatap_isapi_filter.dll" C:\inetpub\yoursite
   ```

   - フィルターファイルをIISのウェブサイトが運用されるディレクトリ内にコピーする場合、追加設定は必要ありません。 

   - フィルターファイルは必ずしもウェブサイトが運用されるディレクトリ内に存在しなくてもよいが、当該経路及びファイルに**IIS_IUSRS**グループの**読み取りと実行権限**が付与される必要があります。

## ISAPIフィルター設定

ISAPIフィルターは**サーバー全体**または**個別サイト**単位で適用できます。

### サーバー全体フィルター適用

IISホスティングされたすべてのウェブサイトのリクエストに対してフィルターを適用するには、次のように設定してます。 

<ImgLang img="dotnet-isapi-pic-001.png" desc="서버 전체 필터 적용" />

1. IIS管理者を実行します。

2. 左側のツリーでサーバーノードを選択します。

3. 中央領域でISAPIフィルターアイコンをダブルクリックします。

### 個別サイトフィルター適用

個別サイトのトランザクションをフィルタリングするには、次のように設定します。 

<ImgLang img="dotnet-isapi-pic-002.png" desc="개별 사이트 필터 적용" />

1. IIS管理者を実行します。

2. 左側のツリーで対象サイトを選択します。 

3. 中央領域でISAPIフィルターアイコンをダブルクリックします。 

### フィルター項目追加

<ImgLang img="dotnet-isapi-pic-003.png" desc="필터 항목 추가" />

1. 右側の作業画面で追加ボタンをクリックします。 

2. フィルター名は自由に指定します。

3. *whatap_isapi_filter.dll*ファイルを見つけて選択します。

4. 確認ボタンをクリックします。 

## ISAPIフィルターが動作しない場合

フィルター設定後も動作しない場合**ISAPI及びCGI制限設定**を追加する必要があります。

<ImgLang img="dotnet-isapi-pic-004-2.png" desc="필터 미동작 sc" />

1. IIS管理者の左のツリーでサーバーを選択します。 

2. 中央領域でISAPI及びCGI制限アイコンをダブルクリックします。 

3. 右側の作業画面で追加ボタンをクリックします。 

4. *whatap_isapi_filter.dll*ファイルを選択します。 

5. 項目名を入力します。 

6. 拡張パス実行許可のチェックボックスをチェックします。 

7. 確認ボタンをクリックします。 
