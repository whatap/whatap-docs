---
id: install-agent
title: インストール
description: Amazon CloudWatchアイテムのインストールについて説明します。
keywords:
  - インストール
  - Amazon CloudWatch
  - クラウド
---

import TR from '@site/src/components/TR';
import ProdImg from '@site/src/components/ChangeImgName.js';

WhaTap Amazon CloudWatchモニタリングはAPI連動を通じてメトリクスを定期的に収集します。収集対象のサービスに該当するCloudWatchネームスペースから5分間隔で必要なスタットを選択して収集します。モニタリングを開始する時、すべてのリージョンのユーザーリソースを検索し、ワンクリックでモニタリングを開始できます。Role方式認証で安全かつ便利に使用できます。 

WhaTapモニタリングサービスを使用するには、まず[会員登録](https://www.whatap.io/ja/signup/)後にプロジェクトを作成する必要があります。会員登録に関する詳細については、[次の文書](../account/account-manage)を参照してください。

import Createprojectv2 from "../getting-started/_create-project-v2.mdx";

<Createprojectv2 />

## チェックリスト

必要なアクセス権限と推奨されるポリシーを確認してください。

| Resouce          | 権限   |
| ---------------- | ---- |
| CloudWatch       | Read |
| EC2              | Read |
| ElasticCache     | Read |
| CloudFront       | Read |
| Dynammodb        | Read |
| ElasticBeansTalk | Read |
| AutoScaling      | Read |
| EFS              | Read |
| RDS              | Read |

- **推奨ポリシー**
  - arn:aws:iam::aws:policy/ReadOnlyAccess

## モニタリング手順

1. Amazon認証情報を入力します。
2. CloudWatchネームスペースおよび収集サイクルを選択します。
3. リージョン、メトリクス、統計などを選択します。

:::note

インストール後の使用状況によっては、WhaTap料金とは別にクラウドで追加費用が発生する場合があります。インストール前に使用しているクラウドサービスの価格ポリシーを[次の文書](https://aws.amazon.com/jp/cloudwatch/pricing/)で確認してください。

:::

### 認証情報入力

Role ARNを利用したインストール方法をサポートします。WhaTapのAWSアカウント(**911937781722**)は、直接ユーザーRoleをAssumeしてCloudwatch情報を収集します。Role Assumeはアクセスキーの発行を必要としないため、安全かつ便利です。

:::note

Roleを利用する設定をお勧めします。Access Keyの使用は、既存のAccess Keyのユーザーのみ可能です。

:::

#### ロール(Role)生成

<ImgLang img='cloudwatch-auth-role.png' desc='Amazon Cloudwatch - role' />

1. AWS Management Consoleにログインしてから、IAMコンソールを開きてください。
2. コンソールのダッシュボードでロールを選択し、「ロールを作成」を選択します。 
3. 信頼されたエンティティタイプ(Select type of trusted entity)からAWSアカウントを選択します。 
4. 別のAWSアカウントを選択し、アカウントIDにWhaTapのIDである**911937781722**を入力して、次へをクリックします。
5. 絞り込みタイプから「AWS管理 - ジョブ機能」を選びます。 
6. 表示されるリストから「ReadOnlyAccess」を選択して適用し、次へをクリックします。 
7. ロール名と説明を入力し、「ロールを作成」ボタンをクリックします。 
8. ロールのリストから作成したロールを選択し、概要(Summary)の編集ボタンをクリックします。 
9. 最大セッション時間(Maximum session duration)を「12時間」に変更して保存します。 
10. ロールの**ARN**項目をコピーします。
11. WhaTap***管理*** > ***エージェントのインストール***ページに戻り、***Role***欄にコピーした**ARN**を貼り付け、***確認***ボタンをクリックします。

### ネームスペースおよび収集周期の選択

import Namespacecollect from "../common-items/_namespace-collect.mdx";

<Namespacecollect />

#### WhaTapの収集周期

import Collectingperiod from "../common-items/_collecting-period.mdx";

<Collectingperiod />

#### ネームスペース

- AWS ACMPrivateCA
- AWS AmazonMQ
- AWS ApplicationELB Monitoring
- AWS AppSync
- AWS Athena
- AWS AutoScaling
- AWS Elastic Beanstalk Health
- AWS Billing
- AWS Cassandra
- AWS Chatbot
- AWS Cloud Front
- AWS CloudHSM
- AWS CloudSearch
- AWS CodeBuild
- AWS CodeGuruProfiler
- AWS Cognito
- AWS Connect
- AWS ContainerInsights Monitoring
- AWS DataSync
- AWS DAX
- AWS DDoSProtection
- AWS DMS
- AWS DocDB
- AWS DX
- AWS Dynamo DB
- AWS Ebs Usage
- AWS EC2 Monitoring
- AWS EC2 Alert Config
- AWS EC2Spot
- AWS ECS
- AWS ECS ContainerInsights Monitoring
- AWS EFS
- AWS ElastiCache Usage
- AWS ElasticGPUs
- AWS ElasticInference
- AWS ElasticMapReduce
- AWS ElasticTranscoder
- AWS Classic ELB Monitoring
- AWS ES
- AWS Events
- AWS Firehose
- AWS FSx
- AWS GameLift
- AWS GatewayELB
- AWS Glue
- AWS GroundStation
- AWS Health
- AWS Inspector
- AWS IoT
- AWS IoTAnalytics
- AWS IoTSiteWise
- AWS IVS
- AWS Kafka
- AWS Kinesis
- AWS KinesisAnalytics
- AWS KinesisVideo
- AWS KMS
- AWS Lambda
- AWS Lex
- AWS Location
- AWS Logs
- AWS LookoutMetrics
- AWS MediaConnect
- AWS MediaConvert
- AWS MediaPackage
- AWS MediaStore
- AWS MediaTailor
- AWS ML
- AWS NATGateway
- AWS Neptune
- AWS NetworkELB
- AWS NetworkFirewall
- AWS OpsWorks
- AWS Polly
- AWS QLDB
- AWS RDS Monitoring
- AWS Redshift
- AWS Robomaker
- AWS Route53
- AWS S3
- AWS SageMaker
- AWS SDKMetrics
- AWS ServiceCatalog
- AWS SES
- AWS SNS
- AWS SQS
- AWS SQS Message
- AWS SSM-RunCommand
- AWS States
- AWS StorageGateway
- AWS SWF
- AWS Textract
- AWS ThingsGraph
- AWS Timestream
- AWS Transfer
- AWS TransitGateway
- AWS Translate
- AWS TrustedAdvisor
- AWS Api Usage
- AWS VPN Monitoring
- AWS WAF
- AWS WorkMail
- AWS WorkSpaces

### リージョン、メトリクス、統計を選択

import Regionmetricstats from "../common-items/_region-metric-stats.mdx";

<Regionmetricstats />

<ImgLang img='amazon_cloudwatch_setup_dialog_2nd.png' desc='Amazon Cloudwatch - Region,Metric,Stats' />

## データ収集の無効化及びサービス初期化 {#data-deactivation}

<ImgLang img='amazon-cloudwatch-deact.png' desc='データ収集の無効化及びサービス初期化' />

- ![指示線a](/img/char-a.svg) 活性化トグル![アイコン](/img/ic-toggle-off.svg)がOFFの場合、データ収集が中止されます。

- ![指示線b](/img/char-b.svg) ***ロール変更***ボタンをクリックし、***エージェント設定***画面から![指示線c](/img/char-c.svg) ***サービス初期化***を選択すると、すべてのメトリクス収集サービスが無効化されます。

- データ収集により発生するすべての費用を防ぐためには、**AWS IAM**コンソールからWhaTapとの連携のため追加した**ロール**(Role)を削除してください。
