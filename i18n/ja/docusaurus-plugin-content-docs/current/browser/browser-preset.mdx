---
id: browser-preset
title: 事前設定
description: ブラウザーエージェントを適用するための事前設定方法を提供します。
tags:
  - Browserモニタリング
  - 事前設定
---

ブラウザーエージェントを適用し、データ収集の手順に従って事前設定を進めてください。

## コンテンツセキュリティポリシーの設定

既存のコンテンツセキュリティポリシー(Content Security Policy、以下CSP) が設定されているウェブアプリケーションの場合、ブラウザーエージェントのCDN URLと収集データを送信するための収集サーバーのURLを追加する必要があります。

さらに、ブラウザーエージェントが効率的にデータ送信を行うには、ウェブワーカー関連のCSPオプションを追加する必要があります。

| ディレクティブ(directive)          | ソース(source)                                        | 説明                                                           |
| --------------------------- | -------------------------------------------------- | ------------------------------------------------------------ |
| script-src, script-src-elem | unsafe-inline                                      | ブラウザーエージェントをインラインスクリプトとしてインストール                              |
| script-src, script-src-elem | https://repo.whatap-browser-agent.io/rum/prod/     | ブラウザーエージェントCDNドメイン                                           |
| connect-src                 | https://rum-ap-northeast-2.whatap-browser-agent.io | 収集したデータを送信するためのドメイン                                          |
| worker-src, child-src       | blob:                                              | ブラウザーエージェントの効率的なデータ送信のウェブワーカー関連のCSPオプション(推奨事項)               |

## Timing-Allow-Origin設定

リソースを提供するサーバーにCORSを適用すると、ほとんどのリソースタイミング属性を0に戻ります。 ブラウザーエージェントがリソースの属性値を収集するには、サーバーから`Timing-Allow-Origin`HTTPレスポンスヘッダーを返す必要があります。 

リソースを提供するサーバーが制御できる場合は、各レスポンスにヘッダーを追加し、属性にアクセスするすべてのドメイン(ブラウザーエージェントを適用したウェブサイトのドメイン)を追加する必要があります。

- 例 1：すべてのソースでリソースタイミング情報を提供します。
  ```json
  Timing-Allow-Origin: *
  ```
- 例 2：ブラウザーエージェントを適用したウェブ アプリケーションのドメインのみ、リソースタイミング情報を提供します。
  ```json
  Timing-Allow-Origin: www.site.com
  ```
