---
id: apply-agent
title: ブラウザエージェントの適用
description: WebアプリケーションにWhaTap Browser Monitoringエージェントを適用し、ブラウザモニタリングを開始します。
keywords:
  - Browser Monitoring
  - エージェント
---

import TR from '@site/src/components/TR';

WhaTap Browser Monitoringサービスを使用するには、[会員登録](https://www.whatap.io/ja/)後、プロジェクトを作成し、WebアプリケーションにWhaTap Browser Monitoringエージェントを適用する必要があります。

次の動画ガイドを参照してください。

<Youtube ko='gZ5A40G2u2A' en='z0-WMAEQo30' ja='z0-WMAEQo30' />

import Createprojectv2 from "../getting-started/_create-project-v2.mdx";

<Createprojectv2 />

import Accesskey from "../getting-started/_accesskey.mdx";

<Accesskey />

## WhaTap Browser Monitoringエージェントのインストール

エージェントのインストール画面の指示に従って、Webアプリケーションに適用するWhaTap Browser Monitoringエージェントのコードを適用します。

<ImgLang img='rum-apply-agent.png' desc='WhaTap Browser Monitoringエージェントのインストール' />

### ![](/img/number-01.png)データ収集サンプリング

WhaTap Browser Monitoringエージェントは、ユーザーセッションを基準にデータを収集します。 収集する全体セッションの割合を0から100の範囲で設定できます。

### ![](/img/number-02.png)WhaTap Browser Monitoringエージェントスクリプト

WhaTap Browser Monitoringエージェントは、インラインスクリプトの形式で提供します。 インストールガイドで提供するスクリプトコードを、モニタリング対象のすべてのHTML ページの`<head>`タグの先頭に追加します。

次の2つの方法のいずれかを選択して、エージェントを適用します。

- **_Async_**(非同期ロード): WebアプリケーションにWhaTap Browser Monitoringエージェントを非同期形式でロードします。 

  - ウェブアプリケーションのロード性能に影響しません。 

  - Browser Monitoringエージェントがロードされる前に発生したAJAX、エラーなどのデータが欠落する可能性があります。

- **_Sync_**(同期ロード): WebアプリケーションにWhaTap Browser Monitoringエージェントを同期形式でロードします。

  - ウェブアプリケーションのロード時にすべてのデータを収集することをお勧めします。 

  - ウェブアプリケーションのロードに影響を与える可能性があります。

## WhaTap Browser Monitoringエージェントのオプション設定 {#setting-agent}

WhaTap Browser Monitoringエージェントに適用するオプションを設定します。 オプションは、インストールスクリプトのConfigオブジェクトで設定できます。 プロジェクトアクセスキー、ユーザーセッション全体の割合、収集から除外リソースドメインなどを設定できます。

```javascript title='config example' showLineNumbers
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  ignoreOrigins: [ 'https://ignore-site.com/', /^(https?://)([^/]*)(ignore-site.io)(/)(.*)/i ],
}
```

### オプションパラメータ

<Columns>
<Column className="text--left width--40">

**projectAccessKey** <span class='type'>String</span> <code className="my">required</code>

プロジェクトアクセスキーです。 プロジェクトインストールのご案内(<Cmdname sid="side_management" className="uitext" /> &gt; <Cmdname sid="side_agentInstall" className="uitext" />)で確認できます。 

</Column>
<Column className="text--left">

```js showLineNumbers {2}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**pcode** <span class='type'>Number</span> <code className="my">required</code>

プロジェクトアクセスキーです。 プロジェクトインストールのご案内(<Cmdname sid="side_management" className="uitext" /> &gt; <Cmdname sid="side_agentInstall" className="uitext" />)で確認できます。 

</Column>
<Column className="text--left">

```js showLineNumbers {3}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**sampleRate** <span class='type'>Number</span> <code className="my">required</code>

収集するユーザーセッションの割合を設定できます。 0から100まで設定できます。

</Column>
<Column className="text--left">

```js showLineNumbers {4}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**proxyBaseUrl** <span class='type'>String</span> <code className="my">required</code>

エージェント収集データの転送URLです。

</Column>
<Column className="text--left">

```js showLineNumbers {5}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**ignorePageUrls** <span class='type'>Array\<string \| RegExp\></span> <code className="my">optional</code>

収集から除外するページURLの一覧です。 文字列のマッチングは`startsWith`方式で行われます。

</Column>
<Column className="text--left">

```js showLineNumbers {6}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
  ignorePageUrls: ["https://test.webpage.com/", "http://localhost:2003/page1/", /^.localhost.$/i]
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**ignoreResources** <span class='type'>Array\<string \| RegExp\></span> <code className="my">optional</code>

収集から除外するリソースURLの一覧です。 文字列のマッチングは`startsWith`方式で行われます。

</Column>
<Column className="text--left">

```js showLineNumbers {6}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
  ignoreResources: ["https://test.web.com/yard/api/flush", "http://localhost:2003/whatap-browser-agent.js",  /^.\/path1\/api.$/i]
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**ignoreErrors** <span class='type'>Array\<string \| RegExp\></span> <code className="my">optional</code>

収集から除外するブラウザエラーの一覧です。 文字列のマッチングは`includes`方式で行われます。

</Column>
<Column className="text--left">

```js showLineNumbers {6}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
  ignoreErrors: ["cannot read", "cors", "basic"]
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**collectUserClick** <span class='type'>Boolean</span> <code className="my">optional</code>

既定値`false`

ユーザークリックイベントを収集できます。 収集したデータを確認する方法は[次の文書](user-session-log-search#click--rapid_click)を参照してください。

</Column>
<Column className="text--left">

```js showLineNumbers {6}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
  collectUserClick: true
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**sessionReplaySampleRate** <span class='type'>Number</span> <code className="my">optional</code>

既定値`0`

セッションリプレイデータを収集するセッションの割合です。 収集対象ユーザーのセッションのうち、0から100まで設定できます。

例えば、`sampleRate`を**50**に設定し`sessionReplaySampleRate`を**20**に設定すると、全体セッションの50%が収集対象となり、そのうち20%のセッションでのみセッションリプレイデータを収集します。

</Column>
<Column className="text--left">

```js showLineNumbers {6}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
  sessionReplaySampleRate: 50
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**sessionReplayMaskAllTexts** <span class='type'>Boolean</span> <code className="my">optional</code>

既定値 `true`

値を`false`に設定すると、マスキング処理なしですべてのテキストデータを収集します。

</Column>
<Column className="text--left">

```js showLineNumbers {7}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
  sessionReplaySampleRate: 50, 
  sessionReplayMaskAllTexts: false
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**sessionReplayMaskAllInputs** <span class='type'>Boolean</span> <code className="my">optional</code>

既定値 `true`

値を`false`に設定すると、マスキング処理なしですべて入力(Input)フィールド領域のデータを収集します。

</Column>
<Column className="text--left">

```js showLineNumbers {7}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
  sessionReplaySampleRate: 50, 
  sessionReplayMaskAllInputs: false
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**sessionReplayCollectAllBrowser** <span class='type'>Boolean</span> <code className="my">optional</code>

既定値`false`

`requestIdleCallback()`に対応しないブラウザでもセッションリプレイデータを収集します。 例え、Safari、Safari on iOS

</Column>
<Column className="text--left">

```js showLineNumbers {7}
config: {
  projectAccessKey: {projec_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js"
  sessionReplaySampleRate: 50, 
  sessionReplayCollectAllBrowser: true
}
```

</Column>
</Columns>

<Columns>
<Column className="text--left width--40">

**ignoreStatusZero** <span class='type'>Boolean</span> <code className="my">optional</code>

既定値`false`

AJAXリクエストのステータスコードが`0`の場合、該当データを収集から除外するオプションです。

</Column>
<Column className="text--left">

```js showLineNumbers {6}
config: {
  projectAccessKey: {project_access_key},
  pcode: {pcode},
  sampleRate: 100,
  proxyBaseUrl: "https://repo.whatap-browser-agent.io/rum/prod/v1/whatap-browser-agent.js",
  ignoreStatusZero: true
}
```

</Column>
</Columns>

:::note

- セッションリプレイについての詳細は、[次の文書](session-replay)を参照してください。

- セッションリプレイ収集に対応するブラウザの詳細は、[次の文書](session-replay#supportedbrowser)を参照してください。

:::

## 次の段階

- **ユーザー定義イベントを収集する**

  Browser Monitoringを通じてウェブサービスの問題点を把握し、ユーザー体験を改善するために、ウェブページで発生するイベントのうち、開発者と運営者が希望するイベントを追加で収集できるインターフェースを提供します。 ユーザー定義イベントを収集する方法の詳細については、[次の文書](collect-custom-events)を参照してください。

- **実際のユーザーIDを設定する**

  Browser Monitoringでは、実際のユーザーIDやEメールなどでユーザーIDを設定し、データを収集できます。 実際のログインIDに基づいてユーザーセッションの性能とイベントの情報やブラウザーのエラー情報を確認して問題を把握できます。 詳細については、[次の文書](set-real-user-id)を参考にしてください。

- **セッションリプレイを設定する**

  <Cmdname sid="TTL08103" className="uitext" />は、ユーザーがウェブサイトで行うすべてのイベントを記録し、再生できる機能です。 この機能により、クリック、スクロール、入力、ページ切り替えなどのユーザー行動を再現できます。 これにより、ユーザーが実際にウェブサイトとどのように相互作用するかを、正確に把握できます。 詳細については、[次の文書](session-replay)を参照にしてください。

- **モニタリングの開始**

  [WhaTapモニタリングサービス](https://service.whatap.io)ページに移動し、Browser Monitoringを開始します。 先に作成したプロジェクトを選択し<Cmdname sid="side_dashboard" className="uitext" /> &gt; <Cmdname sid="side_rumDashboard" className="uitext" />メニューに移動してください。 モニタリング状況を確認できます。 <Cmdname sid="side_rumDashboard" className="uitext" />メニューの詳細については、[次の文書](dashboard)を参照にしてください。
