---
id: analysis-lock-and-deadlock
title: ロックツリー
description: 1日に発生したロックの推移を分析し、デッドロック状態のクエリを確認できます。
keywords:
  - SQL Server
  - データベース
  - Lock
  - ロックツリー
---

{/* 락트리 */}
import Dblocktreedesc from "../common-items/_db-locktree-desc.mdx";

<Dblocktreedesc />

import Dblocktreeusingbasic from "../common-items/_db-locktree-using-basic.mdx";

<Dblocktreeusingbasic level={2} />

{/* 컬럼 정보 안내 */}
import Mssqlcolumn from "../common-items/_db-mssql-column.mdx";

<Mssqlcolumn level={2} />

### wait_type {#waittype}

`wait_type`カラムは、**SQL Server**でクエリやトランザクションが待機している特定のリソースやイベントを表す値です。 **SQL Server**は、内部的に様々な待機タイプを使用してシステムのパフォーマンスを管理し、問題を診断します。

#### I/0関連待機

- `PAGEIOLATCH_EX`：データページを読み込むために排他的ロックを待機します。

- `PAGEIOLATCH_SH`：データページを読み込むために共有ロックを待機します。

- `FILEIO`：ファイル I/O作業中の待機です。

#### ロック(Lock) 関連待機

- `LCK_M_X`：排他的ロック待機です。

- `LCK_M_S`：共有ロック待機です。

- `LCK_M_U`：アップデートのロック待機です。

- `RESOURCE_SEMAPHORE`'：リソースセマフォの待機、メモリリソースを確保するために待機する場合です。

#### その他待機

- `CKPACKET`：並列クエリでスレッド間同期の待機です。

- `ASYNC_NETWORK_IO`：ネットワーク10作業中の待機です。

- `SLEEP_*`：`WAITFOR`または`WAITFOR DELAY`文により待機中です。

- `BROKER_*`：Service Brokerメッセージ待機です。

- `LOCK_MANAGER`：ロック管理待機、**SQL Server**のロック管理者に関連する待機です。

### wait_resource {#waitsresource}

`wait_resource`カラムは、**SQL Server**で実行中のリクエストが待機しているリソースに関する情報を提供します。 リクエストが特定のリソースを待っている状況を文字列形式で表現し、待機中のリソースの具体的な識別子や場所を示します。

主なリソースタイプと例については、以下を参照してください。

- `PAGE: <file_id>:<page_id>`

  データページの待機を示します。 

  > 例）`PAGE: 1:12345`

- `FILE: <file_id>`

  データファイル全体に対する待機を示します。

  > 例）`FILE: 1`

- `0BJECT: <cobject_id>`

  特定のテーブルに対する待機を示します。

  > 例）`0BJECT: 123456`

- `DATABASE: <database_id>`

  特定のデータベースに対する待機を示します。

  > 例）`DATABASE: 5`

- `KEY: <key_id>`

  インデックスキーまたは他のデータ構造のキーに対する待機を示します。

  > 例）`KEY: 67890`

- `RID: <file_id>:<page_id>:<row_id>`

  `wait_resource`カラムが`RID`(Row Identifier)の場合は、**SQL Server**の特定の行(row)に対する待機を示します。 `RID`は、SQL Serverでテーブルの特定の行を識別する固有の識別子です。

  > 例）`RID: 1:1234:5678`

:::note

- `<file_id>`は、データファイルのIDを意味します。

- `<page_id>`は、ページのIDを意味します。

- `<object_id>`は、テーブルのIDです。

- `<database_1d>`は、データベースのIDです。

- `<key_id>`はキーのIDです。

- `<row_id>`は、ページ内で行を識別するIDです。

:::
