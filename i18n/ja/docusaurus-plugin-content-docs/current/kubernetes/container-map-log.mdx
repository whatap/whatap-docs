---
id: container-map-log
title: Log
description: コンテナまたはコンテナ内で実行中のアプリケーションによって出力されたログをすぐに確認できます。
tags:
  - Kubernetes
  - Kubernetesモニタリング
  - Log
---

ホーム画面 > プロジェクト選択 > **_ダッシュボード_** > **_コンテナマップ_** > 対象選択後**詳細を見る**画面に入力 > **_ログ_**

## Kubernetesログ

WhaTap Kubernetesモニタリング サービスは、Kubernetesで発生するログを収集して保存します。 

<!-- 

실시간으로 발생하는 로그는 컨테이너 ***Stdout/Stderr*** 탭의 최근 로그 메시지와 ***로그 검색*** 탭을 통해 조회할 수 있습니다. >

-->

Kubernetesには、次の2種類のログがあります。

-   各コンテナのStandard Out(標準出力) ログ
-   各コンテナの内で実行中のアプリケーションによって出力されたログ

これらのログは、コンテナの状態やメトリクス情報では確認しにくいモニタリングの盲点を補正する役割を果たします。このログを確認する方法は次のとおりです。

-   各コンテナのStandard Outログの場合は、コンテナを入力せずに、Kubernetesが提供する`kubectl logs`コマンドで確認できます。
-   各コンテナ内のアプリケーションログは、コンテナを入力して確認するか、個別のログ収集方法を確率する必要があります。

## 最近のログメッセージ (コンテナStdout／Stderr)

現在のコンテナログをすぐに確認できる機能です。クラスター環境から直接ログを取得して、選択したコンテナのリアルタイムログまたは選択したPod内アプリケーションのリアルタイムログを確認できます。通常、コンテナログを確認するには、次のコマンドを使用します。

```bash
kubectl logs pod/<Pod名> -n <Namespace名>
```

Pod内に2つ以上のコンテナがある場合は、個々のコンテナを選択してログを確認します。

```bash
kubectl logs pod/<Pod名> -c <コンテナ名> -n <Namespace名>
```

ログを確認する度にターミナル画面にアクセスしてコマンドラインツールを実行するのは非常に不便です。WhaTap Kubernetesモニタリングの**_ログ_**機能を使用すると、現在のログを簡単に確認できます。 

![最近ログメッセージ](/img/k8s-container-log.png)

ただし、注意点があります。まず、コンテナを終了すると、ログが確認できなくなります。また、コンテナが実行中であっても、特定の期間または特定の時間のログだけしか確認できないデメリットがあります。WhaTapの最近のログメッセージ(**_コンテナStdout/Stderr_**) 機能は、Kubernetes環境からのログをWhaTapを通じて確認できる機能であり、ユーザー環境から消えたログは、WhaTapでは確認できません。 

したがって、ログデータを安定的かつ継続的に管理するためには、別な管理方法が不可欠です。特にマイクロサービスアーキテクチャの採用が広がり、ビジネスを構成するコンテナ数が増加するにつれてログの検証と管理はますます複雑になっています。

良い方法はありますか？

## ログ検索

コンテナを終了すると、関連するログはすべて消えますが、**_ログ検索_**機能を使用して、選択したコンテナまたはPodで過去に発生したログを確認できます。コンテナStandardOutログを保存する場合、希望する保存期間が設定でき、特定の対象固有の情報の確認や相関分析をができます。 

![ログ検索](/img/k8s-log-search.png)

-   ![number 1](/img/number-01.png)時間セレクターを使用すると、データを表示するタイミングを選択できます。 

-   ![number 2](/img/number-02.png)カテゴリを指定して参照することができます。表示できるカテゴリの説明については、次のブロックとグループガイドを参照してください。

-   ![number 3](/img/number-03.png) ![もっと見るアイコン](/img/ic-caret-right.svg) **_もっと見る_**アイコンを選択すると、解析されたキーと値のログとログメッセージを確認できます。詳しい内容は、[次の文書](../log/log-search)を参照してください。

#### 一般ブロックとマイクロブロック

![コンテナブロックsc](/img/k8s-block.png)

-   ![aアイコン](/img/char-a.svg) **一般ブロック**

    コンテナマップの1つのポリゴンをブロックといいます。ログの`containerStdout`カテゴリーでは、`containerid`に一致する情報を確認できます。

-   ![bアイコン](/img/char-b.svg) **マイクロブロック**

    エージェントがインストールされているブロックをマイクロブロックと呼びます。`containerStdout`カテゴリーだけでなく、`AppLog`、`AppStdOut`、`AppStdErr`などの`App*`関連カテゴリも確認できます。カテゴリを選択する場合、`microOid`(ブロック内のエージェントid)が一致するログ情報を確認できます。

#### グループ

![コンテナブロックグループsc](/img/k8s-container-group.png)

**_コンテナマップ_**画面で全体ブロックを選択した場合、または**詳細を見る**画面のカードでブロックを複数選択した場合、そのマルチブロックをグループと呼びます。グループを選択すると、**_ログ検索_**タブで`containerStdout`カテゴリと`App*`カテゴリのすべてのログを確認できます。

:::caution

WhaTapログサービスを有効にして、コンテナのStandard Outputログ保存機能を使用する場合、それに伴う追加費用が請求されます。関連する料金の詳細については、[次の文書](https://www.whatap.io/ko/pricing/)を参照してください。

:::

:::note

一部の古いバージョンのエージェントは、コンテナStandard Outputログ保存機能を提供しません。エージェントのアップグレード方法は次のとおりです。

```bahs title='Agent update'
kubectl set image daemonset/whatap-node-agent whatap-node-agent=whatap/kube_mon:<エージェントバージョン> -n whatap-monitoring
```

WhaTap Kubernetesエージェントバージョンについては、 [次の文書](https://hub.docker.com/r/whatap/kube_mon/tags)で確認できます。

:::

### Standard Out保存のNodeエージェント設定の追加

WhaTapログサービスをコンテナのStandard Outputを保存するには、WhaTap Kubernetes Nodeエージェントに`logsink_enabled=true`設定を追加する必要があります。WhaTap Kubernetes Nodeエージェントは、DaemonSetの形式です。

-   WhaTapモニタリングサービスページで、**_管理_** > **_エージェント設定_**を使用して、`logsink_enabled=true`設定を追加
-   クラスタープロジェクト全体のノードを対象に設定を追加するには、**_プロジェクトのデフォルト_** > **_Node_**を対象に設定を追加
-   一部のNodeを対象に設定を追加するには、単一または複数のNodeを選択して設定を追加

**_管理_** > **_エージェント設定_** > Nodeエージェント選択 > **_+ オプション追加_** > すべてのエージェントに適用するオプションを選択 > 適用対象Node選択 

![エージェント設定](https://img.whatap.io/media/images/whatap_kubernetes_container_map_logsink_enabled.png)

## ログ検索移動

![ログ検索移動sc](/img/k8s-log-search-to-log-search.png)

**_ログ_**タブの右側にある**_ログ検索_**ボタンをクリックすると、フィルター機能を使用して詳細を表示できる**_ログ_** > **_ログ検索_**メニューに移動します。 

:::note

WhaTapログモニタリングサービスの詳細については、[次の文書](../log/introduction)を参照してください。 

:::

<!-- 

로그 검색 이동 제거 예정

-->
