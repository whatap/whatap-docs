---
id: about-apm-dashboard
title: アプリケーションダッシュボードを見る
description: アプリケーションのパフォーマンスモニタリング機能の1つであるアプリケーションダッシュボードのメニューからチャート型ウィジェットの分析方法を紹介します。
tags:
  - アプリケーション
  - アプリケーションモニタリング
  - アプリケーションダッシュボード
  - APM
keywords:
  - アプリケーション
  - アプリケーションモニタリング
  - アプリケーションダッシュボード
  - APM
displayed_sidebar: learningSidebar
---

この文書では、WhaTapモニタリングサービスの一つであるアプリケーションパフォーマンスモニタリング(Application Performance Monotoring、以下APM)の**_アプリケーションダッシュボード_**メニューからチャート型ウィジェットに対する分析方法を紹介します。Webアプリケーションサーバ(Web Application Server)の問題を**_アプリケーションダッシュボード_**を使用して、特定及び分析する方法を見てみましょう。アプリケーションダッシュボードの機能については、[次のドキュメント](https://docs.whatap.io/java/dashboard)を参照してください。

ウェブサービスは多数のアプリケーションとプラットフォームで構成されており、アプリケーションの観点から性能を分析は複雑になります。**_アプリケーションダッシュボード_**では、次の観点から分析できるダッシュボードにウィジェットを追加しました。

-   アプリケーション接続のステータス： エージェント
-   トランザクション：**_スピードメーター_**、**_アクティブトランザクション_**、**_アクティブステータス_**、**_ヒットマップ_**
-   サービス： **_ Apdex_**、**_TPS_**、**_平均応答時間_**
-   リソース：**_システムCPU_**、**_ヒップメモリ_**
-   ユーザー： **_同時接続ユーザー_**
-   1日基準での比較：**_今日のTPS_**、**_今日のユーザー_**

## アプリケーション接続のステータスを確認

**_アプリケーションダッシュボード_**画面の上部に、WhaTapモニタリングサービスに接続されたアプリケーションサーバーを表示することができます。接続されたエージェントが非アクティブになっているか、アプリケーションサーバーから接続が切断されている場合は、**_Inactive_**項目を確認してください。これにより、エージェントの状態を簡単に把握できます。

<ImgLang img='apm-dashboard-select-agent.png' />

接続されたエージェントを一行に一覧表示して画面を効率的に使用する場合は、エージェントの名前を短く設定できます。エージェント名を設定する方法の詳細については、[次の文書](https://docs.whatap.io/java/agent-name)を参照してください。

## トランザクション分析

<ImgLang img='best-p/apm-dashboard-service.png' />

ウェブアプリケーションサーバー(WAS)を使用するユーザーは、ブラウザを使用して要求されたサービス(AP)の結果が正しく実行されることを期待します。サービス(AP)は、正しく動作するためにサーバーのリソースを使用します。 リソースとは、APプロセス、OS／HWリソース(CPU、メモリ、ディスクなど)、外部システム(Database、その他のサーバ) などを意味します。

ユーザーが希望する結果が得られない場合、応答が遅い場合は、障害の発生または、パフォーマンスに問題があります。これは、サービス(AP)のプログラミングの問題である場合または、リソースの問題である可能性があります。アプリケーションのモニタリングするための鍵は、問題の原因がプログラミング、リソースまたは、その他の原因のいずれかであるかを判別することです。これを把握するには、ユーザーの要求が正しく満たされたことを確認するプロセスが必要です。ユーザーからの要求は、Requestと呼び、このRequestをサーバーで処理し、ユーザーに応答する過程を**トランザクション(Transaction)**と定義します。

**トランザクション**(**Transaction**)は、ユーザーのブラウザのリクエストを処理するためのサーバサイドのLUW(Logical Unit of Work) を意味します。 個々のウェブサービス(URL) リクエストの処理プロセスがトランザクションです。 ウェブアプリケーションのトランザクションでは、ウェブサービスに対するHTTPリクエスト(HTTP Request)を受信し、応答(Response)を返すプロセスです。 WhaTapは、トランザクションの名前をURLとして保存します。 例えば、ブラウザリクエストURLがhttps://www.whatap.io/hr/apply.do?name='kim' の場合、トランザクション名は`/hr/apply.do` になります。

トランザクションがどれだけ速くエラーなく処理されるかは、**サービス応答にエラーなく処理されるか**と同じように解釈できます。 トランザクションは、「進行中のトランザクション」と「終了したトランザクション」に分けられます。 「進行中のトランザクション」は、リクエストを送信されたが応答が受信されていない状態を意味し、「終了したトランザクション」は、サービスにリクエストを送信して応答が受信された状態を意味します。 WhaTapのアプリケーションモニタリングは、トランザクションが処理されるプロセスをリアルタイムで確認できるサービスを提供します。

### 進行中のトランザクション

「進行中のトランザクション」を使用すると、通常8秒以上の遅延を引き起こす問題、広範囲に及ばず、一部のトランザクションのみ発生する問題を特定することができます。次の画面の上部にある**_スピードメーター_**ウィジェットでは、現在進行中のトランザクション(中央の領域)と終了したトランザクション(右側の領域)の状況の全体を確認することができます。全体の状況の中で進行中のトランザクションをエージェントごとに表示したのが**_アクティブトランザクション_**ウィジェットです。進行中のトランザクションの状態を表示したのが**_アクティブステータス_**ウィジェットです。

<ImgLang img='best-p/apm-dashboard-tx-01.png' />

トランザクションによって確認できるトラブルの状態は、応答時間を通じて参照できます。 また、進行中のトランザクションが終了しない場合は、これもトラブルとして認識する必要があります。 WhaTapは、進行中の状態の時間に応じて区間を分けて表示します。 青色は応答時間が正常なトランザクション、橙色は応答時間が8秒の遅いトランザクション、赤色は応答時間が通常の2倍以上に遅いトランザクションを意味します。 これにより、ユーザーは直感的にトラブルを認識できます。

**_アクティブトランザクション_**ウィジェットでは、遅延が発生する状況をエージェント別に確認できます。赤色の領域が各エージェントごとに分散されている場合は、遅延を発生させる要因をエージェントにインストールされたアプリケーションごとに確認する必要があります。逆に、赤色の領域が1つのエージェントのみ発生する場合は、そのアプリケーションサーバーで確認できます。これにより、トラブルの原因が発生した場所をすぐに特定できます。 

外部の要素は**_アクティブステータス_**ウィジェットで確認できます。**_METHOD_**はその他の事項で通常のトランザクションとみなされます。その他の4つの状態値からトラブルの原因を特定できます。外部接続に関する項目は、**_HTTPC_**、**_SQL_**の数値です。**_HTTPC_**の数値が大きいほど、外部から接続されたサーバーの応答性が低下します。Databaseサーバーへの接続が正しく機能していない場合は、**_SQL_**の数値が上がります。

アプリケーションサーバーで最も一般的なトラブルの1つは、DB接続プールに関連しています。DB接続プールの数が不足していると、新しい接続リクエストが発生するたびに遅延が発生し、パフォーマンストラブルの原因となります。この場合、 **_アクティブステータス _**ウィジェットの **_DBC _**数値が増加します。

**_SOCKET_**は外部システムとのTCP接続の試行を意味します。同様に、**_SOCKET_**の数値が持続的に増加する場合は、外部システムへの接続が不足しているためにトラブルが発生している可能性があります。

進行中のトランザクションに問題が発生する場合は、**_アクティブトランザクション_**ウィジェットのチャートをクリックしてスタックを確認することができます。**_アクティブトランザクション_**ウィジェットでトラブルが発生した領域のエージェントをクリックすると、エージェントの**_アクティブトランザクション_**ウィンドウが表示されます。このウィンドウは、進行中のトランザクションの一覧が表示されます。この一覧の**_トランザクション(URL)_**または**_SQL／HTPC(ms)_**項目のいずれかが同じかどうかを確認してください。障害の主な原因が同じ現象なのか、それとも他の問題が発生したのかを確認できます。

<ImgLang img='apm-dashboard-active-tx-popup.png' />

進行中のトランザクションの一覧の項目をクリックすると、それらのトランザクションのスタックを確認できます。このスタック情報からトラブルの原因を分析できます。

### 終了したトランザクション

終了した個々のトランザクションを分布図として確認できるのがヒートマップウィジェットです。ヒートマップウィジェットは、通常１秒かかるはずのトランザクションが予想よりも2秒程度かかる場合、つまり応答時間が2倍以上かかるトランザクションを見つけることで、トラブルの原因を分析します。

<ImgLang img='hitmap.png' />

ウィジェットは右上にあります![上向きアイコン](/img/up-arrow.svg)または![下向きアイコン](/img/down-arrow.svg)ボタンをクリックするとチャートを拡大または縮小できます。チャート領域をマウスでドラッグすると、**_トレース分析_**ウィンドウが表示されます。

<ImgLang img='best-p/analysis-tx-main.png' />

**_トレース分析_**ウィンドウでは、ユーザーがドラッグしたチャート領域のトランザクション情報を一覧で表示します。それぞれのアイテムをクリックすると、そのトランザクションの詳細を右側で確認できます。画面の右側の**_テーブルビュー_**タブでは、どのプロセスを処理しながら遅くなったのかを段階的に確認することができます。

<ImgLang img='best-p/analysis-tx-table-view.png' />

ユーザーからのリクエストがサーバーに届くまで、サーバーでロジックを実行して結果を表示するまで、多くのメソッドが実行されます。いくつかのメソッドを追跡すれば遅延している箇所を確認できるでしょうか？WhaTapは、複数のユーザーのリクエストを既定の10秒間隔でスナップショットとして保存します。スナップショットに保存されたスタック情報をトランザクションに含めます。この場合のスタック情報を**_アクティブスタック_**(Active Stack)と定義します。

<ImgLang img='best-p/analysis-tx-table-view-mode.png' />

:::note

**_トレース分析_**ウィンドウの詳細については[次の文書](../java/dashboard-hitmap-trace)を参照してください。

:::

スタックを収集し、累積された量を基準に一覧表示して確認できる機能が**_分析_** >**_スタック_**です。リソースと関連付けられていない内部ロジックの遅延メソッド間隔を統計的に見つけることができます。 

<ImgLang img='best-p/apm-dashboard-top-stack.png' />

## ユーザーおよびサービス、リソース分析{#analysis-user-service-resource}

ユーザーとサービス、リソース間の相関関係を分析してAPチューニングを継続するには、ユーザー数に応じたTPS、応答時間、CPU使用率を確認する必要があります。

![](/img/best-p/apm-dashboard-user-service-resource.png)

**Transaction Per Second**(TPS、以下TPS)は、1秒あたりにトランザクションを処理した量を意味します。ユーザー数が増えると、TPSは次のようにグラフ化されます。

![](/img/best-p/tps_example_02.png)

サービスのユーザー数が増え続けると、ある時点からTPSは増加しなくなります。このように増加しないポイントを**飽和ポイント**(**Saturation Point**)と呼ばれます。上記のグラフのようなサービスは理想的な状況です。適切にチューニングされていないサービスは、TPSが低下する現象が発生します。

次のグラフを参照してください。 TPSが増加しなくなった状態でユーザー数が増えると、応答時間はユーザーに比例して増加します。

![](/img/best-p/response_time_example_01.png)

CPU使用率は、ユーザーが増加するにつれて次のようなグラフが表示されます。

![](/img/best-p/apm-dashboard-cpu-usage.png)

TPSの最大値を知るのは難しいですが、CPUの最大値は100%です。ただし、CPU使用率が100%または100%に近い場合でも、CPU使用率だけではリソースが不足しているかどうかを判断するのは困難です。これは、サービスのロジックに問題があり、CPU使用率が高くなる可能性もあるからです。そのため、上記の3つのグラフを直観的に把握し、比較して判断することが重要です。 

TPSはパフォーマンスのベンチマークです。つまり、最大TPSは、システムの最大パフォーマンスを意味します。最適なチューニングは、最大TPS値を上げることです。 

応答時間は、ユーザー数が増えるとそれに比例して増加するため、チューニングの指標として使用することは困難です。ただし、応答時間が緩やかなグラフであることが重要です。最大TPSを増やすには、応答時間のグラフを緩やかにする必要があります。したがって、チューニングの対象は応答時間です。個別URL、つまりトランザクションの応答時間を特定して分析することが必要です。**_ヒートマップ_**を使用すると、トランザクションの応答時間を分析し、遅くなる間隔を見つけて原因を特定することができます。

上記の概念を熟知した状態で、**_アプリケーションダッシュボード_**の**_TPS_**ウィジェットと**_ユーザー_**または**_同時接続ユーザー_**ウィジェットを確認ください。ユーザー数が増加し、TPS数が減少する場合、サーバーへのトラフィックが増えることを意味します。この場合、Scale-Outによってサーバーリソースを増やすか、トラフィックを制御してTPS数を一定に保つことをお勧めします。

![](/img/best-p/apm-dashboard-best-practice.png)

Scale-Outする場合は、WhaTapのエージェントを追加してモニタリングを実行できるようにする必要があります。Traffic制御が必要な場合は、WhaTapのエージェント設定から行うことができます。アプリケーションの最大同時処理数を制限するスロットリング機能をアクティブ化できます。詳細な設定方法については、[次の文書](https://docs.whatap.io/java/agent-load-amount)を参照してください。

また、次のグラフのようにユーザー数は増えても、TPS数が最大に増加せずに一定の場合、2つの状況が考えられます。グラフ**Response#1**のように応答時間が継続的に増加している場合は、サービスロジックに問題がある可能性があります。一方、グラフ**Response#2**のように応答時間が一定の場合は、ユーザーのリクエストをサーバーが受信していない状況でネットワークの状態を確認する必要があります。

![](/img/best-p/tps-user-net-error.png)

さらに、ウェブアプリケーションの顧客満足度を測定する**_Apdex_**ウィジェット、**_ヒープメモリ_**ウィジェットを確認することができます。 

**Application Performance Index**(**Apdex**)は、アプリケーションのパフォーマンス指標です。 

![Apdex](/img/apm-dashboard-apdex.png)

ユーザー満足度の指標として使用でき、0~1、0~0.7は**_Poor_**(<span class='vslow'>赤色</span>)、 0.7~0.85は**_Fair_**(<span class='slow'>橙色</span>), 0.85~0.95は**_Good_**(<span class='api'>緑色</span>), 0.95~1は**_Excellent_**(<span class='normal'>青色</span>)の領域で表示します。Apdex指標とカラー領域のアプリケーションの応答速度がユーザーに満足できる水準であるかを確認できます。Apdex指標の詳細は[次の文書](https://docs.whatap.io/java/agent-apdex)を参照してください。

**_ヒープメモリー_**(Heap Memory)ウィジェットは、各サーバーの使用可能な最大メモリーと現在使用中のメモリーを表示します。

<ImgLang img='apm-dashboard-heap-memory.png' />

Heap使用量が低い場合、GCが頻繁に発生し、CPUが過剰に占有されます。通常のHeap使用量パターンはGCによって上下を繰り返します。ヒープメモリチャート分析の詳細については、次のリンクを参照してください。

-   [月間WhaTap：モニタリングで注目すべき指標](https://www.whatap.io/ko/blog/94/)
-   [Javaヒープメモリーチャートの分析：Ch.1ヒープチャート観察](https://youtu.be/FcWfVrETWh4)
-   [JAVAヒープメモリーチャートの分析：Ch.2 メモリリークとヒープダンプ分析](https://youtu.be/t2q5z4HHNfs)

統合ダッシュボードを提供する可視性の高いモニタリングサービスであるWhaTapを使用して、モニタリング業務の効率を高めてみてください。
