<InDoc product='aws-log'>

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_management" className="uitext" /> &gt; <Cmdname sid="side_logSetting" className="uitext" />

</InDoc>

<InDoc product='log,postgresql,mysql,oracle,oracle-pro'>

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_log" className="uitext" /> &gt; <Cmdname sid="side_logSetting" className="uitext" />

</InDoc>

<Cmdname sid="side_logSetting" className="uitext" />メニューで、ログモニタリング関連の設定を行われます。 上部のタブからエージェント設定の確認、ログモニタリングを活性化有無の決定、ログデータの保存期間および照会パスワードの設定、ログパーサ登録、クイックインデックス設定などのメニューが利用できます。

:::note

- <Cmdname sid="use_log_monitoring" className="uitext" />機能を使用するには、<Cmdname sid="edit_project" className="b600" />権限が必要です。

- <Cmdname sid="log_update" className="b600" />権限では、<Cmdname sid="use_log_monitoring" className="uitext" />機能と<Cmdname sid="side_logSetting" className="uitext" />メニューを修正できます。

:::

## ログモニタリングを開始する {#log-getting-started}

<InDoc product='aws-log'>

<ImgLang img='log-getting-started-aws.png' desc='ログモニタリングの開始 sc'/>

</InDoc>

<InDoc product='log'>

<ImgLang img='log-getting-started.png' desc='ログモニタリングの開始 sc'/>

</InDoc>

<InDoc product='postgresql,mysql,oracle,oracle-pro'>

<ImgLang img='log-getting-started-db.png' desc='ログモニタリングの開始'/>

</InDoc>

<Xclude product='postgresql,mysql,oracle,oracle-pro'>

上段で<Cmdname sid="getting_started_log_monitoring" className="uitext" />タブを選択します。 ![WhaTap Docsアイコン](/img/ic-guide.svg) <Cmdname sid="log_monitoring_guide" className="uitext" />アイコンと<Cmdname sid="log_monitoring_plan" className="uitext" />ボタンを選択すると、関連の案内画面に移動します。 

</Xclude>

<InDoc product='postgresql,mysql,oracle,oracle-pro'>

上段で<Cmdname sid="getting_started_log_monitoring" className="uitext" />タブを選択します。 ![WhaTap Docsアイコン](/img/ic-guide.svg) <Cmdname sid="log_monitoring_guide" className="uitext" />アイコンを選択すると、関連の案内画面に移動します。 

</InDoc>

### エージェント設定とログモニタリングの有効化 {#log-set-up}

<InDoc product='aws-log'>

![number 1](/img/number-01.png)領域の<Cmdname sid="use_log_monitoring" className="uitext" />トグルボタンでログモニタリングの有効化・無効化を設定します。

<ImgLang img='log-start-aws.png' desc='ログモニタリングの開始'/>

- ![アイコン](/img/ic-toggle-on.svg)トグルボタンをオンにすると、ログモニタリンがアクティブになります。 活性化した日から15日間無料で体験できます。
- ![アイコン](/img/ic-toggle-off.svg)トグルボタンをオフにすると、ログモニタリンが無効化されます。 これ以上ログを保存しません。 

</InDoc>

<InDoc product='log,postgresql,mysql,oracle,oracle-pro'>

![number 1](/img/number-01.png)領域でエージェント設定を確認し<Cmdname sid="use_log_monitoring" className="uitext" />トグルボタンでログモニタリングの有効化・無効化を設定します。

#### エージェントの設定確認 {#log-check-agent-settings}

<Xclude product='postgresql,mysql,oracle,oracle-pro'>

ログモニタリングを開始するために、エージェントのバージョンと設定情報を確認してください。 **_エージェント設定確認_**メニューを選択して、説明通りにプロセスを進めてください。

- **アプリケーションモニタリング**

  **_適用する_**メニューの下にある固有のアプリケーション手順を確認してください。 次の説明書[Java](log-java)、[PHP](log-php)、[Python](log-python)、[Go](log-go) などを参照してください。

- **サーバーモニタリング**

  **_適用する_**メニューの下にある固有のアプリケーション手順を確認してください。 [次の文書](log-server)を参照してください。 指示に従って*whatap.conf*にログモニタリング対象ファイルの設定を追加してください。

- **Kubernetesモニタリング**

  **_適用する_**メニューの下にある固有のアプリケーション手順を確認してください。 [次の文書](log-k8s)を参照してください。 

</Xclude>

<InDoc product='postgresql,mysql,oracle,oracle-pro'>

ログモニタリングを開始するために、エージェントのバージョンと設定情報を確認してください。 エージェント設定に関する詳細は[次の文書](log-db)を参照してください。

</InDoc>

#### ログモニタリングの有効化 {#log-activate}

<Cmdname sid="use_log_monitoring" className="uitext" />メニューを選択して、ログモニタリングの有効化または無効化を設定します。

<Xclude product="postgresql,mysql,oracle,oracle-pro">

<ImgLang img='log-start.png' desc='ログモニタリングを開始する'/>

</Xclude>

<InDoc product='postgresql,mysql,oracle,oracle-pro'>

<ImgLang img='log-start-db.png' desc='ログモニタリングの開始'/>

</InDoc>

- ![アイコン](/img/ic-toggle-on.svg)トグルボタンをオンにすると、ログモニタリンがアクティブになります。 活性化した日から15日間無料で体験できます。 
- ![アイコン](/img/ic-toggle-off.svg)トグルボタンをオフにすると、ログモニタリンが無効化されます。 これ以上ログを保存しません。 

</InDoc>

### ログモニタリングのデータ設定 {#log-data-setting}

![number 2](/img/number-02.png)領域で<Cmdname sid="log_usage" className="uitext" />が確認できます。 また<Cmdname sid="data_retention" className="uitext" />および<Cmdname sid="log_lookup_password" className="uitext" />設定を変更できます。

#### データ保存期間 {#data-retention}

共通に適用する基本(default) データ保持期間です。 未指定の場合、既定値は1日です。 カテゴリごとのデータ保存期間を個別で設定しない場合は、このデータ保存期間がデフォルトとして適用されます。 カテゴリごとのデータ保存期間を設定し、<Cmdname sid="initialized" className="uitext" />ボタンを選択すると、基本データの保存期間が初期化されます。

#### カテゴリ別のデータ保存期間 {#data-retention-per-category}

カテゴリごとのログデータの保存期間を指定できます。 **ログ数**は、その期間中に蓄積されたログ行数を意味します。 例えば、<Cmdname sid="daily_log_count" className="uitext" />は、その日に収集されたログラインの数、<Cmdname sid="expected_log_count" className="uitext" />は、データ保持日に本日のログ数を掛けたログラインの数を意味します。 

ログデータの保存期間を次のように指定できます。 期間指定により、古いデータを削除してスペースを確保できます。

- **トライアルプロジェクト**  

  データ保存期間として1日、2日、3日を選択できます。

- **有料プロジェクト**  

  データの保存期間として1日、2日、3日、4日、5日、6日、7日、10日、30日、40日が選択できます。

- **保存量基準課金**   

  データの保存期間によってコストが異なります。

  > 例えば、1日平均200万ログ行が蓄積され、データ保存期間を3日に指定した場合、平均600万ログ行が収集サーバに保持され、課金の対象となります。

#### ログ参照パスワード {#log-lookup-pw}

セキュリティを強化するため、<Cmdname sid="log_lookup_password" className="uitext" />を設定してください。 ログ検索パスワードの指定はオプションです。 ログ検索パスワードを使用中の場合は、ログ画面に入るときは必ずパスワードを入力してください。 

:::note

**パスワードの紛失**

**ログ編集**権限がある場合は、<Cmdname sid="side_logSetting" className="uitext" />メニューで新しいパスワードに変更できます。

:::

## ログ1次パーサ設定 {#log-setting-parser-1st}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部にある<Cmdname sid="log_parser_setting_primary" className="uitext" />タブを選択してログパーサを登録または修正ができます。 ログ1次パーサは、***GROK***と***JSON***パーサを提供します。 収集されたログを使用して、パターンの条件と一致するキー情報、つまり検索キーと検索値を抽出します。 パーシングされたログキーは、ログのタイプを分類するための目的および特定のログを検索するためのインデックスに使用されます。 タイプ別ログ発生数を集計したり、特定のログをすばやく特定するために登録に必要なパーサです。

- **_GROK_**：基本的には、正規表現ベースのパーシングに対応します。 予約キーワードベースのパーシングを提供します。

- **_JSON_**：ログからJSONで出力された部分に対して一括パーシング機能を提供します。

:::note 

**パーシングロジックが未登録時に検索可能なkey**

`category`, `oid`, `oname`, `okind`, `okineName`, `@txid`, `@login`, `httphost` 

:::

:::note

**パーサで登録のできない予約語**

次の予約語の場合、パーサを登録してもインデックスは作成されません。

`timestamp`, `message`, `pcode`, `category`, `content`, `logContent`

:::

:::note 

ログパーサの詳細については、[次の文書](log-parser)を参照してください。

:::

### 設定項目 {#log-parser-comp}

| 設定値    | 説明                                                                                           | その他      |
| ------ | -------------------------------------------------------------------------------------------- | -------- |
| カテゴリ   | パターンを適用するカテゴリです。                                                                             | required |
| ログ検出条件 | フィルターとして適用する検索キー、検索値を入力します。 ログ検出条件を満たすログデータにパターンを適用します。 ログ検出条件を入力しない場合、すべてのログを対象にパターンを適用します。 | optional |
| パターン   | ログをパーシング(parsing)するパターンです。 作成したパターンに合わせてパーシングを行い、インデックスを作成します。 GROKと正規表現に対応します。              | required |

### パーサ一覧 {#log-parser-list-1st}

<ImgLang img='log-1st-parser-list.png' desc='ログパーサー一覧'/>

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部の<Cmdname sid="log_parser_setting_primary" className="uitext" />タブを選択すると、登録したパーサが表示され、追加および編集が可能な**パーサ一覧**画面を確認できます。

- 右上の**_+_**<Cmdname sid="adding" className="uitext" />ボタンを選択すると<Cmdname sid="parser" className="uitext" /> <Cmdname sid="add" className="uitext" />画面が表示されます。

- パーサ一覧<Cmdname sid="ITM06352" className="uitext" />カラムの![](/img/ic-drag-drop.svg)アイコンをドラッグしてパーサの設定手順を変更できます。

- パーサ一覧![アイコン](/img/ic-toggle-on.svg) <Cmdname sid="enable" className="uitext" />トグルでパーサの活性化有無を指定できます。

- パーサ一覧![修正アイコン](/img/ico-edit.svg) <Cmdname sid="edit" className="uitext" />及び![削除アイコン](/img/ico-trash-red.svg) <Cmdname sid="delete" className="uitext" />アイコンで登録したパーサを修正または削除できます。

### パーサ登録手順{#log-add-parser-1st}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部にある<Cmdname sid="log_parser_setting_primary" className="uitext" />タブを選択してログパーサを登録または修正ができます。 次に、パーサ登録の共通の手順を説明します。

<ImgLang img='log-1st-parser-add.png' desc='ログパーサ追加'/>

1. **_+_**<Cmdname sid="adding" className="uitext" />ボタンを選択すると<Cmdname sid="parser" className="uitext" /> <Cmdname sid="add" className="uitext" />画面が表示されます。

2. <Cmdname sid="parser" className="uitext" />選択画面からパーサを選択します。 各パーサおよびパターン登録の詳細については、次の文書を参照してください。

   - **_GROK_** [パーサおよびパターン登録](#log-pattern-grok)

   - **_JSON_** [パーサおよびパターン登録](#log-pattern-json)

3. <Cmdname sid="category" className="uitext" />選択画面からカテゴリを選択するか、直接入力します。

4. <Cmdname sid="ITM06439" className="uitext" />として使用する<Cmdname sid="ITM06429" className="uitext" />と<Cmdname sid="ITM06430" className="uitext" />を選択するか、直接入力してください。

   フィルター条件に合ったログデータのみパターンを適用します。 <Cmdname sid="ITM06439" className="uitext" />を指定しない場合は、すべてのログにパターンを適用します。

5. <Cmdname sid="pattern" className="uitext" />を入力してください。

6. 登録したいパターンが正常な場合は、<Cmdname sid="simulation" className="uitext" />ボタンをクリックしてシミュレーション及びパターンのパフォーマンスを測定してください。

   シミュレーションとパフォーマンス測定の詳細については、[次の文書](#parser-simulation)を参照してください。

7. シミュレーション結果が正常である場合は、<Cmdname sid="add" className="uitext" />ボタンを選択してパーサを登録します。

:::note

ログパーサ登録時、同じ<Cmdname sid="category" className="uitext" />のパーサを重複で登録できません。

:::

### GROKパーサパターン登録 {#log-pattern-grok}

<ImgLang img='log-1st-grok.png' desc='Grokパターンパーサ登録'/>

基本文法は、`%{SYNTAX:SEMANTIC}`です。 GROKパーサの詳細は、[次の文書](log-parser#grok-parser-detail)を参照してください。

- **SYNTAX**

  GROK定義パターンです。

- **SEMANTIC**

  パーシングされたデータに割り当てるキーです。

  :::note 

  SEMANTICでは、予約語ではなく、組み合わせでの使用を推奨します。

  :::

### JSONフォーマットのパーサパターン登録 {#log-pattern-json}

<ImgLang img='log-1st-json.png' desc='JSONフォーマットパーサパターン登録'/>

ログ全体または一部がJSON形式で出力される場合、JSONフォーマットのパーサを使用して、JSONに出力された部分をパーシングできます。 ログのうちJSON形式として出力された部分を検出するために、**_Prefix_**、**_Postfix_**オプションを組み合わせてログのどの部分をJSONとして認識してパーシングするかを指定します。 JSONパーサの詳細は、[次の文書](log-parser#json-parser-detail)を参照してください。

| オプション    | 説明                                                                                                             |
| -------- | -------------------------------------------------------------------------------------------------------------- |
| Prefix   | JSON文字列の先頭の前にある文字列を指定します。 未指定時、ログ出力文の先頭からJSON文字列として識別します。                                                      |
| Postfix  | JSON文字列の最後後の部分の文字列を指定します。 未指定時、ログ出力文の最後までをJSON文字列として識別します。                                                     |
| Ignore   | JSON出力部分のうちキー抽出を除外するフィールドを指定します。                                                                               |

- **登録例**

  ```bash title='Log'
  [2022-10-25 10:15:34:145]...(改行)
  Request : {"key1":"value1","key2":"value2",...}(改行)
  Response : {"key3":"value3","key4":"value4",...}
  ```

  例のように流入されるログがRequest JSON、Response JSONをすべてパーシングする場合、次の2つのパターンを登録します。

  - Requestパーシング用のパターン  

    > "Request："と"Response"間の文字列`{"key1":"value1","key2":"value2",...}`対象

  - Reponseパーシング用のパターン

    > "Response："からログの最後までの文字列`{"key3":"value3","key4":"value4",...}`対象
- **JSONカスタムパターンの登録**

  ログの一部がJSON形式で出力される場合、JSONで出力された部分をカスタムパーサを使用してパーシングできます。 パターンを次のように入力します。

  ```java
  io.whatap.logsink.parser.JsonFormatParser{}
  ```

  ログのうちJSON形式として出力された部分を検出するために、**_Prefix_**、**_Postfix_**オプションを組み合わせてログのどの部分をJSONとして認識してパーシングするかを指定します。

  `JsonFormatParser{}`の`{}`にオプションを指定します。

  - **登録例**

    ```bash title='Log'
    [2022-10-25 10:15:34:145]...(改行)
    Request : {"key1":"value1","key2":"value2",...}(改行)
    Response : {"key3":"value3","key4":"value4",...}
    ```

    例のように流入されるログがRequest JSON、Response JSONをすべてパーシングする場合、次の2つのパターンを登録します。

    - Requestパーシング用のパターン  
      > "Request："と"Response"間の文字列`{"key1":"value1","key2":"value2",...}`対象

    ```java
    io.whatap.logsink.parser.JsonFormatParser {prefix:"Request : ",postfix:"Response"}
    ```

    - Reponseパーシング用のパターン
      > "Response："からログの最後までの文字列`{"key3":"value3","key4":"value4",...}`対象

    ```java
    io.whatap.logsink.parser.JsonFormatParser {prefix: "Response : "}
    ```

### パーサシミュレーション {#parser-simulation}

1. パーサ追加画面でパターンを入力した後<Cmdname sid="simulation" className="uitext" />ボタンを選択します。 <Cmdname sid="parser" className="uitext" /> <Cmdname sid="simulation" className="uitext" />画面が表示されます。 

2. <Cmdname sid="parser" className="uitext" /> <Cmdname sid="simulation" className="uitext" />画面で<Cmdname sid="log" className="uitext" />を入力します。

3. 入力した<Cmdname sid="log" className="uitext" />と<Cmdname sid="pattern" className="uitext" />を確認してください。

<ImgLang img='log-parser-simulation.png' desc='パーサシミュレーション'/>

1. <Cmdname sid="simulation" className="uitext" />ボタンを選択して登録するパターンで、パーシングが成功するか確認してください。

   - **シミュレーションの成功画面**

     <ImgLang img='log-simulation-success.png' desc='シミュレーション成功'/>

   - **シミュレーションの失敗画面**

     <ImgLang img='log-simulation-fail.png' desc='シミュレーション失敗'/>

2. <Cmdname sid="apply_pattern" className="uitext" />ボタンをクリックすると、選択したパーサに入力したパターンが適用されます。

### パフォーマンス測定 {#log-performance}

シミュレーションの成功後<Cmdname sid="performance_measurement" className="uitext" />ボタンを選択して、パーサのパフォーマンスを測定できます。 シミュレーションを実行する対象文字列に対して、パーサの繰り返しパーシングの所要時間を測定した後、次のように測定結果を確認します。

<ImgLang img='log-performance.png' desc='パフォーマンス測定'/>

### パーシングの成功 {#log-parsed}

パーシング ロジックを登録し、**キー**(key)が生成されたら、ログを照会する際に該当キーでパーシングされた値が追加されます。 次の<Cmdname sid="side_logTail" className="uitext" />メニュー例のように、パーシングされたキーと値が追加されます。 

<ImgLang img='log-parsed.png' desc='パーシング成功'/>

パーシングされたキーは<Cmdname sid="side_logTail" className="uitext" />、<Cmdname sid="side_logSearch" className="uitext" />、<Cmdname sid="side_logExplorer" className="uitext" />で確認できます。

## ログ2次パーサ設定 {#log-setting-parser-2nd}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部にある<Cmdname sid="log_parser_setting_secondary" className="uitext" />タブを選択してログパーサを登録または修正できます。 <Cmdname sid="status_4xx5xx_parser" className="uitext" />と<Cmdname sid="status_success_rate" className="uitext" />を提供します。 ログの2次パーサは、GROKまたはJSONのような1次パーサがパーシングされた場合に使用できるパーサです。 1次パーサで抽出した値を処理して統計データを生成します。 ウェブまたはAPIの応答ログに対してHttp Status Code基づいて2次統計を抽出します。

- <Cmdname sid="status_4xx5xx_parser" className="uitext" />：異常レスポンスに関する件数情報を集計します。

- <Cmdname sid="status_success_rate" className="uitext" />：全体の件数に対する異常レスポンスの割合を抽出します。

:::note

ログの2次パーサは、1次でパーシングされた結果に対して、追加での2次パーシング機能を提供します。 2次パーサを使用するには、**1次パーサ**を**登録**する必要があります。

:::

### パーサ一覧 {#log-parser-list-2nd}

<ImgLang img='log-2nd-parser-list.png' desc='対数2次パーサ一覧'/>

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部の<Cmdname sid="log_parser_setting_secondary" className="uitext" />タブを選択すると、登録したパーサが表示され、追加および編集が可能な**パーサ一覧**画面を確認できます。

- 右上の**_+_**<Cmdname sid="adding" className="uitext" />ボタンを選択すると<Cmdname sid="parser" className="uitext" /> <Cmdname sid="add" className="uitext" />画面が表示されます。

- パーサ一覧<Cmdname sid="ITM06352" className="uitext" />カラムの![](/img/ic-drag-drop.svg)アイコンをドラッグしてパーサの設定手順を変更できます。

- パーサ一覧![アイコン](/img/ic-toggle-on.svg) <Cmdname sid="enable" className="uitext" />トグルでパーサの活性化有無を指定できます。

- パーサ一覧![修正アイコン](/img/ico-edit.svg) <Cmdname sid="edit" className="uitext" />及び![削除アイコン](/img/ico-trash-red.svg) <Cmdname sid="delete" className="uitext" />アイコンで登録したパーサを修正または削除できます。

### パーサ登録手順 {#log-add-parser-2nd}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部にある<Cmdname sid="log_parser_setting_secondary" className="uitext" />タブを選択してログパーサを登録または修正できます。 次に、パーサ登録の共通の手順を説明します。

<ImgLang img='log-2nd-parser-add.png' desc='ログ2次パーサ登録手順'/>

1. **_+_**<Cmdname sid="adding" className="uitext" />ボタンを選択すると<Cmdname sid="parser" className="uitext" /> <Cmdname sid="add" className="uitext" />画面が表示されます。

2. <Cmdname sid="parser" className="uitext" />選択画面からパーサを選択します。 各パーサ設定項目および除外するステータスコード登録の詳細については、次の文書を参照してください。

   - <Cmdname sid="status_4xx5xx_parser" className="uitext" /> [設定項目および除外するステータスコード登録](#4xx-5xx-status-parser)

   - <Cmdname sid="status_success_rate" className="uitext" /> [設定項目および除外するステータスコード登録](#log-pattern-status)

3. <Cmdname sid="category" className="uitext" />選択画面からカテゴリを選択するか、直接入力します。

4. <Cmdname sid="ITM06439" className="uitext" />を選択するか、直接入力してください。

5. <Cmdname sid="ITM06255" className="uitext" />を入力してください。

6. <Cmdname sid="add" className="uitext" />ボタンを選択してパーサを登録します。

### 4xx、5xxで除外するステータスコードを登録 {#4xx-5xx-status-parser}

<ImgLang img='log-2nd-4xx5xx.png' desc='4xx、5xx状態コードパーサ'/>

<Cmdname sid="status_4xx5xx_parser" className="uitext" />は、statusが既にパーシングされている場合にのみ使用できるパーサです。 パーシングされたstatusを利用して追加で4xx、5xxのステータスコードをパーシングします。 パーシングされたデータで4xx、5xxの件数データを作成できます。 除外するステータスコードとして、4xx、5xxのステータスコードを入力または選択できます。 入力されたステータスコードは、ログから4xx、5xxのステータスコードをパーシングする際に除外されます。

#### 設定項目 {#log-parser-comp-4xx5xx}

| 設定値          | 説明                                                                                                   | その他      |
| ------------ | ---------------------------------------------------------------------------------------------------- | -------- |
| カテゴリ         | 4xx、5xxの件数データを生成するカテゴリです。                                                                            | required |
| ログ検出条件       | フィルターとして適用する検索キー、検索値を入力します。 ログ検出条件を満たすログデータに対して、4xx、5xxのデータを生成します。 ログ検出条件を入力しない場合は、すべてのログのデータを生成します。 | optional |
| 除外するステータスコード | 統計データの作成時に除外するステータスコードです。 入力がなければ、4xx・5xxに該当するすべてのエラーステータスコードを対象に4xx、5xxの件数データを生成します。                | optional |

#### statusパーサの登録例

<ImgLang img='log-2nd-4xx5xx-status.png' desc='Grokパーサ - statusパーシングパターン登録'/>

流入されるログが`{"msg":"message","status":404}`で、例のようにGROKパーサでstatusをパーシングする場合、`status: 404`のようにパーシングされます。 statusが正しくパーシングされることを確認したら、4xx、5xxのステータスコードのパーサから除外するステータスコードを登録します。     

#### データ参照

パーサをすべて登録すると、<Cmdname sid="side_integratedFlexboard" className="uitext" />に移動して<Cmdname sid="log" className="uitext" /> <Cmdname sid="log_4xx5xx_count" className="uitext" />ウィジェットを作成します。

<ImgLang img='log-flexboard-widget.png' desc='Log Flex board widget - 4xx5xx'/>

ウィジェットを作成すると、次のようにデータを確認できます。

<ImgLang img='log-flexboard-widget-chart-4xx5xx.png' desc='Log Flex board widget chart - 4xx5xx'/>

- **_avg_**：照会期間のデータで平均値です。

- **max**：照会期間のデータで最大値です。

- **_recently_**：照会期間のデータで最後の値です。

### 成功率をパーサから除外するステータスコード登録 {#log-pattern-status}

<ImgLang img='log-2nd-status.png' desc='ステータスコード成功率パーサ'/>

<Cmdname sid="status_success_rate" className="uitext" />は、statusが既にパーシングされている場合に使用できるパーサです。 statusパーシングに関する内容は、[次の文書](#4xx-5xx-status-parser)を参照してください。 パーシングされたstatusから追加で2xx、3xxのステータスコードをパーシングします。 パーシングしたデータで、HTTP要請成功率データを生成できます。 除外するステータスコードは、2xx、3xxのステータスコードを入力または選択できます。 入力されたステータスコードは、ログから2xx、3xxのステータスコードをパーシングする際に除外されます。

#### 設定項目 {#log-parser-comp-status}

| 設定値          | 説明                                                                                               | その他      |
| ------------ | ------------------------------------------------------------------------------------------------ | -------- |
| カテゴリ         | 要請成功率データを生成するカテゴリです。                                                                             | required |
| ログ検出条件       | フィルターとして適用する検索キー、検索値を入力します。 ログの検出条件を満たすログデータのみで要請成功率データを生成します。 ログ検出条件を入力しない場合は、すべてのログのデータを生成します。 | optional |
| 除外するステータスコード | 要請成功率データを生成する際に除外するステータスコードです。 入力がなければ、2xx・3xxに該当するすべての成功ステータスコードを対象に要請成功率のデータを生成します。            | optional |

#### データ参照

パーサをすべて登録したら、<Cmdname sid="side_integratedFlexboard" className="uitext" />に移動し、ログ要請の成功率ウィジェットを作成します。  

<ImgLang img='log-flexboard-widget-scs.png' desc='ログリクエスト成功率のウィジェットテンプレート'/>

ウィジェットを作成すると、次のようにデータを確認できます。

<ImgLang img='log-flexboard-widget-chart-scs.png' desc='Log Flex board widget chart request success rate widget chart - 4xx5xx'/>

チャート上のデータは、照会期間に関する統計を示します。 統計方法としては最近値、最大値、平均値などを選択できます。 最近使った値がデフォルトで選択されています。

## 高速インデックス設定 {#log-setting-index}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上段から<Cmdname sid="fast_index_setting" className="uitext" />タブを選択します。 大量のログを収集すると、ログ検索性能が低下する場合があります。 よく使う検索条件は、**インデックス**(index)で生成すると、ログ検索がより速くなります。 設定項目は次のとおりです。

| 設定値                  | 必須の有無      | 説明                                 |
| -------------------- | ---------- | ---------------------------------- |
| カテゴリ                 | 必須         | 高速クインデックスを設定するカテゴリ                 |
| 検索キー                 | 必須         | 高速インデックスを設定する検索キー                  |
| 大文字と小文字を区別しない        | オプション      | 大文字と小文字の区別するかどうか                   |
| ルール                  | 必須         | `*` を少なくとも１つ以上を含める必要あり             |
| 活性化有無                | 必須         | 活性化または非活性化の設定(既定値`true`)           |

## ログ設定のインポート・エクスポート{#export-import-settings}

共通のパーサ設定及び<Cmdname sid="fast_index_setting" />の内容をJSONファイル形式で保存し、他のプロジェクトからJSONファイルをインポートして適用できます。 プロジェクトごとに何度も繰り返し設定を作成する手間を減らします。

1. 1つのプロジェクトにパーサ設定および<Cmdname sid="fast_index_setting" />を追加します。

2. 各設定タブで画面右上に**_JSON_**![エクスポートアイコン](/img/ico-export.svg)ボタンを選択します。

3. <Cmdname sid="export_json" className="uitext" />画面が表示されると、画面右上にある<Cmdname sid="export" className="uitext" />ボタンを選択します。

4. JSON設定ファイルがユーザーPCに保存されます。

5. 他のプロジェクトに移動してから、<Cmdname sid="log" className="uitext" /> &gt; <Cmdname sid="log_setting" className="uitext" />メニューに移動してください。

6. まず、JSON設定ファイルをエクスポートした設定タブを選択し、![インポートアイコン](/img/ico-import.svg)ボタンを選択します。

7. ファイル選択画面が表示されたら、ユーザーのPCに保存したJSON設定ファイルを選択します。

8. <Cmdname sid="import_json" className="uitext" />画面が表示されたら、設定内容を確認し、<Cmdname sid="add_to_list" className="uitext" />または <Cmdname sid="overwrite" className="uitext" />ボタンを選択します。

9. 画面右上の<Cmdname sid="save" className="uitext" />ボタンを選択します。

:::caution

JSON設定ファイルをインポートして、<Cmdname sid="save" className="uitext" />ボタンを選択しないと、インポートされた設定は保存されません。

:::

## ログ長期保存統計の設定 {#log-long-term-archive}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上段から<Cmdname sid="logsink_mcube_config_statistics" className="uitext" />タブを選択します。 ログデータは、非常に大容量のため、長期間保存することは難しいです。 したがって、ログ統計データの設定機能を使用して**特定の条件を満たすログデータが5分ごとに何件収集されたかに関する情報を保存**できます。 長期間にあたって、実際のログデータが削除されても、条件を満たすログがどれだけ収集されているかの推移は確認できます。

{/* 

>

![ログの長期保存の統計](https://img.whatap.io/22/11/28/090932log_022_long_period_stat_config.png)

1. **_ログ長期保存の統計_**タブで**_+ 追加_**ボタンを選択します。 **_ログの長期保存統計の追加_**画面が表示されます。

2. ルールを適用する**_カテゴリ_**を選択します。

3. **_データ保存期間_**を選択します。

4. ルールを満たすログ発生時に保存する**_統計キー_**を設定してください。 同じキーを重複で設定できません。

5. **_ルール名_**の入力欄にルール名を入力します。

6. **_タグ_**を追加します。

7. **_除外_**にチェックを入れると、入力した条件に当てはまらない値で統計データが作成されます。

8. **_大小文字を区別する_**をチェックすると、入力したルールの値に対して大文字と小文字を区別します。

9. 作成したルールは、**_-_**アイコンで削除、**_+ 追加する_**ボタンで追加できます。

*/}

### ログ長期保存統計の追加 {#log-long-term-archive-add}

<ImgLang img='log-long-term-archive.png' desc='ログ長期保存の統計'/>

<Cmdname sid="logsink_mcube_config_statistics" className="uitext" />タブで ***+*** <Cmdname sid="adding" className="uitext" />ボタンを選択すると<Cmdname sid="logsink_mcube_config_statistics" className="uitext" /> <Cmdname sid="add" className="uitext" />画面が表示されます。 ***+*** <Cmdname sid="adding" className="uitext" />ボタンでルールを追加したり、作成したルールを***-***アイコンで削除できます。

#### 設定項目 {#log-long-term-archive-comp}

| フィールド           | 説明                                                                                                                     |
| --------------- | ---------------------------------------------------------------------------------------------------------------------- |
| カテゴリ            | ルールが適用されるカテゴリです。                                                                                                       |
| 統計キー(key)       | ルールを満たすログが発生した場合、保存するキーとして同じキーを重複で設定できません。                                                                             |
| ログ検出条件          | ログ統計データを生成する条件です。 この条件を満たすログがどのくらい収集されたかで統計データを生成します。                                                                  |
| 除外              | 除外をチェックすると、入力した条件を満たさない値で統計データを作成します。                                                                                  |
| 大小文字を区別する       | 入力したログ検出条件の値に対して大文字と小文字の区別有無を指定します。                                                                                    |
| 活性化有無           | 活性化または非活性化の設定(既定値`true`)                                                                                               |

#### 例

次のように設定を追加した場合、収集されたログのうち、statusが`200`, `300`のログを対象に**_TotalCount_**のキーで統計データを作成します。 

<ImgLang img='log-long-term-totalcount.png' desc='ログ長期保存の統計例'/>

### データ参照 {#log-widget-statistics}

1. <Cmdname sid="side_integratedFlexboard" className="uitext" />の<Cmdname sid="widget_template" className="uitext" />で<Cmdname sid="logsink_mcube_config_statistics" className="uitext" />を検索し、ウィジェットを作成します。

   <ImgLang img='log-flexboard-widget-long-term.png' desc='ログ長期保存統計ウィジェットテンプレート'/>

2. データを照会する<Cmdname sid="category" className="uitext" />と<Cmdname sid="ITM06438" className="uitext" />を指定して<Cmdname sid="apply" className="uitext" />ボタンを選択します。

   <ImgLang img='log-flexboard-widget-setting-long-term.png' desc='ログ長期保存統計ウィジェット - カテゴリおよびキーの選択'/>

3. 追加した設定で<Cmdname sid="logsink_mcube_config_statistics" className="uitext" />データを次のように確認できます。

   <ImgLang img='log-flexboard-widget-chart-long-term.png' desc='ログ期保存統計ウィジェット'/>
