<InDoc product='aws-log'>

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_management" className="uitext" /> &gt; <Cmdname sid="side_logSetting" className="uitext" />

</InDoc>

<InDoc product='log,postgresql,mysql,oracle,oracle-pro'>

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_log" className="uitext" /> &gt; <Cmdname sid="side_logSetting" className="uitext" />

</InDoc>

<Cmdname sid="side_logSetting" className="uitext" />メニューで、ログモニタリング関連の設定を行われます。 上部のタブからエージェント設定の確認、ログモニタリングを活性化有無の決定、ログデータの保存期間および照会パスワードの設定、ログパーサ登録、クイックインデックス設定、個人情報の非識別化管理などのメニューが利用できます。

:::note

- <Cmdname sid="use_log_monitoring" className="uitext" />機能を使用するには、<Cmdname sid="edit_project" className="b600" />権限が必要です。

- <Cmdname sid="log_update" className="b600" />権限では、<Cmdname sid="use_log_monitoring" className="uitext" />機能と<Cmdname sid="side_logSetting" className="uitext" />メニューを修正できます。

:::

## ログモニタリングを開始する {#log-getting-started}

<InDoc product='aws-log'>

<ImgLang img='log-getting-started-aws.png' desc='ログモニタリングの開始 sc'/>

</InDoc>

<InDoc product='log'>

<ImgLang img='log-getting-started.png' desc='ログモニタリングの開始 sc'/>

</InDoc>

<InDoc product='postgresql,mysql,oracle,oracle-pro'>

<ImgLang img='log-getting-started-db.png' desc='ログモニタリングの開始'/>

</InDoc>

<Xclude product='postgresql,mysql,oracle,oracle-pro'>

上段で<Cmdname sid="getting_started_log_monitoring" className="uitext" />タブを選択します。 ![WhaTap Docsアイコン](/img/ic-guide.svg) <Cmdname sid="log_monitoring_guide" className="uitext" />アイコンと<Cmdname sid="log_monitoring_plan" className="uitext" />ボタンを選択すると、関連の案内画面に移動します。 

</Xclude>

<InDoc product='postgresql,mysql,oracle,oracle-pro'>

上段で<Cmdname sid="getting_started_log_monitoring" className="uitext" />タブを選択します。 ![WhaTap Docsアイコン](/img/ic-guide.svg) <Cmdname sid="log_monitoring_guide" className="uitext" />アイコンを選択すると、関連の案内画面に移動します。 

</InDoc>

### エージェント設定とログモニタリングの有効化 {#log-set-up}

<InDoc product='aws-log'>

![number 1](/img/number-01.png)領域の<Cmdname sid="use_log_monitoring" className="uitext" />トグルボタンでログモニタリングの有効化・無効化を設定します。

<ImgLang img='log-start-aws.png' desc='ログモニタリングの開始'/>

- ![アイコン](/img/ic-toggle-on.svg)トグルボタンをオンにすると、ログモニタリンがアクティブになります。 活性化した日から15日間無料で体験できます。
- ![アイコン](/img/ic-toggle-off.svg)トグルボタンをオフにすると、ログモニタリンが無効化されます。 これ以上ログを保存しません。 

</InDoc>

<InDoc product='log,postgresql,mysql,oracle,oracle-pro'>

![number 1](/img/number-01.png)領域でエージェント設定を確認し<Cmdname sid="use_log_monitoring" className="uitext" />トグルボタンでログモニタリングの有効化・無効化を設定します。

#### エージェントの設定確認 {#log-check-agent-settings}

<Xclude product='postgresql,mysql,oracle,oracle-pro'>

ログモニタリングを開始するために、エージェントのバージョンと設定情報を確認してください。 ***エージェント設定確認***メニューを選択して、説明通りにプロセスを進めてください。

- **アプリケーションモニタリング**

  ***適用する***メニューの下にある固有のアプリケーション手順を確認してください。 次の説明書[Java](log-java)、[PHP](log-php)、[Node.js](log-nodejs)、[Python](log-python)、[Go](log-go)などをご参照ください。

- **サーバーモニタリング**

  ***適用する***メニューの下にある固有のアプリケーション手順を確認してください。 [次の文書](log-server)を参照してください。 指示に従って*whatap.con*にログモニタリング対象ファイルの設定を追加します。

- **Kubernetesモニタリング**

  ***適用する***メニューの下にある固有のアプリケーション手順を確認してください。 [次の文書](log-k8s)を参照してください。 

</Xclude>

<InDoc product='postgresql,mysql,oracle,oracle-pro'>

ログモニタリングを開始するために、エージェントのバージョンと設定情報を確認してください。 エージェント設定に関する詳細は[次の文書](log-db)を参照してください。

</InDoc>

#### ログモニタリングの有効化 {#log-activate}

<Cmdname sid="use_log_monitoring" className="uitext" />メニューを選択して、ログモニタリングの有効化または無効化を設定します。

<Xclude product="postgresql,mysql,oracle,oracle-pro">

</Xclude>

<InDoc product='postgresql,mysql,oracle,oracle-pro'>

<ImgLang img='log-start-db.png' desc='ログモニタリングの開始'/>

</InDoc>

- ![アイコン](/img/ic-toggle-on.svg)トグルボタンをオンにすると、ログモニタリンがアクティブになります。 活性化した日から15日間無料で体験できます。 
- ![アイコン](/img/ic-toggle-off.svg)トグルボタンをオフにすると、ログモニタリンが無効化されます。 これ以上ログを保存しません。 

</InDoc>

### ログモニタリングのデータ設定 {#log-data-setting}

![number 2](/img/number-02.png)領域で<Cmdname sid="log_usage" className="uitext" />が確認できます。 また<UI>ログ保存期間</UI>と<Cmdname sid="log_lookup_password" className="uitext" />設定を変更できます。

#### ログ保存期間{#data-retention}

共通に適用する基本(default) データ保持期間です。 未指定の場合、既定値は1日です。 ログ保存期間の選択オプションの他に、ユーザーが希望する期間を入力できます。 <Cmdname sid="log_usage" className="uitext" />一覧で別に設定しない場合、このログデータの保存期間がデフォルトで適用されます。 <Cmdname sid="log_usage" className="uitext" />一覧でカテゴリごとのデータ保存期間を設定し<Cmdname sid="initialized" className="uitext" />ボタンを選択すると、デフォルトのデータ保存期間に初期化されます。 

#### ログ使用量{#data-retention-per-category}

<Cmdname sid="log_usage" className="uitext" />一覧でカテゴリ別のログデータの保存期間を指定できます。 **ログ数**は、当該期間中に蓄積されたログの件数を意味します。 例えば、<Cmdname sid="daily_log_count" className="uitext" />は、1日にたまったログ件数、<Cmdname sid="expected_log_count" className="uitext" />は、データ保持日に今日のログ数を掛けたログ件数を意味します。

ログデータの保存期間を次のように指定できます。 期間指定により、古いデータを削除してスペースを確保できます。

- **トライアルプロジェクト**  

  データ保存期間として1日、2日、3日を選択できます。

- **有料プロジェクト**  

  データの保存期間として1日、2日、3日、4日、5日、6日、7日、10日、30日、40日が選択できます。

- **保存量基準課金**   

  データの保存期間によってコストが異なります。

  > 例、1日平均200万ログ件数が蓄積され、データ保存期間を3日に指定した場合、平均600万ログ件数が収集サーバーに保持され、課金の対象となります。

#### ログ参照パスワード {#log-lookup-pw}

セキュリティを強化するため、<Cmdname sid="log_lookup_password" className="uitext" />を設定してください。 ログ検索パスワードの指定はオプションです。 ログ検索パスワードを使用中の場合は、ログ画面に入るときは必ずパスワードを入力します。 

:::note

**パスワードの紛失**

**ログ編集**権限がある場合は、<Cmdname sid="side_logSetting" className="uitext" />メニューで新しいパスワードに変更できます。

:::

## ログ1次パーサ設定 {#log-setting-parser-1st}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部にある<Cmdname sid="log_parser_setting_primary" className="uitext" />タブを選択してログパーサを登録または修正ができます。 ログ1次パーサは、***GROK***と***JSON***パーサを提供します。 収集されたログを使用して、パターンの条件と一致するキー情報、つまり検索キーと検索値を抽出します。 パーシングされたログキーは、ログのタイプを分類するための目的および特定のログを検索するためのインデックスに使用されます。 タイプ別ログ発生数を集計したり、特定のログをすばやく特定するために登録に必要なパーサです。

- ***GROK***：基本的には、正規表現ベースのパーシングに対応します。 予約キーワードベースのパーシングを提供します。

- ***JSON***：ログからJSONで出力された部分に対して一括パーシング機能を提供します。

:::note 

**パーシングロジックが未登録時に検索可能なkey**

`category`, `oid`, `oname`, `okind`, `okineName`, `@txid`, `@login`, `httphost` 

:::

:::note

**パーサで登録のできない予約語**

次の予約語の場合、パーサを登録してもインデックスは作成されません。

`timestamp`, `message`, `pcode`, `category`, `content`, `logContent`

:::

:::note 

ログパーサの詳細については、[次の文書](log-parser)を参照してください。

:::

### 設定項目 {#log-parser-comp}

| 設定値    | 説明                                                                                           | その他      |
| ------ | -------------------------------------------------------------------------------------------- | -------- |
| カテゴリ   | パターンを適用するカテゴリです。                                                                             | required |
| ログ検出条件 | フィルターとして適用する検索キー、検索値を入力します。 ログ検出条件を満たすログデータにパターンを適用します。 ログ検出条件を入力しない場合、すべてのログを対象にパターンを適用します。 | optional |
| パターン   | ログをパーシング(parsing)するパターンです。 作成したパターンに合わせてパーシングを行い、インデックスを作成します。 GROKと正規表現に対応します。              | required |

### パーサ一覧 {#log-parser-list-1st}

<ImgLang img='log-1st-parser-list.png' desc='ログパーサー一覧'/>

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部の<Cmdname sid="log_parser_setting_primary" className="uitext" />タブを選択すると、登録したパーサが表示され、追加および編集が可能な**パーサ一覧**画面を確認できます。

- 右上の***+***<Cmdname sid="adding" className="uitext" />ボタンを選択すると<Cmdname sid="parser" className="uitext" /> <Cmdname sid="add" className="uitext" />画面が表示されます。

- パーサ一覧<Cmdname sid="ITM06352" className="uitext" />カラムの![](/img/ic-drag-drop.svg)アイコンをドラッグしてパーサの設定手順を変更できます。

- パーサ一覧![アイコン](/img/ic-toggle-on.svg) <Cmdname sid="enable" className="uitext" />トグルでパーサの活性化有無を指定できます。

- パーサ一覧![修正アイコン](/img/ico-edit.svg) <Cmdname sid="edit" className="uitext" />及び![削除アイコン](/img/ico-trash-red.svg) <Cmdname sid="delete" className="uitext" />アイコンで登録したパーサを修正または削除できます。

### パーサ登録手順{#log-add-parser-1st}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部にある<Cmdname sid="log_parser_setting_primary" className="uitext" />タブを選択してログパーサを登録または修正ができます。 次に、パーサ登録の共通の手順を説明します。

<ImgLang img='log-1st-parser-add.png' desc='ログパーサーの追加'/>

1. ***+***<Cmdname sid="adding" className="uitext" />ボタンを選択すると<Cmdname sid="parser" className="uitext" /> <Cmdname sid="add" className="uitext" />画面が表示されます。

2. <Cmdname sid="parser" className="uitext" />選択画面からパーサを選択します。 各パーサおよびパターン登録の詳細については、次の文書を参照してください。

   - ***GROK*** [パーサおよびパターン登録](#log-pattern-grok)

   - ***JSON*** [パーサおよびパターン登録](#log-pattern-json)

3. <Cmdname sid="BTN08593" className="uitext" />ボタンを選択すると、右側にパターン登録とシミュレーション画面が表示されます。

4. 登録を希望する<Cmdname sid="pattern" className="uitext" />と<Cmdname sid="log" className="uitext" />を入力します。 

5. 登録したいパターンが正常な場合は、<Cmdname sid="simulation" className="uitext" />ボタンをクリックしてシミュレーション及びパターンのパフォーマンスを測定してください。

6. パターンの適用後、<Cmdname sid="category" className="uitext" />選択画面でカテゴリを選択するか、直接入力します。 

7. <Cmdname sid="ITM06439" className="uitext" />として使用する<Cmdname sid="ITM06429" className="uitext" />と<Cmdname sid="ITM06430" className="uitext" />を選択するか、直接入力します。

8. <Cmdname sid="add" className="uitext" />ボタンを選択してパーサーを追加します。

:::note

- シミュレーションと性能測定についての詳細は、[次の文書](#parser-simulation-and-performance)を参照してください。

- ログパーサ登録時、同じ<Cmdname sid="category" className="uitext" />のパーサを重複で登録できません。

- フィルター条件に合ったログデータのみパターンを適用します。 <Cmdname sid="ITM06439" className="uitext" />を指定しない場合は、すべてのログにパターンを適用します。

:::

:::note 

**個人情報の非識別化**

<Cmdname sid="log_parser_setting_primary" className="uitext" />タブでその時の検索キー名を<code class='filter'>検索キー.p</code>に指定した場合、デフォルトでは非識別化の対象となります。 <Cmdname sid="TTL08814" className="uitext" />タブで追加または修正時に該当の<Cmdname sid="category" className="uitext" />を選択した後、<Cmdname sid="TTL08835" className="uitext" />で確認できます。 マスキング処理を希望しない場合は解除できます。

> 例、<code class='filter'>myname.p</code> `***`

WhaTapは、パーサー設定中に非識別化の対象を指定する方式よりも<Cmdname sid="TTL08814" className="uitext" />タブの使用を勧めます。 個人情報の非識別化の詳細は[次の文書](#log-deidentification-of-personal-info)で参照してください。 

:::

### GROKパーサパターン登録 {#log-pattern-grok}

基本文法は、`%{SYNTAX:SEMANTIC}`です。 GROKパーサの詳細は、[次の文書](log-parser#grok-parser-detail)を参照してください。 パターン登録とシミュレーションが不可欠です。 

- **SYNTAX**

  GROK定義パターンです。

- **SEMANTIC**

  パーシングされたデータに割り当てるキーです。

  :::note 

  SEMANTICでは、予約語ではなく、組み合わせでの使用を推奨します。

  :::

### JSONフォーマットのパーサパターン登録 {#log-pattern-json}

ログ全体または一部がJSON形式で出力される場合、JSONフォーマットのパーサを使用して、JSONに出力された部分をパーシングできます。 ログのうちJSON形式として出力された部分を検出するために、***Prefix***、***Postfix***オプションを組み合わせてログのどの部分をJSONとして認識してパーシングするかを指定します。 JSONパーサの詳細は、[次の文書](log-parser#json-parser-detail)を参照してください。 シミュレーションが不可欠です。 

| オプション    | 説明                                                                                                             |
| -------- | -------------------------------------------------------------------------------------------------------------- |
| Prefix   | JSON文字列の先頭の前にある文字列を指定します。 未指定時、ログ出力文の先頭からJSON文字列として識別します。                                                      |
| Postfix  | JSON文字列の最後後の部分の文字列を指定します。 未指定時、ログ出力文の最後までをJSON文字列として識別します。                                                     |
| Ignore   | JSON出力部分のうちキー抽出を除外するフィールドを指定します。                                                                               |

- **登録例**

  ```bash title='Log'
  [2022-10-25 10:15:34:145]...(改行)
  Request : {"key1":"value1","key2":"value2",...}(改行)
  Response : {"key3":"value3","key4":"value4",...}
  ```

  例のように流入されるログがRequest JSON、Response JSONをすべてパーシングする場合、次の2つのパターンを登録します。

  - Requestパーシング用のパターン  

    > "Request："と"Response"間の文字列`{"key1":"value1","key2":"value2",...}`対象

  - Reponseパーシング用のパターン

    > "Response："からログの最後までの文字列`{"key3":"value3","key4":"value4",...}`対象
- **JSONカスタムパターンの登録**

  ログの一部がJSON形式で出力される場合、JSONで出力された部分をカスタムパーサを使用してパーシングできます。 パターンを次のように入力します。

  ```java
  io.whatap.logsink.parser.JsonFormatParser{}
  ```

  ログのうちJSON形式として出力された部分を検出するために、***Prefix***、***Postfix***オプションを組み合わせてログのどの部分をJSONとして認識してパーシングするかを指定します。

  `JsonFormatParser{}`の`{}`にオプションを指定します。

  - **登録例**

    ```bash title='Log'
    [2022-10-25 10:15:34:145]...(改行)
    Request : {"key1":"value1","key2":"value2",...}(改行)
    Response : {"key3":"value3","key4":"value4",...}
    ```

    例のように流入されるログがRequest JSON、Response JSONをすべてパーシングする場合、次の2つのパターンを登録します。

    - Requestパーシング用のパターン  
      > "Request："と"Response"間の文字列`{"key1":"value1","key2":"value2",...}`対象

    ```java
    io.whatap.logsink.parser.JsonFormatParser {prefix:"Request : ",postfix:"Response"}
    ```

    - Reponseパーシング用のパターン
      > "Response："からログの最後までの文字列`{"key3":"value3","key4":"value4",...}`対象

    ```java
    io.whatap.logsink.parser.JsonFormatParser {prefix: "Response : "}
    ```

### パーサーシミュレーションと性能測定{#parser-simulation-and-performance}

<ImgLang img='log-parser-simulation2.png' desc='パーサーシミュレーションとパフォーマンス測定'/>

1. <Cmdname sid="pattern" className="uitext" />と<Cmdname sid="log" className="uitext" />を入力します。

2. <Cmdname sid="simulation" className="uitext" />ボタンをクリックして、登録しようとするパターンでパーシングに成功することを確認します。

3. シミュレーションの成功時<Cmdname sid="simulation_result" className="uitext" />と<Cmdname sid="TTL08604" className="uitext" />を照会できます。

4. シミュレーション後、<Cmdname sid="apply_pattern" className="uitext" />ボタンをクリックすると、選択したパーサーに入力したパターンが適用されます。 

:::note 

- <Cmdname sid="performance_measurement" className="uitext" />は、シミュレーション実行対象文字列に対してパーサーの反復パーシング所要時間を測定します。

- ***パーサーシミュレーション***後、パターンを登録できます。 

:::

### パーシングの成功 {#log-parsed}

パーシング ロジックを登録し、**キー**(key)が生成されたら、ログを照会する際に該当キーでパーシングされた値が追加されます。 次の<Cmdname sid="side_logTail" className="uitext" />メニュー例のように、パーシングされたキーと値が追加されます。 

<ImgLang img='log-parsed.png' desc='パーシング成功'/>

パーシングされたキーは<Cmdname sid="side_logTail" className="uitext" />、<Cmdname sid="side_logSearch" className="uitext" />、<Cmdname sid="side_logExplorer" className="uitext" />で確認できます。

## ログ2次パーサ設定 {#log-setting-parser-2nd}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部にある<Cmdname sid="log_parser_setting_secondary" className="uitext" />タブを選択してログパーサを登録または修正できます。 <Cmdname sid="status_4xx5xx_parser" className="uitext" />と<Cmdname sid="status_success_rate" className="uitext" />を提供します。 ログの2次パーサは、GROKまたはJSONのような1次パーサがパーシングされた場合に使用できるパーサです。 1次パーサで抽出した値を処理して統計データを生成します。 ウェブまたはAPIの応答ログに対してHttp Status Code基づいて2次統計を抽出します。

- <Cmdname sid="status_4xx5xx_parser" className="uitext" />：異常レスポンスに関する件数情報を集計します。

- <Cmdname sid="status_success_rate" className="uitext" />：全体の件数に対する異常レスポンスの割合を抽出します。

:::note

ログの2次パーサは、1次でパーシングされた結果に対して、追加での2次パーシング機能を提供します。 2次パーサを使用するには、**1次パーサ**を**登録**する必要があります。

:::

### パーサ一覧 {#log-parser-list-2nd}

<ImgLang img='log-2nd-parser-list.png' desc='対数2次パーサ一覧'/>

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部の<Cmdname sid="log_parser_setting_secondary" className="uitext" />タブを選択すると、登録したパーサが表示され、追加および編集が可能な**パーサ一覧**画面を確認できます。

- 右上の***+***<Cmdname sid="adding" className="uitext" />ボタンを選択すると<Cmdname sid="parser" className="uitext" /> <Cmdname sid="add" className="uitext" />画面が表示されます。

- パーサ一覧<Cmdname sid="ITM06352" className="uitext" />カラムの![](/img/ic-drag-drop.svg)アイコンをドラッグしてパーサの設定手順を変更できます。

- パーサ一覧![アイコン](/img/ic-toggle-on.svg) <Cmdname sid="enable" className="uitext" />トグルでパーサの活性化有無を指定できます。

- パーサ一覧![修正アイコン](/img/ico-edit.svg) <Cmdname sid="edit" className="uitext" />及び![削除アイコン](/img/ico-trash-red.svg) <Cmdname sid="delete" className="uitext" />アイコンで登録したパーサを修正または削除できます。

### パーサ登録手順 {#log-add-parser-2nd}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上部にある<Cmdname sid="log_parser_setting_secondary" className="uitext" />タブを選択してログパーサを登録または修正できます。 次に、パーサ登録の共通の手順を説明します。

<ImgLang img='log-2nd-parser-add.png' desc='ログ2次パーサ登録手順' />

1. ***+***<Cmdname sid="adding" className="uitext" />ボタンを選択すると<Cmdname sid="parser" className="uitext" /> <Cmdname sid="add" className="uitext" />画面が表示されます。

2. <Cmdname sid="parser" className="uitext" />選択画面からパーサを選択します。 各パーサ設定項目および除外するステータスコード登録の詳細については、次の文書を参照してください。

   - <Cmdname sid="status_4xx5xx_parser" className="uitext" /> [設定項目および除外するステータスコード登録](#4xx-5xx-status-parser)

   - <Cmdname sid="status_success_rate" className="uitext" /> [設定項目および除外するステータスコード登録](#log-pattern-status)

3. <Cmdname sid="ITM06255" className="uitext" />を入力します。

4. <Cmdname sid="category" className="uitext" />選択画面からカテゴリを選択するか、直接入力します。

5. <Cmdname sid="ITM06439" className="uitext" />を選択するか、直接入力します。

6. <Cmdname sid="add" className="uitext" />ボタンを選択してパーサを登録します。

### 4xx、5xxで除外するステータスコードを登録 {#4xx-5xx-status-parser}

<Cmdname sid="status_4xx5xx_parser" className="uitext" />は、statusが既にパーシングされている場合にのみ使用できるパーサです。 パーシングされたstatusを利用して追加で4xx、5xxのステータスコードをパーシングします。 パーシングされたデータで4xx、5xxの件数データを作成できます。 除外するステータスコードとして、4xx、5xxのステータスコードを入力または選択できます。 入力されたステータスコードは、ログから4xx、5xxのステータスコードをパーシングする際に除外されます。

#### 設定項目 {#log-parser-comp-4xx5xx}

| 設定値          | 説明                                                                                                   | その他      |
| ------------ | ---------------------------------------------------------------------------------------------------- | -------- |
| カテゴリ         | 4xx、5xxの件数データを生成するカテゴリです。                                                                            | required |
| ログ検出条件       | フィルターとして適用する検索キー、検索値を入力します。 ログ検出条件を満たすログデータに対して、4xx、5xxのデータを生成します。 ログ検出条件を入力しない場合は、すべてのログのデータを生成します。 | optional |
| 除外するステータスコード | 統計データの作成時に除外するステータスコードです。 入力がなければ、4xx・5xxに該当するすべてのエラーステータスコードを対象に4xx、5xxの件数データを生成します。                | optional |

#### statusパーサの登録例

<ImgLang img='log-2nd-4xx5xx-status.png' desc='Grokパーサ - statusパーシングパターン登録'/>

流入されるログが`{"msg":"message","status":404}`で、例のようにGROKパーサでstatusをパーシングする場合、`status: 404`のようにパーシングされます。 statusが正しくパーシングされることを確認したら、4xx、5xxのステータスコードのパーサから除外するステータスコードを登録します。     

#### データ参照

パーサをすべて登録すると、<Cmdname sid="side_integratedFlexboard" className="uitext" />に移動して<Cmdname sid="log" className="uitext" /> <Cmdname sid="log_4xx5xx_count" className="uitext" />ウィジェットを作成します。

<ImgLang img='log-flexboard-widget.png' desc='Log Flex board widget - 4xx5xx'/>

ウィジェットを作成すると、次のようにデータを確認できます。

<ImgLang img='log-flexboard-widget-chart-4xx5xx.png' desc='Log Flex board widget chart - 4xx5xx'/>

- ***avg***：照会期間のデータで平均値です。

- **max**：照会期間のデータで最大値です。

- ***recently***：照会期間のデータで最後の値です。

### 成功率をパーサから除外するステータスコード登録 {#log-pattern-status}

<Cmdname sid="status_success_rate" className="uitext" />は、statusが既にパーシングされている場合に使用できるパーサです。 statusパーシングに関する内容は、[次の文書](#4xx-5xx-status-parser)を参照してください。 パーシングされたstatusから追加で2xx、3xxのステータスコードをパーシングします。 パーシングしたデータで、HTTP要請成功率データを生成できます。 除外するステータスコードは、2xx、3xxのステータスコードを入力または選択できます。 入力されたステータスコードは、ログから2xx、3xxのステータスコードをパーシングする際に除外されます。

#### 設定項目 {#log-parser-comp-status}

| 設定値          | 説明                                                                                               | その他      |
| ------------ | ------------------------------------------------------------------------------------------------ | -------- |
| カテゴリ         | 要請成功率データを生成するカテゴリです。                                                                             | required |
| ログ検出条件       | フィルターとして適用する検索キー、検索値を入力します。 ログの検出条件を満たすログデータのみで要請成功率データを生成します。 ログ検出条件を入力しない場合は、すべてのログのデータを生成します。 | optional |
| 除外するステータスコード | 要請成功率データを生成する際に除外するステータスコードです。 入力がなければ、2xx・3xxに該当するすべての成功ステータスコードを対象に要請成功率のデータを生成します。            | optional |

#### データ参照

パーサをすべて登録したら、<Cmdname sid="side_integratedFlexboard" className="uitext" />に移動し、ログ要請の成功率ウィジェットを作成します。  

<ImgLang img='log-flexboard-widget-scs.png' desc='ログリクエスト成功率のウィジェットテンプレート'/>

ウィジェットを作成すると、次のようにデータを確認できます。

<ImgLang img='log-flexboard-widget-chart-scs.png' desc='Log Flex board widget chart request success rate widget chart - 4xx5xx'/>

チャート上のデータは、照会期間に関する統計を示します。 統計方法としては最近値、最大値、平均値などを選択できます。 最近使った値がデフォルトで選択されています。

## 高速インデックス設定 {#log-setting-index}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上段から<Cmdname sid="fast_index_setting" className="uitext" />タブを選択します。 大量のログを収集すると、ログ検索性能が低下する場合があります。 よく使う検索条件は、**インデックス**(index)で生成すると、ログ検索がより速くなります。 設定項目は次のとおりです。

| 設定値                  | 必須の有無      | 説明                                 |
| -------------------- | ---------- | ---------------------------------- |
| カテゴリ                 | 必須         | 高速クインデックスを設定するカテゴリ                 |
| 検索キー                 | 必須         | 高速インデックスを設定する検索キー                  |
| 大文字と小文字を区別しない        | オプション      | 大文字と小文字の区別するかどうか                   |
| ルール                  | 必須         | `*` を少なくとも１つ以上を含める必要あり             |
| 活性化有無                | 必須         | 活性化または非活性化の設定(既定値`true`)           |

## ログ設定のインポート・エクスポート{#export-import-settings}

共通のパーサ設定及び<Cmdname sid="fast_index_setting" />の内容をJSONファイル形式で保存し、他のプロジェクトからJSONファイルをインポートして適用できます。 プロジェクトごとに何度も繰り返し設定を作成する手間を減らします。

1. 1つのプロジェクトにパーサ設定および<Cmdname sid="fast_index_setting" />を追加します。

2. 各設定タブで画面右上に***JSON***![エクスポートアイコン](/img/ico-export.svg)ボタンを選択します。

3. <Cmdname sid="export_json" className="uitext" />画面が表示されると、画面右上にある<Cmdname sid="export" className="uitext" />ボタンを選択します。

4. JSON設定ファイルがユーザーPCに保存されます。

5. 他のプロジェクトに移動してから、<Cmdname sid="log" className="uitext" /> &gt; <Cmdname sid="log_setting" className="uitext" />メニューに移動してください。

6. まず、JSON設定ファイルをエクスポートした設定タブを選択し、![インポートアイコン](/img/ico-import.svg)ボタンを選択します。

7. ファイル選択画面が表示されたら、ユーザーのPCに保存したJSON設定ファイルを選択します。

8. <Cmdname sid="import_json" className="uitext" />画面が表示されたら、設定内容を確認し、<Cmdname sid="add_to_list" className="uitext" />または <Cmdname sid="overwrite" className="uitext" />ボタンを選択します。

9. 画面右上の<Cmdname sid="save" className="uitext" />ボタンを選択します。

:::caution

JSON設定ファイルをインポートして、<Cmdname sid="save" className="uitext" />ボタンを選択しないと、インポートされた設定は保存されません。

:::

## ログ長期保存統計の設定 {#log-long-term-archive}

<Cmdname sid="side_logSetting" className="uitext" />メニューの上段から<Cmdname sid="logsink_mcube_config_statistics" className="uitext" />タブを選択します。 ログデータは、非常に大容量のため、長期間保存することは難しいです。 したがって、ログ統計データの設定機能を使用して**特定の条件を満たすログデータが5分ごとに何件収集されたかに関する情報を保存**できます。 長期間にあたって、実際のログデータが削除されても、条件を満たすログがどれだけ収集されているかの推移は確認できます。

### ログ長期保存統計の追加 {#log-long-term-archive-add}

<ImgLang img='log-long-term-archive.png' desc='ログ長期保存の統計'/>

<Cmdname sid="logsink_mcube_config_statistics" className="uitext" />タブで ***+*** <Cmdname sid="adding" className="uitext" />ボタンを選択すると<Cmdname sid="logsink_mcube_config_statistics" className="uitext" /> <Cmdname sid="add" className="uitext" />画面が表示されます。 ***+*** <Cmdname sid="adding" className="uitext" />ボタンでルールを追加したり、作成したルールを***-***アイコンで削除できます。

#### 設定項目 {#log-long-term-archive-comp}

| フィールド           | 説明                                                                                                                     |
| --------------- | ---------------------------------------------------------------------------------------------------------------------- |
| カテゴリ            | ルールが適用されるカテゴリです。                                                                                                       |
| 統計キー(key)       | ルールを満たすログが発生した場合、保存するキーとして同じキーを重複で設定できません。                                                                             |
| ログ検出条件          | ログ統計データを生成する条件です。 この条件を満たすログがどのくらい収集されたかで統計データを生成します。                                                                  |
| 除外              | 除外をチェックすると、入力した条件を満たさない値で統計データを作成します。                                                                                  |
| 大小文字を区別する       | 入力したログ検出条件の値に対して大文字と小文字の区別有無を指定します。                                                                                    |
| 活性化有無           | 活性化または非活性化の設定(既定値`true`)                                                                                               |

#### 例

次のように設定を追加した場合、収集されたログのうち、statusが`200`, `300`のログを対象に***TotalCount***のキーで統計データを作成します。 

<ImgLang img='log-long-term-totalcount.png' desc='ログ長期保存の統計例'/>

### データ参照 {#log-widget-statistics}

1. <Cmdname sid="side_integratedFlexboard" className="uitext" />の<Cmdname sid="widget_template" className="uitext" />で<Cmdname sid="logsink_mcube_config_statistics" className="uitext" />を検索し、ウィジェットを作成します。

   <ImgLang img='log-flexboard-widget-long-term.png' desc='ログ長期保存統計ウィジェットテンプレート'/>

2. データを照会する<Cmdname sid="category" className="uitext" />と<Cmdname sid="ITM06438" className="uitext" />を指定して<Cmdname sid="apply" className="uitext" />ボタンを選択します。

   <ImgLang img='log-flexboard-widget-setting-long-term.png' desc='ログ長期保存統計ウィジェット - カテゴリおよびキーの選択'/>

3. 追加した設定で<Cmdname sid="logsink_mcube_config_statistics" className="uitext" />データを次のように確認できます。

   <ImgLang img='log-flexboard-widget-chart-long-term.png' desc='ログ期保存統計ウィジェット'/>

## 個人情報の非識別化{#log-deidentification-of-personal-info}

<Cmdname sid="TTL08814" className="uitext" />ではログデータ内に含まれる個人情報を保護するマスキング処理とデータ置換の2つの主要機能を提供します。 <Cmdname sid="TTL08814" className="uitext" />機能により、新規のログデータ内で個人情報の項目をマスキング処理したり、<Cmdname sid="TTL08979" className="uitext" />機能により、既存のログデータの機密な情報を安全な値に変更できます。 この機能は、機密なデータを扱う環境でセキュリティを強化するための不可欠ツールです。

- 暗号化の保存：指定された機密な情報は暗号化され、データベースに保存されます。

- マスキング処理：ログ画面に表示される時、機密な情報は基本的にマスキング(`***`)処理されて表示されます。

- 置換処理：機密な情報をユーザーが指定した安全な値に変更します。 

### 個人情報の分類{#log-personal-info-list}

一般的に個人情報として分類する項目は次のとおりです。 一般の個人情報以外にも機密な情報として処理すべき項目があれば<Cmdname sid="TTL08814" className="uitext" />機能を通じて、ログ内で必要な項目をマスキング処理または置換処理してください。 

<Columns> 
<Column className="text--left width--50">
*住民登録番号

- パスポート番号

- 運転免許証の番号

- 外国人登録番号
</Column>
<Column className="text--left">

- クレジットカードの番号

- 口座番号

- 生体情報
</Column>
</Columns>

### 要求権限

個人情報は非識別化過程を通じてマスキング処理されます。 **ログの個人情報照会**権限が付与されたユーザーのみ個人情報を照会できます。 **ログの個人情報照会**権限を持つユーザーは、ログ一覧の上部で<Cmdname sid="BTN08818" className="uitext" />トグルボタンを確認できます。 <Cmdname sid="BTN08818" className="uitext" />活性化により、マスキング解除時に個人情報を確認できます。 非識別化の対象検索キーの追加及び修正は、**ログ編集**権限のあるユーザーのみ可能です。  

:::note 

**ログの個人情報照会**権限及び**ログ編集**権限の詳細は[次の文書](/project/project-structure#CNT08829)を確認してください。 

:::

### 個人情報の非識別化設定{#log-deidentification-pi-setting}

<Cmdname sid="TTL08814" className="uitext" />設定から今後生成されるデータに対してマスキング処理を適用し、リアルタイムで機密な情報を隠し、セキュリティを強化できます。 マスキング処理されたデータは、元の情報が表示されないように処理され、個人情報が表示されないように管理できます。

<ImgLang img="log-de-identification.png" desc="ログ個人情報の非識別化" />

1. <Cmdname sid="TTL08814" className="uitext" />タブで<Cmdname sid="adding" className="uitext" />ボタンを選択します。

2. 右側の<Cmdname sid="TTL08814" className="uitext" /> <Cmdname sid="add" className="uitext" />画面で<Cmdname sid="category" className="uitext" />を選択します。 

3. 右側の<Cmdname sid="TTL08814" className="uitext" /> <Cmdname sid="add" className="uitext" />画面で暗号化およびマスキング処理する<Cmdname sid="ITM06429" className="uitext" />を入力します。 

4. 右側の<Cmdname sid="TTL08814" className="uitext" /> <Cmdname sid="add" className="uitext" />画面で下段の<Cmdname sid="add" className="uitext" />ボタンをクリックしてその設定を追加します。 

5. <Cmdname sid="TTL08814" className="uitext" />一覧で非識別化項目を確認した後、右上の<Cmdname sid="save" className="uitext" />ボタンを押して現在の設定を保存してください。

   <ImgLang img="log-de-identification-list.png" desc="ログ個人情報の非識別化リスト" />

   - 非識別化処理された検索キーの場合、ログコンテンツ内の<code class='filter'>検索キー.pii</code>形式で出力されます。

   - <Cmdname sid="TTL08814" className="uitext" />一覧内の<Cmdname sid="enable" className="uitext" />カラムで非識別化項目を![トグル活性化アイコン](/img/ic-toggle-on.svg)<Cmdname sid="enable" className="uitext" />にできます。

   - <Cmdname sid="TTL08814" className="uitext" />一覧内の<Cmdname sid="TLT08066" className="uitext" />カラムで![修正アイコン](/img/ic-edit.svg) ***修正***及び![除去アイコン](/img/ic-delete-critical.svg) ***除去***できます。

:::note 

<Cmdname sid="log_parser_setting_primary" className="uitext" />タブでその時の検索キー名を<code class='filter'>検索キー.p</code>に指定した場合、デフォルトでは非識別化の対象となります。 <Cmdname sid="TTL08814" className="uitext" />タブで追加または修正時に該当の<Cmdname sid="category" className="uitext" />を選択した後、<Cmdname sid="TTL08835" className="uitext" />で確認できます。 マスキング処理を希望しない場合は解除できます。 WhaTapは、パーサー設定中に非識別化の対象を指定する方式よりも<Cmdname sid="TTL08814" className="uitext" />タブの使用を勧めます。

![指定された検索キーの例](/img/log-display-pi-1st-parser.png)

:::

#### 個人情報の表示{#log-pi-toggle}

<Cmdname sid="side_logTail" className="uitext" />、<Cmdname sid="side_logExplorer" className="uitext" />、<Cmdname sid="side_logSearch" className="uitext" />メニューのログ一覧に表示されるマスキングデータのソースデータを照会できます。 <Cmdname sid="TTL08814" className="uitext" />設定項目は基本的にマスキング処理された状態で維持され、**ログの個人情報照会**権限のないユーザーは<Cmdname sid="BTN08818" className="uitext" />ボタンを使用できません。 ログ一覧内の<Cmdname sid="BTN08818" className="uitext" />活性化![トグル活性化アイコン](/img/ic-toggle-on.svg)ボタンをクリックすると、次のように元のデータを確認できます。

![ログの個人情報表示sc](/img/log-de-identification-content.png)

:::note 

<Cmdname sid="TTL08814" className="uitext" />タブで指定した検索キーは、ログメニュー内のログコンテンツから<code class='filter'>検索キー.pii</code>形式で表示されます。

> 例: <code class='filter'>status.pii 例</code> `***`

:::

### ログの個人情報の非識別化点検{#log-deidentification-pi-check}

:::caution 

<Cmdname sid="TTL08979" className="uitext" />機能を通じて既存のデータを置き換える場合、そのデータは元に戻すことができません。

:::

<Cmdname sid="TTL08979" className="uitext" />機能は、既存のログデータ内に含まれる個人情報項目を識別し、これをユーザーが指定した<Cmdname sid="ITM08984" className="uitext" />に置き換える機能です。 これにより、既存に保存されたログデータ内の個人情報を非識別化し、個人情報の保護を強化できます。

<ImgLang img="log-de-identification-check.png" desc="ログ個人情報の非識別化点検" />

1. 開始時間と終了時間を設定してください。 

2. <Cmdname sid="category" className="uitext" />を設定します。

3. <Cmdname sid="ITM08981" className="uitext" />を例の中から選択または<Cmdname sid="direct_input" className="uitext" />を選択します。

   :::note 

   <Cmdname sid="direct_input" className="uitext" />選択時に個人情報を識別するための正規表現式パターンを直接入力します。

   :::

4. <Cmdname sid="ITM08983" className="uitext" />トグルで個人情報が識別された場合、該当情報の置換有無を選択します。

5. 既存のログで正規表現式パターンに識別された文字列を変更する<Cmdname sid="ITM08984" className="uitext" />を入力します。 

   :::note 

   - <Cmdname sid="ITM08984" className="uitext" />は元の値より長くしてはなりません。

   - <Cmdname sid="ITM08983" className="uitext" />トグルの活性化時に、必ず<Cmdname sid="ITM08984" className="uitext" />を入力する必要があります。

   :::

6. 条件を入力した後、<Cmdname sid="BTN08985" className="uitext" />ボタンを選択します。 

   :::note 

   点検中の場合はいつでも<Cmdname sid="BTN08986" className="uitext" />ボタンで点検過程を中止できます。 

   :::

7. 置き換えを適用する時<Cmdname sid="TTL09446" className="uitext" />確認画面で<Cmdname sid="DSC09450" className="uitext" />入力後<Cmdname sid="BTN09452" className="uitext" />ボタンをクリックします。 

   <ImgLang img="log-de-identification-confirm.png" desc="로그 개인정보 비식별화 점검 확인" />

8. 点検作業の完了後、例の画像のように右側から<Cmdname sid="ITM08995" className="uitext" />を確認できます。 

   - <Cmdname sid="category" className="uitext" />：点検されたカテゴリ情報を表示します。

   - <Cmdname sid="ITM08989" className="uitext" />及び<Cmdname sid="ITM08990" className="uitext" />：点検が実行された時間範囲を表示します。

   - <Cmdname sid="ITM08981" className="uitext" />：点検された個人情報の項目を表示します。

   - <Cmdname sid="ITM08991" className="uitext" />：使用された正規表現式のパターンを表示します。

   - <Cmdname sid="ITM08984" className="uitext" />：適用された置換値を表示します。

   - <Cmdname sid="ITM08994" className="uitext" />: 識別された個人情報の数を表示します。 <Cmdname sid="BTN09454" className="uitext" />クリックするとサンプルログを確認できます。

   - <Cmdname sid="ITM08995" className="uitext" />：個人情報が識別された結果を表示します。

     > `SUCCESS`(点検成功)、`FAILED`(点検失敗)、`STOP`(点検中止)、`TIMED_OUT`(時間超過による点検終了)

#### <Cmdname sid="BTN09473" /> {#log-de-identification-check-history}

ログ個人情報の非識別化点検を行った後、過去に行われた点検結果を照会するには、上段右側で<Cmdname sid="BTN09473" className="uitext" />ボタンをクリックします。 置き換え履歴、点検時点、適用された個人情報項目などを追跡できます。 また<Cmdname sid="BTN09473" className="uitext" />画面の上段右側の![ダウンロードアイコン](/img/ico-download.svg) ***CSV***ボタンをクリックすると_CSV_ファイル形式でそのリスト情報をダウンロードできます。 

<ImgLang img="log-de-identification-check-history.png" desc="로그 개인정보 비식별화 점검 이력 확인" />

#### 個人情報のパターン{#log-pi-pattern}

export const regexJumin = `(?<!\w)\d{2}(0[1-9]|1[0-2])([0-2][0-9]|3[0-1])-[1-4]\d{6}(?!\w)`;
export const regexPhone = `(?<!\w)(\+82-?1[016789]-?\d{3,4}-?\d{4}|01[016789]-?\d{3,4}-?\d{4})(?!\w)`;
export const regexID = `(?<!\w)\d{6}-?[5-8]\d{6}(?!\w)`;
export const regexCar= `(?<!\w)\d{2}-\d{2}-\d{6}-\d{2}(?!\w)`;
export const regexCard=`(?<!\w)\d{4}-\d{4}-\d{4}-\d{4}(?!\w)`;
export const regexEmail=`([a-zA-Z0-9][a-zA-Z0-9._%+-]*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})`;
export const regexAccount=`(?<!\w)\d{6}-\d{2}-\d{6}(?!\w)`;
export const regexBiz=`(?<!\w)\d{3}-\d{2}-\d{5}(?!\w)`;
export const regexLb=`(?<!\w)\d{6}-?\d{7}(?!\w)`;

既存のログデータから個人情報を識別する際に使用される正規表現式のパターンの例は以下の通りです。

| 個人情報のパターン   | 個人情報の例               | 正規表現式パターン                        | 置換される値                |
| ----------- | -------------------- | -------------------------------- | --------------------- |
| 住民登録番号      | 123456-1234567       | <pre>{regexJumin}</pre>          | `******-*******`      |
| パスポート番号     | M1234567             | <pre>([MSRODTC][0-9]{7}\b)</pre> | `********`            |
| 運転免許証の番号    | 01-23-456789-00      | <pre>{regexCar}</pre>            | `**-**-******-**`     |
| 外国人登録番号     | 987654-1234567       | <pre>{regexID}</pre>             | `******-*******`      |
| クレジットカードの番号 | 1234-5678-9012-3456  | <pre>{regexCard}</pre>           | `****-****-****-****` |
| 電話番号        | 010-1234-5678        | <pre>{regexPhone}</pre>          | `***-****-****`       |
| メールアドレス     | `example@domain.com` | <pre>{regexEmail}</pre>          | `***@***.***`         |
| 口座番号        | 123456-01-654321     | <pre>{regexAccount}</pre>        | `******-**-******`    |
| 事業者登録番号     | 111-11-01111         | <pre>{regexBiz}</pre>            | `***-**-*****`        |
| 法人番号        | 111111-1111111       | <pre>{regexLb}</pre>             | `******-*******`      |
