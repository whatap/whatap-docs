ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" />

WhaTapモニタリングサービスのメイン画面でプロジェクトを選択し<Cmdname sid="side_statistics" className="uitext" />の下位メニューを選択します。WhaTapエージェントは、トランザクション情報やSQLなどの主要なトレース情報について統計情報を収集します。5分ごとに一覧を作成してサーバーに送信します。

## 基本画面ガイド

<Cmdname sid="time_selector" className="uitext" />および<Cmdname sid="filter" className="uitext" />, <Cmdname sid="order_by" className="uitext" />, <Cmdname sid="applications" className="uitext" />項目を設定した後、![検索アイコン](/img/ico-btn-search.png)ボタンを選択します。

<ImgLang img="apm-statistic-basic-operator.png" desc="統計" />

- 各**統計**タブは、**合計**、**最大**、**平均時間**および**件数**による並べ替えオプションを提供し、任意の視点から上位リストを表示できます。 

- <Cmdname sid="BTN06441" className="uitext" />ボタンて既定値の他に照会するカラムを追加または除外できます。

- ![検索アイコン](/img/ico-btn-search.png)ボタンをタップすると、照会結果とともに照会リストの上に![CSVアイコン](/img/ic-csv-download-ms.svg)ボタンが表示されます。ボタンを選択すると、照会リストをCSV形式のファイルでダウンロードできます。

  :::tip

  統計照会の一覧が表示された後に照会条件を変更して、![検索アイコン](/img/ico-btn-search.png)ボタンを選択せずに![CSVアイコン](/img/ic-csv-download-ms.svg)ボタンをクリックすると、変更された条件でCSVファイルをダウンロードできます。

  :::

- 統計リストから![詳細アイコン](/img/ico-detail-view.svg)<Cmdname sid="display_detail" className="uitext" />アイコンを選択すると、件数と平均時間チャートが確認できるし、エージェント間の件数およびエラー件数の比較、応答時間の比較チャートを追加で提供します。そのチャートで照会する時点を選択すると<Cmdname sid="side_txSearch" className="uitext" />メニューに移動します。

- 統計リストで<code class="btn">T</code>ボタンを選択すると <Cmdname sid="top_stack_of_url" className="uitext" />メニューに移動します。

- 統計リストで<code class="btn">U</code>ボタンを選択すると<Cmdname sid="unique_stack_url" className="uitext" />メニューに移動します。

:::note

- 最大31日間のデータを照会できます。ただし、<Cmdname sid="side_statRemote" className="uitext" />メニューでは最大7日間のデータを照会できます。

- <Cmdname sid="time_selector" className="uitext" />オプションの利用方法の詳細については、[次の文書](usage-ui#timeselector)を参照してください。

:::

## TX統計

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_tx" className="uitext" />

トランザクション統計を収集します。5分ごとに最大5,000個のURLごとの実行統計を収集してサーバーに送信します。異なるURLの数が5分間で5,000個を超えた場合は無視されます。

| カラム                             | 説明                                                       |
| ------------------------------- | -------------------------------------------------------- |
| <Cmdname sid="TTL06918" />      | トランザクションアドレス                                             |
| <Cmdname sid="count" />         | 実行件数                                                     |
| <Cmdname sid="error" />         | 実行されたトランザクションのエラー発生件数                                    |
| <Cmdname sid="TTL06960" /> (ms) | 応答時間の合計の平均                                               |
| <Cmdname sid="TTL06963" /> (ms) | 応答時間の合計                                                  |
| <Cmdname sid="TTL06961" /> (ms) | 最大応答時間                                                   |
| <Cmdname sid="TTL06965" />      | CPU使用時間の平均                                               |
| <Cmdname sid="httpc_count" />   | HTTPコール件数                                                |
| <Cmdname sid="TTL06959" /> (ms) | HTTP呼び出しの合計時間/トランザクションの発生件数                              |
| <Cmdname sid="TTL08965" /> (ms) | HTTP呼び出しの合計時間/トランザクションで発生したHTTP呼び出しの合計件数                 |
| <Cmdname sid="TTL06097" />      | SQL実行件数                                                  |
| <Cmdname sid="TTL06956" /> (ms) | SQLの合計時間/トランザクションの発生件数                                   |
| <Cmdname sid="TTL08964" /> (ms) | SQLの合計時間/トランザクションで発生したSQLの合計件数                           |
| <Cmdname sid="sqlFetch" />      | SQLフェッチ件数                                                |
| <Cmdname sid="TTL06953" /> (ms) | SQLパッチの合計時間/トランザクションの発生件数                                |
| <Cmdname sid="TTL08966" /> (ms) | SQLパッチの合計時間/トランザクションで発生したSQLパッチの合計件数                     |

:::note

<Xclude product="php">

<Cmdname sid="TTL06975" className="uitext" />を収集するためには、エージェント設定(*whatap.conf*)に<code>trace_malloc_enabled=true</code>を追加する必要があります。該当オプションの既定値は<code>false</code>です。

</Xclude>

<InDoc product="php">

<Cmdname sid="TTL06975" className="uitext" />を収集するためには、エージェント設定(*whatap.conf*)に<code>trace_malloc_enabled=true</code>を追加する必要があります。該当オプションの既定値は<code>false</code>です。

</InDoc>

:::

### 推移比較機能を利用する{#comparetrend}

<Cmdname sid="TTL08868" className="uitext" />機能を利用して、多数のトランザクションの推移を一目で比較できます。この機能は、確認するトランザクション数が多い場合、主要な問題を迅速に識別し、トラフィックの問題を解決するのに役立ちます。

<ImgLang img="apm-statistic-tx-compare-trend.png" desc="推移比較" />

1. 照会したい時間とモニタリング対象を選択した後![検索アイコン](/img/ico-btn-search.png)ボタンを選択します。

2. トランザクション一覧から比較したいトランザクションを1つ以上選択します。

3. <Cmdname sid="TTL08868" className="uitext" />ボタンを選択します。

4. 選択したトランザクションの推移グラフが一覧表示される<Cmdname sid="TTL08868" className="uitext" />ウィンドウが表示されます。

<Cmdname sid="TTL08868" className="uitext" />ウィンドウで推移グラフを確認して、トランザクション間のトラフィックパターンを比較します。 特定の時間帯、サービスパスのトラフィック分布を比較できます。

:::note

- 最大100個のトランザクションを選択して照会できます。

- 選択したトランザクションが多い場合、ロード時間が増加する可能性があります。

- 正確な分析のために<Cmdname sid="filter" className="uitext" />オプションを適切に活用します。

:::

## トランザクションドメイン統計

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statDomain" className="uitext" />

WhaTapエージェントは、ドメインごとのトランザクション統計を収集できます。1台のサーバーに複数のドメインを個別にサービスを提供するシステムでは、ドメインごとの分析が必要になる場合があります。次のオプションを設定してください。

<Xclude product="php">

```ini title='whatap.conf'
stat_domain_enabled=true
```

</Xclude>

<InDoc product="php">

```ini title='whatap.ini'
whatap.stat_domain_enabled=true
```

</InDoc>

収集されるデータは、ドメイン別のURLの処理状況を把握するために使用できます。

| カラム                          | 説明                               |
| ---------------------------- | -------------------------------- |
| <Cmdname sid="TTL06101" />   | サービスドメイン                         |
| <Cmdname sid="TTL06918" />   | トランザクションアドレス                     |
| <Cmdname sid="count" />      | 実行件数                             |
| <Cmdname sid="error" />      | 実行されたトランザクションのエラー発生件数            |
| <Cmdname sid="timeAvg_ms" /> | 応答時間の合計の平均                       |
| <Cmdname sid="timeSum_ms" /> | 応答時間の合計                          |

## TX Caller統計

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statCaller" className="uitext" />

マルチサーバーがrestコールに接続されると**Caller**と**Callee**間の関連付けられた統計を収集できます。このデータを収集するには、次のオプションを設定してください。

<Xclude product="php">

```ini title='whatap.conf'
mtrace_rate=100
mtrace_spec=v1
stat_mtrace_enabled=true
```

</Xclude>

<InDoc product="php">

```ini title='whatap.ini'
whatap.mtrace_enabled=true 
whatap.mtrace_rate=100
whatap.mtrace_spec=v1
whatap.stat_mtrace_enabled=true
```

</InDoc>

![msa-system](https://img.whatap.io/media/agent_java/data/msa.png)

上記のアーキテクチャでは、**Caller & Callee**の統計情報は、api1、api2のみ表示することができます。ユーザーのブラウザから呼び出されるシステムでは、**Caller**統計を表示できません。

ただし、**Caller**側のサーバーからデータを送信する必要があるため、すべてのサーバーに適切な設定を行う必要があります。

<Xclude product="php">

```ini title='whatap.conf of [front]'
mtrace_rate=100
mtrace_spec=v1
stat_mtrace_enabled=true
```

```ini title='whatap.conf of [api1] & [api2]'
mtrace_spec=v1
stat_mtrace_enabled=true
```

</Xclude>

<InDoc product="php">

```ini title='whatap.ini of [front]'
whatap.mtrace_rate=100
whatap.mtrace_spec=v1
whatap.stat_mtrace_enabled=true
```

```ini title='whatap.ini of [api1] & [api2]'
whatap.mtrace_spec=v1
whatap.stat_mtrace_enabled=true
```

</InDoc>

収集される統計データは次のとおりです。**Callee**側で参照する必要があります。

| カラム                           | 説明                                        |
| ----------------------------- | ----------------------------------------- |
| <Cmdname sid="callerPcode" /> | Callerに対応するプロジェクトコード                      |
| <Cmdname sid="callerOkind" /> | Callerに対応するエージェントが属するグループの単位              |
| <Cmdname sid="callerUrl" />   | Callerトランザクションのトランザクションアドレス               |
| <Cmdname sid="transaction" /> | Calleeトランザクションアドレス                        |
| <Cmdname sid="count" />       | 実行件数                                      |
| <Cmdname sid="error" />       | 実行されたトランザクションのエラー発生件数                     |
| <Cmdname sid="timeAvg_ms" />  | 応答時間の合計の平均                                |

:::note

<Cmdname sid="side_statCaller" className="uitext" />メニューで一度にダウンロードできるCSVライン数は最大10,000行です。

:::

## IPトランザクション統計{#statiptx}

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statIp" className="uitext" />

特定のIPアドレスごとにアプリケーションから呼び出したURLと、呼び出し件数を照会できる機能を提供します。この機能は、異常に多くの要求が発生するIPアドレスを確認し、そのIPアドレスから呼び出されたURLを分析して、潜在的なセキュリティ脅威や性能問題を事前に識別するのに役立ちます。ユーザーはこの情報に基づいて、不要または悪意のあるリクエストをブロックできます。

<Cmdname sid="filter" className="uitext" />オプションを通じてIPアドレスまたはトランザクションアドレスをフィルタリングし、条件に合うデータを素早く照会できます。特定のIPやトランザクションアドレスのパターンを分析する時に役立ちます。

<InDoc product="php">

IPトランザクション統計を収集するには、次のオプション設定が必要です。デフォルト値は`false`です。

```ini title='whatap.ini'
whatap.stat_ipurl_enabled=true
```

</InDoc>

<InDoc product="java">

IPトランザクション統計を収集するには、次のオプション設定が必要です。デフォルト値は`false`です。

```ini title='whatap.conf'
stat_ipurl_enabled=true
```

</InDoc>

| カラム                          | 説明                                        |
| ---------------------------- | ----------------------------------------- |
| <Cmdname sid="ip" />         | リクエストを発生させたクライアントのIPアドレス                  |
| <Cmdname sid="TTL06918" />   | 呼び出されたトランザクションのアドレス、特定経路の変数は`{}`で表示       |
| <Cmdname sid="count" />      | 当該IPアドレスで発生したリクエストの合計件数                   |
| <Cmdname sid="error" />      | リクエスト中に発生したエラー数                           |
| <Cmdname sid="timeAvg_ms" /> | 当該リクエストの平均応答時間(ミリ秒、ms)                    |

:::tip

- **異常なトラフィック検出**: 異常に呼び出し件数の多いIPを探知し、そのIPで発生したトランザクションアドレスのパターンを分析し、潜在的な攻撃を遮断できます。例えば、特定のIPから`/account/{aa}/{bb}/{cc}`URLに対して過度な要請が発生した場合、そのIPをブロックしたり要請を制限する措置ができます。

- **応答時間分析**: 平均応答時間が異常に高いIPを確認し、ネットワークまたはサーバー側の性能問題を把握して改善できます。

- **エラー発生分析**: 特定のIPでエラーが多数発生した場合、そのIPの要請に問題があるか、またはシステムに特定の問題があるかを診断できます。

:::

## トランザクションReferer統計{#stat-referer}

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statReferer" className="uitext" />

WhaTapエージェントは、Refererごとにトランザクション統計を収集できます。次のオプションを設定してください。デフォルト値は`false`です。 

<Xclude product="php">

```ini title='whatap.conf'
stat_referer_enabled=true
```

</Xclude>

<InDoc product="php">

```ini title='whatap.ini'
whatap.stat_referer_enabled=true
```

</InDoc>

収集されたデータは、Refer情報の統計を使用して確認できます。

| カラム                          | 説明                               |
| ---------------------------- | -------------------------------- |
| <Cmdname sid="TTL06108" />   | Refererアドレス                      |
| <Cmdname sid="TTL06918" />   | トランザクションアドレス                     |
| <Cmdname sid="count" />      | 実行件数                             |
| <Cmdname sid="error" />      | 実行されたトランザクションのエラー発生件数            |
| <Cmdname sid="timeAvg_ms" /> | 応答時間の合計の平均                       |
| <Cmdname sid="timeSum_ms" /> | 応答時間の合計                          |

## エラー統計

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statError" className="uitext" />

5分間に発生したサービスエラーに関する統計です。異なるエラーとトランザクション名をキーとして発生件数を収集します。エラー発生時点のスタックを提供します。5分あたり最大1,000個の異なるエラーを統計化します。

| カラム                          | 説明                                        |
| ---------------------------- | ----------------------------------------- |
| <Cmdname sid="class" />      | エラークラス                                    |
| <Cmdname sid="TTL06918" />   | トランザクションアドレス                              |
| <Cmdname sid="msg" />        | エラーメッセージ                                  |
| <Cmdname sid="count" />      | エラー発生件数                                   |
| <Cmdname sid="type_oid" />   | エージェント名                                   |
| <Cmdname sid="type_onode" /> | `whatap.onode`に分類されたエージェントグループのユニット       |
| <Cmdname sid="type_okind" /> | `whatap.okind`に分類されたエージェントグループのユニット       |
| <Cmdname sid="TTL09049" />   | 照会期間中にトランザクションのエラーが最初に生成された統計時間(5分または1時間) |

## SQL実行統計

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statSql" className="uitext" />

5分間のSQL性能統計を収集します。5分間に異なるSQL文が最大5,000まで許可されます。Javaプロセスで制限を超えるSQLを検出すると、そのSQLは統計データから破棄されます。

| カラム                             | 説明                                                 |
| ------------------------------- | -------------------------------------------------- |
| <Cmdname sid="db" />            | データベース種類                                           |
| <Cmdname sid="sql" />           | SQLクエリ文                                            |
| <Cmdname sid="TTL06918" />      | SQLを呼び出したURLのいずれかを任意に収集した情報                        |
| CRUD                            | Create, Read, Update, Delete                       |
| <Cmdname sid="countTotal" />    | クエリ実行件数                                            |
| <Cmdname sid="countError" />    | 実行されたクエリのエラー発生件数                                   |
| <Cmdname sid="TTL06960" /> (ms) | クエリ実行時間の合計の平均                                      |
| <Cmdname sid="TTL06963" /> (ms) | クエリ実行時間の合計                                         |
| <Cmdname sid="TTL06964" />      | クエリ実行時間の標準偏差                                       |

:::info

<Cmdname sid="TTL06918" />は、5分間該当SQLを呼び出したURLから1つ(最後の呼び出しURL)を分析のため収集します。

:::

## HTTP Call性能統計

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statHttpc" className="uitext" />

HTTPおよびHTTPSプロトコルを使用して、５分間のアプリケーション外部呼び出し統計を収集します。5分間、異なるHttp Call文章は最大5,000まで許可します。１つのアプリケーションプロセスで制限を超えた外部Http Callが発生する場合、統計データは捨てられます。

| カラム                          | 説明                                                    |
| ---------------------------- | ----------------------------------------------------- |
| <Cmdname sid="ITM07683" />   | HTTP呼び出しURLハッシュ(hash)                                 |
| <Cmdname sid="TTL06918" />   | HTTP APIをリクエストしたURLのいずれかを任意に収集した情報                    |
| <Cmdname sid="host" />       | HostまたはIPアドレス                                         |
| <Cmdname sid="port" />       | TCPポート                                                |
| <Cmdname sid="total" />      | すべての実行件数                                              |
| <Cmdname sid="error" />      | エラー発生件数                                               |
| <Cmdname sid="timeAvg_ms" /> | 応答時間の合計の平均                                            |
| <Cmdname sid="timeSum_ms" /> | 応答時間の合計                                               |
| <Cmdname sid="timeMin_ms" /> | 最小応答時間                                                |
| <Cmdname sid="timeMax_ms" /> | 最大応答時間                                                |
| <Cmdname sid="TTL06915" />   | HTTPコール時間の標準偏差                                        |

## クライアントIPの地域別呼び出し件数{#client_tx_stat}

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statRemote" className="uitext" />

サーバーとクライアントの物理的距離は、データ送信時間に比例します。クライアントIPのリージョン別の呼び出し件数を統計的に収集します。5分当たりに収集できる異なるIP数は、インスタンスあたり最大70,000個です。

| カラム                        | 説明                 |
| -------------------------- | ------------------ |
| <Cmdname sid="TTL06081" /> | クライアントのIPアドレス      |
| <Cmdname sid="country" />  | ユーザーの接続リージョン       |
| <Cmdname sid="city" />     | ユーザー接続都市           |
| <Cmdname sid="count" />    | 全体呼び出し件数           |

:::note

- クライアントIPに関するデータは、最大7日間のデータを照会できます。

- WhaTapは、クライアントに関する情報を保存します。ユーザーデータの収集に関するエージェント設定の詳細については、[次の文書](agent-number-of-user)を参考にしてください。

:::

### リージョン別の稼働率チャート

稼働率チャートは、ユーザーの接続場所を国と都市別で収集され表示します。 

- 国のエリアを選択すると、その国の都市と接続されているユーザーのIPなどを確認できる詳細なチャートに移動します。
- 中心円を選択すると、既存の国のエリア選択チャートに戻ります。

## ユーザエージェント別の呼び出し件数

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statUseragentDetail" className="uitext" />

ユーザーエージェント文字列のHashごとに呼び出し件数を収集します。5分ごとに収集できる異なるUser Agent Hashはインスタンス当たり最大500個です。

| カラム                         | 説明                               |
| --------------------------- | -------------------------------- |
| <Cmdname sid="useragent" /> | ブラウザのユーザーエージェント情報                |
| <Cmdname sid="os" />        | ブラウザが実行されるOS環境                   |
| <Cmdname sid="browser" />   | ブラウザの種類                          |
| <Cmdname sid="count" />     | 収集された全体件数                        |

## クライアントブラウザの統計

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statUseragent" className="uitext" />

ユーザーエージェントの文字列を分析して、エンドユーザーが使用するブラウザの種類、OS基準で集計した統計情報を提供します。収集した統計情報に基づいて作成されたパイチャートを通じて占有率を確認できます。

| カラム                         | 説明                               |
| --------------------------- | -------------------------------- |
| <Cmdname sid="useragent" /> | ブラウザのユーザーエージェント情報                |
| <Cmdname sid="os" />        | ブラウザが実行されるOS環境                   |
| <Cmdname sid="browser" />   | ブラウザの種類                          |
| <Cmdname sid="count" />     | 収集された全体件数                        |
