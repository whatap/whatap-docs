## ![](/img/number-03.png)ログモニタリングのデータ設定

![number-s](/img/number-03.png)上段から**_ログ使用量_**が確認できます。また**_データ保持期間_**および**_ログ照会パスワード_**設定を変更できます。

### データ保持期間

<!-- 수연님 편집 중 -->

共通して適用する基本（default）データ保持期間です。 カテゴリごとのデータ保持期間を別途設定しないと、このデータ保持期間がデフォルトで適用されます。 カテゴリ別データ保持期間を設定し、**_リセット_**ボタンをクリックすると、基本データ保持期間に初期化されます。

### カテゴリ別のデータ保持期間

<!-- 저장량 컬럼 삭제 -->

カテゴリ別のログデータの保持期間を指定できます。 **ログ数**は、その期間中に蓄積されたログラインを意味します。 例えば、**_本日のログ数_**は一日の間に蓄積されたログライン個数、**_予想ログ数_**はデータ保管日に本日のログ数を掛けたログライン個数を意味します。 

ログデータの保持期間を次のように指定できます。 期間指定により、古いデータを削除してスペースを確保できます。

-   **トライアルプロジェクト**\
      データ保持期間として1日、2日、3日を選択できます。
-   **有料プロジェクト**\
      データ保持期間として1日、2日、3日、4日、5日、6日、7日、10日、30日、40日を選択できます。
-   **保存容量に基づく料金**\
      データの保持期間によってコストが異なります。
    > 例えば、1日平均200万ログラインが蓄積され、データ保持期間を3日に指定した場合は、平均600万ログラインが収集サーバーに維持され、課金対象となります。

### ログ照会パスワード

セキュリティを強化するため**_ログ照会パスワード_**を設定してください。ログ照会パスワードの指定はオプションです。 ログ照会パスワードを使用中の場合は、ログ画面に進入する際に必ずパスワードを入力してください。 

<InDoc product='log'>

{@include: ../common-items/_log-role-pw.mdx}

</InDoc>

<InDoc product='aws-log'>

:::note 

**パスワードの紛失**

**로그 편집** 권한이 있는 경우 **_로그 설정_** 메뉴에서 새 비밀번호로 수정할 수 있습니다.

:::

</InDoc>

## ![](/img/number-04.png)ログパーサー設定

収集されたログを検索できるキーを作成するため、**パーシング**(Parsing)**ロジックを登録**することができます。 パーシングロジックを登録していない場合、次のkeyだけで検索できます。

:::note 

**パーシングロジック未登録時に検索可能なkey**

`category`, `oid`, `oname`, `okind`, `okineName`, `@txid`, `@login`, `httphost` 

:::

### パーサー登録の手順

![](/img/log-setting-parser.png)

1.  ![number-s](/img/number-04.png)領域下段の**_+追加_**を選択してください。

2.  ![number-s](/img/number-04.png)領域**_パーサー選択ウィンドウ_**からパーサーを選択してください。パーサーおよびパターン登録については、[次の文書](#log-pattern)を参照してください

3.  ![number-s](/img/ic-number-07.svg)領域**_カテゴリの選択ウィンドウ_**でカテゴリを選択または直接に入力してください。 

4.  ![number-s](/img/ic-number-07.svg)領域![アイコン](/img/ico-filter.svg)**_フィルター_**ボタンをクリックしてフィルターを追加することができます。 フィルター入力時、フィルター条件に合うログデータにのみパターンを適用します。

5.  登録しようとするパターンが正常か![number-s](/img/ic-number-08.svg)領域**_シミュレーション_**ボタンをクリックしてシミュレーション及びパターンのパフォーマンスを測定してください。 シミュレーションとパフォーマンス測定については、[次の文書](#parser-simulation) を参照してください。

6.  シミュレーション結果が正常であれば、[number-s](/img/ic-number-08.svg)領域**_保存_**ボタンをクリックして保存してください。

:::note

-   ![number-s](/img/ic-number-07.svg)**_フィルター_**を追加することはオプションです。
-   ![number-s](/img/ic-number-08.svg)領域**_リセット_**ボタンをクリックすると、作成中の内容が初期化されます。
-   ![number-s](/img/ic-number-09.svg)ボタンを選択してから、パーサー設定をドラッグして手順を変更できます。

:::

### 設定項目

| 設定値   | 説明                                                                              | その他           |
| ----- | ------------------------------------------------------------------------------- | ------------- |
| カテゴリ  | パターンを適用するカテゴリです。                                                                | required      |
| フィルター | フィルターとして適用する 'search key'、 'search value' を入力します。 フィルター条件に合うログデータのみにパターンを適用します。 | optional      |
| パターン  | ログをパーシングするパターンです。 作成したパターンに合わせてパーシングを行い、インデックスを作成します。 Grok、Custom文法をサポートします。    | required      |
| アクティブ | アクティブ化または非アクティブ化の可否です。                                                          | デフォルト値は`true` |

### パターン登録のタイプ{#log-pattern}

![](/img/log-parser-pattern.png)

次のように4種類のパーサーを提供します。 ![number-s](/img/number-04.png)領域パーサー選択ウィンドウで確認できます。

1.  **Grokパーサー**
2.  **JSONフォーマットパーサー**
3.  **4xx**と**5xxステータスコードのパーサー**
4.  **ステータスコードの成功率のパーサー** 
    <!-- **Grok**과 **JSON 포맷 파서** 2가지 유형의 파서를 제공합니다. ![number-s](/img/number-04.png) 영역 파서 선택창에서 확인할 수 있습니다. -->

:::note

-   4XX, 5XXステータスコードパーサーとステータスコード成功率パーサーは、GrokまたはJSONフォーマットパーサーを通じてstatusキーが抽出されていないと活用できません。
-   パーサー登録時、同じカテゴリーにパーサーを重複登録することはできません。

:::

### Grokパターンパーサー登録

![Grokパターンパーサー](https://img.whatap.io/media/images/log_011_grok_syntax.png)
文法は%{SYNTAX:SEMANTIC}です。    

-   **SYNTAX**\
      Grok定義のパターンです。      

-   **SEMANTIC**\
      パーシングされたデータに割り当てるキーです。

:::note 

SEMANTICには予約語などが使用されないように複合語の使用を推奨します。

:::

### JSONフォーマットのパーサーパターンの登録

![JSONフォーマットのパーサーパターンの登録](https://img.whatap.io/media/images/log_012_json_format_parser_1101.png)\
ログの全体または一部がJSON形式として出力される場合、JSONフォーマットパーサーを通じてJSONに出力された部分をパーシングすることができます。

ログのうちJSON形式として出力された部分を検出するために、prefix、postfixオプションを組み合わせてログのどの部分をJSONとして認識してパーシングするかを指定します。 

| オプション   | 説明                                                            |
| ------- | ------------------------------------------------------------- |
| prefix  | JSON文字列の開始部分の前にある文字列を指定します。 未指定時のログ出力文の一番前からJSON文字列で識別します。    |
| postfix | JSON文字列の終了部分の後ろの文字列を指定します。指定しない場合、ログ出力文の最後までをJSON文字列として識別します。 |
| ignore  | JSON出力部のうち、キー抽出を除くフィールドを指定します。                                |

-   **登録例**

    ```bash title='로그 원문'
    [2022-10-25 10:15:34:145]...(改行)
    Request : {"key1":"value1","key2":"value2",...}(改行)
    Response : {"key3":"value3","key4":"value4",...}
    ```

      例のように流入するログがRequest JSON、Response JSONをすべてパーシングしようとする場合は、次の2つのパターンを登録します。

    -   Requestパーシング用のパターン  

        > "Request："と"Response"間の文字列{"key1":"value1","key2":"value2",...}を対象とします。

    -   Reponseパーシング用のパターン
        > "Response："からログの最後までの文字列{"key3":"value3","key4":"value4",...}を対象とします。
-   **JSONカスタムパターンの登録**

      ログの一部がJSON形式で出力される場合、JSONで出力された部分を専用カスタムパーサーを通じてパーシングできます。 パターンを次のように入力してください。

    ```java
    io.whatap.logsink.parser.JsonFormatParser{}
    ```

      ログのうちJSON形式として出力された部分を検出するために、prefix、postfixオプションを組み合わせてログのどの部分をJSONとして認識してパーシングするかを指定してください。

      `JsonFormatParser{}`の`{}`にオプションを指定します。

    -   **登録例**

        ```bash title='로그 원문'
        [2022-10-25 10:15:34:145]...(改行)
        Request : {"key1":"value1","key2":"value2",...}(改行)
        Response : {"key3":"value3","key4":"value4",...}
        ```

          例のように流入するログがRequest JSON、Response JSONをすべてパーシングしようとする場合は、次の2つのパターンを登録します。

        -   Requestパーシング用のパターン  
            > "Request："と"Response"間の文字列{"key1":"value1","key2":"value2",...}を対象とします。

        ```java
        io.whatap.logsink.parser.JsonFormatParser {prefix:"Request : ",postfix:"Response"}
        ```

        -   Reponseパーシング用のパターン
            > "Response："からログの最後までの文字列{"key3":"value3","key4":"value4",...}を対象とします。

        ```java
        io.whatap.logsink.parser.JsonFormatParser {prefix: "Response : "}
        ```

### 4xx, 5xxステータスコードのパーサーパターン登録{#4xx-5xx-status-parser}

![4XX 5XXステータスコードのパーサー](https://img.whatap.io/22/11/28/085706log_020_status_parser.png)\
statusが既にパーシングされている場合に使用できるパーサーです。 パーシングされたstatusを利用して追加で4xx、5xx状態コードをパーシングします。 パーシングしたデータで4xx、5xx件数データを作成できます。 

パターンには4xx、5xxステータスコードを入力または選択することができ、入力されたステータスコードはログから4xx、5xxステータスコードをパーシングするときに除外されます。 4xx、5xx状態コードパーサーを使用するために、まずstatusがパーシングされている必要があります。

-   **statusパーサー登録例**\
      ![Grokパーサー-statusパーシングパターン登録](https://img.whatap.io/22/11/28/111724log_status_01_parser.png)\
     流入するログが '{"msg": "message", "status": 404}' であり、例のようにGrokパーサーでstatusをパーシングすると、 'status: 404' のようにパーシングされます。 statusが正常にパーシングされることを確認した場合は、4XX、5XX状態コードのパーサーパターンを登録してください。     

-   **ウィジェットテンプレート**\
      パーサーをすべて登録すると**_Flexボード_**に移動し、ログ 4XX、5XX 件数ウィジェットを作成してください。

      ![](https://img.whatap.io/22/11/28/111724log_status_02_widget_template.png)  

      ウィジェットを作成すると、次のようにデータを確認できます。

      ![](https://img.whatap.io/22/11/28/111724log_status_03_widget.png)

    -   **_avg_**：照会期間中のデータの平均値です。
    -   **max**：照会期間中のデータの最大値です。
    -   **_recently_**：照会期間中のデータの最後の値です。

### ステータスコード成功率のパーサーパターンの登録

![ステータスコード成功率のパーサー](https://img.whatap.io/22/11/28/090004log_021_status_success_rate_parser.png)
ステータスコード成功率のパーサーは、statusが既にパーシングされている場合に使用できるパーサーです。status パーシングに関する内容は[次の文書](#4xx-5xx-status-parser)を参照してください。 

パーシングされたstatusを利用して追加で2xx, 3xxステータス コードをパーシングします。パーシングしたデータでHTTPリクエスト成功率データを作成できます。 パターンには2xx、3xxステータスコードを入力または選択することができ、入力されたステータスコードはログから2xx、3xxステータスコードをパーシングするときに除外されます。 

-   **ウィジェットテンプレート**\
      パーサーをすべて登録したら、**_Flexボード_**に移動し、ログリクエスト成功率のウィジェットを作成してください。  

      ![Flexボード - ログリクエスト成功率のウィジェットテンプレート](https://img.whatap.io/22/11/28/120046log_success_rate_01_widget_template.png)  

      ウィジェットを作成すると、次のようにデータを確認できます。

      ![Flexボード - ログリクエスト成功率のウィジェット](https://img.whatap.io/22/11/28/120046log_success_rate_02_widget.png)

      チャート上のデータは、照会期間に関する統計を示します。 統計方法を最近の値、最大値、平均値などで選択できます。 最近の値がデフォルトで選択されています。

### パーサーシミュレーション{#parser-simulation}

:::note

**シミュレーションサポート**

現在、JSONフォーマットのパーサーはシミュレーション機能をサポートしていません。

:::

登録しようとするパターンでパーシングに成功するか確認してください。

<!--
1117 
json 커스텀 파서 추가 문의
30일 이후 업데이트 예정인 패턴 체크
-->

<!--
* **로그 파서 시뮬레이션 시작**
    ![](https://img.whatap.io/media/images/log_013_simulation_1101.png)
-->

-   **シミュレーションの成功画面**
      ![](https://img.whatap.io/media/images/log_014_simulation_success.png)

-   **シミュレーションの失敗画面**
      ![](https://img.whatap.io/media/images/log_015_simulation_fail.png)

### パフォーマンス測定

シミュレーションを成功した後、**_パフォーマンス測定_**ボタンをクリックしてパーサーに対するパフォーマンスを測定することができます。 シミュレーション実行対象文字列に対して繰り返されるパーサーのパーシングの所要時間を測定した後、次のように測定結果をポップアップで確認することができます。

![](https://img.whatap.io/media/images/log_016_performance.png)

### パーシング成功

パーシングロジックを登録してキー（key）が作成されると、ログ照会時にそのキーでパーシングされた値が追加されます。 次のイメージの青いボックス部分に、パーシングされたキーと値が追加されます。 

![](https://img.whatap.io/media/images/log_017_parsed.png)

パーシングされたキーは**_ライブテール_**、**_ログ検索_**、**_ログトレンド_**で確認できます。

## ![](/img/number-05.png)高速インデックス設定

大量のログを収集すると、ログ検索の性能が著しく低下する可能性があります。 よく使う検索条件を**インデックス**として作成すると、ログ検索の性能を改善し、迅速な探索が可能です。 設定の項目は次のとおりです。

| 設定値           | 必修の有無 | 説明                                |
| ------------- | ----- | --------------------------------- |
| カテゴリ          | 必須    | 高速クインデックスを設定するカテゴリ                |
| タグ            | 必須    | 高速インデックスを設定するタグ                   |
| 大文字と小文字を区別しない | オプション | 大文字と小文字を区別するかどうか                  |
| 規則            | 必須    | `*` を一つ以上必ず含む。                    |
| アクティブ         | 必須    | アクティブ化または非アクティブ化の有無（デフォルト `true`） |

## ![](/img/number-06.png)ログ長期保管統計設定

ログデータは非常に容量が大きいため、長期間保管することは困難です。 したがって、***ログ統計データ設定***機能を使用して、**特定の条件を満たすログデータが5分ごとに何件ずつ収集されたかに関する情報を保存**することができます。 

長期間にわたって実際のログデータが削除されても、該当する条件を満たすログがどれだけ収集されたかの推移を確認することができます。

![ログの長期保管の統計](https://img.whatap.io/22/11/28/090932log_022_long_period_stat_config.png)

### 設定項目

<!-- 제외 항목 내용 추가 예정 .. 추가1202 -->

| フィールド      | 説明                                                       |
| ---------- | -------------------------------------------------------- |
| カテゴリ       | 規則を適用するカテゴリです。                                           |
| キー（key）    | 規則を満たすログが発生した場合、保存するキー値で同じキーを重複設定することはできません。             |
| 規則         | ログ統計データを作成する条件です。 この条件を満たすログがどれだけ収集されたかに基づいて統計データを作成します。 |
| 除外         | 除外をチェックすると、入力した条件に該当しない値で統計データを作成します。                    |
| 大文字と小文字の区分 | 入力したルールの値に対して大文字と小文字を区別するかどうかを指定します。                     |
| アクティブ      | アクティブ化または非アクティブ化の有無（デフォルト `true`）                        |

### 例

次のように設定を追加した場合、収集されたログのうちstatusが'200'、'300'であるログを対象に**_TotalCount_**というキー値で統計データを作成します。 

![](https://img.whatap.io/22/11/28/090932log_023_long_period_stat_config.png)

### ウィジェットテンプレート

1.  **_Flexボード_**の**_ウィジェットテンプレート_**から**_ログの長期保管統計_**を検索してウィジェットを作成してください。
    ![長期保管の統計ウィジェットテンプレート](https://img.whatap.io/22/11/28/090932log_024_long_period_widget_template.png)
2.  データを照会する**_カテゴリ_**と**_キー_**を指定した後、**_適用_**ボタンを選択します。\
    ![長期保管統計ウィジェット-カテゴリ及びキー選択](https://img.whatap.io/22/11/28/090932log_025_long_period_widget_config.png)
3.  追加した設定値で**_ログ長期保管統計データ_**を次のように確認することができます。\
    ![長期保管統計のウィジェット](https://img.whatap.io/22/11/28/090932log_026_long_period_widget_view.png)
