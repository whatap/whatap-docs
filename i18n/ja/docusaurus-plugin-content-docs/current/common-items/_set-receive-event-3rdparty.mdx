## 3rd partyプラグイン通知を追加する {#add3rdparty}

Slack、Telegram、Teams、Jandi、Webhookなどの外部アプリケーションを通じてアラート通知を受信できます。

1. <Cmdname sid="event_statistic" className="uitext" /> &gt; <Cmdname sid="eventNoti" className="uitext" />メニューで<Cmdname sid="3rd_party_plugin" className="uitext" />セクションの<Cmdname sid="adding" className="uitext" />ボタンを選択します。

2. 目的のサービスを選択してください。

   <ImgLang img='set-event-3rd-party-plugin.png' desc='3rd partyプラグイン追加' />

3. 選択したサービスの画面の指示に従って、設定を進めてください。

4. すべてのプロセスが完了したら、追加ボタンを選択してください。

:::note

WhaTapのサポート範囲に含まれていないアラート連携は、標準のWebhookとWebhook jsonを介して連携できます。

:::

次の3rd partyプラグイン一覧で使用するアプリケーションに適した通知の追加方法を確認してください。

<details>

<summary>Slack</summary>

画面の下に<Cmdname sid="add_to_slack" className="uitext" />ボタンをクリックすると、Slackのチームおよびチャンネルに**WhaTapNotiBot**を登録できます。

<ImgLang img='3rdparty/set-event-3rd-party-plugin-add-slack.png' desc='Slack' />

</details>

<details>

<summary>Telegram</summary>

1. **Telegram**から**@WhaTapApmNotiBot**を検索します。

   <ImgLang img='3rdparty/set-event-3rd-party-plugin-add-telegram.png' desc='Telegram' />

2. アラート通知を受信するプロジェクトのアクセスキーをチャット画面に入力します。

   <ImgLang img='3rdparty/set-event-3rd-party-plugin-add-telegram-license.png' desc='Telegram' />

:::note

以下は、使用可能なコマンドの一覧です。

- `/help`: コマンド一覧を表示する

- `/license`: 通知を受けるプロジェクトのアクセスキーを入力

- `/remove`: 通知を受けないプロジェクトコードを入力

- `/list`: 現在通知を受けているプロジェクトコードを表示する

:::

</details>

<details>

<summary>Teams</summary>

1. 通知を受けるチャンネルの**コネクター**設定へ移動します。

   <ImgLang img="3rdparty/management_event_new_teams_step_01.png" className="width-200" desc="Teams" />

2. **Webhook**を追加し、**構成**ボタンをクリックして次のステップへ進みます。

   <ImgLang img="3rdparty/management_event_new_teams_step_02.png" className="width-600" desc="Teams" />

3. Webhook名を入力し、**作成**ボタンをクリックします。

   <ImgLang img="3rdparty/management_event_new_teams_step_03.png" className="width-600" desc="Teams" />

4. 作成されたWebhhok URLをコピーします。

   <ImgLang img="3rdparty/management_event_new_teams_step_04.png" className="width-600" desc="Teams" />

5. WhaTapモニタリングサービスの<Cmdname sid="TTL06656" className="uitext" />画面に戻って<UI>Channel Name</UI>と<UI>Webhook URL</UI>項目を入力します。

   <ImgLang img="3rdparty/set-event-3rd-party-plugin-add-teams.png" className="width-600" desc="登録" />

6. <Cmdname sid="BTN06673" className="uitext" />ボタンを選択します。

</details>

<details>

<summary>Teams Workflows</summary>

ワークフローを使用するには、**Microsoft Teams**にアクセスできるアカウントと、ビジネスプランのサブスクリプションが必要です。

1. **チーム**メニューで詳細(...) ボタンを選択した後、**チャンネル追加**をクリックします。

   <ImgLang img="3rdparty/teams_workflows_step_01.png" desc="Teams Workflows" />

2. チャンネル名と説明を入力し、チャンネルタイプを**標準**を選択します。

   <ImgLang img="3rdparty/teams_workflows_step_02.png" desc="Teams Workflows" />

   :::note

   チャンネルタイプを**共有**で選択すると、ワークフローを使用できず、**非公開**を選択すると、ワークフローを追加できますが、通知を受信できません。

   :::

3. 生成したチャンネルで詳細を見る(...) ボタンを選択した後、**ワークフロー**をクリックします。

   <ImgLang img="3rdparty/teams_workflows_step_03.png" desc="Teams Workflows" />

4. **ワークフロー**ダイアログボックスの**ワークフロー**の一覧で**ウェブフックのリクエストが受信されたら、チャンネルに掲示**を選択した後、**追加ワークフロー**をクリックします。

   <ImgLang img="3rdparty/teams_workflows_step_04.png" desc="Teams Workflows" />

5. 名前と接続状態を確認した後、**次**ボタンをクリックします。

   <ImgLang img="3rdparty/teams_workflows_step_05.png" desc="Teams Workflows" />

6. 詳細情報をご確認の上、**ワークフロー追加**ボタンをクリックします。

   <ImgLang img="3rdparty/teams_workflows_step_06.png" desc="Teams Workflows" />

7. ワークフローの追加を完了しました。**生成されたアドレス**をコピーします。

   <ImgLang img="3rdparty/teams_workflows_step_07.png" desc="Teams Workflows" />

8. WhaTapモニタリングサービスの<Cmdname sid="TTL06656" className="uitext" />画面に戻って<UI>Channel Name</UI>と<UI>Webhook URL</UI>項目を入力します。

   <ImgLang img="3rdparty/set-event-3rd-party-plugin-add-teams.png" className="width-600" desc="登録" />

9. <Cmdname sid="BTN06673" className="uitext" />ボタンを選択します。

</details>

<details>

<summary>Jandi</summary>

1. アラート通知を受信するトピック、またはチャットから**Jandi Connect**設定へ移動します。

2. **コネクト一覧**で<b>Webhook受信(Incoming Webhook)</b>項目で**追加**ボタンを選択します。

   <ImgLang img="3rdparty/management_event_jandi_step_01.png" desc="Jandi" />

3. **連携**タブで**連携追加**ボタンを選択します。

4. **Webhook URL登録**項目にWebhook URLをコピーします。

   <ImgLang img="3rdparty/management_event_jandi_step_02.png" desc="Jandi" />

5. WhaTapモニタリングサービスの<Cmdname sid="TTL06656" className="uitext" />画面に戻って<UI>Channel Name</UI>と<UI>Webhook URL</UI>項目を入力します。

   <ImgLang img="3rdparty/set-event-3rd-party-plugin-add-teams.png" className="width-600" desc="登録" />

6. <Cmdname sid="BTN06673" className="uitext" />ボタンを選択します。

</details>

<details>

<summary>AlertNow</summary>

1. **AlerNow**サービスに接続してから**インテグレーション**メニューへ移動します。

   <ImgLang img="3rdparty/management_event_alertnow_step_01.png" desc="AlertNow" className="width-200" />

2. **インテグレーション**メニューの**インテグレーションの作成**ボタンを選択します。

   <ImgLang img="3rdparty/management_event_alertnow_step_02.png" desc="AlertNow" className="width-600" />

3. インテグレーションタイプから**WhaTap**を選択します。

   ![AlerNow](/img/3rdparty/management_event_alertnow_step_03.png)

4. **インテグレーション**画面で統合名と命名規則を設定します。

   <ImgLang img="3rdparty/management_event_alertnow_step_04.png" desc="AlertNow" className="width-600" />

5. **確認**ボタンを選択するとインテグレーションが作成されます。

6. 作成されたインテグレーションの一覧を確認し、該当のインテグレーション項目を選択します。

   <ImgLang img="3rdparty/management_event_alertnow_step_05.png" desc="AlertNow" className="width-600" />

7. 詳細画面で**URL**項目の右側に、コピーするボタンを選択してURLをコピーします。

   <ImgLang img="3rdparty/management_event_alertnow_step_06.png" desc="AlertNow" className="width-600" />

8. WhaTapモニタリングサービスの<Cmdname sid="TTL06656" className="uitext" />画面に戻って<UI>Channel Name</UI>と<UI>Webhook URL</UI>項目を入力します。

   <ImgLang img="3rdparty/set-event-3rd-party-plugin-add-teams.png" className="width-600" desc="登録" />

9. <Cmdname sid="BTN06673" className="uitext" />ボタンを選択します。

</details>

<details>

<summary>Webhook</summary>

1. 通知を受けるWebhookを登録します。登録したURLに、POST Methodで通知の`title`、`text`が転送されます。

   ![Webhook](/img/3rdparty/set-event-3rd-party-plugin-add-webhook.png)

2. <UI>Webhook Name</UI>と<UI>Webhook URL</UI>項目を入力します。

   <ImgLang img="3rdparty/set-event-3rd-party-plugin-add-webhook-options.png" className="width-600" desc="登録" />

3. <Cmdname sid="BTN06673" className="uitext" />ボタンを選択します。

</details>

<Xclude product="server">

<details>

<summary>Webhook JSON</summary>

1. 通知を受け取るWebhookを登録します。登録したURLにPOST Methodで通知データがJSON形式で送信されます。JSON内に含める代替変数については**使用可能変数**部分を参照してください。

   ```json
   {
       "pcode": "${pcode}",
       "projectName": "${projectName}",
       "time": "${time}",
       "oid": "${oid}",
       "oname": "${oname}",
       "title": "${title}",
       "message": "${message}",
       "level": "${level}",
       "status": "${status}",
       "metricName": "${metricName}",
       "metricValue": "${metricValue}",
       "metricThreshold": "${metricThreshold}",
       "uuid": "${uuid}",
       "okind": "${okind}",
       "onode": "${onode}"
   }
   ```

2. <UI>Webhook Name</UI>と<UI>Webhook URL</UI>項目を入力します。

   <ImgLang img="3rdparty/set-event-3rd-party-plugin-add-webhook-json-options.png" className="width-600" desc="登録" />

3. <Cmdname sid="BTN06673" className="uitext" />ボタンを選択します。

:::note

- イベント状態(`status`)はイベント発生(`on`)、イベントの解消(`off`)で区分できます。

- `level`は`None`、`Info`、`Warning`、`Critical`のいずれかに分類されます。

- Header値を追加するには<Cmdname sid="TTL06674" className="uitext" />を選択します。

:::

</details>

</Xclude>

<InDoc product="server">

<details>

<summary>Webhook JSON</summary>

1. 通知を受けるWebhookを登録します。登録したURLに、POST Methodで通知データがJSONで転送されます。

   ```json
   {
       "pcode": 1234,
       "projectName": "Sample project",
       "time": 1577840400000,
       "oid": 1234567890,
       "oname": "WAS-01", // Optional
       "title": "Alert Title",
       "message": "Sample warning message",
       "level": "Warning",
       "status": "on",
       "metricName": "cpu", // Optional
       "metricValue": "99.99", // Optional
       "metricThreshold": "90", // Optional
       "uuid": "ba5db108b788475c95195***********",
       "okind": "WAS-okind-01", // Optional
       "onode": "WAS-onode-01", // Optional
       "serverAlertPolicyName": "Memory Alert" // Optional
   }
   ```

2. <UI>Webhook Name</UI>と<UI>Webhook URL</UI>項目を入力します。

   <ImgLang img="3rdparty/set-event-3rd-party-plugin-add-webhook-json-options.png" className="width-600" desc="登録" />

3. <Cmdname sid="BTN06673" className="uitext" />ボタンを選択します。

:::note

- イベント状態(`status`)はイベント発生(`on`)、イベントの解消(`off`)で区分できます。

- `level`は`None`、`Info`、`Warning`、`Critical`のいずれかに分類されます。

- Header値を追加するには<Cmdname sid="TTL06674" className="uitext" />を選択します。

:::

</details>

</InDoc>

<details>

<summary>Opsgenie</summary>

1. **Teams**メニューで通知を受信するチームを選択してから、**Integrations**メニューをクリックします。

   ![Opsgenie](/img/3rdparty/management_event_opsgenie_step_01.png)

2. **Add Integration**ボタンを選択します。

   ![Opsgenie](/img/3rdparty/management_event_opsgenie_step_02.png)

3. Integration一覧で'API'を検索し、選択します。

   ![Opsgenie](/img/3rdparty/management_event_opsgenie_step_03.png)

4. API名およびTeamを割り当てて各権限を設定します。

   ![Opsgenie](/img/3rdparty/management_event_opsgenie_step_04.png)

5. **Save Integration**ボタンを選択します。

6. WhaTapモニタリングサービスの<Cmdname sid="TTL06656" className="uitext" />画面に戻って<UI>Name</UI>と<UI>API Key</UI>項目を入力します。

   <ImgLang img="3rdparty/set-event-3rd-party-plugin-add-opsgenie-options.png" className="width-600" desc="登録" />

7. <Cmdname sid="BTN06673" className="uitext" />ボタンを選択します。

</details>

<details>

<summary>PagerDuty</summary>

1. [PagerDuty](https://www.pagerduty.com/)アカウントに登録してログインしたことを確認します。

2. PagerDutyで**Services** &gt; **Service Directory**メニューに入って**New Service**ボタンを選択します。

   ![PagerDuty](https://preview.whatap.io/assets/assets/image/management_event_pagerduty_step_01.jpg)

3. Service情報を入力の上、**Next**ボタンを選択します。

   ![PagerDuty](https://preview.whatap.io/assets/assets/image/management_event_pagerduty_step_02.jpg)

4. Escalation Policyを設定して**Next**ボタンを選択します。

   ![PagerDuty](https://preview.whatap.io/assets/assets/image/management_event_pagerduty_step_03.jpg)

5. **Alert Grouping**と**Transient Alerts**項目を設定して**Next**ボタンを選択します。

   ![PagerDuty](https://preview.whatap.io/assets/assets/image/management_event_pagerduty_step_04.jpg)

6. **Integrations**で**Event API V2**を選択して**Create Service**ボタンをクリックします。

   ![PagerDuty](https://preview.whatap.io/assets/assets/image/management_event_pagerduty_step_05.jpg)

7. 生成したService画面で、**Integration Name**と**Integration Key**値をコピーします。

   ![PagerDuty](https://preview.whatap.io/assets/assets/image/management_event_pagerduty_step_06.jpg)

8. WhaTapモニタリングサービスの<Cmdname sid="TTL06656" className="uitext" />画面に戻って<UI>Integration Name</UI>と<UI>Integration Key</UI>項目を入力します。

   <ImgLang img="3rdparty/set-event-3rd-party-plugin-add-pagerduty-options.png" className="width-600" desc="Register" />

:::note

メッセージを受信できなかったり、プラグインが登録されていない場合は、**Integration Name**または**Integration Key**値が正しいか確認します。

:::

</details>

### AI通知を受信する<code className="Beta">Beta</code> {#smartmessage}

Telegramを通じて3rdパーティープラグインを通知手段として追加した場合、AI通知機能を利用できます。AI通知機能は、モニタリング通知をより簡潔で理解しやすいように提供し、ユーザーが迅速に問題を把握し、対応できるようにサポートする機能です。

<ImgLang img="telegram-set-smart-ai-message.png" desc="AI通知の受信" />

<Cmdname sid="3rd_party_plugin" className="uitext" />セクションのTelegram項目で<Cmdname sid="ITM08845" className="uitext" />オプションを選択します。<Cmdname sid="ITM08845" className="uitext" />オプションを活性化すると、ユーザーはTelegramで次のように要約された形で通知を受信できます。

<ImgLang img="telegram-smart-ai-message.png" desc="メッセージ" />

:::note

- 好みの言語を選択できます。現在対応している言語は韓国語、英語、日本語です。

- **Application**、**Server**製品は**クエリコード取得**ボタンをクリックして、その通知に関する質問ができます。この機能は、他の製品にも拡大適用する予定です。

- AI通知機能は現在ベータバージョンとして提供されているため、完璧な回答を提供しない場合があります。

:::
