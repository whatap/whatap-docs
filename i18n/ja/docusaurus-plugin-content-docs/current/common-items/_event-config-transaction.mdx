<ホーム画面> &gt; プロジェクト選択 &gt; ![アイコン](/img/ic-sitemap.svg) <Cmdname sid="sitemap" className="uitext" /> &gt; <Cmdname sid="side_event" className="uitext" /> &gt; <Cmdname sid="side_eventSetting" className="uitext" /> <code class="newfunc">New</code> &gt; **トランザクションイベントタブ**

トランザクションイベントは、特定のURL、エラー、ステータスコードなどのパターンを組み合わせて、トランザクションをきめ細かく監視できる機能です。  
アプリケーション内で発生するトランザクションが指定された条件に一致すると、アラートが発生します。  
トランザクションは1分単位で分析され、条件に一致する件数がしきい値を超えるとアラートが送信されます。

<ImgLang img="metric-event-transaction.png" desc="Metrics Event Transaction" />

## イベント一覧

作成されたトランザクションイベントを確認・管理できます。

- **有効化**: スイッチでイベントの有効・無効を設定  
- **イベントレベル**: <span className="vslow">致命的</span>、<span className="slow">警告</span>、<span className="info">正常</span>  
- **検索機能**: イベント名、受信者、対象パターンで検索可能  
- **列のサイズ調整**: 列の境界をドラッグして幅を変更可能  

### 主なカラム

| 項目              | 説明                                                     |
|------------------|----------------------------------------------------------|
| No               | イベントの順番                                           |
| 有効化           | イベントの有効/無効設定                                   |
| 編集             | イベント編集用のボタン                                     |
| イベント名        | ユーザーが設定したイベント名                               |
| 条件タイプ        | イベントの発生条件の種類（経過時間、エラー、パターンのみ）    |
| 集計基準          | トランザクションカウントの集計単位                           |
| 対象パターン      | 含む/除外のパターン（URL、ステータスコードなど）             |
| 発生回数          | アラートの発生基準となる回数                                 |
| 一時停止時間      | アラート発生後、同一イベントを無視する時間                     |
| イベント受信者     | アラートを受け取るユーザーまたはグループ                       |

## イベントの追加/編集

イベントを追加するには、イベント一覧の右上にある <Cmdname sid="add_notification" className="uitext" /> ボタンをクリックしてください。設定は3つのセクションに分かれています。

### 1. イベント条件の定義

イベントを発生させる条件を設定します。

- **条件タイプ（必須）**
  - 経過時間: 指定ミリ秒以上のトランザクション
  - エラー発生: エラーが発生したトランザクション
  - パターンのみ: 指定したパターンに一致するトランザクション

- **経過時間のしきい値**: 条件タイプが「経過時間」の場合はms単位で入力

- **集計基準（必須）**  
  - 全体  
  - エージェント別  
  - URL別  
  - エージェントごとのURL別  
  - エラークラス別  
  - エージェントごとのエラークラス別  
  - コンテキスト別  
  - エージェントごとのコンテキスト別  

:::note
コンテキストがない場合は集計されません。
- エージェントオプション `app_context_enabled=true` を設定していない場合
- Webトランザクションでない場合
:::

- **発生回数（必須）**: アラートを発生させる最小回数
- **一時停止時間（必須）**: 同一イベントのアラートを抑制する時間（1分～1日）
- **イベント実行時間帯**: 特定の時間帯だけアラートを有効にできます

### 2. 対象パターンの設定

トランザクションをフィルタリングするためのパターンを指定します。

**パターンの設定方法**
- Enterで複数行入力可能
- ワイルドカード(*)使用可
- 同じ種類のパターンはOR、異なる種類はAND条件で処理
- パターンを1つも指定しなければ、すべてのトランザクションが対象になります

:::tip
**「/」とワイルドカード「*」の組み合わせに注意**
- `/api/*` : `/api`はマッチしない。`/api/`以降のパスが必要
- `/api*` : `/api`自体もマッチする（`/api`, `/api/users`, `/apitest`）
:::

#### 一致パターン
指定した条件と一致するデータをフィルタリングします（青タグ表示）。
- **コンテキスト**: アプリケーションコンテキスト
- **URL**: トランザクションURL（例：/api/*, */users/*）
- **エラークラス**: エラークラス名（例：*Exception, *Error）
- **エラーメッセージ**: エラーメッセージに含まれる文字列
- **ステータスコード**: HTTPステータスコード（例：4**, 5**）

#### 除外パターン
一致したデータを除外します（赤タグ表示）。書式は一致パターンと同じです。

#### パターンマッチ例

**1. 完全一致**
```
パターン: "hello"
"hello"     → 一致
"Hello"     → 不一致（大文字小文字を区別）
```

**2. 前方一致**
```
パターン: "hello*"
"hello"       → 一致
"helloworld"  → 一致
"hi"          → 不一致
```

**3. 後方一致**
```
パターン: "*world"
"world"       → 一致
"helloworld"  → 一致
"hello"       → 不一致
```

**4. 部分一致**
```
パターン: "*ell*"
"hello"       → 一致
"excellent"   → 一致
"welcome"     → 不一致
```

**5. 複合パターン**
```
パターン: "hello*world"
"hellobeautifulworld"  → 一致

パターン: "hello*test*"
"hellomytestcase"      → 一致

パターン: "*test*world"
"mytestcaseworld"      → 一致
```

#### 使用例
- URLパターン
  - `/api/*` : `/api` で始まるすべてのURL
  - `*/users/*` : `/users/` を含むURL
  - `/api/v1/users` : 完全一致のみ

- エラークラスパターン
  - `*Exception` : `Exception`で終わるすべてのクラス
  - `java.lang.*` : `java.lang`で始まるクラス
  - `*Timeout*` : `Timeout`を含むクラス

- ステータスコードパターン
  - `4**` : 400番台すべて
  - `404` : 404のみ
  - `5*` : 500番台すべて

:::note
**パターン制限事項**
- `*`の他に最低1文字以上を含む必要があります
  - ❌ 不可: `***`, `**`
  - ✅ 可: `a*`, `*a`, `*a*`, `/api*`
- 空文字列やnullにはマッチしません
- `**`は`*`と同じ扱い
- `*`が3個以上含まれるパターンはサポートされません
- 正規表現は使用不可（`[a-z]`, `+`, `?`, `()`など）
- 大文字小文字を区別
- `*`をエスケープする方法はありません
:::

### 3. 基本情報と通知設定

イベント名と通知先を設定します。

- **イベントの有効化**
- **イベント名（必須）**: わかりやすい名前を入力
- **イベントレベル（必須）**
  - <span className="vslow">致命的</span>  
  - <span className="slow">警告</span>  
  - <span className="info">情報</span>
- **通知対象**
  - **全員通知**: プロジェクトメンバー全員に通知
  - **タグ指定通知**: 特定タグを持つユーザーのみ通知
    - **+タグ追加** で既存タグ選択または新規作成可能

## イベント通知例

### 設定条件
- URLパターン: /api/posts/**, /delete/*, */test/*
- エラークラス: *TimeoutException*, *NullPointerException
- ステータスコード: 4**
- 除外エラークラス: *IOException
- 除外ステータスコード: 5**
- 集計基準: エージェント別
- 発生回数: 2回
- 一時停止: 5分

### 通知メッセージ例
```
(ignored count: 3)
[Per Agent] limit: 2, count: 3
[Condition]
url patterns: /api/posts/**, /delete/*, */test/*
error class patterns: *TimeoutException*, *NullPointerException
status patterns: 4**
exclude error class patterns: *IOException
exclude status patterns: 5**
[Transaction]
url: /api/posts/test/timeout
txid: 408093121470636540
status: 408
error class: java.util.concurrent.TimeoutException
```

### 各項目の説明
- **(ignored count: n)**: 一時停止中に発生したが通知されなかった件数
- **集計情報**:
  - `[Per Agent]`, `[Per URL]`, `[Per Error Class]` など
- **[Condition]**: 当時設定されていた発生条件
- **[Transaction]**: 条件に一致した最後のトランザクション詳細

:::note
- トランザクションイベントは1分単位で評価されます
- 条件タイプが「パターンのみ」の場合、必ず1つ以上のパターンを設定してください
- パターンマッチは大文字小文字を区別します
- 通知メッセージには条件に一致した最後のトランザクション情報が含まれます
:::

## 対応エージェントバージョン {#support-agent-version}

トランザクションイベントには以下の最新エージェントバージョンが必要です。

<InDoc product="java,kubernetes">
- Java: 2.2.48以降
</InDoc>

<InDoc product="php,kubernetes">
- PHP: バージョン未定（最新版の使用を推奨、要問い合わせ）
</InDoc>

<InDoc product="golang,kubernetes">
- Go: バージョン未定（最新版の使用を推奨、要問い合わせ）
</InDoc>

<InDoc product="dotnet,kubernetes">
- .NET: 2.3.5以降
</InDoc>

<InDoc product="python,kubernetes">
- Python: 1.7.8以降
</InDoc>

<InDoc product="nodejs,kubernetes">
- Node.js: 0.5.21以降
</InDoc>
