ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="dashboard" className="uitext" /> &gt; **インスタンスマップ**

**インスタンスマップ**は、データベースサーバーをモニタリングしているインスタンスの状態を視覚化し、難しく感じられることの多いデータベースモニタリングを簡単に行えるよう支援する機能です。

データベースサーバーの主要指標にしきい値（スレッショルド）を設定することで、データベースの状態を一目で把握でき、実行中のアクティブセッションもリアルタイムで確認できます。 また、インスタンスモニタリング画面やマルチインスタンスモニタリング画面へ遷移して、障害が発生したデータベースの分析を迅速に行えるよう連携されています。

<ImgLang img="db-instance-map.png" desc="Instance Map" />

:::note

CPU使用率、メモリ使用量など、データベースサーバーのプロセス使用状況は XOSエージェントの実行によりデータ収集が可能です。

:::

## 基本画面

**インスタンスマップ**は主に **ユーザー設定エリア** とインスタンスの **マップチャートエリア** で構成されています。 

<ImgLang img="db-instance-map-setting.png" desc="Instance Map Setting" />

### ユーザー設定

**インスタンスマップ**画面上部のユーザー設定エリアでは、**グループ化**、**しきい値設定**、**ラベル**、**フィルター**、**プリセット**、![設定アイコン](/img/ico-setting.svg) **追加設定**が可能です。

#### グループ化

インスタンスをさまざまな基準でグループ化したり、ユーザーのニーズに応じてカスタム基準でまとめてモニタリングできます。 グループ化機能は最大2階層までサポートされています。 2階層目のグループをクリックすると、そのグループに属するインスタンスのデータをまとめて確認できる詳細画面が表示されます。

#### しきい値の設定

データベースモニタリングの主要指標に対してしきい値を設定することで、インスタンスの状態を色で表現することができます。 複数の指標を設定でき、各指標ごとに警告（<span class='slow'>Warning</span>）および重大（<span class='vslow'>Critical</span>）の範囲を指定できます。 正常(<span class='normal'>Normal</span>) 区間は<span class='normal'>青色</span>で表示します。 設定された範囲に応じて、該当状態の色が適用されます。

1. 画面上の **しきい値設定** オプションをクリックしてください。

2. 任意の指標を選択し、Warning と Critical の範囲を設定してください。

3. メトリクスを追加する場合は、下段の **+ 指標追加** をクリックしてください。

4. 各指標のしきい値設定が完了したら、**保存** ボタンをクリックしてください。

**インスタンス状態の表示優先順位**

状態表示の優先順位は<span class='vslow'>Critical</span>区間が一番高いです。 複数の指標のうち、いずれか1つでも <span class='vslow'>Critical</span> の範囲に該当する場合、そのインスタンスは赤色で表示されます。 以下の例では、2つのインスタンスがともに <span class='vslow'>Critical</span> として表示されます。

#### ラベル

インスタンスアイコンの内部にはテキストラベルが表示されます。 ラベルの種類は、データベース情報および主要指標で構成されています。

#### フィルター

フィルターを指定することで、特定のインスタンスに集中してモニタリングを行うことができます。

- **フィルターキー**: データベースおよびインスタンス情報がフィルターキーとして提供されます。

  - **収集カラム**: インスタンス名、クラスタ/レプリケーション情報、エージェントバージョン、CPUコア数、データベースの種類、インストール位置、バージョン、IP、Port

- 条件: フィルターの条件は、`≥`、 `≤`、 `>`、 `<`などの数字型条件と一致、 不一致、 包含、 不包含などの文字列条件で設定できます。

#### プリセット

ユーザーは、設定したオプションをプリセットに保存し、必要な時読み込みできます。 プリセットはプロジェクト単位で保存されます。 これにより、プロジェクトメンバーが同じ設定でインスタンスをモニタリングすることができます。 デフォルトプリセット(Default) が提供されており、デフォルトプリセットは削除できません。

:::tip

**基本プリセット**

インスタンスマップのデフォルトプリセットでは、`active_sessions` と `lock_wait_sessions` のしきい値が以下のように設定されています。

- active_sessions

  - <span class='slow'>Warning</span>: 値が 20 以上

  - <span class='vslow'>Critical</span>: 値が 30 以上

- lock_wait_sessions

  - <span class='slow'>Warning</span>: 値が 1 以上

  - <span class='vslow'>Critical</span>: 値が 3 以上

:::

#### 追加設定

インスタンスマップ右上の ![設定アイコン](/img/ico-setting.svg) アイコンをクリックして、追加設定が可能です。

- **第1グループなしを表示**: 第1グループを設定した際、該当グループが存在しない'グループなし'を表示するかどうかを設定します。

- **グループ下部メトリクスエリアの表示**：下部のメトリクス情報の要約を表示するかどうかを設定します

### インスタンスマップチャート

インスタンスマップチャートは、3つのエリアで構成されています。

#### 上部エリア

インスタンスの全体数、またはグループ化されている場合はグループごとの総数と、選択されたメトリクスの状態別の件数を表示します。

#### インスタンスの可視化エリア

すべてのインスタンスの状態と件数を直感的に把握できるビジュアルダッシュボードを提供します。

#### 下部エリア

主要なメトリクスのインスタンス平均値を表示します。 ![設定アイコン](/img/ico-setting.svg) の **グループ下部メトリクスエリアの表示** オプションを使ってオン/オフを切り替えることができます。

## 要約の表示と詳細分析

**インスタンスマップ**で、確認したいインスタンスを選択してください。 右側に表示されるサマリービュー画面では、該当インスタンスの概要情報を **インスタンス概要**、**メトリクス**、**アクティブセッション**、**イベント**、**ログタブ** で確認できます。 サマリービュー画面で **詳細分析** ボタンをクリックすると、詳細分析画面を確認できます。

<ImgLang img="db-instance-map-view-detailed.png" desc="Instance Map Setting view detatiled" />

### インスタンス概要

詳細分析ページの **インスタンス概要** タブでは、選択したインスタンスがモニタリングしているデータベースの情報および指標情報、発生したイベントを確認できます。 また、インスタンスモニタリングメニューへ移動することもでき、非アクティブなインスタンスの場合は、非アクティブ化された時点のインスタンスモニタリング画面へ移動します。

- **イベントエリア**: ユーザーが設定したアラート基準に基づくイベント発生情報を提供します。 各イベントカードをクリックすると、どのイベントが発生したかを確認できます。

- **指標エリア**: 主要なデータベースメトリクスおよびリソース使用状況をリアルタイムで確認できます。 リソース使用状況は XOS エージェントを設定することで確認可能です。

  - データベース指標

    - Active Sessions: 実行中のクエリセッション数

    - Lock Wait Sessions: ロック待機中のセッション数

    - Session Logical Reads: メモリから読み取ったデータブロック数（db block gets + consistent gets）

    - Execute Count: 実行された SQL ステートメントの呼び出し回数

  - リソース使用状況 (Resource Map (XOS))

    - CPU Usage: CPU 使用率

    - Disk Usage: ディスク使用量

    - Memory Usage: メモリ使用量および使用率

    - Network I/O: ネットワークの送受信量

- データベース情報エリア（Database Info）: データベースの詳細情報を確認できます。 インスタンスモニタリングをクリックすると、選択したインスタンスのモニタリング画面へ移動できます。

#### インスタンス概要詳細ビュー

詳細ビュー画面の **インスタンス概要** タブでは、複数のインスタンスを選択して、主要メトリクスおよびデータベース情報をテーブル形式でモニタリングできます。 **インスタンス概要** タブの右上にある **詳細ビュー** ボタンをクリックするか、2次グループを設定後、インスタンス視覚化エリアで2次グループ名をクリックすると、詳細ビュー画面に移動します。

<ImgLang img="db-instance-map-view-detailed-cases.png" desc="Instance Map Setting view detatiled page" />

- **詳細ビュー** 画面では、視覚化エリア内のインスタンスアイコンをクリックするか、画面左下のインスタンスリストをクリックして、インスタンスを選択または選択解除できます。 **すべて選択** または **すべて解除** をクリックすることで、全インスタンスの一括選択または解除が可能です。 

- 複数のインスタンスを選択した場合、**マルチインスタンスモニタリング >** ボタンをクリックして、選択されたインスタンスを **マルチインスタンスモニタリング** 画面でモニタリングできます。

### メトリクス

**メトリクス** タブでは、選択されたインスタンスのメトリクストレンドを確認できます。 時間セレクターを操作することで、リアルタイムまたは過去のメトリクスの変化を確認できます。

### アクティブセッション

**アクティブセッション** タブでは、リアルタイムで実行中のセッションおよびクエリの内容を確認できます。

:::note

テーブルリスト内の文字色は、黒 → <span class='slow'>オレンジ</span> → <span class='vslow'>赤</span> の順にセッションの実行速度が遅いことを示します。

:::

### イベント

**イベント** タブでは、直近1時間に発生したイベントを確認できます。 発生したイベント項目をクリックすると、イベントが発生した時点のインスタンスモニタリング画面に移動します。

### ログ

**ログ** タブでは、発生したログの確認およびリアルタイムログの確認が可能です。 右側の **詳細ビュー** ボタンをクリックすると、より詳細なログを確認できます。
