<Title hashid="query-details" level={props.level}>SQL 詳細情報の確認</Title>

<InDoc pages="instance-monitoring,multi-instance-monitoring">

実行中セッションのSQLクエリ情報を確認するには、<Cmdname sid="active_sessions" className="uitext" />セクションの**query**(または**sql_text**) カラム項目を選択します。 <Cmdname sid="TTL06224" className="uitext" />画面が表示されます。 SQLクエリ文とPlan情報を確認することができます。

</InDoc>

<InDoc pages="analysis-compare-top-sql">

詳細なSQL情報を確認するには、SQL順位テーブルの**query**カラム項目を選択します。 <Cmdname sid="TTL06224" className="uitext" />画面が表示されます。 SQLクエリ文とPlan情報を確認することができます。

</InDoc>

<InDoc pages="slow-query">

実行中のセッションのSQLクエリ情報を確認するには**Slow Query List**セクションの**SQL**カラム項目を選択します。 <Cmdname sid="TTL06224" className="uitext" />画面が表示されます。 SQLクエリ文とPlan情報を確認することができます。

</InDoc>

<InDoc pages="analysis-sql">

画面の下のSQL一覧で**query**カラム項目を選択すると<Cmdname sid="TTL06224" className="uitext" />画面が表示されます。 SQLクエリ文とPlan情報を確認することができます。

</InDoc>

<Cmdname sid="BTN06225" className="uitext" /> **→** ボタンをクリックすると、選択した SQL クエリに関連する統計情報を確認できる <Cmdname sid="statistics_sql" className="uitext" /> に移動します。

<InDoc product="oracle-pro,oracle"><ImgLang img="db-sql-details-oracle-pro.png" desc="SQL統計" /></InDoc>

<InDoc product="postgresql,mysql"><ImgLang img="db-sql-details-postgresql.png" desc="SQL詳細" /></InDoc>

<InDoc product="mssql"><ImgLang img="db-sql-details-mssql.png" desc="SQL詳細" /></InDoc>

<InDoc product="db2,sapase"><ImgLang img="db-sql-details-db2.png" desc="SQL統計" /></InDoc>

<Xclude product="postgresql,mysql,oracle-pro,oracle,mssql,db2,sapase"><ImgLang img="db-sql-details-common.png" desc="SQL統計" /></Xclude>

<InDoc product='postgresql,mysql,altibase,cubrid,mssql,db2'>

- **Default Bind**: クエリ文で変数として設定された部分を既定値としてバインディングできます。

- **Reset Bind**：バインディングされた既定値を解除し、変数を確認できます。

- **Formatting**: SQLクエリ文にインデントおよびフォーマットを適用して可読性を高めます。

</InDoc>

<InDoc product="altibase,cubrid,mssql">

- **Plan**: Plan情報を確認するには**DB Name**、**User Name**、**Password**を入力してから、![検索アイコン](/img/ico-btn-search.png)ボタンを選択します。

</InDoc>

<InDoc product='postgresql'>

- **Plan**: Plan情報を確認するには**DB Name**、**User Name**、**Password**を入力してから、![検索アイコン](/img/ico-btn-search.png)ボタンを選択します。

  - **Text**: テキスト形式でプラン情報を確認できます。

  - **JSON**: JSON形式でプラン情報を照会すると、ボトルネックが発生した箇所がすばやく確認できます。

  :::note

  **JSON**形式でプラン情報を照会する機能は、DBXエージェント1.6.12バージョン以降から対応しています。

  :::

</InDoc>

<InDoc product='mysql'>

- **Plan**: Plan情報を確認するには**DB Name**、**User Name**、**Password**を入力してから、![検索アイコン](/img/ico-btn-search.png)ボタンを選択します。

  - **Text**: テキスト形式でプラン情報を確認できます。

  - **JSON**: JSON形式でプラン情報を照会すると、ボトルネックが発生した箇所がすばやく確認できます。

  :::note

  **JSON**形式でプラン情報を照会する機能は、DBXエージェント1.6.15バージョン以降から対応しています。

  :::

</InDoc>

<InDoc product='oracle-pro,oracle'>

- **Runtime Plan**: 選択されたSQLクエリの実行計画とランタイム情報を提供します。 実行回数、平均実行時間、平均物理的読み取りなどの詳細を提供します。

- **Explain Plan**: オプティマイザーが予測した実行計画を示します。 費用、作業、オブジェクト名、カーディナリティなどの情報を提供します。

- **Plan History**: データベースで実行されたSQLクエリの実行計画に対する履歴を確認できます。

- **Bind Capture**: データベースで実行されたSQLクエリに使用されたバインド変数の値を確認できます。 これにより、クエリ実行の実際の内容を確認できます。

  :::note

  リアルタイムで実行されたbind値ではなく、データベースにキャプチャされた値(`v$sql_bind_capture`)です。 件数が多いと、100個まで表示します。

  :::

</InDoc>

<InDoc product='postgresql,mysql'>

:::tip

**JSON**形式でプラン情報を照会した状態でtableまたはindex項目を選択すると、テーブルの**column**、 **index**構成が確認できる**Object detail**ウィンドウが表示されます。

<ImgLang img='db-sql-objectdetail-pg.png' desc='Object detail' />

この機能は、DBXエージェント1.6.15バージョン以降に対応しています。 データベース権限に関する設定は、[次の文書](install-agent#uid)を参考にしてください。

:::

</InDoc>

<InDoc product='postgresql,mysql,oracle,oracle-pro,mssql'>

#### AI チューニングガイド

AI チューニングガイドは、SQL クエリ、プラン、統計情報を分析してパフォーマンス問題を診断し、最適化の提案を行う機能です。  
開発者や DBA がボトルネックの原因を迅速に特定し、効率的な SQL によりパフォーマンスを改善できるよう支援します。

:::caution
**使用条件および注意事項**

**PostgreSQL、MySQL、SQL Server** ではプランの取得が必須です。  
プランを取得しない場合、AI チューニングガイドアイコンは ![無効な AI チューニングガイドアイコン](/img/ico-ai-tuning-icon-disabled.svg)（無効）として表示され、機能を使用できません。

* AI が生成する結果は自動分析に基づいており、精度が 100% ではないことにご留意ください。
:::

1. 分析および診断する SQL をクリックし、<Cmdname sid="TTL06224" className="uitext" /> 画面に移動します。

1. <Cmdname sid="TTL06224" className="uitext" /> 画面の右下にある AI チューニングガイドアイコン ![AI チューニングガイドアイコン](/img/ico-ai-tuning-icon.svg) をクリックして AI 分析を開始します。

1. AI 分析結果を確認します。

    | 結果項目 | 説明 |
    | :---: | --- |
    | クエリプランおよび概要 | クエリの目的と実行概要を表示します。<br /> 実行回数、累積実行時間、データベース全体の負荷比率を分析し、当該 SQL がシステムパフォーマンスに与える影響を評価します。 |
    | パフォーマンス分析 | 分析結果を総合し、パフォーマンススコアと診断結果を提供します。<br /> CPU 使用率、ディスク使用率、キャッシュヒット率、待機時間など、クエリ実行過程における詳細なリソース使用量を分析し、ボトルネックの発生区間を視覚的に表示します。 |
    | 発見された主な問題 | 主な問題点を要約して表示します。 |
    | 最適化推奨事項 | 検出された問題に基づき、最適化されたクエリを提案します。 |

</InDoc>
