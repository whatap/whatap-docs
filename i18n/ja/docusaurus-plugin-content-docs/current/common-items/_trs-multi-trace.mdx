**マルチトランザクション**は、別のエージェントやプロジェクトに関連付けられたトランザクションを意味します。WhaTapプロジェクトに登録されたアプリケーションサービス間の呼び出しを追跡するのが、**マルチトランザクション追跡**です。 

<InDoc product="java">

:::info

Javaエージェントは、3つのHTTPヘッダーキー値(`x-wtap-po`、`x-wtap-mst`、`x-wtap-sp1`)でマルチトランザクションを追跡します。ゲートウェイを通過するHTTPトランザクションの連携追跡ができない場合は、HTTPヘッダー条件を確認してください。

:::

</InDoc>

:::note

**マルチトランザクションの活性化**

マルチトランザクションを追跡するには<Cmdname sid="side_management" className="uitext" /> &gt; <Cmdname sid="side_agentSetting" className="uitext" />メニューから`mtrace_enabled`オプションを`true`に設定します。エージェント設定の詳細については[次の文書](set-agent#set-agent-service)を参照してください。

:::

## マルチトランザクション追跡機能の利用方法

1. <Cmdname sid="analysis" className="uitext" /> > <Cmdname sid="multi_server_transaction_trace" className="uitext" /> メニューに移動します。

2. <Cmdname sid="TTL06527" className="uitext" /> 画面で確認した <b>MTID</b> の値を、<Cmdname sid="search_mtid_or_custid" className="uitext" /> 項目に入力します。

3. 照会する日付とプロジェクトを選択します。

4. 画面下部の <Cmdname sid="apply" className="uitext" /> ボタンをクリックします。

    * 以下の場合、<Cmdname sid="apply" className="uitext" /> ボタンは無効化されます：
        * 前回と同じフィルター値（MTID/CUSTID、日付、選択プロジェクト）が設定されている場合
        * フィルター値（MTID/CUSTID、日付、選択プロジェクト）が一つも入力されていない場合

5. 右側の <Cmdname sid="BTN07120" className="uitext" /> タブには、各トランザクション間の呼び出し関係を把握できるダイアグラムとテーブルが表示されます。

    :::tip
    ダイアグラムエリアとテーブルエリアは上下に分割されており、比率を自由に調整できます。

    - 上向き矢印をクリックするとテーブルが全体領域を占めます。  
      ダイアグラムが全体表示だった場合は 50/50 にリセットされます。
    - 下向き矢印をクリックするとチャートエリアが全体領域を占めます。  
      テーブルが全体表示だった場合は 50/50 にリセットされます。
    :::

### <Cmdname sid="BTN07120" />

<Cmdname sid="BTN07120" className="uitext" /> は、各トランザクション間の呼び出し関係を迅速かつ明確に確認できる機能です。  
同じ <Cmdname sid="TTL06107" className="uitext" /> を持つトランザクションサービスの個別実行時間を確認できます。  
各トランザクションノード上部に表示される処理時間（<LinkImage img="number-01.png" desc="number 1"/> <Cmdname sid="time_bar" className="uitext" />）を通じて、トランザクション間の呼び出し関係を把握できます。

![Chart](/img/trace-mtx-chart-timebar.png)

:::tip
チャートはマウスで自由に移動・拡大・縮小できます。

- チャート領域をドラッグすると表示位置を移動できます。
- スクロール操作:
    - 縦スクロール：上下移動  
    - 横スクロール：左右移動
- `Ctrl` + 縦スクロールで拡大・縮小できます。  
  （タッチパッドのピンチ操作にも対応）
:::

トランザクションを選択すると、関連するノードのみが強調表示され、関連しないノードは薄く表示されます。  
選択したトランザクションの下部に **詳細表示** ボタン（<LinkImage img="number-02.png" desc="number 2"/>）が有効化され、クリックすると <Cmdname sid="TTL06527" className="uitext" /> ウィンドウが開きます。  
ここでトランザクションの詳細情報を確認できます。  
<Cmdname sid="TTL06527" className="uitext" /> を利用した詳細分析については、[こちらのドキュメント](trs-profile#transaction-info) を参照してください。

* ![확대 아이콘](/img/ic-button-zoom-in.svg) **拡大**: ズームイン  
* ![축소 아이콘](/img/ic-button-zoom-out.svg) **縮小**: ズームアウト  
* ![화면 맞춤 아이콘](/img/ic-button-fit-to-screen.svg) **画面に合わせる**: 全ノードを画面に収めて表示  
* ![화면 초기화 아이콘](/img/ic-button-reset-zooming.svg) **ズーム初期化**:  表示位置とズーム倍率を初期状態に戻す  
* ![설정 아이콘](/img/ic-button-setting.svg) **チャートビュー設定**: 表示項目のオン/オフ
    * <Cmdname sid="TTL06344" className="uitext" />：アプリ名、プロジェクト情報、IP、ステータスコードの表示/非表示  
    * <Cmdname sid="database" className="uitext" /> / <Cmdname sid="apply_external_remote" className="uitext" />：DB接続や外部HTTP呼び出しをノードとして表示

---

### <Cmdname sid="BTN07121" />

<Cmdname sid="BTN07121" className="uitext" /> タブでは、マルチトランザクションに含まれる各トランザクション情報をテーブル形式で確認できます。

トランザクションを選択すると、<Cmdname sid="BTN07120" className="uitext" /> 図内の対応する **ノード** が強調表示され、関連ノードもハイライトされます。  
トランザクション列の詳細ボタンをクリックすると <Cmdname sid="TTL06527" className="uitext" /> ウィンドウが開き、トレースの詳細情報を確認できます。  
詳しくは [こちらのドキュメント](trs-profile#transaction-info) を参照してください。

* ![컬럼 아이콘](/img/ic-column.svg) <Cmdname sid="BTN06441" className="uitext" /> — テーブル列の編集

### ツリー {#trace-multi-tx-tree}

<Cmdname sid="BTN06296" className="uitext" /> ボタンを選択すると、各トランザクションとその配下のトレースに関する詳細情報を確認できます。  
全体トランザクションの実行時間内で、各サブトランザクションおよびトレースの開始時間・経過時間を可視化し、呼び出し関係をツリー形式で表示します。

* ![フィルターアイコン](/img/ico-filter.svg) <Cmdname sid="TLT06410" className="uitext" />：チャートに表示するプロジェクトを選択または解除します。

* ![1行表示アイコン](/img/ic-single-line.svg) <Cmdname sid="BTN06368" className="uitext" />：各区間の実行情報を1行で表示し、ツリーを簡潔にします。

* ![複数行表示アイコン](/img/ic-multi-line.svg) <Cmdname sid="BTN06369" className="uitext" />：各区間の実行情報を複数行で表示します（改行あり）。

* <Cmdname sid="BTN06327" className="uitext" />：最も長いパスへ移動します。

* ![チャートアイコン](/img/ic-bar-chart.svg) <Cmdname sid="BTN06743" className="uitext" />：経過時間を棒グラフとして表示します。

* ![時間アイコン](/img/ic-custom-time.svg) <Cmdname sid="BTN06744" className="uitext" />：各セグメントのタイムスタンプ、ギャップ、経過時間をテキスト形式で表示します。

  * 8秒以上：<span class='etrs'>赤色</span>で <span class='etrs'>過剰遅延</span> として表示  
  * 3～8秒：<span class='ov5ud10'>オレンジ色</span>で <span class='ov5ud10'>遅延</span> として表示  
  * 3秒未満：<span class='woer'>青色</span>で <span class='woer'>正常</span> として表示  

:::note

開始時間および経過時間は、上位トランザクションとのマッピングによる補正処理が行われるため、実際に収集されたデータと差異が生じる場合があります。

:::

* ![非表示アイコン](/img/ic-eye-invisible.svg) <Cmdname sid="BTN06745" className="uitext" />：時間情報を非表示にします。

:::note

* 各トレースの ![統計アイコン](/img/ic-static.svg) または ![ポップアップアイコン](/img/ic-popup.svg) を選択すると、<Cmdname sid="remote_http_call_statistics" className="uitext" />、<Cmdname sid="activestack" className="uitext" />、<UI>SQL</UI> などの詳細情報を確認できます。

* SQL ステップの ![コピーアイコン](/img/ico-copy.svg) をクリックすると、そのステップの SQL 文をコピーできます。

:::
