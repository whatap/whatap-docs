**マルチトランザクション**は、別のエージェントやプロジェクトに関連付けられたトランザクションを意味します。WhaTapプロジェクトに登録されたアプリケーションサービス間の呼び出しを追跡するのが、**マルチトランザクション追跡**です。 

:::note

**マルチトランザクションの活性化**

マルチトランザクションを追跡するには、活性化オプションを設定する必要があります。 

1.  **_管理_** > **_エージェント設定_**メニューに移動します。 
2.  **_マルチサーバートランザクション_**設定の下にある**_活性化_**オプションの`mtrace_enabled`の値を`true`に設定指定します。

:::

## マルチTX追跡{#trace-multi-tx}

ホーム画面 > プロジェクト選択 > **_分析_** > **_ヒートマップ_**メニューからチャート領域をドラッグします。ドラッグしたチャート領域のトランザクション情報は、次のように下部の**_TXトレース_**一覧に表示されます。一覧でマルチトランザクションを含むトランザクションは、![アイコン](/img/ic-s-mult-transation.svg)アイコンが表示されます。

![mtrace_M](/img/tx-trace-table.png)

該当のトレースを選択すると、**_トランザクション情報_**ウィンドウが表示されます。マルチトランザクションが追跡される場合は、**_レコード概要_**タブで**_マルチトランザクションID_**の値を確認できます。トランザクションで外部呼び出しを行うと、同じ**_マルチトランザクションID_**が生成されます。サービスごとにプロジェクトが分かれている場合でも、最初に発行した**_マルチトランザクションID_**を使用して、アプリケーション間のすべてのトランザクションを確認することができます。**_トランザクション情報_**ウィンドウを使用したTXトレースの詳細な分析に関する詳細は[次の文書](trs-profile#details)を参照してください。

![レコード要約](/img/tx-trace-dt-up.png)

**_マルチトランザクションID_**を選択すると、**マルチトランザクション\***タブが表示されます。システム内またはシステム間で発生するさまざまな呼び出し関係を一目で確認でき、どのような問題が発生したかを識別して改善できるようにトランザクションとトレース情報を提供します。

### チャート{#trace-multi-tx-chart}

![チャート](/img/multi-tx-cht.png)

**_マルチトランザクション追跡_**メニューの基本画面は**_チャート_**です。**_チャート_**は、各トランザクションの呼び出し関係を迅速かつ明確にユーザーに提供します。同じ**_マルチトランザクションID_**を持つトランザクションサービスを個別に実行時間を確認できます。トランザクションノードの背景色で表示され、費やされた所要時間(![数字1](/img/number-01.png)**_タイムバー_**)を使用して、トランザクション間の呼び出し関係を確認できます。**_チャート_**では、マウスを使用して目的の位置に移動したり、スクロールして拡大/縮小することができます。

-   ![フィルターアイコン](/img/ico-filter.svg)**_プロジェクト選択_**:チャートに表示されるプロジェクトを選択または解除できます。

-   ![設定アイコン](/img/ico-setting.svg)**_チャートビュー設定_**:チャートに表示する要素を表示または非表示にすることができます。

    -   **_タイムバー_**:各ノードの所要時間(**_タイムバー_**)を表示または非表示にすることができます。

    -   **_アプリケーション名_**:各ノードにエージェント名(oname)を表示または非表示にすることができます。

    -   **_プロジェクト_**:各ノードにプロジェクト名を表示または非表示にすることができます。

    -   **_データベース_**/**_外部呼び出し_**/**_内部呼び出し_**: トランザクションで発生した他のデータベースコネクションリクエストやHTTP Callの情報もチャートのノードで確認できます。

トランザクションノードを選択すると、次のように**_トランザクション情報_**ウィンドウが追加で表示されます。トランザクショントレースにより、そのトランザクションの詳細を確認できます。**_トランザクション情報_**ウィンドウを使用したトランザクショントレースの詳細な分析に関する詳細は、[次の文書](trs-profile#transaction-info)を参照してください。

![マルチトランザクションの詳細を見る](/img/multi-tx-additional-info.png)

### 表{#trace-multi-tx-table}

**_テーブル_**ボタンをクリックすると、テーブル形式でマルチトランザクションに含まれる各トランザクション情報を確認できます。![カラムアイコン](/img/ic-column.svg)**_カラム設定_**アイコンを選択してテーブル内のカラムを編集できます。 

![マルチトランザクションテーブルモード](/img/multi-tx-table-mode.png)

各トランザクション項目を選択すると、**_チャート_**ノード選択と同様に、選択したトランザクションの**_トランザクション情報_**ウィンドウが表示されます。トランザクショントレースにより、そのトランザクションの詳細を確認できます。**_トランザクション情報_** ウィンドウを使用したトランザクショントレースの詳細分析に関する詳しい内容は、[次の文書](trs-profile#transaction-info)を参照してください。

### ツリー{#trace-multi-tx-tree}

**_ツリー_**ボタンをクリックすると、各トランザクションとそれに属しているトレースの詳細を確認できます。トランザクションの所要時間内の各サブトランザクションまたはトレースの開始および所要時間を視覚化し、トランザクション呼び出し関係をツリー形式で提供します。 

![マルチトランザクションツリーモード](/img/multi-tx-tree-mode.png)

-   **_インライン_**:各区間別の遂行情報に表示されたテキストを一行で表示して、ツリー形式を簡易に整理することができます。

-   **_複数行でみる_**:各区間別の遂行情報に表示されたテキストを改行してすべて表示します。

-   **_最長経路_**: 最長の経路で移動できます。

-   ![チャートアイコン](/img/ic-bar-chart.svg)**_タイムバーの表示_**:経過時間を棒チャートで表示します。

-   ![時間アイコン](/img/ic-custom-time.svg)**_時間表示_**:各区間別のタイムスタンプ、ギャップ、経過時間をテキスト形式で表示します。

    -   8秒以上：<span class='etrs'>超過した</span>状態で<span class='etrs'>赤色</span>で表現します。

    -   3秒以上8秒未満：<span class='ov5ud10'>遅延</span>状態で<span class='ov5ud10'>オレンジ</span>で表現します。

    -   3秒未満：<span class='woer'>正常な</span>状態で<span class='woer'>青色</span>で表示します。

    :::note

    開始および所要時間の場合、トランザクション呼び出し環境によって生じる時差を上位トランザクションのトレースやマッピングで修正・表示することで、実際に収集された時間データとの差異が生じる可能性があります。

    :::

-   ![非表示アイコン](/img/ic-eye-invisible.svg)**_Hide Time_**:時間情報を非表示にします。

:::note

トレースの![統計アイコン](/img/ic-static.svg)ボタンまたは![ポップアップアイコン](/img/ic-popup.svg)ボタンを選択すると**_HTTP呼び出し統計_**、**_アクティブスタック_**などの要約ウィンドウを確認できます。

:::

## 参考資料

-   [マルチトランザクションメニューの追加](https://www.whatap.io/ko/blog/85/index.html)
-   [マルチトランザクションダイアグラムの改善](https://www.whatap.io/ko/blog/72/index.html)
