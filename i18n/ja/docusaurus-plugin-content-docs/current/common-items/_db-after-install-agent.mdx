データベースモニタリングのインストールがすべて完了しました。インストール後に確認事項をチェックしてください。

## エージェントログの確認

データベースエージェントをインストールしたパスで、_start.sh_シェルスクリプトファイルまたは_start.bat_バッチファイルを実行します。エージェントを実行するとデータベースのモニタリング情報の収集が開始されます。エージェントログを確認し、エージェントが正常に起動されたことを確認します。

```bash title='start.sh'
$ ./start.sh

 _      ____       ______
| | /| / / /  ___ /_  __/__ ____
| |/ |/ / _ \/ _ `// / / _ `/ _ \
|__/|__/_//_/\_,_//_/  \_,_/ .__/
                          /_/
Just Tap, Always Monitoring
WhaTap DBX version 1.3.9 20181120
```

## エージェントプロセスの確認

次のコマンドを使用して、動作中のWhaTap DBXエージェントプロセスを確認できます。

```bash title='SH'
$ ps –ef | grep dbx
```

## ログの確認

サービスを再起動時にログが正常に表示された場合は、エージェントが正常にインストールされていることを確認できます。エージェント登録後の収集に関するログは、_$WHATAP_HOME/logs_で確認できます。エージェントが正常に動作すると、その日に次のようなログファイルが確認できます。

- whatap-DBX-`OID`-`DATE`
- whatap-boot-`DATE`.log

## モニタリングの確認

サーバーから正常にログが取得されたことを確認し、コンソールから正常に登録されているかを確認するには、[WhaTapモニタリングサービス](https://service.whatap.io)の初期画面に移動します。確認するプロジェクトを選択し、左側にある***管理*** > ***エージェント一覧***メニューを選択します。***エージェント一覧***からデータベースサーバーの名前を確認できます。

<ImgLang img='db-check-monitoring-agent-lists.png' desc='データベースエージェントの一覧' />

データベース名は、`{type}`-`{ip2}`-`{ip3}`-`{port}` の形式で識別IDを付与します。

## エージェント構成 {#agent-architecture}

エージェントのコンポーネントについて調べます。

<ImgLang img='agent-architecture.png' desc='エージェント構成図' />

- **収集サーバ**

  エージェントが収集したデータベースのパフォーマンスデータを収集および保存、統計情報を抽出し、これをユーザーに効率的な方法で提供します。収集サーバーはリージョン（Region）別に設定できます。リージョンごとに収集サーバーのアドレスが異なるように割り当てます。ユーザーが選択したリージョンによって収集サーバーのアドレスは異なる場合があります。プロジェクトを作成する際、リージョンも設定します。

- **基本エージェント**

  Queryベースでパフォーマンスデータを収集し、サーバーに送信します。モニタリング対象データベースサーバーに直接エージェントをインストールすることなく、モニタリングが可能です。

- **追加エージェント**(**XOS Agent**)

  <ImgLang img='agent-xos-architecture.png' desc='XOSエージェントの構成図' />

  XOSエージェントは、データベースサーバーのプロセス使用量をモニタリングできる付加オプションエージェントです。データベースサーバーのプロセス使用量をモニタリングする場合は、データベースサーバーに別のエージェントを実行しデータを収集できます。

  :::note

  XOSエージェントは、x86アーキテクチャベースで動作するOS環境のみ適用できます。

  :::

- **ネットワーク**

  - 基本エージェント：WhaTapのモニタリングエージェントは、収集したモニタリング情報をWhaTap収集サーバーに転送するために外部通信（TCP）6600番ポートを使用します。

  - XOSエージェント：エージェントをインストールしたサーバーとデータベースサーバーの間に外部通信(UDP)3002番ポートを使用します。内部ポートが衝突する場合は、`dbx_port`オプションを使用してポートを変更します。

## エージェント構成ファイル

| ファイル名                          | 説明                                                                                                                                                                                           |
| ------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| whatap.conf                    | データベースサーバーのデータを収集する収集サーバーのアドレスとサーバーのプロジェクトアクセスキーを入力するファイルです。                                                                                                                                 |
| alert/alert.conf               | 収集するモニタリング項目にしきい値を設定するファイルです。しきい値を超えると通知イベントが発生します。                                                                                                                                          |
| scripts/                       | リモートでSQLスクリプトを実行できるスクリプトのディレクトリです。                                                                                                                                                           |
| ps.sh                          | プロセスIDを読み込むスクリプトです。エージェントプロセスを終了する場合は、そのIDを参照します。                                                                                                                                            |
| stop.sh                        | エージェントプロセスを終了するときに使用するスクリプトです。                                                                                                                                                               |
| uid.sh (uid.bat)               | データベースの接続情報を組み合わせて暗号化されたUIDを生成するためのシェルスクリプトファイルです。_db.user_ファイルを作成します。最初に一度だけ設定すると、暗号化されたUIDを通じてモニタリング対象データベースサーバーからデータが収集されます。<br/>モニタリング用アカウント作成の詳細については、[次の文書](install-agent#uid)を参照ください。 |
| start.sh (start.bat)           | エージェント実行用のシェルスクリプトファイルです。エージェントを実行すると、データベースサーバーからのモニタリング情報の収集が開始されます。                                                                                                                       |
| startd.sh (startd.bat)         | エージェント実行用のシェルスクリプトファイルでバックグラウンドで実行できます。                                                                                                                                                      |
| whatap.agent.dbx-`VERSION`.jar | Tracerプログラムは、データベースサーバーの情報を収集し、収集した情報をサーバーに送信するプログラムです。                                                                                                                                      |
| jdbc                           | データベースサーバー接続のために参照するライブラリを収集するディレクトリです。エージェントをデータベースサーバーに接続するためのライブラリを直接ダウンロードし、javaのclasspathオプションにパスを設定して使用します。                                                                            |
| xos                            | データベースサーバーのプロセス使用量をモニタリングできるオプションのエージェントを含むディレクトリです。                                                                                                                                         |
| xos/xos.conf                   | データベースサーバーのプロセス使用状況のデータを収集およびデータ転送をするためのエージェントサーバーのアドレスと通信ポートを入力するファイルです。                                                                                                                    |
