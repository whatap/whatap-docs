### PHP 追加 ini スキャンディレクトリを認識できない問題

PHP を `--with-config-file-scan-dir=PATH` オプションなしでコンパイルした場合、追加 ini スキャンディレクトリが検出されず、設定ファイルが読み込まれない問題が発生します。

#### 確認方法

* **Linux/FreeBSD**
```bash
$ sudo php -i | grep '.ini files'

Scan this dir for additional .ini files => (none)
```

* **Windows**
```cmd
php --ini
```

#### 解決方法

*whatap.ini* の内容を *php.ini* の最後に追加します。

##### Linux

```bash
$ php -i | grep 'php.ini'

Loaded Configuration File => /etc/php.ini

$ sudo vi php.ini

# ファイルの最後に追加
[whatap]
;Enable whatap extension module
extension=whatap.so
whatap.ext.error_enabled=true
whatap.ext.exception_enabled=true
whatap.trace_user_enabled=true
whatap.trace_user_using_ip=false
```

その他の設定は */usr/whatap/php/whatap.ini* を参照してください。

##### Windows

```cmd
REM whatap.ini の内容を php.ini に追加
type "C:\Program Files\WhaTap\PHP\template.ini" >> C:\PHP\php.ini

REM または手動で編集
notepad C:\PHP\php.ini
```

* **php.ini に追加する内容（Windows例）**
```ini
[whatap]
extension=php_whatap.dll

# 詳細設定は C:\Program Files\WhaTap\PHP\whatap.ini を参照
```

#### whatap-php サービス用の環境変数設定

`$WHATAP_CONFIG_HOME` 環境変数に *whatap.ini* のパスを設定します。

PHP が追加 ini ディレクトリを検出できない場合は、*whatap.ini* を作成した */usr/whatap/php* を設定してください。

```bash
$ sudo vi /etc/init.d/whatap-php

export WHATAP_CONFIG_HOME=      # whatap.ini のディレクトリ（例：/etc/php.d）
```

#### サービス再起動

* Apache および PHP-FPM の再起動  
* whatap-php サービスの再起動

#### Error: Not found PHP API

PHP CLI コマンドを見つけられない場合に発生します。

[PHP CLI の位置](#check-php-cli-path) を正しく確認し、  
[PHP 拡張モジュールおよび whatap-php サービスの手動設定](#extension-modul-manual-setting) を実行してください。

##### Linux

```bash title='Check PHP API version'
$ sudo php -i | grep 'PHP API'

PHP API => 20100412
```

##### Windows

```cmd
REM PHP の場所を確認
where php

REM PATH 環境変数に PHP のパスを追加
setx PATH "%PATH%;C:\PHP"

REM またはシステム環境変数で直接追加
sysdm.cpl → 詳細設定 → 環境変数 → PATH 編集
```