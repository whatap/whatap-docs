"use strict";(self.webpackChunkwhatap_docs=self.webpackChunkwhatap_docs||[]).push([["3027"],{86486:function(e,n,t){t.r(n),t.d(n,{metadata:()=>a,default:()=>d,frontMatter:()=>o,contentTitle:()=>r,toc:()=>h,assets:()=>l});var a=JSON.parse('{"id":"kubernetes/agent-troubleshooting","title":"Agent troubleshooting","description":"You can check the problems that may occur during the agent installation.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/kubernetes/agent-troubleshooting.mdx","sourceDirName":"kubernetes","slug":"/kubernetes/agent-troubleshooting","permalink":"/whatap-docs/en/kubernetes/agent-troubleshooting","draft":false,"unlisted":false,"editUrl":"undefined/docs/kubernetes/agent-troubleshooting.mdx","tags":[],"version":"current","frontMatter":{"id":"agent-troubleshooting","title":"Agent troubleshooting","description":"You can check the problems that may occur during the agent installation.","toc_max_heading_level":2,"keywords":["Kubernetes","Kubernetes Monitoring","Troubleshooting","Troubleshooting","Agent issues"],"isTranslationMissing":false},"sidebar":"kubeSidebar","previous":{"title":"Creating a namespace project","permalink":"/whatap-docs/en/kubernetes/create-name-space-project"},"next":{"title":"\uC124\uC815\uD558\uAE30","permalink":"/whatap-docs/en/kubernetes/set-agent"}}'),i=t(74848),s=t(84429);let o={id:"agent-troubleshooting",title:"Agent troubleshooting",description:"You can check the problems that may occur during the agent installation.",toc_max_heading_level:2,keywords:["Kubernetes","Kubernetes Monitoring","Troubleshooting","Troubleshooting","Agent issues"],isTranslationMissing:!1},r,l={},h=[{value:"Installation troubleshooting based on the Helm chart",id:"troubleshooting-helm-chart",level:2},{value:"In case there is a <code>whatap</code> Helm repository with the same name",id:"in-case-there-is-a-whatap-helm-repository-with-the-same-name",level:3},{value:"In case there is another namespace named <code>whatap-monitoring</code> in the cluster",id:"in-case-there-is-another-namespace-named-whatap-monitoring-in-the-cluster",level:3},{value:"In case the <code>clusterrole</code> and <code>clusterrolebinding</code> resources exist in the cluster",id:"in-case-the-clusterrole-and-clusterrolebinding-resources-exist-in-the-cluster",level:3},{value:"In case the <code>whatap-monitoring</code> namespace is unavailable",id:"whatap-monitoring-namespace-unavailable",level:3},{value:"Preparation",id:"preparation",level:4},{value:"Installation procedure",id:"installation-procedure",level:4},{value:"Updating and deleting",id:"updating-and-deleting",level:4},{value:"Troubleshooting issues that occur when starting the agent",id:"troubleshooting-agent",level:2},{value:"In case of installation of WhaTap Kubernetes Monitoring via an old YAML file",id:"in-case-of-installation-of-whatap-kubernetes-monitoring-via-an-old-yaml-file",level:3},{value:"Solution",id:"solution",level:4},{value:"In case the agent is not installed properly due to DockerHub&#39;s image pull limit",id:"troubleshooting-pull-limit",level:3},{value:"Viewing errors",id:"viewing-errors",level:4},{value:"Lookup result",id:"lookup-result",level:4},{value:"Troubleshooting the application integration issues",id:"troubleshooting-k8s-application",level:2},{value:"In case the Java monitoring data is not displayed in the container map",id:"in-case-the-java-monitoring-data-is-not-displayed-in-the-container-map",level:3},{value:"Solution",id:"solution-1",level:4},{value:"Agent Update",id:"agent-update",level:5},{value:"Configuring additional environment variables",id:"configuring-additional-environment-variables",level:5},{value:"How to check mapping between the container and APM",id:"how-to-check-mapping-between-the-container-and-apm",level:4}];function c(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",table:"table",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components},{Cmdname:t}=n;return t||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Cmdname",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"troubleshooting-helm-chart",children:"Installation troubleshooting based on the Helm chart"}),(0,i.jsxs)("div",{class:"faq",children:[(0,i.jsxs)(n.h3,{id:"in-case-there-is-a-whatap-helm-repository-with-the-same-name",children:["In case there is a ",(0,i.jsx)(n.code,{children:"whatap"})," Helm repository with the same name"]}),(0,i.jsx)(n.table,{children:(0,i.jsx)(n.thead,{children:(0,i.jsx)(n.tr,{children:(0,i.jsx)(n.th,{children:'"whatap" already exists with the same configuration, skipping'})})})}),(0,i.jsxs)(n.p,{children:["If another ",(0,i.jsx)(n.code,{children:"whatap"})," repository with the same name already exists, delete the existing ",(0,i.jsx)(n.code,{children:"whatap"})," repository by using the following command and then proceed with installation."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"helm repo remove whatap\n"})}),(0,i.jsxs)(n.h3,{id:"in-case-there-is-another-namespace-named-whatap-monitoring-in-the-cluster",children:["In case there is another namespace named ",(0,i.jsx)(n.code,{children:"whatap-monitoring"})," in the cluster"]}),(0,i.jsx)(n.table,{children:(0,i.jsx)(n.thead,{children:(0,i.jsx)(n.tr,{children:(0,i.jsx)(n.th,{children:'Error: INSTALLATION FAILED: Unable to continue with install: Namespace "whatap-monitoring" in namespace "" exists and cannot be imported into the current release'})})})}),(0,i.jsxs)(n.p,{children:["If the ",(0,i.jsx)(n.code,{children:"whatap-monitoring"})," namespace exists in the cluster, it is because the user has already installed the Whatap Kubernetes agent based on the ",(0,i.jsx)(n.em,{children:"yaml"})," file. In this case, delete the existing ",(0,i.jsx)(n.code,{children:"whatap-monitoring"})," namespace and related resources by using the following commands."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"kubectl delete namespace whatap-monitoring\nkubectl delete clusterrolebinding whatap\nkubectl delete clusterrole whatap\n"})}),(0,i.jsxs)(n.h3,{id:"in-case-the-clusterrole-and-clusterrolebinding-resources-exist-in-the-cluster",children:["In case the ",(0,i.jsx)(n.code,{children:"clusterrole"})," and ",(0,i.jsx)(n.code,{children:"clusterrolebinding"})," resources exist in the cluster"]}),(0,i.jsx)(n.table,{children:(0,i.jsx)(n.thead,{children:(0,i.jsx)(n.tr,{children:(0,i.jsx)(n.th,{children:'Error: INSTALLATION FAILED: Unable to continue with install: ClusterRole "whatap" in namespace "" exists and cannot be imported into the current release'})})})}),(0,i.jsxs)(n.p,{children:["If the ",(0,i.jsx)(n.code,{children:"clusterrole"})," and ",(0,i.jsx)(n.code,{children:"clusterrolebinding"})," resources already exist in the cluster, delete them by using the following commands."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"kubectl delete clusterrolebinding whatap\nkubectl delete clusterrole whatap\n"})}),(0,i.jsxs)(n.h3,{id:"whatap-monitoring-namespace-unavailable",children:["In case the ",(0,i.jsx)(n.code,{children:"whatap-monitoring"})," namespace is unavailable"]}),(0,i.jsxs)(n.p,{children:["By default, the WhaTap Kubernetes agent is installed in the ",(0,i.jsx)(n.code,{children:"whatap-monitoring"})," namespace. However, if the namespace is unavailable or you need to specify a specific namespace, follow the steps below to install the agent in the desired namespace."]}),(0,i.jsx)(n.h4,{id:"preparation",children:"Preparation"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cart version"}),": whatap/kube 1.7.11 or later"]}),"\n",(0,i.jsx)(n.p,{children:"Check the chart version by using the following command."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm search repo whatap/kube --versions\n"})}),"\n",(0,i.jsx)(n.p,{children:"If the version is less than 1.7.11, update the chart version by using the following command."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm repo update\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Helm version"}),": Helm 3 or later"]}),"\n"]}),"\n"]}),(0,i.jsx)(n.h4,{id:"installation-procedure",children:"Installation procedure"}),(0,i.jsxs)(n.p,{children:["Install the agent by executing the following command, after entering the namespace to use in ",(0,i.jsx)(n.code,{children:"<namespace>"}),"."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm install whatap-kube-agent whatap/kube --create-namespace --namespace <namespace> --set namespaceOverrideEnabled=true --wait -f values.yaml\n"})}),(0,i.jsx)(n.h4,{id:"updating-and-deleting",children:"Updating and deleting"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Update"})}),"\n",(0,i.jsx)(n.p,{children:"Execute the following command to update the agent."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm update whatap-kube-agent whatap/kube --namespace <namespace> --wait\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Delete"})}),"\n",(0,i.jsx)(n.p,{children:"Execute the following command to remove the agent."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm uninstall whatap-kube-agent whatap/kube --namespace <namespace>\n"})}),"\n"]}),"\n"]})]}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"troubleshooting-agent",children:"Troubleshooting issues that occur when starting the agent"}),(0,i.jsxs)("div",{class:"faq",children:[(0,i.jsx)(n.h3,{id:"in-case-of-installation-of-whatap-kubernetes-monitoring-via-an-old-yaml-file",children:"In case of installation of WhaTap Kubernetes Monitoring via an old YAML file"}),(0,i.jsx)(n.table,{children:(0,i.jsx)(n.thead,{children:(0,i.jsx)(n.tr,{children:(0,i.jsxs)(n.th,{children:["Unrecognized VM option 'UseCGroupMemoryLimitForHeap'",(0,i.jsx)("br",{}),"Error: Could not create the Java Virtual Machine.",(0,i.jsx)("br",{}),"Error: A fatal exception has occurred. Program will exit."]})})})}),(0,i.jsxs)(n.p,{children:["If you installed WhaTap Kubernetes Monitoring via the installation ",(0,i.jsx)(n.em,{children:"yaml"})," downloaded before ",(0,i.jsx)(n.strong,{children:"August 24, 2022"}),", you may encounter an error or failure to start the node agent (whatap-node-agent)."]}),(0,i.jsxs)(n.p,{children:["Possible causes are as follows. The installation ",(0,i.jsx)(n.em,{children:"yaml"})," file downloaded before August 24, 2022 contains a node agent launch script using the ",(0,i.jsx)(n.code,{children:"UseCGroupMemoryLimitForHeap"})," JVM option."]}),(0,i.jsxs)(n.p,{children:["Starting from WhaTap node agent ",(0,i.jsx)(n.strong,{children:"1.2.0"})," (released on November 21, 2022), the JDK used in the agent has been upgraded, and the upgraded JDK version no longer provides the ",(0,i.jsx)(n.code,{children:"UseCGroupMemoryLimitForHeap"})," option. If you run the node agent 1.2.0 or later with the WhaTap Kubernetes Monitoring installed using a ",(0,i.jsx)(n.em,{children:"yaml"})," file downloaded before ",(0,i.jsx)(n.strong,{children:"August 24, 2022"}),", the startup fails with the message ",(0,i.jsx)(n.code,{children:"Unrecognized VM option 'UseCGroupMemoryLimitForHeap\u2019"}),"."]}),(0,i.jsx)(n.h4,{id:"solution",children:"Solution"}),(0,i.jsx)(n.p,{children:"To resolve this issue, reinstall the Kubernetes monitoring as follows:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Download the latest ",(0,i.jsx)(n.em,{children:"YAML"})," file by using ",(0,i.jsx)(t,{sid:"side_management",className:"uitext"})," > ",(0,i.jsx)(t,{sid:"agentInstall",className:"uitext"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Install the agent by using the ",(0,i.jsx)(n.em,{children:"yaml"})," file downloaded from the Kubernetes environment."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check whether any errors are output during installation in the Kubernetes environment."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Make sure the WhaTap monitoring agent Pod is in Running state."}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.mdxAdmonitionTitle,{}),(0,i.jsxs)(n.p,{children:["Check the Kubernetes environment and the ",(0,i.jsx)(t,{sid:"side_workload",className:"uitext"})," > ",(0,i.jsx)(t,{sid:"side_podList",className:"uitext"})," menu."]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Check the logs generated by each monitoring agent through ",(0,i.jsx)(t,{sid:"side_management",className:"uitext"})," > ",(0,i.jsx)(t,{sid:"side_kubernetesAgentList",className:"uitext"})]}),"\n"]}),"\n"]}),(0,i.jsx)(n.h3,{id:"troubleshooting-pull-limit",children:"In case the agent is not installed properly due to DockerHub's image pull limit"}),(0,i.jsx)(n.p,{children:"If you pull images from multiple nodes simultaneously, the installation may fail with an error as follows. If you encounter any problem, reinstall with the following command by changing the image in yaml."}),(0,i.jsx)(n.h4,{id:"viewing-errors",children:"Viewing errors"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"kubectl describe pod/<WhaTap k8s agent's Pod name> -n whatap-monitoring\n"})}),(0,i.jsx)(n.h4,{id:"lookup-result",children:"Lookup result"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'> > Failed to pull image "whatap/kube_mon:latest": rpc error: code = Unknown desc = toomanyrequests: You have reached your pull rate limit. Please try again later or log in to increase your rate limit.\n'})}),(0,i.jsxs)(n.p,{children:["In this case, change the DockerHub image in the ",(0,i.jsx)(n.code,{children:"yaml"})," file to the public.ecr.aws repository and then reinstall it."]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["If you downloaded the default installation yaml from the agent installation screen, you can change the image with the following command. When executing the command, the existing dockerHub image in yaml is replaced with the image of the ",(0,i.jsx)(n.a,{href:"http://public.ecr.aws",children:"public.ecr.aws"})," repository."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"sed -i 's|image: \"whatap/kube_mon|image: \"public.ecr.aws/whatap/kube_mon|g' kube_agent.yaml\n"})}),"\n"]}),"\n"]})]})]}),"\n",(0,i.jsx)(n.section,{className:"remark-sectionize-h2",children:(0,i.jsx)(n.h2,{id:"troubleshooting-k8s-application",children:"Troubleshooting the application integration issues"})}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"in-case-the-java-monitoring-data-is-not-displayed-in-the-container-map",children:"In case the Java monitoring data is not displayed in the container map"}),(0,i.jsxs)(n.p,{children:["Depending on the configuration and management for Cgroups in your Kubernetes environment, you may encounter the issues with obtaining container IDs in specific situations. To address this situation, WhaTap changed the mapping mechanism between the containers and applications for Kubernetes monitoring. This change applies to WhaTap ",(0,i.jsx)(n.strong,{children:"Kubernetes Agent 1.7.7"})," and ",(0,i.jsx)(n.strong,{children:"Java Agent 2.2.42"}),", and addresses the issue where container IDs are missing due to Cgroups."]})]}),"\n",(0,i.jsx)(n.section,{className:"remark-sectionize-h4",children:(0,i.jsx)(n.h4,{id:"solution-1",children:"Solution"})}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h5",children:[(0,i.jsx)(n.h5,{id:"agent-update",children:"Agent Update"}),(0,i.jsxs)(n.p,{children:["To resolve container ID identification issues in the Kubernetes environment, use the latest version that supports accurate identification of data exchanged between the WhaTap Kubernetes agent and APM. Install ",(0,i.jsx)(n.strong,{children:"Kubernetes Agent"})," ",(0,i.jsx)(n.strong,{children:"1.7.7 or later"})," and ",(0,i.jsx)(n.strong,{children:"Java Agent"})," ",(0,i.jsx)(n.strong,{children:"2.2.42 or later"}),"."]}),(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"Currently only the Java agents are supported, and APMs for other languages are supported in the future."})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h5",children:[(0,i.jsx)(n.h5,{id:"configuring-additional-environment-variables",children:"Configuring additional environment variables"}),(0,i.jsxs)(n.p,{children:["If Java application information does not appear in ",(0,i.jsx)(t,{sid:"side_containerMap",className:"uitext"})," even after updating the agent version, you can solve the problem by adding user environment variables. This setting adds the ",(0,i.jsx)(n.code,{children:"WHATAP_JAVA_AGENT_PATH"})," option to the container manifest (",(0,i.jsx)(n.em,{children:"yaml"}),") environment variable where the Java APM has been installed, indicating the absolute path to the Java agent within the container."]}),(0,i.jsx)(n.p,{children:"The following is an example of adding the corresponding option to the container environment variables where the Java APM has been installed."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-YAML",children:'env:\n- name: NODE_IP\n  valueFrom: {fieldRef: {fieldPath: status.hostIP}}\n- name: NODE_NAME\n  valueFrom: {fieldRef: {fieldPath: spec.nodeName}}\n- name: POD_NAME\n  valueFrom: {fieldRef: {fieldPath: metadata.name}}\n- name: OKIND\n  value: {YOUR_OKIND_NAME}\n- name: license\n  value: <Project Access Key>\n- name: whatap.server.host\n  value: <collection server IP address>\n- name: whatap.micro.enabled\n  value: "true"\n- name: WHATAP_JAVA_AGENT_PATH\n  value: "/whatap/whatap.agent-2.2.35.jar"\n'})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h4",children:[(0,i.jsx)(n.h4,{id:"how-to-check-mapping-between-the-container-and-apm",children:"How to check mapping between the container and APM"}),(0,i.jsx)(n.p,{children:"The following explains how to check that the container and applications are mapped correctly."}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["If any white micro container exists inside the ",(0,i.jsx)(t,{sid:"side_containerMap",className:"uitext"})," block in ",(0,i.jsx)(t,{sid:"side_dashboard",className:"uitext"})," > ",(0,i.jsx)(t,{sid:"side_containerMap",className:"uitext"}),", it indicates a normal mapping."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In ",(0,i.jsx)(t,{sid:"side_analysis",className:"uitext"})," > ",(0,i.jsx)(t,{sid:"side_metricsSearch",className:"uitext"}),", if the ",(0,i.jsx)(n.code,{children:"container"})," field for the ",(0,i.jsx)(n.code,{children:"app_counter"})," category contains the container ID in which the application is running, the mapping is successful."]}),"\n"]}),"\n"]})]})]})}function d(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},84429:function(e,n,t){t.d(n,{R:()=>o,x:()=>r});var a=t(96540);let i={},s=a.createContext(i);function o(e){let n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);