"use strict";(self.webpackChunkwhatap_docs=self.webpackChunkwhatap_docs||[]).push([["78116"],{27963:function(e,n,s){s.r(n),s.d(n,{metadata:()=>t,default:()=>h,frontMatter:()=>a,contentTitle:()=>c,toc:()=>o,assets:()=>l});var t=JSON.parse('{"id":"java/agent-dbsql","title":"DB, SQL","description":"The following provides various options for Java agents to handle the database and collect SQL performance data. They can trace various DB connection pools such as DBCP, Hikari, and Tomcat and record SQL execution details. Additionally, it provides information collection options for performance optimization, such as recording SQL parameters and tracing DB connection leaks.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/java/agent-dbsql.mdx","sourceDirName":"java","slug":"/java/agent-dbsql","permalink":"/whatap-docs/en/java/agent-dbsql","draft":false,"unlisted":false,"editUrl":"undefined/docs/java/agent-dbsql.mdx","tags":[],"version":"current","frontMatter":{"id":"agent-dbsql","title":"DB, SQL","description":"The following provides various options for Java agents to handle the database and collect SQL performance data. They can trace various DB connection pools such as DBCP, Hikari, and Tomcat and record SQL execution details. Additionally, it provides information collection options for performance optimization, such as recording SQL parameters and tracing DB connection leaks.","keywords":["Java","Application","DB","SQL","Agent"],"isTranslationMissing":false},"sidebar":"javaSidebar","previous":{"title":"Transactions","permalink":"/whatap-docs/en/java/agent-transaction"},"next":{"title":"HTTPC, API Call","permalink":"/whatap-docs/en/java/agent-httpcapicall"}}'),i=s(74848),r=s(84429);let a={id:"agent-dbsql",title:"DB, SQL",description:"The following provides various options for Java agents to handle the database and collect SQL performance data. They can trace various DB connection pools such as DBCP, Hikari, and Tomcat and record SQL execution details. Additionally, it provides information collection options for performance optimization, such as recording SQL parameters and tracing DB connection leaks.",keywords:["Java","Application","DB","SQL","Agent"],isTranslationMissing:!1},c,l={},o=[];function d(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{ScrollToLink:s}=n;return s||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("ScrollToLink",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"The following provides various options for Java agents to handle the database and collect SQL performance data. They can trace various DB connection pools such as DBCP, Hikari, and Tomcat and record SQL execution details. Additionally, it provides information collection options for performance optimization, such as recording SQL parameters and tracing DB connection leaks."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"dbcp_pool_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsx)(n.p,{children:"It is used to trace DB connection data of DBCP without using JMX."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"hikari_pool_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:"It is used to trace DB connection data of the hikari pool without using JMX."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"tomcat_ds_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:"It enables the function to trace Tomcat DB connection pool data without using JMX."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"tomcat_pool_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsx)(n.p,{children:"It enables the function to trace Tomcat DB connection pool data without using JMX."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"weblogic_ds_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:"It enables the function to trace the Weblogic DB connection pool data by using JMX."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"weblogic_pool_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsx)(n.p,{children:"It enables the function to trace the Weblogic DB connection pool data without using JMX."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"jeus_pool_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsx)(n.p,{children:"It enables the function to trace the JEUS DB connection pool data without using JMX."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"profile_connection_open_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsx)(n.p,{children:"It records DB connection open data in the trace details."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"trace_dbc_close_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})," ",(0,i.jsx)("code",{class:"my",children:"Java Agent v2.2.3 or later"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsxs)(n.p,{children:["It works only when ",(0,i.jsx)(n.code,{children:"profile_connection_open_enabled"})," is ",(0,i.jsx)(n.code,{children:"true"}),". DB connection close-up data is recorded in the transaction trace details."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"For versions earlier than Java Agent 2.2.3"}),", use the ",(0,i.jsx)(n.code,{children:"profile_dbc_close"})," option name."]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"profile_sql_param_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"}),(0,i.jsx)(s,{anchor:"profile-sql-param"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:"It is used to record SQL parameters in the transaction trace details. The parameters can be viewed by entering a separate security key."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Earlier than Java Agent 2.2.2"}),": The security key is written in the WAS server ",(0,i.jsxs)(n.em,{children:[(0,i.jsx)(n.code,{children:"${WHATAP_AGENT_HOME}"}),"/paramkey.txt"]})," file with a 6-letter value. If the ",(0,i.jsx)(n.em,{children:"paramkey.txt"})," file does not exist, it is automatically created with a random value."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Java Agent 2.2.2 or later"}),": For the security key, check the ",(0,i.jsx)(n.code,{children:"paramkey"})," key value in the WAS server ",(0,i.jsxs)(n.em,{children:[(0,i.jsx)(n.code,{children:"${WHATAP_AGENT_HOME}"}),"/security.conf"]})," file. If the ",(0,i.jsx)(n.em,{children:"security.conf"})," file does not exist, the ",(0,i.jsx)(n.code,{children:"paramkey"})," key value is automatically created as ",(0,i.jsx)(n.strong,{children:"WHATAP"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["For more information about the security key configuration file, see ",(0,i.jsx)(n.a,{href:"install-agent#security",children:"the following"}),"."]}),"\n"]}),"\n"]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"profile_sql_resource_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:"It traces the CPU and memory usages during collection of SQLs in the transaction trace."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"profile_update_count"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsxs)(n.p,{children:["It collects the number of updates when SQL update statements have been executed through the ",(0,i.jsx)(n.code,{children:"executeUpdate()"})," method."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"custom_pool_classes"})," ",(0,i.jsx)("span",{class:"type",children:"String"})]}),"\n",(0,i.jsx)(n.p,{children:"When using a separate connection pool that has not been defined previously, set the class name."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"ds_update_interval"})," ",(0,i.jsx)("span",{class:"type",children:"MiliSeconds"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"5000"})]}),"\n",(0,i.jsx)(n.p,{children:"Set the interval for counting DB connection data."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"profile_position_sql"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:"It records the stack traces when SQL statements are executed."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"profile_sql_param_length"})," ",(0,i.jsx)("span",{class:"type",children:"Int"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"40"})]}),"\n",(0,i.jsx)(n.p,{children:"Set the length of the SQL parameter."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"The maximum value is 128. Even if you enter a number than this value, parameters are saved up to 128 bits."})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"trace_dbc_leak_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:"It enables to trace DB connection leaks."}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsx)(n.p,{children:"Because leaks are traced using the connection wrapper, be sure to apply it after a test as it can affect the operation services."})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"trace_dbc_leak_fullstack_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:"When any DB connection leak is detected, it collects stack traces at this time."}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsx)(n.p,{children:"Do not apply this at the peak time, if possible. If the option is applied, the CPU usage may increase slightly. It is recommended to apply it temporarily for troubleshooting purposes only."})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"trace_sql_normalize_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsx)(n.p,{children:"It enables the function to normalize any SQL statements by extracting the literal part from each SQL statement."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"profile_error_jdbc_fetch_max"})," ",(0,i.jsx)("span",{class:"type",children:"Int"})," ",(0,i.jsx)(s,{anchor:"profile_error_jdbc_fetch_max"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"10000"})]}),"\n",(0,i.jsxs)(n.p,{children:["When the SQL Fetch Count (the number of ",(0,i.jsx)(n.code,{children:"ResultSet.next()"})," calls) exceeds the set value, it is treated as the ",(0,i.jsx)(n.strong,{children:"TOO_MANY_RECORDS"})," error. If it is set to ",(0,i.jsx)(n.code,{children:"0"}),", it is not treated as an error."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"profile_error_sql_time_max"})," ",(0,i.jsx)("span",{class:"type",children:"Int"})," ",(0,i.jsx)(s,{anchor:"profile_error_sql_time_max"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"30000"})]}),"\n",(0,i.jsxs)(n.p,{children:["When the SQL execution time exceeds the set value, it is treated as the ",(0,i.jsx)(n.strong,{children:"SLOW_SQL"})," error. If it is set to ",(0,i.jsx)(n.code,{children:"0"}),", it is not treated as an error."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"hook_connection_open_patterns"})," ",(0,i.jsx)("span",{class:"type",children:"String"})]}),"\n",(0,i.jsx)(n.p,{children:"It registers the method to call upon DB connection open. It is common to register getConnection of any connection pool that has not been set."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",metastring:"title='Example'",children:"hook_connection_open_patterns=mypool.ConPool.getConnection\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"hook_jdbc_con_classes"})," ",(0,i.jsx)("span",{class:"type",children:"String"})]}),"\n",(0,i.jsx)(n.p,{children:"Set an unregistered JDBC connection class."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",metastring:"title='Example'",children:"hook_jdbc_con_classes=mypool.ConPool\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"hook_jdbc_pstmt_classes"})," ",(0,i.jsx)("span",{class:"type",children:"String"})]}),"\n",(0,i.jsx)(n.p,{children:"Set an unregistered JDBC PreparedStatement class. Note that it must be a structure where the SQL string is delivered to the creator parameter."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",metastring:"title='Example'",children:"hook_jdbc_pstmt_classes=org.apache.derby.impl.jdbc.EmbedPreparedStatement\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"hook_jdbc_cstmt_classes"})," ",(0,i.jsx)("span",{class:"type",children:"String"})]}),"\n",(0,i.jsx)(n.p,{children:"Set an unregistered JDBC CallableStatement class."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",metastring:"title='Example'",children:"hook_jdbc_cstmt_classes=org.apache.derby.impl.jdbc.EmbedCallableStatement\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"hook_jdbc_stmt_classes"})," ",(0,i.jsx)("span",{class:"type",children:"String"})]}),"\n",(0,i.jsx)(n.p,{children:"Set an unregistered JDBC statement class."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",metastring:"title='Example'",children:"hook_jdbc_stmt_classes=org.apache.derby.impl.jdbc.EmbedStatement\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"hook_jdbc_rs_classes"})," ",(0,i.jsx)("span",{class:"type",children:"String"})]}),"\n",(0,i.jsx)(n.p,{children:"Set an unregistered JDBC result set class."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",metastring:"title='Example'",children:"hook_jdbc_rs_classes=org.apache.derby.impl.jdbc.EmbedResultSet\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"hook_jdbc_wrapping_driver_patterns"})," ",(0,i.jsx)("span",{class:"type",children:"String"})]}),"\n",(0,i.jsxs)(n.p,{children:["The obfuscated JDBC driver like the DB2 driver is difficult to directly perform BCI with the ",(0,i.jsx)(n.code,{children:"hook_jdbc_xxx"})," option. In this case, SQLs can be traced with the wrapper method. At this time, set ",(0,i.jsx)(n.code,{children:"Driver.connect"})," for tracing."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"debug_dbc_stack_enabled"})," ",(0,i.jsx)("span",{class:"type",children:"Boolean"})]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsx)(n.p,{children:"StackTrace is saved in the transaction trace at the time of DB connection. It is used to obtain connection pool information that is used by applications."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"ignore_sql_hash_set"})," ",(0,i.jsx)("span",{class:"type",children:"String"})," ",(0,i.jsx)("code",{class:"my",children:"Java Agent v2.2.4 or later"})]}),"\n",(0,i.jsx)(n.p,{children:"You can set to ignore the SQL statements that match the SQL hash value in the option."}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},84429:function(e,n,s){s.d(n,{R:()=>a,x:()=>c});var t=s(96540);let i={},r=t.createContext(i);function a(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);