"use strict";(self.webpackChunkwhatap_docs=self.webpackChunkwhatap_docs||[]).push([["53859"],{84487:function(e,n,r){r.d(n,{Ay:()=>t,RM:()=>o});var s=r(74848),i=r(84429);let o=[{value:"Firewall configuration checking",id:"firewall-configuration-checking",level:2}];function a(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",section:"section",strong:"strong",...(0,i.R)(),...e.components};return(0,s.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,s.jsx)(n.h2,{id:"firewall-configuration-checking",children:"Firewall configuration checking"}),(0,s.jsxs)(n.p,{children:["If the TCP outbound policy for the WhaTap data collection server has not been set, monitoring data cannot be transferred. ",(0,s.jsx)(n.strong,{children:"Deselect"})," the ",(0,s.jsx)(n.strong,{children:"firewall blocking"}),"."]}),(0,s.jsxs)(n.p,{children:["Use the ",(0,s.jsx)(n.code,{children:"telnet"}),' command to check "Connected to ',(0,s.jsx)(n.code,{children:"IP"}),'."']}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"$ telnet 52.193.60.176 6600\nTrying 52.193.60.176...\nConnected to 52.193.60.176.\nEscape character is '^]'.\n"})}),(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["For the connection server details, select a desired project in ",(0,s.jsx)(n.a,{href:"https://service.whatap.io/",children:"WhaTap Monitoring Service"}),", and then check in ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.em,{children:"Management"})})," > ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.em,{children:"Agent Installation"})}),"."]})})]})}function t(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},98244:function(e,n,r){r.r(n),r.d(n,{metadata:()=>s,default:()=>A,frontMatter:()=>v,contentTitle:()=>b,toc:()=>S,assets:()=>y});var s=JSON.parse('{"id":"java/agent-troubleshooting","title":"Troubleshooting","description":"The following provides various problems that may occur during installation of a Java agent and detailed instructions for resolving them. It provides solutions to various issues such as firewall settings, SpringBoot and Tomcat JMX settings, server settings for use of the OSGI framework, Log Manager and MBeanServerBuilder errors, Permission errors, and Sigar library problems.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/java/agent-troubleshooting.mdx","sourceDirName":"java","slug":"/java/agent-troubleshooting","permalink":"/whatap-docs/en/java/agent-troubleshooting","draft":false,"unlisted":false,"editUrl":"undefined/docs/java/agent-troubleshooting.mdx","tags":[],"version":"current","frontMatter":{"id":"agent-troubleshooting","title":"Troubleshooting","description":"The following provides various problems that may occur during installation of a Java agent and detailed instructions for resolving them. It provides solutions to various issues such as firewall settings, SpringBoot and Tomcat JMX settings, server settings for use of the OSGI framework, Log Manager and MBeanServerBuilder errors, Permission errors, and Sigar library problems.","toc_max_heading_level":2,"keywords":["Java","Troubleshooting","Troubleshooting"],"isTranslationMissing":false},"sidebar":"javaSidebar","previous":{"title":"Installation checking items","permalink":"/whatap-docs/en/java/install-check"},"next":{"title":"Agent CONFIG.","permalink":"/whatap-docs/en/java/set-agent"}}'),i=r(74848),o=r(84429),a=r(84487);function t(e){let n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",section:"section",...(0,o.R)(),...e.components};return(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"springboot-22-or-later-tomcat-jmx-off",children:"SpringBoot 2.2 or later, Tomcat JMX off"}),(0,i.jsxs)(n.p,{children:["If the embedded Tomcat is used in SpringBoot 2.2 or later, the JMX functions do not work with the default settings. In this case, activate the JMX functions. Please refer to the ",(0,i.jsx)(n.a,{href:"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.2-Release-Notes#jmx-now-disabled-by-default",children:"related document"}),"."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-properties",metastring:"title='application.properties'",children:"spring.jmx.enabled=true\nserver.tomcat.mbeanregistry.enabled=true # tomcat embedded\uC778 \uACBD\uC6B0 #\n"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",metastring:"title='application.yml'",children:"spring:\n  jmx:\n    enabled: true\nserver:\n  tomcat:\n    mbeanregistry:\n      enabled: true #tomcat embedded\n"})})]})}function l(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}function c(e){let n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",section:"section",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"in-case-of-the-application-server-using-the-osgi-framework",children:"In case of the application server using the OSGI framework"}),(0,i.jsx)(n.p,{children:"Register any agent package prefix (whatap) in the JVM options for an OSGI framework-based application server."}),(0,i.jsx)(n.p,{children:"The application server is available in Jboss EAP 6.0 or later, Jboss AS 7.0 or later, Wildfly 8.0 or later, IBM WebSphere AS 7.0 or later, and such."})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"jboss-as-wildfly-jboss-eap-60-or-later",children:"JBoss AS, Wildfly, JBoss EAP 6.0 or later"}),(0,i.jsx)(n.p,{children:"Register a prefix in the following file:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-apacheconf",metastring:"title='$JBOSS_HOME/bin/standalone.conf(domain.conf)'",children:"-Djboss.modules.system.pkgs=whatap\n"})}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://img.whatap.io/media/agent_java/install/410.png",alt:"JBOSS EAP 7.0"})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"websphere",children:"WebSphere"}),(0,i.jsx)(n.p,{children:"As an JVM option, add the following."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"-Dcom.ibm.ws.classloader.server.alwaysAllowedPackages=whatap\n"})}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'If "*" is specified as the default value, no additional setting is required.'}),"\n",(0,i.jsxs)(n.li,{children:["For the setting location, see ",(0,i.jsx)(n.a,{href:"add-jvm-opt/websphere",children:"WebSphere"}),"."]}),"\n"]}),(0,i.jsxs)(n.p,{children:["Add the ",(0,i.jsx)(n.em,{children:"security.policy"})," role as follows:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:"title='$WEBSPHERE_HOME/properties/server.policy || $WEBSPHERE_PROFILE_HOME/properties/server.policy'",children:'grant codeBase "file:$WHATAP_HOME/-"\n{\n   permission java.security.AllPermission;\n};\n'})})]})]})}function d(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}function h(e){let n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",section:"section",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"errors-of-log-manager",children:"Errors of Log Manager"}),(0,i.jsx)(n.p,{children:"If any Log Manager error occurs in JBoss AS 7.0 or later and JBoss EAP 6.0 or later, add the JVM options."}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Set the package name of Log Manager in ",(0,i.jsx)(n.code,{children:"-Djava.util.logging.manager"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Set the JBoss Log Manager JAR file in ",(0,i.jsx)(n.code,{children:"-Xbootclassloader"}),"."]}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-apacheconf",metastring:"title='(JBoss_Path)/bin/standalone.conf(domain.conf)' {4,12,13} showLineNumbers",children:'# Specify the exact Java VM executable to use.\n#\nif [ "x$JBOSS_MODULES_SYSTEM_PKGS" = "x" ]; then\n    JBOSS_MODULES_SYSTEM_PKGS="org.jboss.byteman,org.jboss.logmanager,whatap"\nfi\n\n...\n# Specify options to pass to the Java VM.\n#\nif [ "x$JAVA_OPTS" = "x" ]; then\n    JAVA_OPTS="-Xms1303m -Xmx1303m -Djava.net.preferIPv4Stack=true"\n    JAVA_OPTS="$JAVA_OPTS -Djboss.modules.system.pkgs=$JBOSS_MODULES_SYSTEM_PKGS -Djava.awt.headless=true"\n    JAVA_OPTS="$JAVA_OPTS -Djava.util.logging.manager=org.jboss.logmanager.LogManager -Xbootclasspath/p:/home/vagrant/EAP-7.0.0/modules/system/layers/base/org/jboss/logmanager/main/jboss-logmanager-2.0.3.Final-redhat-1.jar"\nelse\n    echo "JAVA_OPTS already set in environment; overriding default settings with values: $JAVA_OPTS"\nfi\n'})})]})}function p(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}function m(e){let n={code:"code",h2:"h2",p:"p",pre:"pre",section:"section",...(0,o.R)(),...e.components};return(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"in-case-the-mbeanserverbuilder-error-occurs",children:"In case the MBeanServerBuilder error occurs"}),(0,i.jsx)(n.p,{children:"If any MBeanServerBuilder-related error is output in JBoss 5.0 or earlier, add the JVM options."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-apacheconf",metastring:"title='(JBoss_Path)/bin/run.conf' {5} showLineNumbers",children:'# Specify options to pass to the Java VM.\n#\nif [ "x$JAVA_OPTS" = "x" ]; then\n   JAVA_OPTS="-Xms128m -Xmx512m -XX:MaxPermSize=256m -Dorg.jboss.resolver.warning=true -Dsun.rmi.dgc.client.gcInterval=3600000 -Dsun.rmi.dgc.server.gcInterval=3600000"\n   JAVA_OPTS="$JAVA_OPTS -Djboss.platform.mbeanserver"\nfi\n'})})]})}function g(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(m,{...e})}):m(e)}function u(e){let n={code:"code",em:"em",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",section:"section",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"in-case-of-occurrence-of-a-permission-error",children:"In case of occurrence of a permission error"}),(0,i.jsxs)(n.p,{children:["If any Java security policy-related error occurs, add the role setting in ",(0,i.jsx)(n.em,{children:"$JAVA_HOME/jre/lib/security/java.policy"}),"."]}),(0,i.jsxs)(n.p,{children:["To apply all roles collectively, add the setting in ",(0,i.jsx)(n.em,{children:"java.policy"})," as follows:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:"title='$JAVA_HOME/jre/lib/security/java.policy'",children:"grant {\n   permission java.security.AllPermission;\n};\n"})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"in-case-of-occurrence-of-the-javaiofilepermission-error",children:"In case of occurrence of the java.io.FilePermission error"}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"java.io.FilePermision error",src:r(23435).A+"",width:"883",height:"185"})}),(0,i.jsxs)(n.p,{children:["Add the setting in ",(0,i.jsx)(n.em,{children:"java.policy"}),"."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:"title='$JAVA_HOME/jre/lib/security/java.policy'",children:'grant {\n   ...\n   permission java.io.FilePermission {package path seen in the error message}, "read"\n};\n'})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"in-case-of-occurrence-of-the-javautilpropertypermission-error",children:"In case of occurrence of the java.util.PropertyPermission error"}),(0,i.jsxs)(n.p,{children:["Add the setting in ",(0,i.jsx)(n.em,{children:"java.policy"}),"."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:"title='$JAVA_HOME/jre/lib/security/java.policy'",children:'grant {\n   ...\n   permission java.util.PropertyPermission {package path see in the error message}, "read"\n};\n'})})]})]})}function j(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}function x(e){let n={code:"code",em:"em",h2:"h2",img:"img",p:"p",pre:"pre",section:"section",...(0,o.R)(),...e.components};return(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"in-case-the-sigar-library-cannot-be-loaded",children:"In case the sigar library cannot be loaded"}),(0,i.jsxs)(n.p,{children:["Check whether the execution role for ",(0,i.jsx)("em",{children:"$WHATAP_HOME/lib1/*.so"})," exists. If no permission, give the execution role."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ sudo chmod +x *.so\n"})}),(0,i.jsxs)(n.p,{children:["If under ",(0,i.jsx)(n.em,{children:"$WHATAP_HOME/lib1"})," of AIX 7, ",(0,i.jsx)(n.em,{children:"libsigar-ppc64-aix-7.so"})," does not exist and the error occurs, copy the file."]}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Sigar library error on AIX 7",src:r(76784).A+"",width:"883",height:"185"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ cp libsigar-ppc64-aix-5.so libsigar-ppc64-aix-7.so\n"})})]})}function f(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(x,{...e})}):x(e)}let v={id:"agent-troubleshooting",title:"Troubleshooting",description:"The following provides various problems that may occur during installation of a Java agent and detailed instructions for resolving them. It provides solutions to various issues such as firewall settings, SpringBoot and Tomcat JMX settings, server settings for use of the OSGI framework, Log Manager and MBeanServerBuilder errors, Permission errors, and Sigar library problems.",toc_max_heading_level:2,keywords:["Java","Troubleshooting","Troubleshooting"],isTranslationMissing:!1},b,y={},S=[...a.RM,{value:"SpringBoot 2.2 or later, Tomcat JMX off",id:"springboot-22-or-later-tomcat-jmx-off",level:2},{value:"In case of the application server using the OSGI framework",id:"in-case-of-the-application-server-using-the-osgi-framework",level:2},{value:"JBoss AS, Wildfly, JBoss EAP 6.0 or later",id:"jboss-as-wildfly-jboss-eap-60-or-later",level:3},{value:"WebSphere",id:"websphere",level:3},{value:"Errors of Log Manager",id:"errors-of-log-manager",level:2},{value:"In case the MBeanServerBuilder error occurs",id:"in-case-the-mbeanserverbuilder-error-occurs",level:2},{value:"In case of occurrence of a permission error",id:"in-case-of-occurrence-of-a-permission-error",level:2},{value:"In case of occurrence of the java.io.FilePermission error",id:"in-case-of-occurrence-of-the-javaiofilepermission-error",level:3},{value:"In case of occurrence of the java.util.PropertyPermission error",id:"in-case-of-occurrence-of-the-javautilpropertypermission-error",level:3},{value:"In case the sigar library cannot be loaded",id:"in-case-the-sigar-library-cannot-be-loaded",level:2},{value:"In case CPU metrics are displayed as -1",id:"cpumetrics",level:2},{value:"Recommendation: Configure metric collection via built-in libraries.",id:"recommendation-configure-metric-collection-via-built-in-libraries",level:3}];function w(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",section:"section",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.Ay,{}),"\n","\n",(0,i.jsx)(l,{}),"\n","\n",(0,i.jsx)(d,{}),"\n","\n",(0,i.jsx)(p,{}),"\n","\n",(0,i.jsx)(g,{}),"\n","\n",(0,i.jsx)(j,{}),"\n","\n",(0,i.jsx)(f,{}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"cpumetrics",children:"In case CPU metrics are displayed as -1"}),(0,i.jsxs)(n.p,{children:["When running IBM Java in the environment with the latest version of the Java agent, the CPU metrics may sometimes be displayed as ",(0,i.jsx)(n.strong,{children:"-1"}),". This issue occurs because the ",(0,i.jsx)(n.strong,{children:"System Load Average"})," value is not supported on specific platforms."]}),(0,i.jsxs)(n.p,{children:["The Java agent basically uses the Java Management Extensions (JMX) to collect metrics. It uses the ",(0,i.jsx)(n.code,{children:"getSystemLoadAverage()"})," method of the ",(0,i.jsx)(n.code,{children:"OperatingSystemMXBean"})," interface. This method returns the average load of the system over the last minute depending on the operating system. However, some platforms do not support this value and may return ",(0,i.jsx)(n.strong,{children:"-1"}),"."]}),(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"getSystemLoadAverage()"})," method can be checked in the OpenJDK source code. For example, the source code for the OpenJDK 7u version can be seen in the ",(0,i.jsx)(n.a,{href:"https://github.com/openjdk-mirror/jdk7u-jdk/blob/master/src/share/classes/java/lang/management/OperatingSystemMXBean.java",children:"GitHub repository"}),"."]})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"recommendation-configure-metric-collection-via-built-in-libraries",children:"Recommendation: Configure metric collection via built-in libraries."}),(0,i.jsxs)(n.p,{children:["To resolve the CPU metrics displayed as ",(0,i.jsx)(n.strong,{children:"-1"}),", enable the built-in library (OSHI or SIGAR) via the Java agent settings."]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Java 8 or later"}),": Use the ",(0,i.jsx)(n.strong,{children:"OSHI"})," library."]}),"\n",(0,i.jsxs)(n.p,{children:["You can use the ",(0,i.jsx)(n.strong,{children:"OSHI"})," library to reliably collect operating system level metrics. See the following how to configure the agent."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",metastring:'title="whatap.conf"',children:"# default false\noshi_enabled=true\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Below Java 8"}),": Use the ",(0,i.jsx)(n.strong,{children:"SIGAR"})," library."]}),"\n",(0,i.jsxs)(n.p,{children:["For environments below Java 8, you can collect metrics via the ",(0,i.jsx)(n.strong,{children:"SIGAR"})," library. For more information on how to configure the agent, see the following."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",metastring:'title="whatap.conf"',children:"# default false\nsigar_enabled=true\n"})}),"\n"]}),"\n"]}),(0,i.jsxs)(n.admonition,{type:"caution",children:[(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"OSHI"})," (",(0,i.jsx)(n.code,{children:"oshi_enabled"}),") and ",(0,i.jsx)(n.strong,{children:"SIGAR"})," (",(0,i.jsx)(n.code,{children:"sigar_enabled"}),") options are disabled by default. They must be explicitly set if needed."]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Be careful not to enable both settings at the same time. Select a library that best suits your environment and then configure it."}),"\n"]})]})]})]})}function A(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(w,{...e})}):w(e)}},23435:function(e,n,r){r.d(n,{A:()=>s});let s=r.p+"assets/images/troubleshooting-permission-error-4d8210609932d8b7a2d2121045758cd9.png"},76784:function(e,n,r){r.d(n,{A:()=>s});let s=r.p+"assets/images/troubleshooting-sigar-error-4d8210609932d8b7a2d2121045758cd9.png"},84429:function(e,n,r){r.d(n,{R:()=>a,x:()=>t});var s=r(96540);let i={},o=s.createContext(i);function a(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);