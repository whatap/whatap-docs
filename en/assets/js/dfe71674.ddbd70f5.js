"use strict";(self.webpackChunkwhatap_docs=self.webpackChunkwhatap_docs||[]).push([["85066"],{57527:function(e,n,t){t.d(n,{Ay:()=>r,RM:()=>o});var a=t(74848),i=t(84429);let o=[{value:"Download agent",id:"download-agent",level:2},{value:"Agent CONFIG.",id:"agent-config",level:2},{value:"Setting the <code>WHATAP_HOME</code> variable",id:"setting-the-whatap_home-variable",level:3},{value:"Configuring the Go library",id:"configuring-the-go-library",level:2},{value:"Configuring the container environment variables",id:"configuring-the-container-environment-variables",level:2},{value:"Running the agent",id:"running-the-agent",level:2},{value:"Checking the agent installation",id:"checking-the-agent-installation",level:2}];function s(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",section:"section",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Cmdname:t,InDoc:o,TabItem:s,Tabs:r}=n;return t||c("Cmdname",!0),o||c("InDoc",!0),s||c("TabItem",!0),r||c("Tabs",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"This process applies the WhaTap monitoring agent to the Go application running on the Docker container and packages the container image as follows."}),"\n",(0,a.jsx)(o,{product:"kubernetes",children:(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsx)(n.mdxAdmonitionTitle,{}),(0,a.jsx)(n.p,{children:"EKS Fargate is to be supported later."})]})}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(n.h2,{id:"download-agent",children:"Download agent"}),(0,a.jsx)(n.p,{children:"Install the whatap-agent package when building your Go application docker image."}),(0,a.jsxs)(r,{children:[(0,a.jsx)(s,{value:"x64",label:"x64",default:!0,children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",metastring:"title='x64'",children:"RUN wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz\nRUN tar -xvzf whatap-agent.tar.gz -C /\n"})})}),(0,a.jsx)(s,{value:"aarch64",label:"AArch64",default:!0,children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",metastring:"title='AArch64'",children:"RUN wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/aarch64/whatap-agent.tar.gz\nRUN tar -xvzf whatap-agent.tar.gz -C /\n"})})})]})]}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(n.h2,{id:"agent-config",children:"Agent CONFIG."}),(0,a.jsxs)(n.p,{children:["Create the ",(0,a.jsx)(n.em,{children:"whatap.conf"})," file in which WhaTap's access key and server IP address have been set in the user application execution path. If you use a specific path, you can set it with the ",(0,a.jsx)(n.code,{children:"WHATAP_HOME"})," environment variable."]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",metastring:"title='whatap.conf'",children:'RUN echo "accesskey={Access Key}" >> whatap.conf \nRUN echo "whatap.server.host={Collection Server IP Address}" >> whatap.conf\n'})}),(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsx)(n.mdxAdmonitionTitle,{}),(0,a.jsxs)(n.p,{children:["Be careful not to expose the ",(0,a.jsx)(n.strong,{children:"access key"})," to images that are in Docker Public status."]})]})]}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,a.jsxs)(n.h3,{id:"setting-the-whatap_home-variable",children:["Setting the ",(0,a.jsx)(n.code,{children:"WHATAP_HOME"})," variable"]}),(0,a.jsxs)(n.p,{children:["You can set the ",(0,a.jsx)(n.em,{children:"whatap.conf"})," path as the ",(0,a.jsx)(n.code,{children:"WHATAP_HOME"})," variable. Create the ",(0,a.jsx)(n.code,{children:"WHATAP_HOME"})," path first. Add the ",(0,a.jsx)(n.code,{children:"WHATAP_HOME"})," setting before the application startup command."]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'mkdir ./whatap_home\necho "license={Access Key}" >> ./whatap_home/whatap.conf\necho "whatap.server.host={Collection Server IP Address}" >> ./whatap_home/whatap.conf\n\n# run application\nWHATAP_HOME=./whatap_home ./app\n'})})]}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(n.h2,{id:"configuring-the-go-library",children:"Configuring the Go library"}),(0,a.jsxs)(n.p,{children:["Add the ",(0,a.jsx)(n.a,{href:"https://github.com/whatap/go-api",children:"github.com/whatap/go-api"})," package to the Go application source code."]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"go get github.com/whatap/go-api\n"})}),(0,a.jsxs)(n.p,{children:["Configure for initialization and shutdown with the ",(0,a.jsx)(n.code,{children:"trace.Init()"})," and ",(0,a.jsx)(n.code,{children:"trace.Shutdown()"})," functions. Set the startup and end for transactions with the ",(0,a.jsx)(n.code,{children:"trace.Start()"})," and ",(0,a.jsx)(n.code,{children:"trace.End()"})," functions."]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",metastring:"title='Go'",children:'import "github.com/whatap/go-api/trace"\n\nfunc main(){\n    trace.Init(nil)\n    //It must be executed before closing the app.    \n    defer trace.Shutdown()    \n\n    ctx, _ := trace.Start(context.Background(), "Start Tx")\n\n    ...\n\n    trace.End(ctx, err)\n}\n'})}),(0,a.jsx)(o,{product:"golang",children:(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["For more information about the library configuration, see ",(0,a.jsx)(n.a,{href:"api-guide",children:"the following"}),"."]})})}),(0,a.jsx)(o,{product:"kubernetes",children:(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["For more information about the library configuration, see ",(0,a.jsx)(n.a,{href:"../golang/api-guide",children:"the following"}),"."]})})})]}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(n.h2,{id:"configuring-the-container-environment-variables",children:"Configuring the container environment variables"}),(0,a.jsxs)(n.p,{children:["After building Docker, set ",(0,a.jsx)(n.strong,{children:"container environment variables"})," in the Kubernetes environment. Add the following items in the ",(0,a.jsx)(n.em,{children:"yaml"})," file for releasing the application."]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"env:\n- name: NODE_IP\n  valueFrom: {fieldRef: {fieldPath: status.hostIP}}\n- name: NODE_NAME\n  valueFrom: {fieldRef: {fieldPath: spec.nodeName}}\n- name: POD_NAME\n  valueFrom: {fieldRef: {fieldPath: metadata.name}}\n"})}),(0,a.jsx)(n.p,{children:"See the following example:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: # Pod Name\n  labels: # Pod Labels\nspec:\n  containers:\n    env:\n    - name: NODE_IP\n      valueFrom: {fieldRef: {fieldPath: status.hostIP}}\n    - name: NODE_NAME\n      valueFrom: {fieldRef: {fieldPath: spec.nodeName}}\n    - name: POD_NAME\n      valueFrom: {fieldRef: {fieldPath: metadata.name}}\n"})}),(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsx)(n.mdxAdmonitionTitle,{}),(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Roles of environment variables"})}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"NODE_IP"}),": Collects the IP address of the node where the current Pod has been hosted."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"NODE_NAME"}),": Collects the name of the node where the current Pod is running."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"POD_NAME"}),": Collects the name of the current Pod."]}),"\n"]}),"\n"]})]})]}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(n.h2,{id:"running-the-agent",children:"Running the agent"}),(0,a.jsxs)(r,{children:[(0,a.jsxs)(s,{value:"cm",label:"Command",default:!0,children:[(0,a.jsx)(n.p,{children:"Add the whatap-agent startup command before the application startup command."}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",children:'sh -c "/usr/whatap/agent/whatap-agent start && [application startup command]"\n'})})]}),(0,a.jsxs)(s,{value:"sup",label:"Supervisor",default:!0,children:[(0,a.jsx)(n.p,{children:"In case of starting the application as supervisor, see the following code to add the whatap-agent service."}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",children:'RUN echo "[program:whatap-agent]" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "command = sh -c \u2018/usr/whatap/agent/whatap-agent start\u2019" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "user = root" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "startsecs = 0" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "autostart = true" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "autorestart = false" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stdout_logfile = /dev/stdout" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stdout_logfile_maxbytes=0" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stderr_logfile = /dev/stderr" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stderr_logfile_maxbytes=0" >> /etc/supervisor/conf.d/whatap.conf\n'})})]})]}),(0,a.jsx)(n.p,{children:"Execute the following command to check whether the WhaTap service has been run normally. When the application server runs, it begins collecting monitoring information."}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",children:"ps -ef | grep whatap_agent\n"})})]}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(n.h2,{id:"checking-the-agent-installation",children:"Checking the agent installation"}),(0,a.jsxs)(n.p,{children:["To check whether the agent has been installed, go to ",(0,a.jsx)(t,{sid:"dashboard",className:"uitext"})," > ",(0,a.jsx)(t,{sid:"serviceDashboard",className:"uitext"}),"."]}),(0,a.jsxs)(n.p,{children:["If you have manually installed the downloaded file but cannot see the agent in ",(0,a.jsx)(t,{sid:"dashboard",className:"uitext"}),", check the following."]}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Execute the command, ",(0,a.jsx)(n.code,{children:"ps -ef | grep whatap_agent"})," in the container, and then check whether the agent options have been applied properly."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Check the ",(0,a.jsxs)(n.em,{children:[(0,a.jsx)(n.code,{children:"WHATAP_HOME"}),"/logs"]})," of the container or the ",(0,a.jsx)(n.em,{children:"logs"})," directory of the application execution path. The file name of the agent log is displayed as ",(0,a.jsxs)(n.em,{children:["logs/",(0,a.jsx)(n.code,{children:"{boot or install}"}),"-yyyymmdd.log"]}),"."]}),"\n"]}),"\n"]})]})]})}function r(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(s,{...e})}):s(e)}function c(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},56934:function(e,n,t){t.r(n),t.d(n,{metadata:()=>a,default:()=>p,frontMatter:()=>r,contentTitle:()=>c,toc:()=>h,assets:()=>l});var a=JSON.parse('{"id":"kubernetes/install-docker-go","title":"Installing the docker Go","description":"This step allows you to install the agent to monitor Go applications in the container.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/kubernetes/install-docker-go.mdx","sourceDirName":"kubernetes","slug":"/kubernetes/install-docker-go","permalink":"/whatap-docs/en/kubernetes/install-docker-go","draft":false,"unlisted":false,"editUrl":"undefined/docs/kubernetes/install-docker-go.mdx","tags":[],"version":"current","frontMatter":{"id":"install-docker-go","title":"Installing the docker Go","description":"This step allows you to install the agent to monitor Go applications in the container.","keywords":["Kubernetes","Kubernetes Monitoring","Application Installation","Go"],"isTranslationMissing":false},"sidebar":"kubeSidebar","previous":{"title":"Installing the docker PHP","permalink":"/whatap-docs/en/kubernetes/install-docker-php"},"next":{"title":"Creating a namespace project","permalink":"/whatap-docs/en/kubernetes/create-name-space-project"}}'),i=t(74848),o=t(84429),s=t(57527);let r={id:"install-docker-go",title:"Installing the docker Go",description:"This step allows you to install the agent to monitor Go applications in the container.",keywords:["Kubernetes","Kubernetes Monitoring","Application Installation","Go"],isTranslationMissing:!1},c,l={},h=[...s.RM];function d(e){let n={em:"em",p:"p",strong:"strong",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["At the bottom of ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.em,{children:"Management"})})," > ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.em,{children:"Agent installation"})}),", click ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.em,{children:"Install Application"})}),", and then Select the ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.em,{children:"Docker Go"})})," tab in Install guide."]}),"\n","\n",(0,i.jsx)(s.Ay,{})]})}function p(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},84429:function(e,n,t){t.d(n,{R:()=>s,x:()=>r});var a=t(96540);let i={},o=a.createContext(i);function s(e){let n=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);