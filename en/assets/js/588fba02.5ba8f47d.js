"use strict";(self.webpackChunkwhatap_docs=self.webpackChunkwhatap_docs||[]).push([["33792"],{45777:function(e,t,n){n.r(t),n.d(t,{metadata:()=>i,default:()=>h,frontMatter:()=>l,contentTitle:()=>a,toc:()=>o,assets:()=>c});var i=JSON.parse('{"id":"openmetrics_cardinality","title":"OpenMetrics Cardinality","description":"Understand OpenMetrics cardinality and calculate cardinality per metric directly.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/openmetrics_cardinality.mdx","sourceDirName":".","slug":"/openmetrics_cardinality","permalink":"/whatap-docs/en/openmetrics_cardinality","draft":false,"unlisted":false,"editUrl":"undefined/docs/openmetrics_cardinality.mdx","tags":[],"version":"current","frontMatter":{"id":"openmetrics_cardinality","title":"OpenMetrics Cardinality","description":"Understand OpenMetrics cardinality and calculate cardinality per metric directly.","keywords":["OpenMetrics","Cardinality"],"isTranslationMissing":false},"sidebar":"referSidebar","previous":{"title":"Reference","permalink":"/whatap-docs/en/reference"},"next":{"title":"Software proxy","permalink":"/whatap-docs/en/software-proxy"}}'),r=n(74848),s=n(84429);let l={id:"openmetrics_cardinality",title:"OpenMetrics Cardinality",description:"Understand OpenMetrics cardinality and calculate cardinality per metric directly.",keywords:["OpenMetrics","Cardinality"],isTranslationMissing:!1},a,c={},o=[{value:"What is Cardinality?",id:"what-is-cardinality",level:2},{value:"How to Check Cardinality",id:"how-to-check-cardinality",level:2},{value:"Step 1. Extract Prometheus Metric File",id:"step-1-extract-prometheus-metric-file",level:3},{value:"Step 2. Check Metric Format",id:"step-2-check-metric-format",level:3},{value:"Step 3. Calculate Cardinality",id:"step-3-calculate-cardinality",level:3},{value:"Step 4. Interpret Results",id:"step-4-interpret-results",level:3}];function d(e){let t={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",section:"section",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.admonition,{type:"info",children:[(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Purpose of the OpenMetrics Cardinality Document"})}),(0,r.jsxs)(t.p,{children:["After storing metrics exposed in Prometheus format, you can directly calculate cardinality per metric using a simple script.",(0,r.jsx)(t.br,{}),"\n","This allows you to see how many different label combinations each metric has in your environment."]})]}),"\n",(0,r.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,r.jsx)(t.h2,{id:"what-is-cardinality",children:"What is Cardinality?"}),(0,r.jsxs)(t.p,{children:["Cardinality refers to the ",(0,r.jsx)(t.strong,{children:"number of unique label combinations (excluding values)"})," for a specific metric. Even if the metric name is the same, data with identical label composition is treated as one."]}),(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Example"})}),(0,r.jsx)("pre",{style:{background:"#292d3e",borderRadius:"5px",padding:"16px 20px",overflow:"auto",lineHeight:"1.9",lineHeight:"0.3",fontSize:"10px"},children:(0,r.jsxs)("code",{style:{fontFamily:"var(--ifm-font-family-monospace, monospace)"},children:[(0,r.jsx)("span",{style:{color:"#ffffff"},children:(0,r.jsxs)(t.p,{children:["00:00\xa0\xa0",(0,r.jsxs)("span",{style:{background:"#d7ecff",color:"#000000"},children:[" http_requests_total","{",'url="/hello"',"}"," "]}),"\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Value:\xa0",(0,r.jsx)("span",{style:{color:"#ffffff"},children:"100"})]})}),(0,r.jsx)("span",{style:{color:"#ffffff"},children:(0,r.jsxs)(t.p,{children:["00:00\xa0\xa0",(0,r.jsxs)("span",{style:{background:"#fffbd1",color:"#000000"},children:[" http_requests_total","{",'url="/hello", name="whatap"',"}"," "]}),"\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Value:\xa0",(0,r.jsx)("span",{style:{color:"#ffffff"},children:"93"})]})}),(0,r.jsx)("span",{style:{color:"#ffffff"},children:(0,r.jsxs)(t.p,{children:["00:01\xa0\xa0",(0,r.jsxs)("span",{style:{background:"#fffbd1",color:"#000000"},children:[" http_requests_total","{",'url="/hello", name="whatap"',"}"," "]}),"\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Value:\xa0",(0,r.jsx)("span",{style:{color:"#ffffff"},children:"114"})]})}),(0,r.jsx)("span",{style:{color:"#ffffff"},children:(0,r.jsxs)(t.p,{children:["00:01\xa0\xa0",(0,r.jsxs)("span",{style:{background:"#d7ecff",color:"#000000"},children:[" http_requests_total","{",'url="/hello"',"}"," "]}),"\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Value:\xa0",(0,r.jsx)("span",{style:{color:"#ffffff"},children:"5"})]})})]})}),(0,r.jsx)(t.p,{children:"Although there are four data points, based on label composition they are counted as two:"}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:'url="/hello"'})," \u2192 1"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:'url="/hello", name="whatap"'})," \u2192 1"]}),"\n"]}),(0,r.jsxs)(t.p,{children:["Thus, the cardinality of this metric is ",(0,r.jsx)(t.strong,{children:"2"}),"."]}),(0,r.jsx)(t.hr,{})]}),"\n",(0,r.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,r.jsx)(t.h2,{id:"how-to-check-cardinality",children:"How to Check Cardinality"}),(0,r.jsx)(t.p,{children:"To check the cardinality of actual metrics collected in your environment, calculate it based on metrics exposed in Prometheus format."})]}),"\n",(0,r.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,r.jsx)(t.h3,{id:"step-1-extract-prometheus-metric-file",children:"Step 1. Extract Prometheus Metric File"}),(0,r.jsxs)(t.p,{children:["Call the endpoint (",(0,r.jsx)(t.code,{children:"/metrics"}),") that exposes metrics in Prometheus format and save it as a text file.",(0,r.jsx)(t.br,{}),"\n","Port ",(0,r.jsx)(t.code,{children:"9100"})," is an example for Prometheus Node Exporter; use the endpoint address suitable for your environment."]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"curl -s http://localhost:9100/metrics > metrics.txt\n"})})]}),"\n",(0,r.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,r.jsx)(t.h3,{id:"step-2-check-metric-format",children:"Step 2. Check Metric Format"}),(0,r.jsxs)(t.p,{children:["The saved file (metrics.txt) usually looks like the following.\nHere, the basis for calculating cardinality is ",(0,r.jsx)(t.strong,{children:"metric_name + label combination"}),"."]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'metric_name{label1="value1",label2="value2"} 123\n'})})]}),"\n",(0,r.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,r.jsx)(t.h3,{id:"step-3-calculate-cardinality",children:"Step 3. Calculate Cardinality"}),(0,r.jsx)(t.p,{children:"Run the following command to calculate the number of unique label combinations for each metric (metric_name)."}),(0,r.jsxs)(t.p,{children:["Download the shell script and execute the following commands. ",(0,r.jsx)(t.a,{href:"https://github.com/whatap/whatap-docs/releases/download/v2.19.0/count_cardinality.sh",children:"Download count_cardinality.sh "})]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"chmod +x count_cardinality.sh\n./count_cardinality.sh metrics.txt\n"})}),(0,r.jsx)(t.p,{children:"If you cannot download and run the shell script in your environment, copy and execute the following commands directly:"}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"grep -v '^#' metrics.txt \\\n  | awk -F'{' '{\n      if (NF > 1) {\n        name=$1\n      } else {\n        split($1, arr, \" \")\n        name=arr[1]\n      }\n      count[name]++\n      total++\n    }\n    END {\n      for (n in count) {\n        print n, count[n]\n      }\n      print \"Total\", total\n    }' | sort\n"})})]}),"\n",(0,r.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,r.jsx)(t.h3,{id:"step-4-interpret-results",children:"Step 4. Interpret Results"}),(0,r.jsx)(t.p,{children:"The execution result will look like the following. It shows the cardinality count of each metric and the total cardinality."}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"apiserver_flowcontrol_priority_level_request_utilization_bucket 44\ngo_gc_duration_seconds_count 1\ngo_gc_duration_seconds_sum 1\nprocess_cpu_seconds_total 1\nTotal 47\n"})}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"apiserver_flowcontrol_priority_level_request_utilization_bucket: 44 unique label combinations"}),"\n",(0,r.jsx)(t.li,{children:"go_gc_duration_seconds_count: 1 unique label combination"}),"\n",(0,r.jsx)(t.li,{children:"go_gc_duration_seconds_sum: 1 unique label combination"}),"\n",(0,r.jsx)(t.li,{children:"process_cpu_seconds_total: 1 unique label combination"}),"\n",(0,r.jsx)(t.li,{children:"Total: 47 (overall cardinality count)"}),"\n"]})]})]})}function h(e={}){let{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},84429:function(e,t,n){n.d(t,{R:()=>l,x:()=>a});var i=n(96540);let r={},s=i.createContext(r);function l(e){let t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);