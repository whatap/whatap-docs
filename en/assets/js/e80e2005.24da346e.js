"use strict";(self.webpackChunkwhatap_docs=self.webpackChunkwhatap_docs||[]).push([["1311"],{43871:function(e,n,t){t.r(n),t.d(n,{metadata:()=>s,default:()=>h,frontMatter:()=>i,contentTitle:()=>a,toc:()=>l,assets:()=>d});var s=JSON.parse('{"id":"kubernetes/etcd-dashboard","title":"etcd Dashboard","description":"The following guides to the etcd dashboard.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/kubernetes/etcd-dashboard.mdx","sourceDirName":"kubernetes","slug":"/kubernetes/etcd-dashboard","permalink":"/whatap-docs/en/kubernetes/etcd-dashboard","draft":false,"unlisted":false,"editUrl":"undefined/docs/kubernetes/etcd-dashboard.mdx","tags":[],"version":"current","frontMatter":{"id":"etcd-dashboard","title":"etcd Dashboard","description":"The following guides to the etcd dashboard.","keywords":["Kubernetes","Kubernetes Monitoring","etcd","Control Plane"],"toc_max_heading_level":3,"isTranslationMissing":false},"sidebar":"kubeSidebar","previous":{"title":"kube-apiserver Metrics Search","permalink":"/whatap-docs/en/kubernetes/kube-apiserver-metrics-search"},"next":{"title":"kube-scheduler Dashboard","permalink":"/whatap-docs/en/kubernetes/kube-scheduler-dashboard"}}'),r=t(74848),c=t(84429);let i={id:"etcd-dashboard",title:"etcd Dashboard",description:"The following guides to the etcd dashboard.",keywords:["Kubernetes","Kubernetes Monitoring","etcd","Control Plane"],toc_max_heading_level:3,isTranslationMissing:!1},a,d={},l=[{value:"Basic screen guide",id:"basic-screen-guide",level:2},{value:"Activation of the etcd monitoring",id:"activation-of-the-etcd-monitoring",level:2},{value:"Checking the certificate and creating the secret",id:"checking-the-certificate-and-creating-the-secret",level:3},{value:"Checking the etcd certificate",id:"checking-the-etcd-certificate",level:4},{value:"Creating the secret",id:"creating-the-secret",level:4},{value:"In case the root account is unavailable",id:"in-case-the-root-account-is-unavailable",level:5},{value:"In case there is no namespace",id:"in-case-there-is-no-namespace",level:5},{value:"Modifying the WhaTap Kubernetes agent <em>YAML</em>",id:"modifying-the-whatap-kubernetes-agent-yaml",level:3},{value:"Configuring the container",id:"configuring-the-container",level:4},{value:"Connecting the secret",id:"connecting-the-secret",level:4},{value:"Full <em>YAML</em> example",id:"full-yaml-example",level:4},{value:"etcd metrics",id:"etcd-metrics",level:2}];function o(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components},{Cmdname:t,ImgLang:s}=n;return t||m("Cmdname",!0),s||m("ImgLang",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Select Home > cluster project (",(0,r.jsx)("code",{class:"my",children:"CP"}),") > ",(0,r.jsx)(t,{sid:"side_controlPlane",className:"uitext"})," > ",(0,r.jsx)(t,{sid:"side_etcdDashboard",className:"uitext"})]}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsx)(n.mdxAdmonitionTitle,{}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Requirements"})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The WhaTap Kubernetes agent 1.7.16 or later is required."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If it is a Kubernetes cluster project (",(0,r.jsx)("code",{class:"my",children:"CP"}),"), you can view the corresponding menu."]}),"\n"]}),"\n"]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"etcd"})," is a core component in the Kubernetes environment that stores the data related to the cluster status. WhaTap provides ",(0,r.jsx)(t,{sid:"side_etcdDashboard",className:"uitext"})," to monitor the performance and status of etcd. This increases the stability of the cluster and enables a quick response when a problem occurs."]}),"\n",(0,r.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,r.jsx)(n.h2,{id:"basic-screen-guide",children:"Basic screen guide"}),(0,r.jsx)(s,{img:"k8s-etcd-dashboard.png",desc:"etcd dashboard"}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(t,{sid:"side_etcdDashboard",className:"uitext"})," provides key etcd metrics collected over the last one hour at an interval of 1 minute. The key metrics you can see on the dashboard are as follows. For the metrics details, see the ",(0,r.jsx)(n.a,{href:"#etcd-metrics",children:"metric guide"})," at the bottom."]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The resources used by etcd, number of Pod restarts, and log details are provided."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"The commits and number of applies in etcd are provided."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"It provides the existence status of etcd leaders and the history of leader changes."}),"\n"]}),"\n"]})]}),"\n",(0,r.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,r.jsx)(n.h2,{id:"activation-of-the-etcd-monitoring",children:"Activation of the etcd monitoring"}),(0,r.jsxs)(n.p,{children:["Activate the agent by modifying the downloaded ",(0,r.jsx)(n.em,{children:"YAML"})," file and registering the mTLS certificate when installing the WhaTap Kubernetes agent."]})]}),"\n",(0,r.jsx)(n.section,{className:"remark-sectionize-h3",children:(0,r.jsx)(n.h3,{id:"checking-the-certificate-and-creating-the-secret",children:"Checking the certificate and creating the secret"})}),"\n",(0,r.jsxs)(n.section,{className:"remark-sectionize-h4",children:[(0,r.jsx)(n.h4,{id:"checking-the-etcd-certificate",children:"Checking the etcd certificate"}),(0,r.jsxs)(n.p,{children:["An mTLS certificate is required for etcd. The etcd certificates are typically stored in the ",(0,r.jsx)(n.em,{children:"/etc/kubernetes/pki/etcd"})," path on the control plane node. The file owner is the root account and the required certificates are as follows:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"ca.crt"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"server.crt"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"server.key"})}),"\n"]}),"\n"]}),(0,r.jsxs)(n.p,{children:["On the machine where the ",(0,r.jsx)(n.code,{children:"kubectl"})," command is executed, check if the certificate exists using the following command."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo ls /etc/kubernetes/pki/etcd\n"})})]}),"\n",(0,r.jsxs)(n.section,{className:"remark-sectionize-h4",children:[(0,r.jsx)(n.h4,{id:"creating-the-secret",children:"Creating the secret"}),(0,r.jsx)(n.p,{children:"If a certificate exists, create a secret with the following command."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo kubectl create secret generic whatap-etcd-cert -n whatap-monitoring --from-file=ca.crt=/etc/kubernetes/pki/etcd/ca.crt --from-file=server.crt=/etc/kubernetes/pki/etcd/server.crt --from-file=server.key=/etc/kubernetes/pki/etcd/server.key\n"})}),(0,r.jsx)(n.p,{children:"When a secret is created successfully, the following message appears."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"secret/whatap-etcd-cert created\n"})})]}),"\n",(0,r.jsxs)(n.section,{className:"remark-sectionize-h5",children:[(0,r.jsx)(n.h5,{id:"in-case-the-root-account-is-unavailable",children:"In case the root account is unavailable"}),(0,r.jsxs)(n.p,{children:["If you cannot use the ",(0,r.jsx)(n.code,{children:"kubectl"})," command from the root account, see the following instructions."]}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"After copying the certificate, go to the accessible path."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Change the owner of the duplicated certificate file to the current owner."}),"\n"]}),"\n"]})]}),"\n",(0,r.jsxs)(n.section,{className:"remark-sectionize-h5",children:[(0,r.jsx)(n.h5,{id:"in-case-there-is-no-namespace",children:"In case there is no namespace"}),(0,r.jsxs)(n.p,{children:["If you create a secret before applying the Kubernetes agent YAML, the secret creation may fail because the ",(0,r.jsx)(n.code,{children:"whatap-monitoring"})," namespace does not exist. After creating the namespace, create a secret again with the following command."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl create namespace whatap-monitoring\n"})})]}),"\n",(0,r.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,r.jsxs)(n.h3,{id:"modifying-the-whatap-kubernetes-agent-yaml",children:["Modifying the WhaTap Kubernetes agent ",(0,r.jsx)(n.em,{children:"YAML"})]}),(0,r.jsxs)(n.p,{children:["Modify the WhaTap Kubernetes agent ",(0,r.jsx)(n.em,{children:"YAML"})," file to add container settings and then attach the secret."]})]}),"\n",(0,r.jsxs)(n.section,{className:"remark-sectionize-h4",children:[(0,r.jsx)(n.h4,{id:"configuring-the-container",children:"Configuring the container"}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add the etcd-related settings to the args section in the ",(0,r.jsx)(n.code,{children:"whatap-control-plane-helper"})," container of Deployment."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"-collect_etcd_monitoring_enabled=true\n-etcd_hosts=user_etcd_ip, user_etcd_ip\n"})}),"\n",(0,r.jsx)(n.p,{children:"See the following example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:"title='Example'",children:"-etcd_hosts=192.168.1.45,192.168.1.46,192.168.1.47\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add the following to the environment variables (env) of the ",(0,r.jsx)(n.code,{children:"whatap-master-agent"})," container of Deployment."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'- name: "collect_etcd_monitoring_enabled"\n  value: "true"\n'})}),"\n"]}),"\n"]})]}),"\n",(0,r.jsxs)(n.section,{className:"remark-sectionize-h4",children:[(0,r.jsx)(n.h4,{id:"connecting-the-secret",children:"Connecting the secret"}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add a secret to the volumes section in ",(0,r.jsx)(n.code,{children:"whatap-master-agent"})," of Deployment."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:"{3}",children:'- name: "whatap-etcd-cert"\n  secret:\n    secretName: "whatap-etcd-cert"\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Mount the secret into the ",(0,r.jsx)(n.code,{children:"whatap-control-plane-helper"})," container."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:"{2}",children:'volumeMounts:\n  - name: "whatap-etcd-cert"\n    readOnly: true\n    mountPath: "/etc/kubernetes/pki/etcd"\n'})}),"\n"]}),"\n"]})]}),"\n",(0,r.jsxs)(n.section,{className:"remark-sectionize-h4",children:[(0,r.jsxs)(n.h4,{id:"full-yaml-example",children:["Full ",(0,r.jsx)(n.em,{children:"YAML"})," example"]}),(0,r.jsxs)(n.p,{children:["Below is an example of the ",(0,r.jsx)(n.em,{children:"YAML"})," file with all settings applied. See the highlighted area."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:"{31-34,55-56,64-67,76-78}",children:'apiVersion: "apps/v1"\nkind: "Deployment"\nmetadata:\n  name: "whatap-master-agent"\n  namespace: "whatap-monitoring"\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      name: "whatap-master-agent"\n  template:\n    metadata:\n      labels:\n        name: "whatap-master-agent"\n    spec:\n      containers:\n      - command:\n        - "/bin/entrypoint.sh"\n        env:\n        - name: "WHATAP_LICENSE"\n          value: "x208gnc8i1kko-z2p19shk7npc4t-z788sgbj3n123a"\n        - name: "WHATAP_HOST"\n          value: "59.13.101.109"\n        - name: "WHATAP_PORT"\n          value: "61574"\n        - name: "WHATP_MEM_LIMIT"\n          valueFrom:\n            resourceFieldRef:\n              containerName: "whatap-master-agent"\n              resource: "limits.memory"\n        - name: "collect_control_plane_monitoring_enabled"\n          value: "true"\n        - name: "collect_etcd_monitoring_enabled"\n          value: "true"\n        image: "whatap/kube_mon"\n        name: "whatap-master-agent"\n        ports:\n        - containerPort: 6600\n        resources:\n          limits:\n            cpu: "200m"\n            memory: "350Mi"\n          requests:\n            cpu: "100m"\n            memory: "300Mi"\n        volumeMounts:\n        - mountPath: "/bin/entrypoint.sh"\n          name: "start-script-volume"\n          readOnly: true\n          subPath: "entrypoint.sh"\n        - mountPath: "/whatap_conf"\n          name: "whatap-config-volume"\n      - args:\n        - "-collect_control_plane_monitoring_enabled=true"\n        - "-collect_etcd_monitoring_enabled=true"\n        - "-etcd_hosts=192.168.1.45,192.168.1.46,192.168.1.47"\n        command:\n        - "/data/agent/master/whatap_control_plane_helper"\n        image: "whatap/kube_mon"\n        imagePullPolicy: "Always"\n        name: "whatap-control-plane-helper"\n        ports:\n        - containerPort: 9496\n        volumeMounts:\n          - name: "whatap-etcd-cert"\n            readOnly: true\n            mountPath: "/etc/kubernetes/pki/etcd"\n      serviceAccount: "whatap"\n      volumes:\n      - configMap:\n          defaultMode: 448\n          name: "master-start-script"\n        name: "start-script-volume"\n      - emptyDir: {}\n        name: "whatap-config-volume"\n      - name: "whatap-etcd-cert"\n        secret:\n          secretName: "whatap-etcd-cert" \n'})})]}),"\n",(0,r.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,r.jsx)(n.h2,{id:"etcd-metrics",children:"etcd metrics"}),(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"Number of Pods"})})}),(0,r.jsx)(n.td,{children:"Number of the current etcd Pods"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"etcd restart count trend"})})}),(0,r.jsx)(n.td,{children:"etcd Pod restart count sum trend"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"Reader change trend"})})}),(0,r.jsx)(n.td,{children:"etcd Pod reader change count trend"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"Reader exists or not"})})}),(0,r.jsx)(n.td,{children:"Whether the etcd Pod as the reader role exists or not"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"CPU usage sum"})})}),(0,r.jsx)(n.td,{children:"etcd Pod CPU usage sum"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"CPU usage"})})}),(0,r.jsx)(n.td,{children:"etcd Pod CPU usage trend"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"Memory usage sum"})})}),(0,r.jsx)(n.td,{children:"etcd Pod memory usage sum"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"Memory usage"})})}),(0,r.jsx)(n.td,{children:"etcd Pod memory usage trend"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"Commit trend"})})}),(0,r.jsx)(n.td,{children:"Number of etcd change commits"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"Apply trend"})})}),(0,r.jsx)(n.td,{children:"Number of applies after a commit"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"etcd log"})})}),(0,r.jsx)(n.td,{children:"Logs generated from the etcd Pod"})]})]})]})]})]})}function h(e={}){let{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}function m(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},84429:function(e,n,t){t.d(n,{R:()=>i,x:()=>a});var s=t(96540);let r={},c=s.createContext(r);function i(e){let n=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);