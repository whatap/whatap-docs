"use strict";(self.webpackChunkwhatap_docs=self.webpackChunkwhatap_docs||[]).push([["39176"],{93781:function(e,n,t){t.d(n,{Ay:()=>r,RM:()=>i});var a=t(74848),s=t(84429);let i=[{value:"Download agent",id:"download-agent",level:2},{value:"Agent CONFIG.",id:"agent-config",level:2},{value:"Configuring the container environment variables",id:"configuring-the-container-environment-variables",level:2},{value:"Running the agent",id:"running-the-agent",level:2},{value:"Checking the agent installation",id:"checking-the-agent-installation",level:2}];function o(e){let n={admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",section:"section",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Cmdname:t,InDoc:i,TabItem:o,Tabs:r}=n;return t||l("Cmdname",!0),i||l("InDoc",!0),o||l("TabItem",!0),r||l("Tabs",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"This process applies the WhaTap monitoring agent to the PHP application running on the Docker container and packages the container image as follows."}),"\n",(0,a.jsx)(i,{product:"kubernetes",children:(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsx)(n.mdxAdmonitionTitle,{}),(0,a.jsx)(n.p,{children:"EKS Fargate is to be supported later."})]})}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(n.h2,{id:"download-agent",children:"Download agent"}),(0,a.jsx)(n.p,{children:"Install the whatap-php package when building your PHP application docker image."}),(0,a.jsxs)(r,{children:[(0,a.jsx)(o,{value:"x64",label:"x64",default:!0,children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",metastring:"title='x64'",children:"RUN wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-php.tar.gz\nRUN tar -xvzf whatap-php.tar.gz -C /\n"})})}),(0,a.jsx)(o,{value:"aarch64",label:"AArch64",default:!0,children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",metastring:"title='AArch64'",children:"RUN wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/aarch64/whatap-php.tar.gz\nRUN tar -xvzf whatap-php.tar.gz -C /\n"})})})]})]}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(n.h2,{id:"agent-config",children:"Agent CONFIG."}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Use the following command to set the installation script. If you enter the WhaTap access key and server IP, the PHP environment data is automatically collected."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",children:'RUN (echo "[Access Key]"; echo "[Server IP]")|/usr/whatap/php/install.sh\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Using the following method, you can directly enter the PHP environment settings."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",children:"# RUN /usr/whatap/php/install.sh -l [Access Key] -s [Server IP] -v [PHP version x.x] -i [php.ini full path] -p [Process Name] -z [thread safety] \nRUN /usr/whatap/php/install.sh -l xxxxx -s 1.1.1.1/2.2.2.2 -v 7.0 -i /etc/php.ini -p httpd [-z]\n"})}),"\n"]}),"\n"]}),(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsx)(n.mdxAdmonitionTitle,{}),(0,a.jsxs)(n.p,{children:["Be careful not to expose the ",(0,a.jsx)(n.strong,{children:"access key"})," to images that are in Docker Public status."]})]})]}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(n.h2,{id:"configuring-the-container-environment-variables",children:"Configuring the container environment variables"}),(0,a.jsxs)(n.p,{children:["After building Docker, set ",(0,a.jsx)(n.strong,{children:"container environment variables"})," in the Kubernetes environment. Add the following items in the ",(0,a.jsx)(n.em,{children:"yaml"})," file for releasing the application."]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"\nenv:\n- name: NODE_IP\n  valueFrom: {fieldRef: {fieldPath: status.hostIP}}\n- name: NODE_NAME\n  valueFrom: {fieldRef: {fieldPath: spec.nodeName}}\n- name: POD_NAME\n  valueFrom: {fieldRef: {fieldPath: metadata.name}}\n- name: WHATAP_PHP_AGENT_PATH\n  value: /usr/whatap/php/whatap_php_static\n- name: WHATAP_CONTAINER_CONF_PATH\n  value: /usr/whatap/php\n\n"})}),(0,a.jsx)(n.p,{children:"See the following example:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: # Pod Name\n  labels: # Pod Labels\nspec:\n  containers:\n    env:\n    - name: NODE_IP\n      valueFrom: {fieldRef: {fieldPath: status.hostIP}}\n    - name: NODE_NAME\n      valueFrom: {fieldRef: {fieldPath: spec.nodeName}}\n    - name: POD_NAME\n      valueFrom: {fieldRef: {fieldPath: metadata.name}}\n    - name: WHATAP_PHP_AGENT_PATH\n      value: /usr/whatap/php/whatap_php_static\n    - name: WHATAP_CONTAINER_CONF_PATH\n      value: /usr/whatap/php\n"})}),(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsx)(n.mdxAdmonitionTitle,{}),(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Roles of environment variables"})}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"NODE_IP"}),": Collects the IP address of the node where the current Pod has been hosted."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"NODE_NAME"}),": Collects the name of the node where the current Pod is running."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"POD_NAME"}),": Collects the name of the current Pod."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"WHATAP_PHP_AGENT_PATH"}),": Specifies the PHP agent executable file path."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"WHATAP_CONTAINER_CONF_PATH"}),": Specifies the path where the container ID will be stored."]}),"\n"]}),"\n"]})]})]}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(n.h2,{id:"running-the-agent",children:"Running the agent"}),(0,a.jsxs)(r,{children:[(0,a.jsxs)(o,{value:"cm",label:"Command",default:!0,children:[(0,a.jsx)(n.p,{children:"Add the whatap-php startup command before the application startup command."}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker'",children:'sh -c "/usr/whatap/php/whatap-php start && [Application Startup Command]"\n'})})]}),(0,a.jsxs)(o,{value:"sup",label:"Supervisor",default:!0,children:[(0,a.jsx)(n.p,{children:"In case of starting the application as supervisor, see the following code to add the whatap-php service."}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",children:'\nRUN echo "[program:whatap-php]" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "command = sh -c \u2018/usr/whatap/php/whatap-php start\u2019" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "user = root" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "startsecs = 0" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "autostart = true" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "autorestart = false" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stdout_logfile = /dev/stdout" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stdout_logfile_maxbytes=0" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stderr_logfile = /dev/stderr" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stderr_logfile_maxbytes=0" >> /etc/supervisor/conf.d/whatap.conf\n\n'})})]})]}),(0,a.jsx)(n.p,{children:"Execute the following command to check whether the WhaTap service has been run normally. When the application server runs, it begins collecting monitoring information."}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-docker",children:"\nps -ef | grep whatap_php\n\n"})})]}),"\n",(0,a.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(n.h2,{id:"checking-the-agent-installation",children:"Checking the agent installation"}),(0,a.jsxs)(n.p,{children:["To check whether the agent has been installed, go to ",(0,a.jsx)(t,{sid:"dashboard",className:"uitext"})," > ",(0,a.jsx)(t,{sid:"serviceDashboard",className:"uitext"}),"."]}),(0,a.jsxs)(n.p,{children:["If you have manually installed the downloaded file but cannot see the agent in ",(0,a.jsx)(t,{sid:"dashboard",className:"uitext"}),", check the following."]}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Execute the command, ",(0,a.jsx)(n.code,{children:"ps -ef | grep whatap"})," in the container, and then check whether the agent options have been applied properly."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Check the content of the container in the ",(0,a.jsx)(n.em,{children:"/usr/whatap/php/logs"})," path. The file name of the agent log is displayed as ",(0,a.jsxs)(n.em,{children:["logs/",(0,a.jsx)(n.code,{children:"{boot or install}"}),"-yyyymmdd.log"]}),"."]}),"\n"]}),"\n"]})]})]})}function r(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}function l(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},6364:function(e,n,t){t.r(n),t.d(n,{metadata:()=>a,default:()=>p,frontMatter:()=>r,contentTitle:()=>l,toc:()=>h,assets:()=>c});var a=JSON.parse('{"id":"kubernetes/install-docker-php","title":"Installing the docker PHP","description":"This step allows you to install the agent to monitor PHP applications in the container.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/kubernetes/install-docker-php.mdx","sourceDirName":"kubernetes","slug":"/kubernetes/install-docker-php","permalink":"/whatap-docs/kubernetes/install-docker-php","draft":false,"unlisted":false,"editUrl":"undefined/docs/kubernetes/install-docker-php.mdx","tags":[],"version":"current","frontMatter":{"id":"install-docker-php","title":"Installing the docker PHP","description":"This step allows you to install the agent to monitor PHP applications in the container.","keywords":["Kubernetes","Kubernetes Monitoring","Application Installation","PHP"],"isTranslationMissing":false},"sidebar":"kubeSidebar","previous":{"title":"Installing Docker Python","permalink":"/whatap-docs/kubernetes/install-docker-python"},"next":{"title":"Installing the docker Go","permalink":"/whatap-docs/kubernetes/install-docker-go"}}'),s=t(74848),i=t(84429),o=t(93781);let r={id:"install-docker-php",title:"Installing the docker PHP",description:"This step allows you to install the agent to monitor PHP applications in the container.",keywords:["Kubernetes","Kubernetes Monitoring","Application Installation","PHP"],isTranslationMissing:!1},l,c={},h=[...o.RM];function d(e){let n={em:"em",p:"p",strong:"strong",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["At the bottom of ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.em,{children:"Management"})})," > ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.em,{children:"Agent installation"})}),", click ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.em,{children:"Install Application"})})," > Select the ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.em,{children:"Docker PHP"})})," tab in Install guide."]}),"\n","\n",(0,s.jsx)(o.Ay,{})]})}function p(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},84429:function(e,n,t){t.d(n,{R:()=>o,x:()=>r});var a=t(96540);let s={},i=a.createContext(s);function o(e){let n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);