"use strict";(self.webpackChunkwhatap_docs=self.webpackChunkwhatap_docs||[]).push([["48255"],{92196:function(e,n,t){t.r(n),t.d(n,{metadata:()=>o,default:()=>h,frontMatter:()=>a,contentTitle:()=>r,toc:()=>c,assets:()=>l});var o=JSON.parse('{"id":"php/php-os/gcae","title":"Google Cloud App Engine","description":"Google Cloud App Engine","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/php/php-os/gcae.mdx","sourceDirName":"php/php-os","slug":"/php/php-os/gcae","permalink":"/whatap-docs/php/php-os/gcae","draft":false,"unlisted":false,"editUrl":"undefined/docs/php/php-os/gcae.mdx","tags":[],"version":"current","frontMatter":{"id":"gcae","title":"Google Cloud App Engine","description":"Google Cloud App Engine","keywords":["Google Cloud App Engine","PHP"],"isTranslationMissing":false},"sidebar":"phpSidebar","previous":{"title":"Alpine Linux","permalink":"/whatap-docs/php/php-os/alpine-linux"},"next":{"title":"AWS Elastic beanstalk","permalink":"/whatap-docs/php/php-os/aws-eb"}}'),s=t(74848),i=t(84429);let a={id:"gcae",title:"Google Cloud App Engine",description:"Google Cloud App Engine",keywords:["Google Cloud App Engine","PHP"],isTranslationMissing:!1},r,l={},c=[{value:"Custom Docker",id:"custom-docker",level:2},{value:"Installation of the PHP monitoring agent",id:"installation-of-the-php-monitoring-agent",level:2},{value:"Adding firewall rules",id:"adding-firewall-rules",level:2},{value:"Checking the deployment and instance",id:"checking-the-deployment-and-instance",level:2}];function p(e){let n={admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,s.jsx)(n.h2,{id:"custom-docker",children:"Custom Docker"}),(0,s.jsx)(n.p,{children:"To install the PHP monitoring agent in the Google Cloud App engine, the custom docker must be used."}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Defaults of Google App Engine PHP cannot run PHP extension modules and service daemons"}),". Install them via Docker Container."]}),(0,s.jsxs)(n.p,{children:["In the ",(0,s.jsx)(n.em,{children:"app.yaml"})," file (Google App engine's configuration file), configure the settings with the ",(0,s.jsx)(n.code,{children:"flex"})," environment and ",(0,s.jsx)(n.code,{children:"custom"})," run-time."]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:"title=SH",children:"$ vi app.yaml\nenv: flex\nruntime: custom\n"})}),(0,s.jsxs)(n.p,{children:["To run with the custom Docker, create ",(0,s.jsx)(n.em,{children:"Dockerfile"})," in the same location as ",(0,s.jsx)(n.em,{children:"app.yaml"})," set with the ",(0,s.jsx)(n.code,{children:"flex"})," environment and the ",(0,s.jsx)(n.code,{children:"custom"})," run-time. See the default PHP Docker image for the Google App engine."]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",metastring:"title=Docker",children:"# google-appengine php php56, php70, php71\nFROM gcr.io/google-appengine/php56\n"})})]}),"\n",(0,s.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,s.jsx)(n.h2,{id:"installation-of-the-php-monitoring-agent",children:"Installation of the PHP monitoring agent"}),(0,s.jsx)(n.p,{children:"Install the PHP monitoring agent."}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Install the library (wget)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",children:"RUN apt-get install wget -y\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Create the php-fpm execution command link."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",children:"RUN ln -s /opt/php/sbin/php-fpm /usr/bin/php-fpm\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Install the WhaTap repository and whatap-php package."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",children:"RUN wget http://repo.whatap.io/debian/release.gpg -O -| apt-key add -\nRUN wget http://repo.whatap.io/debian/whatap-repo_1.0_all.deb\nRUN dpkg -i whatap-repo_1.0_all.deb\nRUN apt-get update\nRUN apt-get install whatap-php\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Configure the PHP extension module and whatap-php service."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",children:'#RUN (echo "[granted access key]"; echo "[granted server IP ]")|/usr/whatap/php/install.sh\nRUN (echo "xxxxxxxx"; echo "1.1.1.1/2.2.2.2")|/usr/whatap/php/install.sh\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["After creating a PHP monitoring project, the ",(0,s.jsx)(n.strong,{children:"access key"})," and server IP is issued. With the delimiter (",(0,s.jsx)(n.em,{children:"/"}),"), multiple IPs can be issued."]})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Run the whatap-php service through ",(0,s.jsx)(n.code,{children:"supervisor"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",children:'RUN echo "[program:whatap-php]" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "command = /etc/init.d/whatap-php start" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stdout_logfile = /dev/stdout" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stdout_logfile_maxbytes=0" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stderr_logfile = /dev/stderr" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "stderr_logfile_maxbytes=0" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "user = root" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "autostart = true" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "autorestart = true" >> /etc/supervisor/conf.d/whatap.conf\nRUN echo "priority = 10" >> /etc/supervisor/conf.d/whatap.conf\n'})}),"\n"]}),"\n"]})]}),"\n",(0,s.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,s.jsx)(n.h2,{id:"adding-firewall-rules",children:"Adding firewall rules"}),(0,s.jsx)(n.p,{children:"Add firewall rules for the network that is used by the Google App engine. TCP transmission must be allowed through the port 6600 for the issued server IP."})]}),"\n",(0,s.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,s.jsx)(n.h2,{id:"checking-the-deployment-and-instance",children:"Checking the deployment and instance"}),(0,s.jsxs)(n.p,{children:["Deploy ",(0,s.jsx)(n.em,{children:"app.yaml"})," and ",(0,s.jsx)(n.em,{children:"Dockerfile"})," that have been set through the Google Cloud SDK."]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:"title=SH",children:"$ gcloud app deploy\n"})}),(0,s.jsx)(n.p,{children:"Check the App engine instance generated in the Google Cloud Console."})]})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},84429:function(e,n,t){t.d(n,{R:()=>a,x:()=>r});var o=t(96540);let s={},i=o.createContext(s);function a(e){let n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);