"use strict";(self.webpackChunkwhatap_docs=self.webpackChunkwhatap_docs||[]).push([["83113"],{33345:function(e,n,t){t.r(n),t.d(n,{metadata:()=>a,default:()=>d,frontMatter:()=>r,contentTitle:()=>s,toc:()=>c,assets:()=>l});var a=JSON.parse('{"id":"kubernetes/install-whatap-operator","title":"Install WhaTap Operator","description":"Guide for installing WhaTap Operator.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/kubernetes/install-whatap-operator.mdx","sourceDirName":"kubernetes","slug":"/kubernetes/install-whatap-operator","permalink":"/whatap-docs/kubernetes/install-whatap-operator","draft":false,"unlisted":false,"editUrl":"undefined/docs/kubernetes/install-whatap-operator.mdx","tags":[],"version":"current","frontMatter":{"id":"install-whatap-operator","title":"Install WhaTap Operator","description":"Guide for installing WhaTap Operator.","keywords":["Kubernetes","Kubernetes Monitoring","WhaTap Operator","Application Installation"],"toc_max_heading_level":3,"isTranslationMissing":false},"sidebar":"kubeSidebar","previous":{"title":"\uC640\uD0ED \uC624\uD37C\uB808\uC774\uD130","permalink":"/whatap-docs/kubernetes/whatap-operator"},"next":{"title":"APM Auto-Installation Configuration","permalink":"/whatap-docs/kubernetes/install-auto-application-agent"}}'),i=t(74848),o=t(84429);let r={id:"install-whatap-operator",title:"Install WhaTap Operator",description:"Guide for installing WhaTap Operator.",keywords:["Kubernetes","Kubernetes Monitoring","WhaTap Operator","Application Installation"],toc_max_heading_level:3,isTranslationMissing:!1},s,l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation",id:"installation",level:2},{value:"Minimal Configuration",id:"minimal-configuration",level:3},{value:"Default Configuration",id:"default-configuration",level:3},{value:"Example Configurations",id:"example-configurations",level:2},{value:"GPU Monitoring",id:"gpu-monitoring",level:3},{value:"GPU Monitoring Auto Setup",id:"gpu-monitoring-auto-setup",level:4},{value:"GPU Node Toleration",id:"gpu-node-toleration",level:4},{value:"APM Auto Installation",id:"apm-auto-installation",level:3},{value:"OpenAgent",id:"openagent",level:3},{value:"Using Kubernetes Monitoring and APM Together",id:"using-kubernetes-monitoring-and-apm-together",level:3}];function p(e){let n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{ImgLang:t}=n;return t||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("ImgLang",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["This guide explains how to install the WhaTap Operator in a Kubernetes environment and configure the ",(0,i.jsx)(n.code,{children:"WhatapAgent"})," CR to start monitoring with WhaTap."]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Kubernetes cluster (v1.19+)"}),"\n",(0,i.jsx)(n.li,{children:"Helm 3.2 or later"}),"\n",(0,i.jsx)(n.li,{children:"WhaTap account and license key"}),"\n"]})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),(0,i.jsxs)(n.p,{children:["Follow the steps below to install the WhaTap Operator and create the ",(0,i.jsx)(n.code,{children:"WhatapAgent"})," CR."]}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Install the WhaTap Operator"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If you are installing the agent for the first time, run the following commands:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm repo add whatap https://whatap.github.io/helm/\nhelm repo update\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl create ns whatap-monitoring\nexport WHATAP_HOST=<collector IP>\nexport WHATAP_LICENSE=<license key>\nexport WHATAP_PORT=<collector port>\nkubectl create secret generic whatap-credentials --namespace whatap-monitoring --from-literal WHATAP_LICENSE=$WHATAP_LICENSE --from-literal WHATAP_HOST=$WHATAP_HOST --from-literal WHATAP_PORT=$WHATAP_PORT\nhelm install whatap-operator whatap/whatap-operator --namespace whatap-monitoring\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Advanced configuration"})}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Image registry and pull secret"})}),(0,i.jsxs)(n.p,{children:["If you use a private registry or need to adjust image tags or the pull policy, set the following values in ",(0,i.jsx)(n.em,{children:"values.yaml"}),"."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"  image:\n  repository: public.ecr.aws/whatap/whatap-operator\n  tag: latest\n  pullPolicy: Always\n\n  # For private registry\n  imagePullSecret:\n  name: <your-registry-secret-name>\n"})}),(0,i.jsx)("br",{}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Scheduling and priority options"})}),(0,i.jsx)(n.p,{children:"You can control scheduling constraints and priority for the operator Pod. The template renders only when a value is specified, which preserves compatibility with existing users."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'  priorityClassName: ""   # Example: system-cluster-critical\n  nodeName: ""            # When you need fixed scheduling on a specific node\n  nodeSelector: {}        # Example: { kubernetes.io/os: linux }\n  affinity: {}            # Standard K8s Affinity schema\n  tolerations: []         # Standard K8s Toleration list\n'})}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Example"})}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'  priorityClassName: "high-priority"\n  nodeSelector:\n    nodepool: system\n\n  affinity:\n    nodeAffinity:\n        requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n          - matchExpressions:\n              - key: kubernetes.io/os\n                operator: In\n                values: ["linux"]\n\n  tolerations:\n    - key: "node-role.kubernetes.io/control-plane"\n      effect: NoSchedule\n'})}),(0,i.jsx)("br",{}),(0,i.jsxs)(n.p,{children:["If you use a custom configuration instead of the default ",(0,i.jsx)(n.em,{children:"values.yaml"}),", install the operator with the following commands."]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"If the namespace already exists"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"helm install whatap-operator whatap/whatap-operator -n whatap-monitoring -f custom-values.yaml\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"If the namespace does not exist, create it automatically and install"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"helm upgrade --install whatap-operator whatap/whatap-operator -n whatap-monitoring --create-namespace -f custom-values.yaml\n"})}),"\n"]}),"\n"]})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If you were previously using the WhaTap Kubernetes agent, run the following commands to install the agent:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"kubectl delete ns whatap-monitoring\nkubectl delete clusterrole whatap\nkubectl delete clusterrolebinding whatap\nkubectl create ns whatap-monitoring\nkubectl create secret generic whatap-credentials --namespace whatap-monitoring --from-literal WHATAP_LICENSE=$WHATAP_LICENSE --from-literal WHATAP_HOST=$WHATAP_HOST --from-literal WHATAP_PORT=$WHATAP_PORT\nhelm install whatap-operator whatap/whatap-operator --namespace whatap-monitoring\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["If the previous WhaTap Kubernetes agent was installed via ",(0,i.jsx)(n.em,{children:"yaml"})," files or Helm, a clean install is required. It is recommended to uninstall the existing Kubernetes agent before using the Operator."]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The operator is deployed as a deployment. Run the following command to check if the operator is running:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n whatap-monitoring | grep -i operator\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The result should show the ",(0,i.jsx)(n.code,{children:"whatap-operator"})," pod in ",(0,i.jsx)(n.strong,{children:"Running"})," status.","\n",(0,i.jsx)(t,{img:"whatap-operator-running-pod.png",desc:"whatap-operator-pod"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Create the WhatapAgent CR"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Run the following command to create the WhatapAgent custom resource:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"kubectl apply -f values.yaml\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"WhatapAgent"})," CR defines deployment and configuration for WhaTap agents. It supports setting up the Kubernetes agent, auto-installing APM, and collecting OpenMetrics via the Open Agent."]}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"minimal-configuration",children:"Minimal Configuration"}),(0,i.jsx)(n.p,{children:"This is a minimal configuration that enables the WhaTap master and node agents for basic Kubernetes monitoring."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:"title='values-min.yaml'",children:"apiVersion: monitoring.whatap.com/v2alpha1\nkind: WhatapAgent\nmetadata:\n  name: whatap\nspec:\n  features:\n    k8sAgent:\n      masterAgent:\n        enabled: true\n      nodeAgent:\n        enabled: true\n      gpuMonitoring:\n        enabled: false\n"})}),(0,i.jsxs)(n.p,{children:["When installed with the minimal configuration, ",(0,i.jsx)(n.code,{children:"whatap-master-agent"})," and ",(0,i.jsx)(n.code,{children:"whatap-node-agent"})," are additionally deployed as shown below."]}),(0,i.jsx)(t,{img:"whatap-operator-whatapagent-cr.png",desc:"whatap-master-agent, whatap-node-agent"}),(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["When installing the WhaTap agent with the operator, refer to ",(0,i.jsx)(n.a,{href:"whatap-cr-configuration-options",children:"WhaTap CR configuration options"})," for details on CR settings (resource constraints, tolerations, imagePullSecret)."]})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"default-configuration",children:"Default Configuration"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'\napiVersion: monitoring.whatap.com/v2alpha1\nkind: WhatapAgent\nmetadata:\n  name: whatap\nspec:\n  features:\n    ### Uncomment to enable APM auto-installation - \n    ### Automatically injects the APM agent into application Pods to enable performance monitoring.\n    # apm:\n    #   instrumentation:\n    #     targets:\n    #       - name: hello-world\n    #         enabled: true\n    #         language: "java"          # Supported languages: java, python, nodejs\n    #         whatapApmVersions:\n    #           java: "2.2.58"          # APM agent version to use\n    #         namespaceSelector:\n    #           matchNames:\n    #             - default             # Namespace containing the application to monitor\n    #         podSelector:\n    #           matchLabels:\n    #             app: "hello-world"    # Label of the application Pod to monitor\n    #         config:\n    #           mode: default           # APM agent mode setting\n\n    ### Uncomment to enable Kubernetes monitoring - \n    ### Enables monitoring of Kubernetes cluster, nodes, and containers.\n    # k8sAgent:\n    #   masterAgent:\n    #     enabled: true                 # Enable master agent (cluster-level metric collection)\n    #   nodeAgent:\n    #     enabled: true                 # Enable node agent (node and container-level metrics)\n\n    ### Uncomment to enable GPU monitoring - \n    ### Enables NVIDIA GPU metrics collection.\n    #   gpuMonitoring:\n    #     enabled: true                 # Enable GPU monitoring (NVIDIA DCGM-EXPORTER is installed as a sidecar in the whatap-node-agent)\n\n    ### Uncomment to enable OpenMetrics collection (Prometheus-compatible format) - \n    ### Collects metrics in Prometheus format.\n    # openAgent:\n    #     enabled: true                 # Enable OpenAgent\n    #     targets:\n    #       - targetName: kube-apiserver\n    #         type: ServiceMonitor      # Target type: ServiceMonitor, PodMonitor, StaticEndpoints\n    #         namespaceSelector:\n    #           matchNames:\n    #             - "default"           # Namespace from which to collect metrics\n    #         selector:\n    #           matchLabels:\n    #             component: apiserver  # Labels of the service/Pod to monitor\n    #             provider: kubernetes\n    #         endpoints:\n    #           - port: "https"         # Metric endpoint port\n    #             path: "/metrics"      # Metric path\n    #             interval: "30s"       # Scraping interval for this endpoint\n    #             scheme: "https"       # HTTP scheme (http or https)\n    #             tlsConfig:\n    #               insecureSkipVerify: true  # Skip TLS certificate verification\n        #         metricRelabelConfigs:\n        #           - source_labels: ["__name__"]\n        #             regex: "apiserver_request_total"  # Filter to collect specific metrics\n        #             action: "keep"                    # Keep only matching metrics\n'})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"example-configurations",children:"Example Configurations"}),(0,i.jsx)(n.p,{children:"In addition to supporting Kubernetes agents, the WhaTap Operator also provides APM auto-installation and custom metric agent setup. Use the following examples to deploy various configurations."})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"gpu-monitoring",children:"GPU Monitoring"}),(0,i.jsxs)(n.p,{children:["Instead of installing the Kubernetes monitoring agent, you can deploy the DCGM-EXPORTER container as a sidecar to the WhaTap node agent Pod.",(0,i.jsx)(n.br,{}),"\n","Without additional configuration, simply apply the yaml below to collect metrics that are displayed in the ",(0,i.jsx)(n.strong,{children:"GPU dashboard"}),"."]}),(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["If you configured DCGM-EXPORTER manually instead of using the built-in sidecar in the node agent, refer to the ",(0,i.jsx)(n.a,{href:"openagent",children:"OpenAgent Configuration"})," to collect dcgm metrics."]})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h4",children:[(0,i.jsx)(n.h4,{id:"gpu-monitoring-auto-setup",children:"GPU Monitoring Auto Setup"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:"title='GPU Monitoring Auto Setup'",children:"apiVersion: monitoring.whatap.com/v2alpha1\nkind: WhatapAgent\nmetadata:\n  name: whatap\nspec:\n  features:\n    openAgent:\n      enabled: true  # Enable OpenAgent\n    k8sAgent:\n      masterAgent:\n        enabled: true\n      nodeAgent:\n        enabled: true\n      gpuMonitoring:\n        enabled: true  # Enable GPU monitoring\n"})}),(0,i.jsx)(n.p,{children:"Note: During auto-installation, the Open Agent automatically detects and scrapes the DCGM Exporter."})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h4",children:[(0,i.jsx)(n.h4,{id:"gpu-node-toleration",children:"GPU Node Toleration"}),(0,i.jsx)(n.p,{children:"If your GPU node has taints, you must add toleration settings."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:"title='GPU Node Toleration'",children:'    apiVersion: monitoring.whatap.com/v2alpha1\n    kind: WhatapAgent\n    metadata:\n      name: whatap\n    spec:\n      features:\n        k8sAgent:\n          nodeAgent:\n            enabled: true\n            tolerations:\n              - key: "nvidia.com/gpu"\n                operator: "Exists"\n                effect: "NoSchedule"\n              - key: "gpu"\n                operator: "Exists"\n                effect: "NoSchedule"\n          gpuMonitoring:\n            enabled: true\n'})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"apm-auto-installation",children:"APM Auto Installation"}),(0,i.jsx)(n.p,{children:"Automatically install APM in the Kubernetes cluster without enabling Kubernetes monitoring agents."}),(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["For more details, refer to the ",(0,i.jsx)(n.a,{href:"install-auto-application-agent",children:"APM Auto-Installation Guide"}),"."]})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:"title='APM Auto Installation'",children:'apiVersion: monitoring.whatap.com/v2alpha1\nkind: WhatapAgent\nmetadata:\n  name: whatap\nspec:\n  features:\n    apm:\n      instrumentation:\n        targets:\n          - name: hello-world\n            enabled: true\n            language: "java"\n            whatapApmVersions:\n              java: "2.2.58"\n            namespaceSelector:\n              matchNames:\n                - default\n            podSelector:\n              matchLabels:\n                app: "hello-world"\n            config:\n              mode: default\n'})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"openagent",children:"OpenAgent"}),(0,i.jsx)(n.p,{children:"Configure only the OpenAgent component to collect Prometheus-style metrics, without enabling Kubernetes monitoring agents or APM instrumentation."}),(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["For more details, refer to the ",(0,i.jsx)(n.a,{href:"openagent",children:"OpenAgent Configuration"}),"."]})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: monitoring.whatap.com/v2alpha1\nkind: WhatapAgent\nmetadata:\n  name: whatap\nspec:\n  features:\n    openAgent:\n        enabled: true\n        targets:\n          - targetName: kube-apiserver\n            type: ServiceMonitor\n            namespaceSelector:\n              matchNames:\n                - "default"\n            selector:\n              matchLabels:\n                component: apiserver\n                provider: kubernetes\n            endpoints:\n            - port: "https"\n              path: "/metrics"\n              interval: "30s"\n              scheme: "https"\n              tlsConfig:\n                insecureSkipVerify: true\n              metricRelabelConfigs:\n                - source_labels: ["__name__"]\n                  regex: "apiserver_request_total"\n                  action: "keep"\n'})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"using-kubernetes-monitoring-and-apm-together",children:"Using Kubernetes Monitoring and APM Together"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: monitoring.whatap.com/v2alpha1\nkind: WhatapAgent\nmetadata:\n  name: whatap\nspec:\n  features:\n    apm:\n      instrumentation:\n        targets:\n          - name: hello-world\n            enabled: true\n            language: "java"\n            whatapApmVersions:\n              java: "2.2.58"\n            namespaceSelector:\n              matchNames:\n                - default\n            podSelector:\n              matchLabels:\n                app: "hello-world"\n            config:\n              mode: default\n    k8sAgent:\n      masterAgent:\n        enabled: true\n      nodeAgent:\n        enabled: true\n    openAgent:\n        enabled: true\n        targets:\n          - targetName: kube-apiserver\n            type: ServiceMonitor\n            namespaceSelector:\n              matchNames:\n                - "default"\n            selector:\n              matchLabels:\n                component: apiserver\n                provider: kubernetes\n            endpoints:\n            - port: "https"\n              path: "/metrics"\n              interval: "30s"\n              scheme: "https"\n              tlsConfig:\n                insecureSkipVerify: true\n              metricRelabelConfigs:\n              - source_labels: ["__name__"]\n                regex: "apiserver_request_total"\n                action: "keep"\n'})})]})]})}function d(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},84429:function(e,n,t){t.d(n,{R:()=>r,x:()=>s});var a=t(96540);let i={},o=a.createContext(i);function r(e){let n=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);