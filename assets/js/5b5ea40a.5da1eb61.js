"use strict";(self.webpackChunkwhatap_docs=self.webpackChunkwhatap_docs||[]).push([["43564"],{74246:function(n,e,t){t.r(e),t.d(e,{default:()=>d,frontMatter:()=>o,metadata:()=>r,assets:()=>c,toc:()=>h,contentTitle:()=>s});var r=JSON.parse('{"id":"release-notes/golang/golang-0_1_12","title":"Go Agent v0.1.12","description":"\uBC30\uD3EC\uC77C: 2022-08-02","source":"@site/docs/release-notes/golang/golang-0.1.12.mdx","sourceDirName":"release-notes/golang","slug":"/release-notes/golang/golang-0_1_12","permalink":"/release-notes/golang/golang-0_1_12","draft":false,"unlisted":false,"editUrl":"undefined/docs/release-notes/golang/golang-0.1.12.mdx","tags":[],"version":"current","frontMatter":{"id":"golang-0_1_12","title":"Go Agent v0.1.12","toc_max_heading_level":2,"displayed_sidebar":"releaseSidebar","isTranslationMissing":false},"sidebar":"releaseSidebar"}'),a=t("85893"),i=t("50065");t("60372"),t("98009");let o={id:"golang-0_1_12",title:"Go Agent v0.1.12",toc_max_heading_level:2,displayed_sidebar:"releaseSidebar",isTranslationMissing:!1},s=void 0,c={},h=[{value:"\uBCA0\uD0C0 - \uC5C5\uB370\uC774\uD2B8",id:"\uBCA0\uD0C0---\uC5C5\uB370\uC774\uD2B8",level:2},{value:"alpine linux \uB97C \uC9C0\uC6D0\uD569\uB2C8\uB2E4.",id:"alpine-linux-\uB97C-\uC9C0\uC6D0\uD569\uB2C8\uB2E4",level:3},{value:"\uC124\uCE58 \uC548\uB0B4",id:"\uC124\uCE58-\uC548\uB0B4",level:4},{value:"whatap-agent \uC2E4\uD589",id:"whatap-agent-\uC2E4\uD589",level:4},{value:"github.com/go-chi/chi \uB77C\uC774\uBE0C\uB7EC\uB9AC \uC9C0\uC6D0",id:"githubcomgo-chichi-\uB77C\uC774\uBE0C\uB7EC\uB9AC-\uC9C0\uC6D0",level:3},{value:"\uC124\uCE58 \uC548\uB0B4",id:"\uC124\uCE58-\uC548\uB0B4-1",level:4},{value:"github.com/go-gorm/gorm \uB77C\uC774\uBE0C\uB7EC\uB9AC \uC9C0\uC6D0",id:"githubcomgo-gormgorm-\uB77C\uC774\uBE0C\uB7EC\uB9AC-\uC9C0\uC6D0",level:3},{value:"whatapgorm \uC0AC\uC6A9 \uBC29\uC2DD",id:"whatapgorm-\uC0AC\uC6A9-\uBC29\uC2DD",level:4},{value:"whatapsql \uC0AC\uC6A9 \uBC29\uC2DD",id:"whatapsql-\uC0AC\uC6A9-\uBC29\uC2DD",level:4},{value:"github.com/jinzhu/gorm \uB77C\uC774\uBE0C\uB7EC\uB9AC \uC9C0\uC6D0",id:"githubcomjinzhugorm-\uB77C\uC774\uBE0C\uB7EC\uB9AC-\uC9C0\uC6D0",level:3},{value:"whatapgorm \uC0AC\uC6A9 \uBC29\uC2DD",id:"whatapgorm-\uC0AC\uC6A9-\uBC29\uC2DD-1",level:4},{value:"whatapsql \uC0AC\uC6A9 \uBC29\uC2DD",id:"whatapsql-\uC0AC\uC6A9-\uBC29\uC2DD-1",level:4},{value:"github.com/gomodule/redigo \uB77C\uC774\uBE0C\uB7EC\uB9AC \uC9C0\uC6D0",id:"githubcomgomoduleredigo-\uB77C\uC774\uBE0C\uB7EC\uB9AC-\uC9C0\uC6D0",level:3},{value:"github.com/shopify/sarama \uB77C\uC774\uBE0C\uB7EC\uB9AC \uC9C0\uC6D0",id:"githubcomshopifysarama-\uB77C\uC774\uBE0C\uB7EC\uB9AC-\uC9C0\uC6D0",level:3},{value:"async producer \uCD94\uC801",id:"async-producer-\uCD94\uC801",level:4},{value:"consumer \uCD94\uC801",id:"consumer-\uCD94\uC801",level:4}];function l(n){let e={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",section:"section",...(0,i.a)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.p,{children:"\uBC30\uD3EC\uC77C: 2022-08-02"}),"\n",(0,a.jsx)(e.section,{className:"remark-sectionize-h2",children:(0,a.jsx)(e.h2,{id:"\uBCA0\uD0C0---\uC5C5\uB370\uC774\uD2B8",children:"\uBCA0\uD0C0 - \uC5C5\uB370\uC774\uD2B8"})}),"\n",(0,a.jsx)(e.section,{className:"remark-sectionize-h3",children:(0,a.jsx)(e.h3,{id:"alpine-linux-\uB97C-\uC9C0\uC6D0\uD569\uB2C8\uB2E4",children:"alpine linux \uB97C \uC9C0\uC6D0\uD569\uB2C8\uB2E4."})}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"\uC124\uCE58-\uC548\uB0B4",children:"\uC124\uCE58 \uC548\uB0B4"}),(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.a,{href:"https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz",children:"whatap-agent.tar.gz"}),"\uC744 \uB2E4\uC6B4\uBC1B\uACE0 '/' \uB514\uB809\uD130\uB9AC \uAE30\uC900\uC73C\uB85C \uC555\uCD95\uC744 \uD574\uC81C\uD569\uB2C8\uB2E4. ",(0,a.jsx)(e.em,{children:"/usr/whatap/agent"})," \uB514\uB809\uD130\uB9AC\uC5D0 \uBAA8\uB2C8\uD130\uB9C1 \uC124\uCE58 \uD30C\uC77C\uC774 \uC0DD\uC131\uB429\uB2C8\uB2E4."]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz\ntar -xvzf whatap-agent.tar.gz -C /\n"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"whatap-agent-\uC2E4\uD589",children:"whatap-agent \uC2E4\uD589"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"/usr/whatap/agent/whatap-agent \n    Default restart\n    Command start, stop, restart, version\n\n## \uBC84\uC804 \uD655\uC778\n# /usr/whatap/agent/whatap-agent version\n0.8.5.20201209\n\n## \uC2E4\uD589 \uD655\uC778\n# ps -elf | grep whatap\n  103 root      0:05 ./whatap_agent_static -t=4\n"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(e.h3,{id:"githubcomgo-chichi-\uB77C\uC774\uBE0C\uB7EC\uB9AC-\uC9C0\uC6D0",children:"github.com/go-chi/chi \uB77C\uC774\uBE0C\uB7EC\uB9AC \uC9C0\uC6D0"}),(0,a.jsxs)(e.p,{children:["chi \uD504\uB808\uC784\uC6CC\uD06C\uC758 \uC6F9 \uD2B8\uB79C\uC7AD\uC158\uC744 \uCD94\uC801\uD569\uB2C8\uB2E4. ",(0,a.jsx)(e.code,{children:"Use"})," \uD568\uC218\uB97C \uD1B5\uD574 \uBBF8\uB4E4\uC6E8\uC5B4\uB97C \uB4F1\uB85D\uD558\uC5EC \uCD94\uC801\uD569\uB2C8\uB2E4."]})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"\uC124\uCE58-\uC548\uB0B4-1",children:"\uC124\uCE58 \uC548\uB0B4"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",children:'import (\n  "github.com/go-chi/chi"\n  "github.com/whatap/go-api/trace"\n  "github.com/whatap/go-api/instrumentation/github.com/go-chi/chi/whatapchi"\n)\n\nfunc main() {\n  config := make(map[string]string)\n  trace.Init(config)\n  defer trace.Shutdown()\n  \n  r := chi.NewRouter()\n  \n  // whatapchi\uC758 middleware\uB97C \uB4F1\uB85D\uD569\uB2C8\uB2E4.\n  r.Use(whatapchi.Middleware)\n  \n  r.Get("/", func(w http.ResponseWriter, r *http.Request) {\n      fmt.Println("Response -", r.Response)\n})\n'})}),(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/whatap/go-api-example/tree/main/github.com/go-chi/chi",children:"\uC608\uC81C \uCC38\uC870"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(e.h3,{id:"githubcomgo-gormgorm-\uB77C\uC774\uBE0C\uB7EC\uB9AC-\uC9C0\uC6D0",children:"github.com/go-gorm/gorm \uB77C\uC774\uBE0C\uB7EC\uB9AC \uC9C0\uC6D0"}),(0,a.jsx)(e.p,{children:"gorm v2 \uD504\uB808\uC784\uC6CC\uD06C\uB97C \uD1B5\uD574 \uCC98\uB9AC\uB418\uB294 DB Connection \uBC0F SQL\uC744 \uCD94\uC801\uD569\uB2C8\uB2E4."})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"whatapgorm-\uC0AC\uC6A9-\uBC29\uC2DD",children:"whatapgorm \uC0AC\uC6A9 \uBC29\uC2DD"}),(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"gorm.Open"})," \uD568\uC218 \uB300\uC2E0\uC5D0 ",(0,a.jsx)(e.code,{children:"whatapgorm.OpenWithContext"})," \uD568\uC218\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4. \uC804\uB2EC\uD558\uB294 context\uB294 \uB0B4\uBD80\uC5D0 whatap TraceCtx\uB97C \uD3EC\uD568\uD574\uC57C \uD558\uBA70 trace \uD328\uD0A4\uC9C0\uC758 ",(0,a.jsx)(e.code,{children:"Start"})," \uD568\uC218\uB97C \uD1B5\uD574 \uC0DD\uC131 \uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4."]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "net/http"\n\n  "github.com/whatap/go-api/instrumentation/github.com/go-gorm/gorm/whatapgorm"\n  "github.com/whatap/go-api/trace"\n  "gorm.io/driver/sqlite"\n  "gorm.io/gorm"\n)\n\nfunc main() {\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  http.HandleFunc("/InsertAndDelete", func(w http.ResponseWriter, r *http.Request) {\n    // Context\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4.\n    ctx, _ := trace.StartWithRequest(r)\n    defer trace.End(ctx, nil)\n\n    // whatapgorm\uC744 \uD1B5\uD574 DB\uB97C \uC5F0\uACB0\uD569\uB2C8\uB2E4.\n    db, err := whatapgorm.OpenWithContext(sqlite.Open("test.db"), &gorm.Config{}, ctx)\n    if err != nil {\n      panic("Db \uC5F0\uACB0\uC5D0 \uC2E4\uD328\uD558\uC600\uC2B5\uB2C8\uB2E4.")\n    }\n\n    for i := 0; i < 100; i++ {\n      db.Create(&Product{Code: i, Price: i * 100})\n    }\n\n    db.Unscoped().Delete(&Product{}, "Code >= ? AND Code < ?", 0, 100)\n  })\n\n  _ = http.ListenAndServe(fmt.Sprintf(":%d", port), nil)\n}\n'})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"whatapsql-\uC0AC\uC6A9-\uBC29\uC2DD",children:"whatapsql \uC0AC\uC6A9 \uBC29\uC2DD"}),(0,a.jsx)(e.p,{children:"gorm\uC740 \uACF5\uC2DD \uC9C0\uC6D0\uD558\uB294 sqlite, mysql, postgres, sqlserver \uC678\uC5D0\uB3C4 dialect interface \uAE30\uBC18\uC73C\uB85C \uC791\uC131\uB41C dirver\uC5D0 \uB300\uD574\uC11C \uD638\uD658 \uAC00\uB2A5\uD569\uB2C8\uB2E4."}),(0,a.jsxs)(e.p,{children:["\uAD00\uB828 \uB9C1\uD06C : ",(0,a.jsx)(e.a,{href:"https://gorm.io/docs/write_driver.html",children:"gorm driver"})]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "net/http"\n  "github.com/whatap/go-api/instrumentation/database/sql/whatapsql"\n  "github.com/whatap/go-api/trace"\n  "gorm.io/driver/mysql"\n  "gorm.io/gorm"\n)\n\nfunc main() {\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  http.HandleFunc("/WhatapDriverTest", func(w http.ResponseWriter, r *http.Request) {\n    // Context\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4.\n    ctx, _ := trace.StartWithRequest(r)\n    defer trace.End(ctx, nil)\n\n    // whatapsql driver\uB85C db connection\uC744 \uC0DD\uC131\uD569\uB2C8\uB2E4.\n    dbConn, err := whatapsql.OpenContext(ctx, "mysql", dataSource)\n    \n    // \uAE30 \uC0DD\uC131\uB41C connection\uC744 \uD1B5\uD574 gorm\uC5D0 \uC5F0\uACB0\uD569\uB2C8\uB2E4.\n    db, err := gorm.Open(mysql.New(mysql.Config{Conn: dbConn}), &gorm.Config{})\n    if err != nil {\n      panic("Db \uC5F0\uACB0\uC5D0 \uC2E4\uD328\uD558\uC600\uC2B5\uB2C8\uB2E4.")\n    }\n    \n    for i := 0; i < 100; i++ {\n      db.Create(&Product{Code: i, Price: i * 100})\n    }\n  })\n\n  _ = http.ListenAndServe(fmt.Sprintf(":%d", port), nil)\n}\n'})}),(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/whatap/go-api-example/tree/main/github.com/go-orm/gorm",children:"\uCC38\uC870 \uC608\uC81C"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(e.h3,{id:"githubcomjinzhugorm-\uB77C\uC774\uBE0C\uB7EC\uB9AC-\uC9C0\uC6D0",children:"github.com/jinzhu/gorm \uB77C\uC774\uBE0C\uB7EC\uB9AC \uC9C0\uC6D0"}),(0,a.jsx)(e.p,{children:"gorm v1 \uD504\uB808\uC784\uC6CC\uD06C\uB97C \uD1B5\uD574 \uCC98\uB9AC\uB418\uB294 DB Connection \uBC0F SQL\uC744 \uCD94\uC801\uD569\uB2C8\uB2E4."})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"whatapgorm-\uC0AC\uC6A9-\uBC29\uC2DD-1",children:"whatapgorm \uC0AC\uC6A9 \uBC29\uC2DD"}),(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"gorm.Open"})," \uD568\uC218 \uB300\uC2E0\uC5D0 ",(0,a.jsx)(e.code,{children:"whatapgorm.OpenWithContext"})," \uD568\uC218\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4. \uC804\uB2EC\uD558\uB294 context\uB294 \uB0B4\uBD80\uC5D0 whatap TraceCtx\uB97C \uD3EC\uD568\uD574\uC57C \uD558\uBA70 trace \uD328\uD0A4\uC9C0\uC758 Start \uD568\uC218\uB97C \uD1B5\uD574 \uC0DD\uC131 \uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4."]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "net/http"\n\n  "github.com/whatap/go-api/instrumentation/github.com/go-gorm/gorm/whatapgorm"\n  "github.com/whatap/go-api/trace"\n  _ "github.com/mattn/go-sqlite3"\n  "github.com/jinzhu/gorm"\n)\n\nfunc main() {\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  http.HandleFunc("/InsertAndDelete", func(w http.ResponseWriter, r *http.Request) {\n    // Context\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4.\n    ctx, _ := trace.StartWithRequest(r)\n    defer trace.End(ctx, nil)\n\n    // whatapgorm\uC744 \uD1B5\uD574 DB\uB97C \uC5F0\uACB0\uD569\uB2C8\uB2E4.\n    db, err := whatapgorm.OpenWithContext(ctx, "sqlite3", "test.db")\n    defer db.Close()\n    if err != nil {\n      trace.Error(ctx, err)\n      panic("Gorm Open Fail")\n    }\n\n    for i := 0; i < 100; i++ {\n      db.Create(&Product{Code: i, Price: i * 100})\n    }\n\n    db.Unscoped().Delete(Product{}, "Code >= ? AND Code < ?", 0, 100)\n  })\n\n  _ = http.ListenAndServe(fmt.Sprintf(":%d", port), nil)\n}\n'})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"whatapsql-\uC0AC\uC6A9-\uBC29\uC2DD-1",children:"whatapsql \uC0AC\uC6A9 \uBC29\uC2DD"}),(0,a.jsx)(e.p,{children:"gorm\uC740 \uACF5\uC2DD \uC9C0\uC6D0\uD558\uB294 sqlite, mysql, postgres, sqlserver \uC678\uC5D0\uB3C4 dialect interface \uAE30\uBC18\uC73C\uB85C \uC791\uC131\uB41C dirver\uC5D0 \uB300\uD574\uC11C \uD638\uD658 \uAC00\uB2A5\uD569\uB2C8\uB2E4."}),(0,a.jsxs)(e.p,{children:["\uAD00\uB828 \uB9C1\uD06C : ",(0,a.jsx)(e.a,{href:"https://v1.gorm.io/docs/dialects.html",children:"gorm driver"})]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "net/http"\n  "github.com/whatap/go-api/instrumentation/database/sql/whatapsql"\n  "github.com/whatap/go-api/trace"\n  "github.com/jinzhu/gorm"\n_ "github.com/go-sql-driver/mysql"\n)\n\nfunc main() {\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  http.HandleFunc("/WhatapDriverTest", func(w http.ResponseWriter, r *http.Request) {\n    // Context\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4.\n    ctx, _ := trace.StartWithRequest(r)\n    defer trace.End(ctx, nil)\n\n    // whatapsql driver\uB85C db connection\uC744 \uC0DD\uC131\uD569\uB2C8\uB2E4.\n    var conn gorm.SQLCommon\n    var err error\n    conn, err = whatapsql.OpenContext(ctx, "mysql", dataSource)\n    if err != nil {\n      trace.Error(ctx, err)\n      panic("Whatapsql Open Fail")\n    }\n    \n    // \uAE30 \uC0DD\uC131\uB41C connection\uC744 \uD1B5\uD574 gorm\uC5D0 \uC5F0\uACB0\uD569\uB2C8\uB2E4.\n    db, err := gorm.Open("mysql", conn)\n    if err != nil {\n      trace.Error(ctx, err)\n      panic("Gorm Open Fail")\n    }\n    for i := 0; i < 100; i++ {\n      db.Create(&Product{Code: i, Price: i * 100})\n    }\n  })\n\n  _ = http.ListenAndServe(fmt.Sprintf(":%d", port), nil)\n}\n'})}),(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/whatap/go-api-example/tree/main/github.com/jinzhu/gorm",children:"\uCC38\uC870 \uC608\uC81C"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(e.h3,{id:"githubcomgomoduleredigo-\uB77C\uC774\uBE0C\uB7EC\uB9AC-\uC9C0\uC6D0",children:"github.com/gomodule/redigo \uB77C\uC774\uBE0C\uB7EC\uB9AC \uC9C0\uC6D0"}),(0,a.jsxs)(e.p,{children:["redigo \uD504\uB808\uC784\uC6CC\uD06C\uB97C \uD1B5\uD574 redis\uC5D0 \uC804\uB2EC\uB418\uB294 \uBA85\uB839\uC744 \uCD94\uC801\uD569\uB2C8\uB2E4. ",(0,a.jsx)(e.code,{children:"redis.Dial"})," \uB300\uC2E0\uC5D0 ",(0,a.jsx)(e.code,{children:"whatapredigo.DialContext"}),"\uB97C \uD568\uC218\uB97C \uC0AC\uC6A9\uD569\uB2C8\uB2E4."]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "context"\n  "net/http"\n\n  "github.com/gomodule/redigo/redis"\n  "github.com/whatap/go-api/instrumentation/github.com/gomodule/redigo/whatapredigo"\n  "github.com/whatap/go-api/trace"\n)\n\nfunc main() {\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  http.HandleFunc("/SetAndGetWithDialContext", func(w http.ResponseWriter, r *http.Request) {\n    // Context\uB97C \uC0DD\uC131\uD569\uB2C8\uB2E4.\n    ctx, _ := trace.StartWithRequest(r)\n    defer trace.End(ctx, nil)\n\n    // whtapredigo\uB97C \uD1B5\uD574 redis connection\uC744 \uC0DD\uC131\uD569\uB2C8\uB2E4.\n    conn, err := whatapredigo.DialContext(ctx, "tcp", "127.0.0.1:6379")\n    if err != nil {\n      trace.Error(ctx, err)\n      return\n    }\n    defer conn.Close()\n\n    _, err = conn.Do("SET", "DataKey", "DataValue")\n    if err != nil {\n      trace.Error(ctx, err)\n      return\n    }\n\n    data, err := redis.Bytes(conn.Do("GET", "DataKey"))\n    if err != nil {\n      trace.Error(ctx, err)\n      return\n    }\n  })\n}\n'})}),(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/whatap/go-api-example/tree/main/github.com/gomodule/redigo",children:"\uCC38\uC870 \uC608\uC81C"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(e.h3,{id:"githubcomshopifysarama-\uB77C\uC774\uBE0C\uB7EC\uB9AC-\uC9C0\uC6D0",children:"github.com/shopify/sarama \uB77C\uC774\uBE0C\uB7EC\uB9AC \uC9C0\uC6D0"}),(0,a.jsx)(e.p,{children:"sarama \uD504\uB808\uC784\uC6CC\uD06C\uB97C \uD1B5\uD574\uC11C \uCC98\uB9AC\uB418\uB294 kafka produce, consume \uC774\uBCA4\uD2B8\uB97C \uCD94\uC801\uD569\uB2C8\uB2E4."})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"async-producer-\uCD94\uC801",children:"async producer \uCD94\uC801"}),(0,a.jsx)(e.p,{children:"whatapsarama\uC758 Interceptor\uB97C \uD1B5\uD574 async producer \uC815\uBCF4\uB97C \uCD94\uC801\uD569\uB2C8\uB2E4. Producer Message \uC0DD\uC131\uC2DC Ctx \uAD00\uB828 \uC815\uBCF4\uB97C Metadata\uB97C \uD1B5\uD574 \uC804\uB2EC\uD558\uBA74 Multi Transaction\uC73C\uB85C \uC5F0\uACB0 \uB429\uB2C8\uB2E4."}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "context"\n  "net/http"\n  "github.com/Shopify/sarama"\n  "github.com/whatap/go-api/instrumentation/github.com/Shopify/sarama/whatapsarama"\n  "github.com/whatap/go-api/trace"\n)\n\nfunc main() {\n  config := sarama.NewConfig()\n  brokers := []string{"127.0.0.1:9092"} //config kafka broker IP/Port\n\n  // whatapsarama\uC758 \uC778\uD130\uB7FD\uD2B8\uB97C config\uC5D0 \uB4F1\uB85D\uD569\uB2C8\uB2E4.\n  interceptor := whatapsarama.Interceptor{Brokers: brokers}\n  config.Producer.Interceptors = []sarama.ProducerInterceptor{&interceptor}\n\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  // Prdoducer \uC0DD\uC131\uC2DC config\uB97C \uC804\uB2EC\uD569\uB2C8\uB2E4.\n  producer, err := sarama.NewAsyncProducer(brokers, config)\n  consumerOffset := sarama.OffsetOldest\n  if err != nil {\n    panic(err)\n  }\n  defer func() {\n    if err := producer.Close(); err != nil {\n      panic(err)\n    }\n  }()\n\n  http.HandleFunc("/AsyncProduceInput", func(w http.ResponseWriter, r *http.Request) {\n    ctx, _ := trace.StartWithRequest(r)\n    defer func() {\n      trace.End(ctx, nil)\n    }()\n    msg := &sarama.ProducerMessage{\n      Topic:    "tmp-topic",\n      Key:      sarama.StringEncoder("Data Key"),\n      Value:    sarama.StringEncoder("Data Value"),\n      Metadata: trace.GetMTrace(ctx),\n    }\n    producer.Input() <- msg //error check\n\n  })\n\n  _ = http.ListenAndServe(fmt.Sprintf(":%d", port), nil)\n}\n'})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"consumer-\uCD94\uC801",children:"consumer \uCD94\uC801"}),(0,a.jsx)(e.p,{children:"whatapsarama\uC758 Interceptor\uB97C \uD1B5\uD574 consumer \uC815\uBCF4\uB97C \uCD94\uC801\uD569\uB2C8\uB2E4. Produce\uC5D0\uC11C \uC804\uB2EC\uB41C Message \uAE30\uC900\uC73C\uB85C Multi Transaction\uC73C\uB85C \uC5F0\uACB0 \uB429\uB2C8\uB2E4."}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "context"\n  "flag"\n  "fmt"\n  "net/http"\n  "text/template"\n\n  "github.com/Shopify/sarama"\n  "github.com/whatap/go-api/instrumentation/github.com/Shopify/sarama/whatapsarama"\n  "github.com/whatap/go-api/trace"\n)\n\nfunc main() {\n  config := sarama.NewConfig()\n  brokers := []string{"127.0.0.1:9092"} //config kafka broker IP/Port\n\n  // whatapsarama\uC758 \uC778\uD130\uB7FD\uD2B8\uB97C config\uC5D0 \uB4F1\uB85D\uD569\uB2C8\uB2E4.\n  interceptor := whatapsarama.Interceptor{Brokers: brokers}\n  config.Consumer.Interceptors = []sarama.ConsumerInterceptor{&interceptor}\n\n  // consume 1\uD68C\uB2F91tx\n  // Consumer \uC0DD\uC131\uC2DC config\uB97C \uC804\uB2EC\uD569\uB2C8\uB2E4.\n  consumer, err := sarama.NewConsumer(brokers, config)\n  topic := "tmp-topic"\n\n  partitions, _ := consumer.Partitions(topic)\n  consume, _ := consumer.ConsumePartition(topic, partitions[0], consumerOffset)\n\n  if consume == nil {\n    fmt.Println("consume nil")\n    return\n  }\n\n  go func() {\n    for {\n      select {\n      case msg := <-consume.Messages():\n        fmt.Println(msg)\n      case consumerError := <-consume.Errors():\n        fmt.Println("error", consumerError)\n        return\n      }\n    }\n  }()\n}\n'})}),(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/whatap/go-api-example/tree/main/github.com/shopify/sarama",children:"\uCC38\uC870 \uC608\uC81C"})})]})]})}function d(n={}){let{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(l,{...n})}):l(n)}},60372:function(n,e,t){t.d(e,{Z:function(){return a}});var r=t(85893);function a(n){let{children:e,priority:t}=n;return t?(0,r.jsx)("code",{className:e,type:t,children:e}):(0,r.jsx)("code",{className:e,children:e})}t(67294)},98009:function(n,e,t){t.d(e,{Z:function(){return a}});var r=t(85893);function a(n){let{children:e}=n;return(0,r.jsx)("span",{className:"uitext",children:e})}t(67294)},50065:function(n,e,t){t.d(e,{Z:function(){return s},a:function(){return o}});var r=t(67294);let a={},i=r.createContext(a);function o(n){let e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:o(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);