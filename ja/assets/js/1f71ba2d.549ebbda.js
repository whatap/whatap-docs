"use strict";(self.webpackChunkwhatap_docs=self.webpackChunkwhatap_docs||[]).push([["15032"],{7683:function(e,t,n){n.r(t),n.d(t,{metadata:()=>r,default:()=>h,frontMatter:()=>c,contentTitle:()=>i,toc:()=>o,assets:()=>l});var r=JSON.parse('{"id":"golang/api-guide","title":"API\u30AC\u30A4\u30C9","description":"Go\u30E9\u30A4\u30D6\u30E9\u30EA\u30FC\u3092\u5229\u7528\u3057\u3066\u3001WhaTap\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u306B\u30E2\u30CB\u30BF\u30EA\u30F3\u30B0\u3059\u308B\u30C7\u30FC\u30BF\u3092\u9001\u4FE1\u3067\u304D\u307E\u3059\u3002","source":"@site/i18n/ja/docusaurus-plugin-content-docs/current/golang/api-guide.mdx","sourceDirName":"golang","slug":"/golang/api-guide","permalink":"/whatap-docs/ja/golang/api-guide","draft":false,"unlisted":false,"editUrl":"undefined/docs/golang/api-guide.mdx","tags":[],"version":"current","frontMatter":{"id":"api-guide","title":"API\u30AC\u30A4\u30C9","description":"Go\u30E9\u30A4\u30D6\u30E9\u30EA\u30FC\u3092\u5229\u7528\u3057\u3066\u3001WhaTap\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u306B\u30E2\u30CB\u30BF\u30EA\u30F3\u30B0\u3059\u308B\u30C7\u30FC\u30BF\u3092\u9001\u4FE1\u3067\u304D\u307E\u3059\u3002","keywords":["Go","API\u30AC\u30A4\u30C9","\u30E9\u30A4\u30D6\u30E9\u30EA"],"isTranslationMissing":false},"sidebar":"goSidebar","previous":{"title":"Docker\u74B0\u5883\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB","permalink":"/whatap-docs/ja/golang/install-agent-docker"},"next":{"title":"\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u30C1\u30A7\u30C3\u30AF\u30EA\u30B9\u30C8","permalink":"/whatap-docs/ja/golang/install-check"}}'),a=n(74848),s=n(84429);let c={id:"api-guide",title:"API\u30AC\u30A4\u30C9",description:"Go\u30E9\u30A4\u30D6\u30E9\u30EA\u30FC\u3092\u5229\u7528\u3057\u3066\u3001WhaTap\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u306B\u30E2\u30CB\u30BF\u30EA\u30F3\u30B0\u3059\u308B\u30C7\u30FC\u30BF\u3092\u9001\u4FE1\u3067\u304D\u307E\u3059\u3002",keywords:["Go","API\u30AC\u30A4\u30C9","\u30E9\u30A4\u30D6\u30E9\u30EA"],isTranslationMissing:!1},i,l={},o=[{value:"\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9",id:"\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9",level:2},{value:"\u306F\u3058\u3081\u306B",id:"\u306F\u3058\u3081\u306B",level:2},{value:"init\u3001shutdown",id:"initshutdown",level:3},{value:"Context",id:"context",level:3},{value:"\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306E\u4F5C\u6210",id:"\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306E\u4F5C\u6210",level:4},{value:"\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306E\u30C8\u30EC\u30FC\u30B9",id:"\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306E\u30C8\u30EC\u30FC\u30B9",level:2},{value:"Web\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1",id:"web\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1",level:3},{value:"\u4E00\u822C\u7684\u306A\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1",id:"\u4E00\u822C\u7684\u306A\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1",level:3},{value:"API",id:"api",level:3},{value:"DB\u63A5\u7D9A\u304A\u3088\u3073SQL\u8FFD\u8DE1",id:"db\u63A5\u7D9A\u304A\u3088\u3073sql\u8FFD\u8DE1",level:2},{value:"DB Connection",id:"db-connection",level:3},{value:"database/sql\u30D1\u30C3\u30B1\u30FC\u30B8\u306E\u8A2D\u5B9A",id:"databasesql\u30D1\u30C3\u30B1\u30FC\u30B8\u306E\u8A2D\u5B9A",level:3},{value:"API",id:"api-1",level:3},{value:"HTTP\u30EA\u30AF\u30A8\u30B9\u30C8\u8FFD\u8DE1",id:"http\u30EA\u30AF\u30A8\u30B9\u30C8\u8FFD\u8DE1",level:2},{value:"http transport RoundTrip",id:"http-transport-roundtrip",level:3},{value:"API",id:"api-2",level:3},{value:"\u30DE\u30EB\u30C1\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1(\u5206\u6563\u8FFD\u8DE1)",id:"mtrace",level:2},{value:"\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u8A2D\u5B9A",id:"\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u8A2D\u5B9A",level:3},{value:"Request Header\u3092\u6E21\u3059",id:"request-header\u3092\u6E21\u3059",level:3},{value:"HTTP\u63A5\u7D9A\u6642\u306BHeader\u60C5\u5831\u3092\u8FFD\u52A0\u3059\u308B",id:"http\u63A5\u7D9A\u6642\u306Bheader\u60C5\u5831\u3092\u8FFD\u52A0\u3059\u308B",level:3},{value:"\u81EA\u52D5\u7684\u306B\u30D8\u30C3\u30C0\u30FC\u3092\u8FFD\u52A0\u3059\u308B",id:"\u81EA\u52D5\u7684\u306B\u30D8\u30C3\u30C0\u30FC\u3092\u8FFD\u52A0\u3059\u308B",level:3},{value:"\u30E1\u30BD\u30C3\u30C9\u8FFD\u8DE1",id:"\u30E1\u30BD\u30C3\u30C9\u8FFD\u8DE1",level:2},{value:"API",id:"api-3",level:3},{value:"Log",id:"log",level:2},{value:"\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u8A2D\u5B9A",id:"\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u8A2D\u5B9A-1",level:3},{value:"\u30ED\u30B0\u30E9\u30A4\u30D6\u30E9\u30EA\u306E\u521D\u671F\u5316\u524D",id:"\u30ED\u30B0\u30E9\u30A4\u30D6\u30E9\u30EA\u306E\u521D\u671F\u5316\u524D",level:3},{value:"\u30ED\u30B0\u30E9\u30A4\u30D6\u30E9\u30EA\u306E\u521D\u671F\u5316\u5F8C",id:"\u30ED\u30B0\u30E9\u30A4\u30D6\u30E9\u30EA\u306E\u521D\u671F\u5316\u5F8C",level:3},{value:"API",id:"api-4",level:3},{value:"log package",id:"log-package",level:4},{value:"go.uber.org/zap",id:"gouberorgzap",level:4},{value:"github.com/sirupsen/logrus",id:"githubcomsirupsenlogrus",level:4}];function d(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",section:"section",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t.p,{children:["\u3053\u306E\u6587\u66F8\u3067\u8A18\u8FF0\u3055\u308C\u3066\u3044\u308B\u4F8B\u984C\u30B3\u30FC\u30C9\u306F\u3001",(0,a.jsx)(t.a,{href:"https://github.com/whatap/go-api-example",children:"github.com/whatap/go-api-example"}),"\u4FDD\u5B58\u5834\u6240\u3067\u78BA\u8A8D\u3067\u304D\u307E\u3059\u3002"]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(t.h2,{id:"\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9",children:"\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9"}),(0,a.jsx)(t.p,{children:"\u30D1\u30C3\u30B1\u30FC\u30B8\u304A\u3088\u3073\u95A2\u9023\u5F93\u5C5E\u6027(dependency)\u3092\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u3057\u3066\u304F\u3060\u3055\u3044\u3002"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"go get github.com/whatap/go-api\n"})})]}),"\n",(0,a.jsx)(t.section,{className:"remark-sectionize-h2",children:(0,a.jsx)(t.h2,{id:"\u306F\u3058\u3081\u306B",children:"\u306F\u3058\u3081\u306B"})}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"initshutdown",children:"init\u3001shutdown"}),(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"trace.Init()"}),"\u30E1\u30BD\u30C3\u30C9\u3092\u4F7F\u7528\u3057\u3066\u30E2\u30CB\u30BF\u30EA\u30F3\u30B0\u30E2\u30B8\u30E5\u30FC\u30EB\u3092\u8D77\u52D5\u3057\u3066\u304F\u3060\u3055\u3044\u3002 ",(0,a.jsx)(t.code,{children:"defer trace.Shutdown()"}),"\u3067\u30E2\u30CB\u30BF\u30EA\u30F3\u30B0\u7D42\u4E86\u3092\u4FDD\u8A3C\u3057\u307E\u3059\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",metastring:'title="Go"',children:'import "github.com/whatap/go-api/trace"\n\nfunc main(){\n    trace.Init(nil)\n    //It must be executed before closing the app.\n    defer trace.Shutdown()\n\n    ...\n}\n\nfunc Init(m map[string]string)\n'})}),(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"map[string]string"}),"\u5F62\u5F0F\u3092\u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u306E\u521D\u671F\u306B\u8A2D\u5B9A\u3067\u304D\u307E\u3059\u3002 \u307E\u305F\u306F\u3001",(0,a.jsx)(t.em,{children:"whatap.conf"}),"\u30D5\u30A1\u30A4\u30EB\u306B\u8A2D\u5B9A\u3067\u304D\u307E\u3059\u3002 \u6027\u80FD\u60C5\u5831\u3092WhaTap\u53CE\u96C6\u30B5\u30FC\u30D0\u30FC\u306B\u9001\u308B\u305F\u3081\u306B\u306F\u3001\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u304B\u3089TCP\u63A5\u7D9A\u304C\u6B63\u5E38\u306B\u884C\u308F\u308C\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002 \u30C7\u30D5\u30A9\u30EB\u30C8\u63A5\u7D9A\u60C5\u5831\u3068\u3057\u3066",(0,a.jsx)(t.strong,{children:"127.0.0.1:6600"}),"\u3092\u901A\u3058\u3066TCP\u3067\u901A\u4FE1\u3057\u307E\u3059\u3002"]}),(0,a.jsxs)(t.p,{children:["\u63A5\u7D9A\u60C5\u5831\u3092\u5909\u66F4\u3059\u308B\u306B\u306F\u3001",(0,a.jsx)(t.code,{children:"Init"}),"\u30E1\u30BD\u30C3\u30C9\u306B\u8A2D\u5B9A\u3092\u4F1D\u3048\u308B\u304B",(0,a.jsx)(t.em,{children:"whatap.conf"})," \u30D5\u30A1\u30A4\u30EB\u306B\u8A2D\u5B9A\u3057\u3001\u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u3092\u518D\u8D77\u52D5\u3057\u3066\u304F\u3060\u3055\u3044\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'m := make(map[string]string)\nm["net_ipc_host"] = "127.0.0.1"\nm["net_ipc_port"] = "6601"\n\ntrace.Init(m)\n'})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ini",metastring:'title="whatap.conf"',children:"accesskey={\u30A2\u30AF\u30BB\u30B9\u30AD\u30FC}\nwhatap.server.host={\u53CE\u96C6\u30B5\u30FC\u30D0\u30FC\u306EIP\u30A2\u30C9\u30EC\u30B9}\nnet_ipc_host=127.0.0.1\nnet_ipc_host=6600\n"})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"context",children:"Context"}),(0,a.jsxs)(t.p,{children:["\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u306F\u3001\u6027\u80FD\u60C5\u5831\u3092\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u5358\u4F4D\u3067\u53CE\u96C6\u3057\u307E\u3059\u3002 \u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306E\u533A\u5206\u306F\u3001",(0,a.jsx)(t.code,{children:"whatap context(trace.TraceCtx)"}),"\u304C\u542B\u307E\u308C\u305F",(0,a.jsx)(t.code,{children:"context"}),"\u3092\u57FA\u6E96\u306B\u3057\u307E\u3059\u3002 \u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306B\u9023\u643A\u3055\u308C\u3066\u3044\u306A\u3044\u6027\u80FD\u60C5\u5831\u306F\u3001\u53CE\u96C6\u3092\u7121\u8996\u3059\u308B\u304B\u3001\u7D71\u8A08\u60C5\u5831\u3067\u306E\u307F\u53CE\u96C6\u3057\u307E\u3059\u3002"]})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(t.h4,{id:"\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306E\u4F5C\u6210",children:"\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306E\u4F5C\u6210"}),(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"go-api/trace"}),"\u30E2\u30B8\u30E5\u30FC\u30EB\u306E",(0,a.jsx)(t.code,{children:"Start"}),", ",(0,a.jsx)(t.code,{children:"StartWithReqest"}),"\u30E1\u30BD\u30C3\u30C9\u3067",(0,a.jsx)(t.code,{children:"whatap context"}),"\u3092\u4F5C\u6210\u3057\u307E\u3059\u3002 ",(0,a.jsx)(t.code,{children:"context"}),"\u5185\u90E8\u306B",(0,a.jsx)(t.code,{children:"whatap"}),"\u30AD\u30FC\u3067",(0,a.jsx)(t.code,{children:"TraceCtx"}),"\u60C5\u5831\u3092\u8A2D\u5B9A\u3057\u307E\u3059\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'var traceCtx *TraceCtx\ntraceCtx.Txid = keygen.Next()\nctx = context.WithValue(ctx, "whatap", traceCtx)\n'})}),(0,a.jsxs)(t.p,{children:["\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u3001SQL\u3001DBConnection\u3001\u5916\u90E8HTTP request\u3001\u4E00\u822C\u30E1\u30BD\u30C3\u30C9\u8FFD\u8DE1\u306A\u3069\u306EAPI\u3067\u306E\u958B\u59CB\u6642\u70B9\u306F\u5FC5\u305A",(0,a.jsx)(t.code,{children:"whatap"}),"\u30AD\u30FC\u3067",(0,a.jsx)(t.code,{children:"TraceCtx"}),"\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u304C\u3042\u308B",(0,a.jsx)(t.code,{children:"Context"}),"\u304C\u5FC5\u8981\u3067\u3059\u3002"]})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(t.h2,{id:"\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306E\u30C8\u30EC\u30FC\u30B9",children:"\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306E\u30C8\u30EC\u30FC\u30B9"}),(0,a.jsxs)(t.p,{children:["Web\u30EA\u30AF\u30A8\u30B9\u30C8\u3068\u5FDC\u7B54\u307E\u3067\u306E\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u3068\u4E00\u822C\u7684\u306A\u30BF\u30B9\u30AF\u5358\u4F4D\u306E\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306E\u4E21\u65B9\u3092\u8FFD\u8DE1\u3057\u307E\u3059\u3002 \u958B\u59CB\u304A\u3088\u3073\u7D42\u4E86\u306E\u30E1\u30BD\u30C3\u30C9\u3067\u69CB\u6210\u3055\u308C\u3066\u3044\u307E\u3059\u3002 \u4E00\u3064\u306E\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u3068\u3057\u3066\u8A8D\u8B58\u3055\u308C\u3001",(0,a.jsx)(t.strong,{children:(0,a.jsx)(t.em,{children:"\u30D2\u30C3\u30C8\u30DE\u30C3\u30D7"})}),"\u30A6\u30A3\u30BC\u30C3\u30C8\u3067\u8A73\u7D30\u3084TPS\u3001\u5FDC\u7B54\u6642\u9593\u3001\u5E73\u5747\u5FDC\u7B54\u6642\u9593\u306A\u3069\u306E\u7D71\u8A08\u6307\u6A19\u3092\u78BA\u8A8D\u3059\u308B\u3053\u3068\u304C\u3067\u304D\u307E\u3059\u3002"]}),(0,a.jsx)(t.p,{children:"\u8A2D\u5B9A\u3092\u901A\u3058\u3066HTTP\u30D1\u30E9\u30E1\u30FC\u30BF\u3001HTTP\u30D8\u30C3\u30C0\u30FC\u60C5\u5831\u3092\u53CE\u96C6\u3067\u304D\u307E\u3059\u3002"})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"web\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1",children:"Web\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'http.HandleFunc("/index", func(w http.ResponseWriter, r *http.Request) {\n    ctx, _ := trace.StartWithRequest(r)\n    defer trace.End(ctx, nil)\n}\n'})}),(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"trace.Func()"}),", ",(0,a.jsx)(t.code,{children:"trace.HandlerFunc()"})]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"net/http"}),"\u306EHandle\u3001HandFunc\u3092\u30E9\u30C3\u30D4\u30F3\u30B0\u3057\u305F\u30E1\u30BD\u30C3\u30C9"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"trace.StartWithRequest"}),"\u3001",(0,a.jsx)(t.code,{children:"trace.End"}),"\u3092\u540C\u4E00\u306B\u9032\u884C\u3057\u307E\u3059\u3002"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"\u30A6\u30A7\u30D6\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u306E\u540D\u524D\u306F\u3001RequestURI\u3067\u8A2D\u5B9A\u3067\u304D\u307E\u3059\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.code,{children:"trace.Step()"})}),"\n",(0,a.jsx)(t.p,{children:"\u30E6\u30FC\u30B6\u30FC\u304C\u9001\u308B\u6587\u5B57\u5217\u3092\u30D7\u30ED\u30D5\u30A1\u30A4\u30EB\u60C5\u5831\u306B\u51FA\u529B\u3059\u308B\u6A5F\u80FD\u3092\u63D0\u4F9B\u3057\u307E\u3059\u3002"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'http.HandleFunc("/wrapHandleFunc", trace.Func(func(w http.ResponseWriter, r *http.Request) {\n    ...\n}))\n'})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'http.Handle("/wrapHandleFunc1", trace.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    ...\n}))\n'})}),"\n"]}),"\n"]})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"\u4E00\u822C\u7684\u306A\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1",children:"\u4E00\u822C\u7684\u306A\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'func main() {\n    ...\n\n    ctx := context.Background()\n    ctx, _ := trace.Start(ctx, "Custom Transaction")\n\n    ...\n\n    trace.End(ctx, nil)\n\n    ...\n}\n'})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"api",children:"API"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func Start(ctx context.Context, name string) (context.Context, error)\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func End(ctx context.Context, err error) error\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func StartWithRequest(r *http.Request) (context.Context, error)\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func Step(ctx context.Context, title, message string, elapsed, value int) error\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func HandlerFunc(handler func(http.ResponseWriter, *http.Request)) http.HandlerFunc\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func Func(handler func(http.ResponseWriter, *http.Request)) func(http.ResponseWriter, *http.Request)\n"})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(t.h2,{id:"db\u63A5\u7D9A\u304A\u3088\u3073sql\u8FFD\u8DE1",children:"DB\u63A5\u7D9A\u304A\u3088\u3073SQL\u8FFD\u8DE1"}),(0,a.jsx)(t.p,{children:"DB\u63A5\u7D9A\u60C5\u5831\u3001sql\u69CB\u6587\u3001error\u304A\u3088\u3073prepared\u69CB\u6587\u306E\u305F\u3081\u306E\u30D1\u30E9\u30E1\u30FC\u30BF\u3092API\u306B\u9001\u308B\u3068\u3001\u5B9F\u884C\u6642\u9593\u304A\u3088\u3073\u30A8\u30E9\u30FC\u4E8B\u9805\u3092\u53CE\u96C6\u3067\u304D\u307E\u3059\u3002 SQL\u69CB\u6587\u306F\u6700\u592732KB\u307E\u3067\u53CE\u96C6\u3057\u307E\u3059\u3002 SQL Prepared\u69CB\u6587\u306E\u305F\u3081\u306E\u30D1\u30E9\u30E1\u30FC\u30BF\u306F\u6700\u592720\u500B\u3001\u305D\u308C\u305E\u308C256byte\u307E\u3067\u53CE\u96C6\u3057\u307E\u3059\u3002"})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"db-connection",children:"DB Connection"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'import (\n    whatapsql "github.com/whatap/go-api/sql"\n)\n\nfunc main(){\n    trace.Init(nil)\n    //It must be executed before closing the app.\n    defer trace.Shutdown()\n    \n    ctx, _ := trace.Start(context.Background(), "Trace Open DB")\n    defer trace.End(ctx, nil)\n    \n    sqlCtx, _ := whatapsql.StartOpen(ctx, "id@tcp(x.x.x.x:3306)/test")\n    db, err := sql.Open("mysql", "id:pwd@tcp(x.x.x.x:3306)/test")\n    whatapsql.End(sqlCtx, err)\n    defer db.Close()\n}\n'})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'import (\n    whatapsql "github.com/whatap/go-api/sql"\n)\n\nfunc main(){\n    trace.Init(nil)\n    //It must be executed before closing the app.\n    defer trace.Shutdown()\n    \n    ctx, _ := trace.Start(context.Background(), "Trace Query")\n    defer trace.End(ctx, nil)\n    \n    query = "select id, subject from tbl_faq limit 10"\n    sqlCtx, _ = whatapsql.Start(ctx, "id:pwd@tcp(x.x.x.x:3306)/test", query)\n    rows, err := db.QueryContext(ctx, query)\n    whatapsql.End(sqlCtx, err)\n}\n'})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'import (\n    whatapsql "github.com/whatap/go-api/sql"\n)\n\nfunc main(){\n    trace.Init(nil)\n    //It must be executed before closing the app.\n    defer trace.Shutdown()\n    \n    ctx, _ := trace.Start(context.Background(), "Trace Prepared Statement")\n    defer trace.End(ctx, nil)\n    \n    // Prepared Statement \u4F5C\u6210\n    query = "select id, subject from tbl_faq where id = ? limit ?"\n    stmt, err := db.Prepare(query)\n    if err != nil {\n      return\n    }\n    defer stmt.Close()\n    \n    params := make([]interface{}, 0)\n    params = append(params, 8)\n    params = append(params, 1)\n    \n    sqlCtx, _ := whatapsql.StartWithParamArray(ctx, "id:pwd(x.x.x.x:3306)/test", query, params)\n    rows, err := stmt.QueryContext(ctx, params...)\n    whatapsql.End(sqlCtx, err)\n    \n\n    sqlCtx, _ = whatapsql.StartWithParam(ctx, "id:pwd(x.x.x.x:3306)/test", query, params...)\n    rows, err := stmt.QueryContext(ctx, params...)\n    whatapsql.End(sqlCtx, err)\n}\n'})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"databasesql\u30D1\u30C3\u30B1\u30FC\u30B8\u306E\u8A2D\u5B9A",children:"database/sql\u30D1\u30C3\u30B1\u30FC\u30B8\u306E\u8A2D\u5B9A"}),(0,a.jsxs)(t.p,{children:["database/sql\u30D1\u30C3\u30B1\u30FC\u30B8\u306E",(0,a.jsx)(t.code,{children:"sql.Open"}),"\u30E1\u30BD\u30C3\u30C9\u306E\u4EE3\u308F\u308A\u306B\u3001",(0,a.jsx)(t.code,{children:"whatapsql.OpenContext"}),"\u30E1\u30BD\u30C3\u30C9\u3092\u4F7F\u3044\u307E\u3059\u3002 ",(0,a.jsx)(t.code,{children:"PrepareContext"}),"\u3001",(0,a.jsx)(t.code,{children:"QueryContext"}),"\u3001",(0,a.jsx)(t.code,{children:"ExecContext"}),"\u306A\u3069",(0,a.jsx)(t.code,{children:"context"}),"\u3092\u9001\u308B\u30E1\u30BD\u30C3\u30C9\u3067\u4F7F\u7528\u3059\u308B\u3053\u3068\u3092\u304A\u52E7\u3081\u3057\u307E\u3059\u3002 \u8EE2\u9001\u3059\u308B",(0,a.jsx)(t.code,{children:"context"}),"\u306F",(0,a.jsx)(t.code,{children:"trace.Start()"}),"\u3092\u901A\u3058\u3066\u3001WhaTap TraceCtx\u60C5\u5831\u304C\u5FC5\u8981\u3067\u3059\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'\nimport (\n    _ "github.com/go-sql-driver/mysql"\n    "github.com/whatap/go-api/instrumentation/database/sql/whatapsql"\n)\n\nfunc main() {\n    config := make(map[string]string)\n    trace.Init(config)\n    defer trace.Shutdown()\n\n    // whataphttp.Func\u5185\u90E8\u3067whatap TraceCtx\u3092\u4F5C\u6210\u3057\u307E\u3059\u3002\n    http.HandleFunc("/query", whataphttp.Func(func(w http.ResponseWriter, r *http.Request){\n      ctx := r.Context()\n    \n      // Use WhaTap Driver. whatap\u306ETraceCtx\u304C\u3042\u308Bcontext\u3092\u9001\u308A\u307E\u3059\u3002\n      db, err := whatapsql.OpenContext(ctx, "mysql", dataSource)\n      if err != nil {\n        fmt.Println("Error whatapsql.Open ", err)\n        return\n      }\n      defer db.Close()\n      \n      ...\n      query := "select id, subject from tbl_faq limit 10"\n      \n      // whatap TraceCtx\u304C\u3042\u308Bcontext\u3092\u9001\u308A\u307E\u3059\u3002\n      if rows, err := db.QueryContext(ctx, query); err == nil {\n        ...\n      }\n    }\n    ...\n}\n'})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"api-1",children:"API"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func Start(ctx context.Context, dbhost, sql string) (*SqlCtx, error)\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func StartOpen(ctx context.Context, dbhost string) (*SqlCtx, error)\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func End(sqlCtx *SqlCtx, err error) error\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func StartWithParam(ctx context.Context, dbhost, sql, param ...interface{}) (*SqlCtx, error)\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func StartWithParamArray(ctx context.Context, dbhost, sql string, param []interface{}) (*SqlCtx, error)\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func Trace(ctx context.Context, dbhost, sql, param string, elapsed int, err error) error\n"})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(t.h2,{id:"http\u30EA\u30AF\u30A8\u30B9\u30C8\u8FFD\u8DE1",children:"HTTP\u30EA\u30AF\u30A8\u30B9\u30C8\u8FFD\u8DE1"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'import (\n    "github.com/whatap/go-api/httc"\n)\n\nfunc main(){\n    trace.Init(nil)\n    //It must be executed before closing the app.\n    defer trace.Shutdown()\n\n    ctx, _ := trace.Start(context.Background(), "Trace Http Call")\n    defer trace.End(ctx, nil)\n\n    httpcCtx, _ := httpc.Start(ctx, callUrl)\n    resp, err := http.Get(callUrl)\n    if err == nil {\n        httpc.End(httpcCtx, resp.StatusCode, "", nil)\n    } else {\n        httpc.End(httpcCtx, 0, "", err)\n    }\n}\n'})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"http-transport-roundtrip",children:"http transport RoundTrip"}),(0,a.jsx)(t.p,{children:"RoundTrip\u3092\u8A2D\u5B9A\u3067\u304D\u307E\u3059\u3002"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'import (\n    "github.com/whatap/go-api/instrumentation/net/http/whataphttp"\n)\n\nfunc main() {\n    config := make(map[string]string)\n    trace.Init(config)\n    defer trace.Shutdown()\n\n    ctx, _ := trace.Start(context.Background(), "Http call")\n    defer trace.End(ctx, nil)\n\n    callUrl := "http://aaa.com/xxx"\n    client := http.DefaultClient\n    // Use WhaTap RoundTrip. Passes the context with whatap\'s TraceCtx.\n    client.Transport = whataphttp.NewRoundTrip(ctx, http.DefaultTransport)\n    resp, err := client.Get(callUrl)\n    if err != nil {\n        ...\n    }\n    defer resp.Body.Close()\n    ...\n}\n'})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"api-2",children:"API"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func Start(ctx context.Context, url string) (*HttpcCtx, error)\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func End(httpcCtx *HttpcCtx, status int, reason string, err error) error\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func Trace(ctx context.Context, host string, port int, url string, elapsed int, status int, reason string, err error) error\n"})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(t.h2,{id:"mtrace",children:"\u30DE\u30EB\u30C1\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1(\u5206\u6563\u8FFD\u8DE1)"}),(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"\u30DE\u30EB\u30C1\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3"}),"\u306F\u3001\u4ED6\u306E\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u3084\u30D7\u30ED\u30B8\u30A7\u30AF\u30C8\u306B\u95A2\u9023\u4ED8\u3051\u3089\u308C\u305F\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u3092\u610F\u5473\u3057\u307E\u3059\u3002 WhaTap\u30D7\u30ED\u30B8\u30A7\u30AF\u30C8\u306B\u767B\u9332\u3055\u308C\u305F\u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u30B5\u30FC\u30D3\u30B9\u9593\u306E\u547C\u3073\u51FA\u3057\u3092\u8FFD\u8DE1\u3059\u308B\u306E\u304C\u3001",(0,a.jsx)(t.strong,{children:"\u30DE\u30EB\u30C1\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1"}),"\u3067\u3059\u3002"]}),(0,a.jsxs)(t.admonition,{type:"note",children:[(0,a.jsxs)(t.p,{children:["Go\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u306F\u30013\u3064\u306EHTTP\u30D8\u30C3\u30C0\u30FC\u30AD\u30FC\u5024(",(0,a.jsx)(t.code,{children:"x-wtap-po"}),"\u3001",(0,a.jsx)(t.code,{children:"x-wtap-mst"}),"\u3001",(0,a.jsx)(t.code,{children:"x-wtap-sp1"}),")\u3067\u30DE\u30EB\u30C1\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u3092\u8FFD\u8DE1\u3057\u307E\u3059\u3002 \u30B2\u30FC\u30C8\u30A6\u30A7\u30A4\u3092\u901A\u904E\u3059\u308BHTTP\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u304C\u9023\u643A\u8FFD\u8DE1\u3055\u308C\u306A\u3044\u5834\u5408\u306F\u3001HTTP\u30D8\u30C3\u30C0\u30FC\u6761\u4EF6\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002"]}),(0,a.jsx)(t.p,{children:"\u30AA\u30FC\u30D7\u30F3\u30BD\u30FC\u30B9\u306E\u8FFD\u8DE1\u306E\u305F\u3081\u306BTraceContext\u306B\u5BFE\u5FDC\u3057\u307E\u3059\u3002 (traceparent\u30D8\u30C3\u30C0\u30FC\u8FFD\u8DE1)"})]})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u8A2D\u5B9A",children:"\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u8A2D\u5B9A"}),(0,a.jsxs)(t.p,{children:["\u30DE\u30EB\u30C1\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u8FFD\u8DE1\u306E\u305F\u3081\u306E\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u8A2D\u5B9A\u30D5\u30A1\u30A4\u30EB(",(0,a.jsx)(t.em,{children:"whatap.conf"}),")\u306B\u6B21\u306E\u3088\u3046\u306B\u30AA\u30D7\u30B7\u30E7\u30F3\u3092\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ini",metastring:'title="whatap.conf"',children:"# Activation option, Default: false\nmtrace_enabled=true\n\n# Sampling rate, Default: 10\nmtrace_rate=100\n"})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"request-header\u3092\u6E21\u3059",children:"Request Header\u3092\u6E21\u3059"}),(0,a.jsx)(t.p,{children:"\u5206\u6563\u8FFD\u8DE1\u60C5\u5831(\u30D8\u30C3\u30C0\u30FC\u60C5\u5831)\u3092\u78BA\u8A8D\u3059\u308B\u306B\u306F\u3001Request Header\u3092\u6E21\u3059\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'// import "github.com/whatap/go-api/trace"\nfunc UpdateMtrace(traceCtx *trace.TraceCtx, header http.Header) \n'})}),(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"trace.StartWithRequest"}),"\u95A2\u6570\u306F\u3001\u5185\u90E8\u7684\u306B",(0,a.jsx)(t.code,{children:"UpdateMtrace"}),"\u95A2\u6570\u3092\u547C\u3073\u51FA\u3057\u307E\u3059\u3002 ",(0,a.jsx)(t.code,{children:"trace.StartWithRequest"}),"\u95A2\u6570\u3092\u4F7F\u7528\u3057\u306A\u3044\u5834\u5408\u306F\u3001\u76F4\u63A5\u547C\u3073\u51FA\u3057\u3066\u53D7\u3051\u53D6\u3063\u305F\u30D8\u30C3\u30C0\u30FC\u60C5\u5831\u3092\u5206\u6790\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'// func GetTraceContext(ctx context.Context) (context.Context, *TraceCtx)\n// if v := ctx.Value("whatap"); v != nil {\n//      return ctx, v.(*TraceCtx)\n// }\nctx, traceCtx := trace.GetTraceContext(ctx);\nif traceCtx != nil {\n    trace.UpdateMtrace(traceCtx, header)\n}\n'})}),(0,a.jsxs)(t.admonition,{type:"note",children:[(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"trace.Start"}),"\u95A2\u6570\u306E\u5185\u90E8\u30B3\u30FC\u30C9\u53C2\u7167:"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go" showLineNumbers {6}',children:"func Start(ctx context.Context, name string) (context.Context, error) {\n    ctx, traceCtx := NewTraceContext(ctx)\n    traceCtx.Name = name\n    traceCtx.StartTime = dateutil.SystemNow()\n    // update multi trace info\n    UpdateMtrace(traceCtx, http.Header{})\n\n    ...\n"})}),(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"trace.StartWithRequest"}),"\u95A2\u6570\u306E\u5185\u90E8\u30B3\u30FC\u30C9\u53C2\u7167:"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go" showLineNumbers {6}',children:"func StartWithRequest(r *http.Request) (context.Context, error) {\n    ctx, traceCtx := NewTraceContext(r.Context())\n    traceCtx.Name = r.RequestURI\n    traceCtx.StartTime = dateutil.SystemNow()\n    // update multi trace info\n    UpdateMtrace(traceCtx, r.Header)\n\n    ...\n"})})]})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"http\u63A5\u7D9A\u6642\u306Bheader\u60C5\u5831\u3092\u8FFD\u52A0\u3059\u308B",children:"HTTP\u63A5\u7D9A\u6642\u306BHeader\u60C5\u5831\u3092\u8FFD\u52A0\u3059\u308B"}),(0,a.jsx)(t.p,{children:"\u5916\u90E8\u306BHTTP\u63A5\u7D9A\u3059\u308B\u3068\u304D\u3001Request Header\u306B\u8FFD\u8DE1\u306E\u305F\u3081\u306EHeader\u60C5\u5831\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go" showLineNumbers',children:'import (\n    "github.com/whatap/go-api/trace"\n)\n\nfunc GetMTrace(ctx context.Context) http.Header\n'})}),(0,a.jsxs)(t.p,{children:["\u6B21\u306F\u3001\u5206\u6563\u8FFD\u8DE1\u306B\u5FC5\u8981\u306A\u30D8\u30C3\u30C0\u30FC\u3092\u7167\u4F1A\u3059\u308B\u95A2\u6570\u3067\u3059\u3002 \u8FD4\u3055\u308C\u308B\u30D8\u30C3\u30C0\u30FC\u3092\u5916\u90E8\u30EA\u30AF\u30A8\u30B9\u30C8\u306B\u8FFD\u52A0\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002 context\u306B\u306F\u3001'whatap'\u9805\u76EE\u306E",(0,a.jsx)(t.code,{children:"trace.TraceContext"}),"\u60C5\u5831\u304C\u542B\u307E\u308C\u3066\u3044\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002 \u5F53\u8A72\u60C5\u5831\u306F\u3001",(0,a.jsx)(t.code,{children:"trace.Start"}),"\u3001",(0,a.jsx)(t.code,{children:"StartWithRequest"}),"\u3001",(0,a.jsx)(t.code,{children:"StartWithContext"}),"\u95A2\u6570\u3092\u4F7F\u7528\u3059\u308B\u969B\u306B\u3001\u5185\u90E8\u306Bwhatap context\u60C5\u5831\u304C\u8FFD\u52A0\u3055\u308C\u307E\u3059\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Example code" showLineNumbers {1}',children:"headers := trace.GetMTrace(wCtx)\nfor key, _ := range headers {\n    // req *http.Request\n    // The Add function is also available.\n    req.Header.Set(key, headers.Get(key))\n}\n"})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"\u81EA\u52D5\u7684\u306B\u30D8\u30C3\u30C0\u30FC\u3092\u8FFD\u52A0\u3059\u308B",children:"\u81EA\u52D5\u7684\u306B\u30D8\u30C3\u30C0\u30FC\u3092\u8FFD\u52A0\u3059\u308B"}),(0,a.jsxs)(t.p,{children:["Whatap transport(RoundTrip)\u306B\u306F\u3001\u5185\u90E8\u7684\u306B",(0,a.jsx)(t.code,{children:"GetMTrace"}),"\u3092\u4F7F\u7528\u3059\u308B\u30B3\u30FC\u30C9\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059\u3002 \u30AA\u30D7\u30B7\u30E7\u30F3\u3092\u6D3B\u6027\u5316\u3059\u308B\u3068\u3001\u81EA\u52D5\u7684\u306B\u30D8\u30C3\u30C0\u30FC\u60C5\u5831\u3092\u8FFD\u52A0\u3067\u304D\u307E\u3059\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Example code" showLineNumbers',children:'import (\n    "net/http"\n    "github.com/whatap/go-api/instrumentation/net/http/whataphttp"\n)\n\n...\n\n//client := http.DefaultClient\nclient := http.Client{\n    Timeout: timeout,\n}\nclient.Transport = whataphttp.NewRoundTrip(ctx, http.DefaultTransport)\nif resp, err := client.Get(callUrl); err == nil {\n    ...\n}\n'})}),(0,a.jsxs)(t.p,{children:["\u4EE5\u4E0B\u306F\u3001\u8907\u6570\u306ETransport\u4F7F\u7528\u4F8B\u3067\u3059\u3002 context\u306B\u306F\u3001'whatap'\u9805\u76EE\u306E",(0,a.jsx)(t.code,{children:"trace.TraceContext"}),"\u60C5\u5831\u304C\u542B\u307E\u308C\u3066\u3044\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Exmple code" showLineNumbers',children:'import (\n    "net/http"\n    "github.com/whatap/go-api/instrumentation/net/http/whataphttp"\n)\n\n...\n\nclient := http.DefaultClient\nclient.Transport = NewAccessLogRoundTrip(whataphttp.NewRoundTrip(ctx, http.DefaultTransport))	\n\n...\n'})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,a.jsx)(t.h2,{id:"\u30E1\u30BD\u30C3\u30C9\u8FFD\u8DE1",children:"\u30E1\u30BD\u30C3\u30C9\u8FFD\u8DE1"}),(0,a.jsx)(t.p,{children:"\u30E6\u30FC\u30B6\u30FC\u30E1\u30BD\u30C3\u30C9\u307E\u305F\u306F\u5E0C\u671B\u3059\u308B\u533A\u9593\u306E\u5B9F\u884C\u6642\u9593\u3092\u6E2C\u5B9A\u3059\u308B\u305F\u3081\u306EAPI\u3067\u3059\u3002 \u30E1\u30BD\u30C3\u30C9\u306E\u5B9F\u884C\u524D\u304A\u3088\u3073\u5F8C\u3067API\u3092\u8A2D\u5B9A\u3067\u304D\u307E\u3059\u3002"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:'import (\n    "github.com/whatap/go-api/method"\n)\nfunc main(){\n    trace.Init(nil)\n    //It must be executed before closing the app.\n    defer trace.Shutdown()\n  \n    ctx, _ := trace.Start(context.Background(), "Trace Method")\n    defer trace.End(ctx, nil)\n  \n    getUser(ctx)\n}\n\nfunc getUser(ctx context.Context) {\n    methodCtx, _ := method.Start(ctx, "getUser")\n    defer method.End(methodCtx, nil)\n    time.Sleep(time.Duration(1) * time.Second)\n}\n'})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"api-3",children:"API"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func Start(ctx context.Context, name string) (*MethodCtx, error)\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func End(methodCtx *MethodCtx, err error) error\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="Go"',children:"func Trace(ctx context.Context, name string, elapsed int, err error) error\n"})})]}),"\n",(0,a.jsx)(t.section,{className:"remark-sectionize-h2",children:(0,a.jsx)(t.h2,{id:"log",children:"Log"})}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u8A2D\u5B9A-1",children:"\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u8A2D\u5B9A"}),(0,a.jsxs)(t.p,{children:["\u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u5B9F\u884C\u524D\u306B",(0,a.jsx)(t.em,{children:"whatap.conf"}),"\u30D5\u30A1\u30A4\u30EB\u306B\u30A8\u30FC\u30B8\u30A7\u30F3\u30C8\u30AA\u30D7\u30B7\u30E7\u30F3\u3092\u8A2D\u5B9A\u307E\u3059\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ini",metastring:'title="whatap.conf"',children:"# Enable all log collection\nlogsink_enabled=true\n\n# Enable stdout collection\nlogsink_stdout_enabled=true\n\n# Enable stderr collection\nlogsink_stderr_enabled=true\n\n# Optional. This is a setting for compressing data. \nlogsin_zip_enabled=true\n"})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"\u30ED\u30B0\u30E9\u30A4\u30D6\u30E9\u30EA\u306E\u521D\u671F\u5316\u524D",children:"\u30ED\u30B0\u30E9\u30A4\u30D6\u30E9\u30EA\u306E\u521D\u671F\u5316\u524D"}),(0,a.jsxs)(t.p,{children:["\u30ED\u30B0\u30E9\u30A4\u30D6\u30E9\u30EA\u306E\u521D\u671F\u5316\u524D\u306B",(0,a.jsx)(t.code,{children:"trace.Init()"}),"\u95A2\u6570\u3092\u547C\u3073\u51FA\u3059\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002 \u5185\u90E8\u7684\u306B",(0,a.jsx)(t.code,{children:"os.Stdout"}),"\u3001",(0,a.jsx)(t.code,{children:"os.Stderr"}),"\u3092\u30E9\u30C3\u30D4\u30F3\u30B0\u3057\u307E\u3059\u3002 \u305D\u306E\u5F8C\u3001\u30ED\u30B0\u30E9\u30A4\u30D6\u30E9\u30EA\u304C",(0,a.jsx)(t.code,{children:"os.Stdout"}),"\u3001",(0,a.jsx)(t.code,{children:"os.Stderr"}),"\u3092\u8A2D\u5B9A\u3059\u308B\u3068\u3001\u81EA\u52D5\u7684\u306B\u30ED\u30B0\u3092\u53CE\u96C6\u3057\u307E\u3059\u3002"]})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"\u30ED\u30B0\u30E9\u30A4\u30D6\u30E9\u30EA\u306E\u521D\u671F\u5316\u5F8C",children:"\u30ED\u30B0\u30E9\u30A4\u30D6\u30E9\u30EA\u306E\u521D\u671F\u5316\u5F8C"}),(0,a.jsxs)(t.p,{children:["\u30ED\u30B0\u30E9\u30A4\u30D6\u30E9\u30EA\u306E\u521D\u671F\u5316\u5F8C\u306F\u3001\u5225\u306E\u8A2D\u5B9A\u95A2\u6570\u306B\u3088\u3063\u3066\u30E9\u30C3\u30D4\u30F3\u30B0\u3057\u305F",(0,a.jsx)(t.strong,{children:"io.Writer"}),"\u3092\u8A2D\u5B9A\u3067\u304D\u307E\u3059\u3002"]}),(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"logsink.GetWriterHookStdout()"}),"\uFF1A",(0,a.jsx)(t.code,{children:"os.Stderr"}),"\u3092\u30E9\u30C3\u30D4\u30F3\u30B0\u3057\u305F",(0,a.jsx)(t.strong,{children:"io.Writer"}),"\u3092\u8FD4\u3057\u307E\u3059\u3002 ",(0,a.jsx)(t.code,{children:"os.Stdout"}),"\u306B\u51FA\u529B\u3059\u308B\u3068\u540C\u6642\u306B\u3001\u305D\u306E\u30ED\u30B0\u3092WhaTap\u30ED\u30B0\u306B\u53CE\u96C6\u3057\u307E\u3059\u3002"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"logsink.GetWriterHookStderr()"}),"\uFF1A",(0,a.jsx)(t.code,{children:"os.Stderr"}),"\u3092\u30E9\u30C3\u30D4\u30F3\u30B0\u3057\u305F",(0,a.jsx)(t.strong,{children:"io.Writer"}),"\u3092\u8FD4\u3057\u307E\u3059\u3002 \u30E9\u30C3\u30D4\u30F3\u30B0\u3057\u305F",(0,a.jsx)(t.strong,{children:"io.Writer"}),"\u306F",(0,a.jsx)(t.code,{children:"os.Stderr"}),"\u306B\u51FA\u529B\u5F8C\u3001\u30ED\u30B0\u306E\u5185\u5BB9\u3092WhaTap\u30ED\u30B0\u306B\u53CE\u96C6\u3057\u307E\u3059\u3002"]}),"\n"]}),"\n"]})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(t.h3,{id:"api-4",children:"API"}),(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"os.Stdout"}),"\u3092\u30E9\u30C3\u30D4\u30F3\u30B0\u3057\u305F",(0,a.jsx)(t.strong,{children:"io.Writer"}),"\u3092\u8FD4\u3057\u307E\u3059\u3002"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",children:"func GetWriterHookStdout() io.Writer\n"})}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"os.Stderr"}),"\u3092\u30E9\u30C3\u30D4\u30F3\u30B0\u3057\u305F",(0,a.jsx)(t.strong,{children:"io.Writer"}),"\u3092\u8FD4\u3057\u307E\u3059\u3002"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",children:"func GetWriterHookStderr() io.Writer\n"})}),"\n"]}),"\n"]}),(0,a.jsx)(t.p,{children:"\u6B21\u306E\u30D1\u30C3\u30B1\u30FC\u30B8\u3054\u3068\u306E\u30B3\u30FC\u30C9\u4F8B\u3092\u53C2\u7167\u3057\u3066\u304F\u3060\u3055\u3044\u3002"})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(t.h4,{id:"log-package",children:"log package"}),(0,a.jsxs)(t.p,{children:["log\u30D1\u30C3\u30B1\u30FC\u30B8\u306F",(0,a.jsx)(t.strong,{children:"import"}),"\u6642\u70B9(",(0,a.jsx)(t.code,{children:"init"}),"\u95A2\u6570)\u3067",(0,a.jsx)(t.code,{children:"os.Stderr"}),"\u3092\u8A2D\u5B9A\u3057\u307E\u3059\u3002 ",(0,a.jsx)(t.code,{children:"trace.Init"}),"\u95A2\u6570\u3092\u5148\u306B\u547C\u3073\u51FA\u3059\u3053\u3068\u304C\u3067\u304D\u306A\u3044\u305F\u3081\u3001\u30E9\u30C3\u30D4\u30F3\u30B0\u3057\u305F",(0,a.jsx)(t.strong,{children:"io.Writer"}),"(",(0,a.jsx)(t.code,{children:"os.Stderr"}),")\u3092",(0,a.jsx)(t.code,{children:"log.SetOutput"}),"\u95A2\u6570\u3092\u901A\u3058\u3066\u8A2D\u5B9A\u3057\u307E\u3059\u3002"]}),(0,a.jsxs)(t.p,{children:["\u4EE5\u5F8C\u4F7F\u7528\u3055\u308C\u308Blog\u30D1\u30C3\u30B1\u30FC\u30B8\u306E",(0,a.jsx)(t.code,{children:"print"}),"\u95A2\u6570\u3092\u4F7F\u7528\u3057\u305F\u51FA\u529B\u306F\u3001\u30E9\u30C3\u30D4\u30F3\u30B0\u3057\u305F",(0,a.jsx)(t.strong,{children:"io.Writer"}),"\u3092\u901A\u3058\u3066",(0,a.jsx)(t.code,{children:"os.Stderr"}),"\u306B\u51FA\u529B\u306F\u7DAD\u6301\u3057\u306A\u304C\u3089\u3001\u540C\u6642\u306B\u30ED\u30B0\u5185\u5BB9\u3092WhaTap\u30ED\u30B0\u306B\u53CE\u96C6\u3057\u307E\u3059\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="log package"',children:'import (\n    "log"\n    "github.com/whatap/go-api/logsink"\n)\n\n...\n\nif logsink.GetWriterHookStderr() != nil {\n    // set single writer\n    log.SetOutput(logsink.GetWriterHookStderr())	\n    \n    // set multi writer \n    multi := io.MultiWriter(file, logsink.GetWriterFromStderr())\n    log.SetOutput(logsink.GetWriterHookStderr())\n}\n\n// \nlog.Println("aaaaa")\n...\n'})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(t.h4,{id:"gouberorgzap",children:"go.uber.org/zap"}),(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.code,{children:"os.Stdout"}),"\u3092\u8A2D\u5B9A\u3059\u308B\u524D\u306B",(0,a.jsx)(t.code,{children:"trace.Init()"}),"\u95A2\u6570\u3092\u547C\u3073\u51FA\u3059\u3068\u3001\u81EA\u52D5\u7684\u306B\u30ED\u30B0\u3092\u53CE\u96C6\u3057\u307E\u3059\u3002 ",(0,a.jsx)(t.code,{children:"os.Stdout"}),"\u51FA\u529B\u306F\u7DAD\u6301\u3057\u306A\u304C\u3089\u3001\u540C\u6642\u306BWhaTap\u30ED\u30B0\u306B\u53CE\u96C6\u3057\u307E\u3059\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="go.uber.org/zap"',children:'import (\n    "github.com/whatap/go-api/trace"\n    "github.com/whatap/go-api/logsink"\n    \n    "go.uber.org/zap"\n    "go.uber.org/zap/zapcore"\n)\n\nfunc main() {\n    trace.Init(nil)\n    //It must be executed before closing the app.\n    defer trace.Shutdown()\n\n    // fmt.Println("Logger stdout=", os.Stdout, zapcore.AddSync(os.Stdout))\n    consoleCore := zapcore.NewCore(\n        zapcore.NewConsoleEncoder(consoleEncoderConfig), \n        zapcore.AddSync(os.Stdout),                      \n        zap.InfoLevel,\n    )\n\n    // Menggabungkan core file dan console\n    core := zapcore.NewTee(consoleCore)\n    Log = zap.New(core, zap.AddCaller(), zap.AddStacktrace(zapcore.ErrorLevel))\n    Log.Info("logger started")\n\n    ...\n}\n'})})]}),"\n",(0,a.jsxs)(t.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(t.h4,{id:"githubcomsirupsenlogrus",children:"github.com/sirupsen/logrus"}),(0,a.jsxs)(t.p,{children:["\u30E9\u30C3\u30D4\u30F3\u30B0\u3057\u305F",(0,a.jsx)(t.strong,{children:"io.Writer"}),"\u3092\u8A2D\u5B9A\u3059\u308B\u3068\u3001",(0,a.jsx)(t.code,{children:"os.Stderr"}),"\u51FA\u529B\u306F\u7DAD\u6301\u3057\u306A\u304C\u3089\u3001\u540C\u6642\u306BWhaTap\u30ED\u30B0\u306B\u53CE\u96C6\u3057\u307E\u3059\u3002"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="github.com/sirupsen/logrus"',children:'package main\n\nimport (\n    "time"\n\n    log "github.com/sirupsen/logrus"\n\n    "github.com/whatap/go-api/logsink"\n    "github.com/whatap/go-api/trace"\n)\n\nfunc main() {\n    trace.Init(nil)\n    defer trace.Shutdown()\n\n    //In WhaTap, set io.Writer wrapping os.Stderr as the output of logrus\n    if logsink.GetWriterHookStderr() != nil {\n        log.SetOutput(logsink.GetWriterHookStderr())\n    }\n\n    for i := 0; i < 100; i++ {\n        log.WithFields(log.Fields{\n            "animal":  "tiger",\n            "habitat": "mountain",\n        }).Info("Index:[", i, "] A tiger appears")\n\n        time.Sleep(100 * time.Millisecond)\n    }\n}\n'})})]})]})}function h(e={}){let{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},84429:function(e,t,n){n.d(t,{R:()=>c,x:()=>i});var r=n(96540);let a={},s=r.createContext(a);function c(e){let t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);